import{r as l,H as Q,B as X,z as G,j as s,A as J,L as K}from"./vendor-20RkeJz5.js";import{b as O,S as W,c as Y,p as Z,o as ee}from"./icons-DMyrTxXs.js";import{u as se,s as h,a as te,b as ae}from"./index-DL2gia46.js";import"./utils-BTGVH9Kg.js";import"./state-WeFCiDx1.js";import"./animations-DaCnULhE.js";const I=({src:a,alt:c})=>{const[o,e]=l.useState(!1);return s.jsx("img",{src:a,alt:c,onLoad:()=>e(!0),className:`w-full h-full object-contain ${o?"fadeIn":"opacity-0"}`,loading:"eager",decoding:"async"})},ne=l.memo(({img:a,active:c,onClick:o})=>s.jsx("button",{onClick:o,className:`border rounded-lg overflow-hidden transition-all duration-300 ${c?"ring-2 ring-blue-500":""}`,children:s.jsx("img",{src:a,alt:"Превью товара",className:"w-full h-8 object-contain",loading:"lazy",width:40,height:40})})),le=({count:a,activeIndex:c,onChange:o})=>s.jsx("div",{className:"flex justify-center gap-2 mt-4",children:Array.from({length:a}).map((e,m)=>s.jsx("button",{onClick:()=>o(m),className:`w-2 h-2 rounded-full transition-all duration-300 ${m===c?"bg-blue-500 scale-125":"bg-gray-300 hover:bg-gray-400"}`},m))}),$=({rating:a,starSizeClass:c="w-5 h-5"})=>s.jsx("div",{className:"flex items-center",children:Array.from({length:5},(o,e)=>s.jsx(ee,{className:`${c} ${e<Math.floor(a)?"text-yellow-400 fill-current":"text-gray-300"}`},e))}),r=a=>a==null?!1:typeof a=="string"?a.trim()!=="":!0,i=a=>typeof a=="string"&&a.trim()!=="",T=a=>i(a)?a.toLowerCase()==="tire"?"Легковий":a:"",re=()=>{var k;const{id:a}=Q(),c=X(),o=G(),[e,m]=l.useState(null),[L,R]=l.useState(!0),[b,j]=l.useState(1),[d,x]=l.useState(0),U=se(t=>t.addItem),[v,y]=l.useState([]),[g,N]=l.useState(""),[w,_]=l.useState(5),[p,D]=l.useState(null),C=l.useCallback(async()=>{var t;if(a)try{const{data:n,error:u}=await h.from("products").select("*, reviews:reviews!product_id (id, rating)").eq("id",a).single();if(u)throw u;if(n){const H={...n,reviews_count:((t=n.reviews)==null?void 0:t.length)||0,rating:n.rating};m(H)}}catch(n){console.error("Error fetching product:",n),m(null)}finally{R(!1)}},[a]);l.useEffect(()=>{C()},[C]),l.useEffect(()=>{a&&(async()=>{const{data:n,error:u}=await h.from("reviews").select("id, product_id, comment, created_at, user_id, rating").eq("product_id",a).order("created_at",{ascending:!1});!u&&n&&y(n)})()},[a]),l.useEffect(()=>{(async()=>{const{data:{user:n}}=await h.auth.getUser();D(n)})()},[]);const S=l.useCallback(t=>{j(n=>Math.max(1,n+t))},[]),E=l.useCallback(t=>{x(t)},[]),M=async t=>{if(t.preventDefault(),!p){c("/auth",{state:{from:o.pathname}});return}if(!g.trim())return;const{data:n,error:u}=await h.from("reviews").insert([{product_id:a,comment:g,rating:w,user_id:p.id}]).select();!u&&n&&(y([n[0],...v]),N(""),_(5))},A=te(),{handleTouchStart:P,handleTouchMove:q,handleTouchEnd:B,handleTouchCancel:F}=ae({onSwipe:t=>{e&&(t==="left"&&d<e.image_url.length-1?x(d+1):t==="right"&&d>0&&x(d-1))}});if(L)return null;if(!e)return s.jsxs("div",{className:"bg-white min-h-screen flex flex-col justify-center items-center px-4 py-8",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Товар не знайдено"}),s.jsx("button",{onClick:()=>c("/"),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors",children:"На головну"})]});const V=i(e.country)&&e.country.length===2?e.country.toUpperCase():"US",f=[i(e.brand)?e.brand:"",i(e.model)?e.model:"",r(e.width)||r(e.profile)||r(e.diameter)?`${e.width??""}/${e.profile??""} R${e.diameter??""}`:"",r(e.load_index)||r(e.speed_index)?`${e.load_index??""}${e.speed_index??""}`:""].filter(Boolean).join(" "),z=[{label:"Тип:",value:T(e.type),condition:i(e.type)},{label:"Бренд:",value:e.brand,condition:i(e.brand)},{label:"Модель:",value:e.model,condition:i(e.model)},{label:"Розмір:",value:r(e.width)||r(e.profile)||r(e.diameter)?`${e.width??""}/${e.profile??""} R${e.diameter??""}`:"",condition:r(e.width)||r(e.profile)||r(e.diameter)},{label:"Сезон:",value:e.season==="winter"?"Зимові":e.season==="summer"?"Літні":e.season==="all-season"?"Всесезонні":"",condition:i(e.season)},{label:"Рік випуску:",value:e.year,condition:r(e.year)},{label:"Індекс Навантаження:",value:r(e.load_index)?typeof e.load_index=="string"?e.load_index.toUpperCase():String(e.load_index):"",condition:r(e.load_index)},{label:"Індекс Швидкості:",value:r(e.speed_index)?typeof e.speed_index=="string"?e.speed_index.toUpperCase():String(e.speed_index):"",condition:r(e.speed_index)},{label:"Шипи:",value:e.spikes!==void 0?e.spikes?"ТАК":"НІ":"",condition:e.spikes!==void 0},{label:"Зчеплення:",value:i(e.wet_grip)?typeof e.wet_grip=="string"?e.wet_grip.toUpperCase():String(e.wet_grip):"",condition:i(e.wet_grip)},{label:"Паливо:",value:i(e.fuel_efficiency)?typeof e.fuel_efficiency=="string"?e.fuel_efficiency.toUpperCase():String(e.fuel_efficiency):"",condition:i(e.fuel_efficiency)},{label:"Рівень шуму dB:",value:e.noise_level,condition:e.noise_level!==void 0}];return s.jsx("div",{className:"bg-white min-h-screen relative",children:s.jsxs("div",{className:"mx-auto px-4 py-8",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"relative",children:[e.image_url&&e.image_url.length>1?s.jsx("div",{className:"w-full  h-[320px] bg-white rounded-lg overflow-hidden",...A?{onTouchStart:P,onTouchMove:q,onTouchEnd:B,onTouchCancel:F}:{},children:s.jsx("div",{className:"flex h-full transition-transform duration-300 ease-in-out",style:{transform:`translateX(-${d*100}%)`},children:e.image_url.map(t=>s.jsx("div",{className:"w-full h-[300px] flex-shrink-0",children:s.jsx(I,{src:t,alt:f})},t))})}):s.jsx("div",{className:"w-full h-[300px] bg-white rounded-lg overflow-hidden",children:s.jsx(I,{src:((k=e.image_url)==null?void 0:k[0])||"",alt:f})}),e.image_url&&e.image_url.length>1&&s.jsxs(s.Fragment,{children:[s.jsx(le,{count:e.image_url.length,activeIndex:d,onChange:E}),s.jsx("div",{className:"mt-4 flex justify-center ",children:s.jsx("div",{className:"grid grid-cols-4 gap-2 w-60 ",children:e.image_url.map((t,n)=>s.jsx(ne,{img:t,active:d===n,onClick:()=>x(n)},t))})})]})]}),s.jsxs("div",{className:"md:origin-top-left inline-block md:text-[0.8rem]",children:[s.jsx("h1",{className:"text-xl font-bold mb-4",children:f}),s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx($,{rating:e.rating}),s.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",e.reviews_count," відгуків)"]}),s.jsxs("span",{className:"ml-4 text-sm text-gray-600",children:["Артикул: ",e.id.slice(0,8).toUpperCase()]})]}),s.jsxs("div",{className:"flex items-center gap-6 mb-2 text-sm text-gray-600",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:"Сезон:"}),e.season==="winter"?s.jsx(O,{className:"w-5 h-5 text-blue-600"}):e.season==="summer"?s.jsx(W,{className:"w-5 h-5 text-yellow-500"}):e.season==="all-season"?s.jsx(Y,{className:"w-5 h-5 text-green-600"}):null,s.jsx("span",{children:e.season==="winter"?"Зимові":e.season==="summer"?"Літні":e.season==="all-season"?"Всесезонні":""})]}),i(e.type)&&s.jsxs("div",{className:"flex items-center gap-2 ml-10",children:[s.jsx("span",{children:"Тип:"}),s.jsx("span",{children:T(e.type)}),s.jsx(Z,{className:"w-5 h-5 text-blue-600 -mt-1"})]})]}),s.jsx("div",{className:"mb-4",children:e.sale_price?s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-3xl font-bold text-red-500",children:[e.sale_price," ₴"]}),s.jsxs("span",{className:"text-xl text-gray-400 line-through",children:[e.price," ₴"]})]}):s.jsxs("span",{className:"text-3xl font-bold",children:[e.price," ₴"]})}),s.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md",children:[s.jsx("button",{onClick:()=>S(-1),className:"px-3 py-2 text-gray-600 hover:bg-gray-100",children:"-"}),s.jsx("input",{type:"number",min:"1",value:b,onChange:t=>j(Math.max(1,Number(t.target.value)||1)),className:"w-16 text-center border-x border-gray-300 py-2"}),s.jsx("button",{onClick:()=>S(1),className:"px-3 py-2 text-gray-600 hover:bg-gray-100",children:"+"})]}),s.jsx("button",{onClick:()=>U(e.id,b),className:"flex-1 bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 transition-colors",children:"Купити"})]}),s.jsxs("div",{className:"mb-6 text-sm text-gray-700 leading-relaxed",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Доставка"}),s.jsx("p",{children:"Термін доставки 1-3 дні"}),s.jsx("p",{children:"Доставляємо службами Нова Пошта"}),s.jsx("p",{children:"Є можливість самовивозу зі складу в Одесі згідно графіку роботи"}),s.jsx("h2",{className:"text-lg font-semibold mt-4 mb-2",children:"Оплата"}),s.jsx("p",{children:"Банківськими картами Visa/Mastercard"}),s.jsx("p",{children:"Готівкою при отриманні товару"}),s.jsx("p",{children:"Безготівковий розрахунок з ПДВ або без ПДВ"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Додаткові характеристики"}),s.jsxs("div",{className:"space-y-3",children:[z.map((t,n)=>t.condition&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:t.label}),s.jsx("span",{children:t.value})]},n)),i(e.country)&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Країна:"}),s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(J,{countryCode:V,svg:!0,className:"w-5 h-5 rounded-full border",title:e.country,"aria-label":e.country}),s.jsx("span",{children:e.country})]})]})]})]})]})]}),s.jsxs("div",{className:"mt-4 md:mt-2",children:[s.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Відгуки про товар"}),p?s.jsxs("form",{onSubmit:M,className:"mb-8 bg-gray-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block mb-2 font-medium",children:"Ваша оцінка:"}),s.jsx("select",{value:w,onChange:t=>_(Number(t.target.value)),className:"w-full p-2 border rounded",children:[5,4,3,2,1].map(t=>s.jsxs("option",{value:t,children:[t," ★"]},t))})]}),s.jsx("textarea",{value:g,onChange:t=>N(t.target.value),className:"w-full p-2 border rounded mb-4",placeholder:"Напишіть ваш відгук...",rows:4,required:!0}),s.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Опублікувати"})]}):s.jsx("div",{className:"mb-8 flex justify-center",children:s.jsx("button",{onClick:()=>c("/auth",{state:{from:o.pathname}}),className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Написати відгук"})}),s.jsx("div",{className:"space-y-6",children:v.slice(0,3).map(t=>s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx($,{rating:t.rating,starSizeClass:"w-4 h-4"}),s.jsx("span",{className:"text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString("ru-RU")})]}),s.jsx("p",{className:"text-gray-800 mb-2",children:t.comment}),s.jsxs("div",{className:"text-sm text-gray-500",children:["Користувач: анонімний ",t.user_id.slice(0,6)]})]},t.id))}),e.reviews_count>3&&s.jsx("div",{className:"mt-6 flex justify-center",children:s.jsxs(K,{to:`/product/${a}/comment`,className:"bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition-colors",children:["Переглянути всі коментарі (",e.reviews_count,")"]})})]})]})})},xe=l.memo(re);export{re as ProductDetail,xe as default};
//# sourceMappingURL=ProductDetail-DAE-fbPB.js.map
