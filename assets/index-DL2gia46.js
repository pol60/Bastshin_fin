const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProductDetail-DAE-fbPB.js","assets/vendor-20RkeJz5.js","assets/utils-BTGVH9Kg.js","assets/vendor-GNLSjkBZ.css","assets/icons-DMyrTxXs.js","assets/state-WeFCiDx1.js","assets/animations-DaCnULhE.js","assets/SaleProductsSection-BXFS9jbG.js","assets/NewArrivalsSection-IfmmO0D8.js","assets/TopRatedSection-DY78iUV-.js","assets/FooterSection-BS9PM11-.js"])))=>i.map(i=>d[i]);
import{x as _s,r as t,j as e,L as W,y as Es,z as me,A as jt,R as te,B as G,C as Is,D as Ls,_ as be,E as Kt,F as Jt,H as vt,I as yt,J as q,K as Ps,S as Rs,M as Ms,N as Ds,O as Qe,P as Ts,Q as Zt,T as As,U as es,V as $s,W as ts,X as Os,Y as Fs,Z as Us}from"./vendor-20RkeJz5.js";import{c as ss,p as as,a as rs,s as ns,u as rt,b as nt,d as qs,Q as zs,e as Bs}from"./state-WeFCiDx1.js";import{R as is,a as Mt,X as Ws,C as ls,S as os,b as cs,c as ds,d as Hs,e as mt,f as ut,g as ht,h as xt,i as ms,j as ft,T as tt,k as Vs,l as Ys,F as Gs,m as Xs,H as Qs,D as Ks,n as Js,o as Zs,M as ea,p as ta,G as sa,q as aa,V as ra,r as us,U as hs,P as na,s as ia,L as la,t as pt,u as gt,v as Dt,w as Tt,x as oa,y as ca,z as da,A as ma,B as ua,E as ha,I as xa,J as fa,K as pa,N as ga,O as At,Q as $t,W as Ot}from"./icons-DMyrTxXs.js";import{t as ba,c as ja}from"./utils-BTGVH9Kg.js";import{m as A,A as oe,u as Ft,a as va,b as ya}from"./animations-DaCnULhE.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(l){if(l.ep)return;l.ep=!0;const n=r(l);fetch(l.href,n)}})();const wa="https://xfaifnwoslflqswcmmiv.supabase.co",Na="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhmYWlmbndvc2xmbHFzd2NtbWl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY1OTA2MjQsImV4cCI6MjA1MjE2NjYyNH0.owlWzpg4kt0j3uHf6kyODoRwilCJgBmS3NlkhoKfzYs",M=_s(wa,Na,{auth:{persistSession:!0,autoRefreshToken:!0},global:{fetch:(a,s)=>fetch(a,{...s,cache:"default"})}});function $e(...a){return ba(ja(a))}const xs=t.forwardRef(({className:a,type:s="text",...r},i)=>e.jsx("input",{type:s,className:$e("flex h-9 w-full rounded-md border border-input bg-transparent px- py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:i,...r}));xs.displayName="Input";const Ke=ss()(as((a,s)=>({items:[],addItem:(r,i=1)=>a(l=>l.items.find(c=>c.product_id===r)?{items:l.items.map(c=>c.product_id===r?{...c,quantity:c.quantity+i}:c)}:{items:[...l.items,{id:crypto.randomUUID(),order_id:"",product_id:r,quantity:i,price:0,created_at:new Date().toISOString()}]}),removeItem:r=>a(i=>({items:i.items.filter(l=>l.product_id!==r)})),updateQuantity:(r,i)=>a(l=>({items:l.items.map(n=>n.product_id===r?{...n,quantity:i}:n)})),clearCart:()=>a({items:[]}),total:()=>s().items.reduce((r,i)=>r+i.price*i.quantity,0)}),{name:"cart-store",storage:rs(()=>localStorage)}),ns),st=ss()(as(a=>({favorites:[],toggleFavorite:async s=>{a(i=>({favorites:i.favorites.includes(s)?i.favorites.filter(n=>n!==s):[...i.favorites,s]}));const{data:{user:r}}=await M.auth.getUser();if(r){const{data:i}=await M.from("favorites").select("*").eq("user_id",r.id).eq("product_id",s).single();i?await M.from("favorites").delete().eq("user_id",r.id).eq("product_id",s):await M.from("favorites").insert([{user_id:r.id,product_id:s}])}},loadFavorites:async()=>{const{data:{user:s}}=await M.auth.getUser();if(s){const{data:r,error:i}=await M.from("favorites").select("product_id").eq("user_id",s.id);if(!i&&r){const l=r.map(n=>n.product_id);a({favorites:l})}}}}),{name:"favorites-store",storage:rs(()=>localStorage)}),ns);let Se=null;const Sa=36e5,fs=t.memo(({className:a="w-28",align:s="left"})=>{const[r,i]=t.useState((Se==null?void 0:Se.url)||""),[l,n]=t.useState(!Se),c=s==="left"?"ml-0":s==="right"?"mr-0":"mx-auto";return t.useEffect(()=>{r||(async()=>{try{if(Se&&Date.now()-Se.timestamp<Sa){i(Se.url),n(!1);return}const f="Logo",x="logo.png",{data:v}=M.storage.from(f).getPublicUrl(x);if(!v.publicUrl)throw new Error("Logo load error: publicUrl is undefined");Se={url:v.publicUrl,timestamp:Date.now()},i(v.publicUrl)}catch(f){console.error("Logo load error:",f)}finally{n(!1)}})()},[r]),l?e.jsx("div",{className:`${a} ${c} bg-gray-200 animate-pulse rounded-md`,"aria-label":"Loading logo..."}):r?e.jsx("img",{src:r,alt:"ShinaGo",className:`${a} ${c} h-auto object-contain`,style:{transform:"translateZ(0)",imageRendering:"crisp-edges",contentVisibility:"auto"},loading:"eager",decoding:"async"}):e.jsx("div",{className:`${a} ${c} bg-gray-200 flex items-center justify-center text-xs`,children:"ShinaGo"})}),Le=()=>{const[a,s]=t.useState(()=>typeof window<"u"?window.innerWidth<768:!1);return t.useEffect(()=>{const r=()=>s(window.innerWidth<768);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),a},zr=({onSwipe:a}={})=>{const[s,r]=t.useState(!1),i=t.useRef(null),[l,n]=t.useState(0),[c,m]=t.useState(0),f=50,x=j=>{i.current&&clearTimeout(i.current),n(j.targetTouches[0].clientX),m(j.targetTouches[0].clientX),i.current=setTimeout(()=>{r(!0)},100)},v=()=>{i.current&&clearTimeout(i.current),r(!1);const j=l-c;if(Math.abs(j)>f){const w=j>0?"left":"right";a==null||a(w)}},g=()=>{i.current&&clearTimeout(i.current),r(!1)},N=j=>{m(j.targetTouches[0].clientX)};return t.useEffect(()=>()=>{i.current&&clearTimeout(i.current)},[]),{isTouching:s,handleTouchStart:x,handleTouchEnd:v,handleTouchCancel:g,handleTouchMove:N}},ka=({onClose:a,externalFilter:s="",onSearchChange:r})=>{const[i,l]=t.useState([]),[n,c]=t.useState(null),[m,f]=t.useState(!1),x=Le(),v=t.useRef(null);t.useEffect(()=>{const b=C=>{v.current&&!v.current.contains(C.target)&&(C.stopPropagation(),C.preventDefault(),a())};return document.addEventListener("click",b,{capture:!0}),()=>{document.removeEventListener("click",b,{capture:!0})}},[a]),t.useEffect(()=>{(async()=>{const{data:C,error:h}=await M.from("products").select("id, brand, rating, width, profile, diameter").gte("rating",20);h?(console.error("Supabase error:",h),c("Ошибка загрузки данных")):C&&l(C),f(!0)})()},[]);const g=t.useMemo(()=>{const b=new Map;return i.forEach(C=>{if(C.width&&C.profile&&C.diameter){const h=`${C.width}/${C.profile} R${C.diameter}`;b.set(h,(b.get(h)||0)+1)}}),Array.from(b.entries()).sort((C,h)=>h[1]-C[1]).slice(0,8).map(C=>C[0])},[i]),N=t.useMemo(()=>{const b=new Map;return i.forEach(C=>{C.brand&&b.set(C.brand,(b.get(C.brand)||0)+1)}),Array.from(b.entries()).sort((C,h)=>h[1]-C[1]).slice(0,8).map(C=>C[0])},[i]),j=t.useMemo(()=>s.trim()?g.filter(b=>b.toLowerCase().includes(s.toLowerCase())):g,[s,g]),w=t.useMemo(()=>s.trim()?N.filter(b=>b.toLowerCase().includes(s.toLowerCase())):N,[s,N]);if(!m)return null;const E=s.trim()!==""&&j.length===0&&w.length===0,y=x?{initial:{y:"-100%",opacity:0},animate:{y:0,opacity:1,transition:{duration:.5,ease:"easeInOut"}},exit:{y:"-100%",opacity:0,transition:{duration:.5,ease:"easeInOut"}}}:{initial:{y:"-10%",opacity:0},animate:{y:"0%",opacity:1,transition:{duration:.3,ease:"easeInOut"}},exit:{y:"-10%",opacity:0,transition:{duration:.3,ease:"easeInOut"}}},_=x?"fixed inset-x-0 top-16 z-50 bg-white shadow-lg p-4 overflow-hidden max-h-[80vh]":"absolute z-50 top-full left-0 w-full bg-white shadow-lg rounded-lg mt-1 p-4 max-h-[80vh] overflow-y-auto";return e.jsxs(A.div,{ref:v,className:_,onClick:b=>b.stopPropagation(),variants:y,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx("button",{onClick:b=>{b.stopPropagation(),a()},className:"absolute top-2 right-2 text-gray-600 text-2xl p-2 hover:bg-gray-100 rounded-full transition-transform duration-150 active:scale-150","aria-label":"Закрыть поиск",children:e.jsx(is,{})}),x&&e.jsx("div",{className:"mb-4",onTouchStart:b=>b.stopPropagation(),children:e.jsx("input",{type:"text",value:s,onChange:b=>r==null?void 0:r(b.target.value),onPointerDown:b=>b.stopPropagation(),onMouseDown:b=>b.stopPropagation(),onTouchStart:b=>b.stopPropagation(),placeholder:"Пошук...",className:"w-full px-3 py-2 border border-gray-300 text-black rounded-lg focus:outline-none text-lg"})}),e.jsx(oe,{children:(s.trim()===""||j.length>0||w.length>0||E)&&e.jsx(A.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto",transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,y:-10,transition:{duration:.3,ease:"easeInOut"}},style:{overflow:"hidden"},onClick:b=>b.stopPropagation(),onPointerDown:b=>b.stopPropagation(),onTouchStart:b=>b.stopPropagation(),children:n?e.jsxs("div",{className:"flex items-center text-red-500 gap-2 p-4",children:[e.jsx(Mt,{className:"text-2xl"}),e.jsx("p",{children:n})]}):i.length===0?e.jsx("p",{className:"text-center p-4 text-gray-500",children:"Нет данных"}):E?e.jsxs(A.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center p-4 bg-yellow-50 rounded-lg",children:[e.jsx(Mt,{className:"text-yellow-600 text-3xl mb-2"}),e.jsxs("p",{className:"text-yellow-800 text-center",children:["За вашим запитом"," ",e.jsxs("span",{className:"font-semibold",children:['"',s,'"']})," нічого не знайдено"]}),e.jsx("p",{className:"text-yellow-700 text-sm mt-1 text-center",children:"Спробуйте інші ключові слова або перевірте правильність введення"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6",children:[s.trim()===""&&e.jsx("h2",{className:"text-xl text-black md:text-lg font-bold mb-2",children:"Популярні типорозміри"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:j.map((b,C)=>e.jsx(W,{to:`/search?size=${encodeURIComponent(b)}`,className:"text-xs font-medium p-2 text-black bg-gray-100 hover:bg-gray-200 rounded transition-colors",onClick:a,children:b},C))})]}),e.jsxs("div",{className:"mt-6",children:[s.trim()===""&&e.jsx("h2",{className:"text-xl text-black md:text-lg font-bold mb-2",children:"Популярні бренди"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:w.map((b,C)=>e.jsx(W,{to:`/search?brand=${encodeURIComponent(b)}`,className:"text-xs font-medium p-2 text-black bg-gray-100 hover:bg-gray-200 rounded transition-colors",onClick:a,children:b},C))})]})]})},"search-results")})]})},bt=t.memo(ka),ps=()=>{const[a,s]=t.useState(!1),r=t.useRef(null),i=t.useRef(null),l=Le(),n=()=>{l||s(!0)},c=h=>{if(!l){const R=h.relatedTarget;r.current&&i.current&&!r.current.contains(R)&&!i.current.contains(R)&&s(!1)}},m={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,y:-10,transition:{duration:.3,ease:"easeInOut"}}},f=[{label:"Літні",to:"/tires?season=summer",icon:e.jsx(os,{className:"w-4 h-4"})},{label:"Зимові",to:"/tires?season=winter",icon:e.jsx(cs,{className:"w-4 h-4"})},{label:"Всесезонні",to:"/tires?season=all-season",icon:e.jsx(ds,{className:"w-4 h-4"})}],x=["225/65 R17","225/60 R17","205/60 R16","205/55 R16","195/65 R15","215/60 R16","185/65 R15","215/65 R16","235/60 R18","215/55 R17"],v=["R13","R14","R14C","R15","R15C","R16","R16C","R17","R17.5","R18","R19","R19.5","R20","R21","R22","R23","R24"],g=[{label:"Легкові",to:"/tires?autoType=passenger"},{label:"Вантажні",to:"/tires?autoType=heavy"},{label:"Легковантажні",to:"/tires?autoType=light-truck"},{label:"Позашляхові",to:"/tires?autoType=offroad"}],N=["Michelin","Continental","Goodyear","Debica","Kapsen","Gislaved","Triangle","Premiorri","Funtoma","Arivo","Kelly","Rosava","Dunlop","Nexen","Bridgestone","Nokian","Uniroyal","Tigar","Matador","Hankook"],j=()=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-4 text-sm text-left",children:"За сезоном"}),e.jsx("div",{className:"inline-grid p-2 gap-2",children:f.map(h=>e.jsxs(W,{to:h.to,onClick:()=>s(!1),className:"flex items-center gap-2 text-sm transition-colors rounded hover:bg-blue-500 hover:text-white px-2",children:[h.icon,e.jsx("span",{children:h.label})]},h.to))})]}),w=()=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-4 text-sm text-left",children:"За типом авто"}),e.jsx("div",{className:"inline-grid p-2 gap-2",children:g.map(h=>e.jsx(W,{to:h.to,onClick:()=>s(!1),className:"text-sm transition-colors rounded hover:bg-blue-500 hover:text-white px-2",children:h.label},h.to))})]}),E=()=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-4 text-sm text-left",children:"Типорозміри"}),e.jsx("div",{className:"inline-grid grid-cols-3 gap-x-2 gap-y-2 justify-items-center",children:x.map(h=>e.jsx(W,{to:`/tires?tireSize=${h}`,onClick:()=>s(!1),className:"whitespace-nowrap px-1 py-1 border border-gray-300 rounded text-center text-xs transition-colors hover:bg-blue-500 hover:text-white hover:font-medium",children:h},h))})]}),y=()=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-4 text-sm text-left",children:"Діаметри"}),e.jsx("div",{className:"inline-grid grid-cols-5 gap-x-2 gap-y-2 justify-items-center",children:v.map(h=>e.jsx(W,{to:`/tires?diameter=${h.replace("R","")}`,onClick:()=>s(!1),className:"w-full h-full flex justify-center items-center px-1 py-1 border border-gray-300 rounded text-center text-xs transition-colors hover:bg-blue-500 hover:text-white hover:font-medium",children:h},h))})]}),_=()=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-4 text-sm text-left",children:"За брендом"}),e.jsx("div",{className:"inline-grid grid-cols-2 gap-2",children:N.map(h=>e.jsx(W,{to:`/tires?brand=${h}`,onClick:()=>s(!1),className:"text-sm transition-colors rounded hover:bg-blue-500 hover:text-white md:px-3",children:h},h))})]}),b=l?"absolute top-full left-0 right-0 mt-2 z-50":"fixed left-0 right-0 top-16 z-50",C=e.jsx(oe,{children:a&&e.jsx(A.div,{ref:i,variants:m,initial:"hidden",animate:"visible",exit:"exit",className:b,onMouseEnter:n,onMouseLeave:c,children:e.jsxs("div",{className:"bg-white text-black mx-auto w-full max-w-6xl rounded-lg shadow-xl",children:[e.jsx("div",{className:"flex justify-end p-2 border-b",children:e.jsx("button",{onClick:()=>s(!1),className:"text-black transition-colors hover:text-blue-600",children:e.jsx(Ws,{className:"w-5 h-5"})})}),e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col space-y-6",children:[j(),w()]}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[E(),y()]}),e.jsx("div",{className:"flex flex-col",children:_()})]})})]})})});return e.jsxs("div",{onMouseLeave:c,className:"relative",children:[e.jsxs("button",{ref:r,type:"button",onClick:()=>s(h=>!h),onMouseEnter:n,className:`
    w-full md:w-auto flex items-center justify-center gap-2 text-md md:text-sm transition-colors px-4 py-1.5 md:rounded-md rounded-xl shadow
    bg-blue-500/60 md:bg-white/10 md:border-white/20  ${a?"text-yellow-400":"text-white md:text-white/60 hover:text-yellow-400"}
  `,children:["Каталог шин",e.jsx(ls,{className:`w-5 h-5 transition-transform ${a?"rotate-180":""}`})]}),l?C:Es.createPortal(C,document.body)]})},Ae=t.memo(({icon:a,label:s,onClick:r,href:i})=>{const l=e.jsx("button",{onClick:r,"aria-label":s,className:"p-2 bg-transparent text-white rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800 focus:outline-none focus:ring-0",style:{WebkitTapHighlightColor:"transparent",touchAction:"manipulation"},children:a});return i?e.jsx("a",{href:i,"aria-label":s,children:l}):l}),Ca=({isOpen:a,onClose:s,onProfileClick:r,onFavoritesClick:i,onCartClick:l,favoritesCount:n,cartCount:c,isAuthenticated:m})=>{const f=t.useRef(0),[x,v]=t.useState(!1),[g,N]=t.useState(""),[j,w]=t.useState(!1),E=me(),y=t.useRef(E);t.useEffect(()=>{a&&y.current.pathname!==E.pathname&&s(),y.current=E},[E,a,s]),t.useLayoutEffect(()=>(a?(f.current=window.pageYOffset,document.body.style.position="fixed",document.body.style.top=`-${f.current}px`,document.body.style.left="0",document.body.style.right="0"):(document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",requestAnimationFrame(()=>{window.scrollTo(0,f.current)})),()=>{document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right=""}),[a]);const _={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,transition:{duration:.3,ease:"easeInOut"}}},b={hidden:{x:"-100%"},visible:{x:0,transition:{duration:.3,ease:"easeInOut"}},exit:{x:"-100%",transition:{duration:.3,ease:"easeInOut"}}};return e.jsx(oe,{children:a&&e.jsxs(e.Fragment,{children:[e.jsx(A.div,{variants:_,initial:"hidden",animate:"visible",exit:"exit",className:"fixed inset-0 bg-black/50 z-40",onClick:()=>{x||s()},role:"presentation"},"overlay"),e.jsx(A.nav,{variants:b,initial:"hidden",animate:"visible",exit:"exit",drag:"x",dragConstraints:{left:0,right:0},dragElastic:.3,onDragEnd:(C,h)=>{h.offset.x<-10&&s()},className:"fixed inset-y-0 left-0 w-72 bg-[#1e3fac] z-50 overflow-y-auto","aria-label":"Основне меню",onClick:C=>C.stopPropagation(),children:e.jsxs("div",{className:"p-4 text-white",children:[e.jsxs("header",{className:"flex justify-between items-center mb-4",children:[e.jsx(Ae,{icon:e.jsx(is,{className:"w-6 h-6"}),label:"Закрити меню",onClick:s}),e.jsx(W,{to:"/",onClick:s,children:e.jsx(fs,{className:"w-28",align:"left"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("hr",{className:"border-white/20"}),e.jsxs("div",{className:"mt-2 flex justify-around",children:[e.jsx(Ae,{href:"tel:09307594003",icon:e.jsx(Hs,{className:"w-6 h-6 text-white"}),label:"Зателефонувати"}),e.jsx("div",{className:"relative",children:e.jsx(Ae,{label:"Профіль",onClick:r,icon:m?e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"w-6 h-6",fill:"white",stroke:"white",strokeWidth:1}),e.jsx(A.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-3 left-4 -right-3 flex items-center justify-center",style:{transform:"rotate(15deg)",transformOrigin:"center"},children:e.jsx("div",{className:"bg-green-500/90 rounded-full w-4 h-4 flex items-center justify-center shadow-sm",children:e.jsx(ut,{className:"w-2.5 h-2.5 text-white",strokeWidth:1.8})})})]}):e.jsx(ht,{className:"w-6 h-6 text-white"})})}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{icon:e.jsx(xt,{className:`w-6 h-6 ${n>0?"text-red-500":"text-white"}`}),label:"Вибране",onClick:i}),n>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center",children:n})]}),e.jsx(Ae,{icon:e.jsx(ms,{className:"w-6 h-6 text-white"}),label:"Пошук",onClick:()=>v(!0)}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{icon:e.jsx(ft,{className:`w-6 h-6 ${c>0?"text-yellow-500":"text-white"}`}),label:"Кошик",onClick:l}),c>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center",children:c})]})]}),e.jsx("hr",{className:"mt-2 border-white/20"})]}),e.jsxs("section",{className:"space-y-5 mb-4",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-3",children:[e.jsx(ps,{}),e.jsx(W,{to:"/detailed-search",onClick:s,className:"w-full md:self-start inline-block py-1.5 text-md bg-blue-500/60 rounded-xl px-4 shadow font-medium hover:text-yellow-300 transition-colors text-center",children:"Детальний пошук"}),e.jsx("button",{onClick:()=>w(!0),className:"w-full md:self-start inline-block py-1.5 text-md bg-blue-500/60 rounded-xl px-4 shadow font-medium hover:text-yellow-300 transition-colors text-center",children:"Особисті пропозиції"})]}),e.jsx("hr",{className:"border-white/20"}),e.jsxs("nav",{"aria-label":"Основна навігація",className:"text-sm",children:[e.jsx(W,{to:"/akcii",onClick:s,className:"block py-2 font-medium hover:text-yellow-300 transition-colors",children:"Акції"}),e.jsx(W,{to:"/statti",onClick:s,className:"block py-2 font-medium hover:text-yellow-300 transition-colors",children:"Статті"}),e.jsx(W,{to:"/pro-nas",onClick:s,className:"block py-2 font-medium hover:text-yellow-300 transition-colors",children:"Про нас"}),e.jsx(W,{to:"/delivery",onClick:s,className:"block py-2 font-medium hover:text-yellow-300 transition-colors",children:"Доставка і оплата"}),e.jsx(W,{to:"/contacts",onClick:s,className:"block py-2 font-medium hover:text-yellow-300 transition-colors",children:"Контакти"}),e.jsx(W,{to:"/warranty",onClick:s,className:"block py-2 font-medium hover:text-yellow-300 transition-colors",children:"Гарантія"})]})]}),e.jsxs("section",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Гарантія якості"}),e.jsx("p",{className:"text-sm opacity-80",children:"Тільки оригінальна продукція"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Швидка доставка"}),e.jsx("p",{className:"text-sm opacity-80",children:"По всій Україні"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Зручна оплата"}),e.jsx("p",{className:"text-sm opacity-80",children:"Готівка, карта, безготівковий"})]})]})]}),e.jsxs("footer",{className:"mt-6 text-sm",children:[e.jsx("p",{children:"Графік роботи кол-центра:"}),e.jsx("p",{children:"Пн-Пт: 9:00-21:00"}),e.jsx("p",{children:"Сб: 9:00-19:00, Нд: 9:00-18:00"})]})]})},"menu"),e.jsx(oe,{children:x&&e.jsx(A.div,{className:"fixed inset-0 z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:()=>v(!1),children:e.jsx(bt,{onClose:()=>v(!1),externalFilter:g,onSearchChange:N})},"search-overlay")}),e.jsx(oe,{children:j&&e.jsx(A.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:()=>w(!1),children:e.jsxs(A.div,{className:"bg-white p-4 rounded shadow-md text-center",initial:{scale:.8},animate:{scale:1},exit:{scale:.8},transition:{duration:.2},children:[e.jsx("p",{children:"Поки що немає особистих пропозицій"}),e.jsx("button",{onClick:()=>w(!1),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded",children:"Закрити"})]})},"personal-offers-stub")})]})})},_a=t.memo(Ca),Ut=({variant:a,isScrolled:s,favoritesCount:r,cartCount:i,favoritesControl:l,cartControl:n,onSearchClick:c,onFavoritesClick:m,onCartClick:f,onProfileClick:x,isAuthenticated:v})=>a==="mobile"?e.jsxs(A.div,{animate:{x:s?-20:0},className:"flex items-center gap-2 mr-4",children:[e.jsx("button",{onClick:c,"aria-label":"Поиск",className:"p-2 bg-transparent rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800",children:e.jsx(ms,{className:"w-6 h-6 text-white"})}),e.jsx(A.button,{onClick:x,"aria-label":"Профиль",className:"p-2 bg-transparent rounded-lg transition-transform duration-150 hover:bg-blue-800",whileTap:{scale:.9},children:v?e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"w-6 h-6 text-white"}),e.jsx(A.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-2.5 -right-2.5 flex items-center justify-center",children:e.jsx("div",{className:"bg-green-500/90 rounded-full w-4 h-4 flex items-center justify-center shadow-sm",children:e.jsx(ut,{className:"w-2.5 h-2.5 text-white"})})})]}):e.jsx(ht,{className:"w-6 h-6 text-white"})}),e.jsxs(A.div,{animate:l,className:"relative",children:[e.jsx(A.button,{"aria-label":"Избранное",onClick:m,className:"p-2 bg-transparent rounded-lg transition-transform duration-150 hover:bg-blue-800 active:scale-150",children:e.jsx(xt,{className:`w-6 h-6 ${r>0?"text-red-500":"text-white"}`})}),r>0&&e.jsx(A.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300},className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center",children:r},r)]}),e.jsxs(A.div,{animate:n,className:"relative",children:[e.jsx("button",{"aria-label":"Корзина",onClick:f,className:"p-2 bg-transparent rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800",children:e.jsx(ft,{className:`w-6 h-6 ${i>0?"text-yellow-500":"text-white"}`})}),i>0&&e.jsx(A.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300},className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center",children:i},i)]})]}):e.jsxs(A.div,{animate:{x:s?-20:0},transition:{type:"spring",stiffness:300},className:"flex items-center gap-4",children:[e.jsx(A.button,{"aria-label":"Профиль",onClick:x,className:"flex items-center relative p-2 bg-transparent rounded-lg transition-transform duration-150 hover:bg-blue-800",whileTap:{scale:.9},children:v?e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"w-6 h-6 text-white"}),e.jsx(A.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-3 left-4 -right-3 flex items-center justify-center",style:{transform:"rotate(15deg)",transformOrigin:"center"},children:e.jsx("div",{className:"bg-green-500/90 rounded-full w-4 h-4 flex items-center justify-center shadow-sm",children:e.jsx(ut,{className:"w-2.5 h-2.5 text-white"})})})]}):e.jsx(ht,{className:"w-6 h-6 text-white"})}),e.jsxs(A.div,{animate:l,className:"relative",children:[e.jsx(A.button,{"aria-label":"Избранное",onClick:m,className:"p-2 bg-transparent rounded-lg transition-transform duration-150 hover:bg-blue-800 active:scale-150",children:e.jsx(xt,{className:`w-6 h-6 ${r>0?"text-red-500":"text-white"}`})}),r>0&&e.jsx(A.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300},className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center",children:r},r)]}),e.jsxs(A.div,{animate:n,className:"relative",children:[e.jsx("button",{"aria-label":"Корзина",onClick:f,className:"p-2 bg-transparent rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800",children:e.jsx(ft,{className:`w-6 h-6 ${i>0?"text-yellow-500":"text-white"}`})}),i>0&&e.jsx(A.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:300},className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center",children:i},i)]})]}),qt=({onClose:a,isClosing:s})=>{const{items:r,removeItem:i,updateQuantity:l}=Ke(),n=t.useRef(r.length===0),[c,m]=t.useState(r),[f,x]=t.useState({}),[v,g]=t.useState(!0);t.useEffect(()=>{r.length>0&&m(r)},[r]);const N=b=>{switch(b.toLowerCase()){case"winter":return"Зимние";case"summer":return"Летние";case"all-season":return"Всесезонные";default:return b}},j=b=>b.toLocaleString("uk-UA",{minimumFractionDigits:1,maximumFractionDigits:1})+" ₴";if(t.useEffect(()=>{(async()=>{const C=r.length>0?r:c;if(C.length===0){g(!1);return}const{data:h,error:R}=await M.from("products").select("*").in("id",C.map(I=>I.product_id));if(R)console.error("Error fetching products:",R);else if(h){const I=h.reduce((k,o)=>(k[o.id]=o,k),{});x(I)}g(!1)})()},[r,c]),r.length===0&&n.current)return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-xl font-bold mb-2",children:"Кошик порожній"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Додайте товари для оформлення замовлення"})]})});const w=r.length>0?r:c,E=()=>w.reduce((b,C)=>{const h=f[C.product_id];if(!h)return b;const R=h.sale_price&&h.sale_price<h.price?h.sale_price:h.price;return b+R*C.quantity},0),y=b=>{const C=w.length===1;i(b),C&&a()};if(v)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-800"})});return e.jsx("div",{className:"p-4 overflow-y-auto max-h-full",children:_(w)});function _(b){return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-xl font-bold mb-4",children:"Кошик"}),e.jsx("div",{className:"space-y-4",children:b.map(C=>{const h=f[C.product_id];if(!h)return null;const R=h.image_url&&h.image_url[0]?h.image_url[0]:"https://via.placeholder.com/56",I=h.country?h.country.slice(0,2).toUpperCase():"UA";return e.jsxs(A.div,{className:"bg-white rounded-lg shadow p-3 flex items-center gap-3 relative",initial:{opacity:1,y:0},animate:{opacity:s?0:1,y:s?10:0},exit:{opacity:0,y:10},transition:{duration:.5},children:[e.jsx(W,{to:`/product/${h.id}`,onClick:a,className:"block",children:e.jsx("img",{src:R,alt:`${h.brand} ${h.model}`,className:"w-14 h-14 object-contain"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(W,{to:`/product/${h.id}`,onClick:a,className:"font-medium text-black hover:text-blue-800 text-sm line-clamp-1",children:[h.brand," ",h.model]}),e.jsxs("span",{className:"absolute top-0 right-[-8rem] text-xs text-gray-500 font-bold whitespace-nowrap",children:["арт: ",h.id.slice(0,8).toUpperCase()]})]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Размер: ",h.width,"/",h.profile," R",h.diameter]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Сезон: ",N(h.season??"all-season")]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx("div",{className:"aspect-square rounded-full overflow-hidden border w-3 h-3 relative",children:e.jsx(jt,{countryCode:I,svg:!0,className:"absolute top-1/2 left-1/2 w-[135%] h-[135%] -translate-x-1/2 -translate-y-1/2 object-cover",title:h.country||"UA","aria-label":h.country||"UA"})}),e.jsxs("span",{children:[h.year," рік"]})]}),e.jsx("div",{className:"mt-2",children:h.sale_price&&h.sale_price<h.price?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm font-bold text-red-500",children:j(h.sale_price)}),e.jsx("span",{className:"text-xs text-gray-400 line-through ml-2",children:j(h.price)})]}):e.jsx("span",{className:"text-sm font-bold",children:j(h.price)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center border border-gray-300 rounded",children:[e.jsx("button",{onClick:()=>y(C.product_id),className:"px-2 py-1 text-gray-600 hover:bg-gray-100",disabled:s,children:"-"}),e.jsx("input",{type:"number",min:"1",value:C.quantity,onChange:k=>l(C.product_id,Math.max(1,parseInt(k.target.value)||1)),className:"w-12 text-center border-x border-gray-300 py-1 text-xs",disabled:s}),e.jsx("button",{onClick:()=>l(C.product_id,C.quantity+1),className:"px-2 py-1 text-gray-600 hover:bg-gray-100",disabled:s,children:"+"})]}),e.jsx("button",{onClick:()=>y(C.product_id),className:"text-gray-500 hover:text-red-500",disabled:s,children:e.jsx(tt,{className:"w-5 h-5"})})]})]},C.product_id)})}),e.jsxs(A.div,{className:"mt-4 border-t pt-4",initial:{opacity:1},animate:{opacity:s?0:1},transition:{duration:.5},children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold",children:[e.jsxs("span",{children:["Товари (",w.length,")"]}),e.jsx("span",{children:j(E())})]}),e.jsx(W,{to:"/checkout",onClick:a,className:"block mt-4 bg-green-600 text-white text-center px-4 py-2 rounded-md hover:bg-green-700 text-sm",children:"Оформити замовлення"})]})]})}},Ea=a=>{const[s,r]=t.useState(!1);return t.useEffect(()=>{const i=window.matchMedia(a);r(i.matches);const l=()=>r(i.matches);return i.addEventListener("change",l),()=>i.removeEventListener("change",l)},[a]),s},Ia=({isOpen:a,onClose:s})=>{const r=Ea("(max-width: 768px)"),[i,l]=t.useState("closed");t.useEffect(()=>{a&&l("open")},[a]);const n=()=>{l("closing"),setTimeout(()=>{s(),l("closed")},100)},c=()=>n(),m=f=>f.stopPropagation();return e.jsx(oe,{children:(a||i==="closing")&&e.jsx(A.div,{className:"fixed inset-0 z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},onClick:c,children:r?e.jsx(A.div,{className:"absolute w-full bg-white shadow-lg overflow-y-auto",style:{top:"4rem",maxHeight:"90vh"},initial:{y:"-100%"},animate:{y:0},exit:{y:"-100%"},transition:{duration:.5,ease:"easeInOut"},onClick:m,children:e.jsx(qt,{onClose:n,isClosing:i==="closing"})},"cart-content-mobile"):e.jsx(A.div,{className:"absolute right-0 bg-white shadow-lg overflow-y-auto",style:{top:"4rem",width:"400px",maxWidth:"90vw",maxHeight:"90vh",minHeight:"150px"},initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.5,ease:"easeInOut"},onClick:m,children:e.jsx(qt,{onClose:n,isClosing:i==="closing"})},"cart-content-desktop")},"cart-backdrop")})},zt=({onClose:a})=>{const{favorites:s,toggleFavorite:r}=st(),{items:i,addItem:l,removeItem:n}=Ke(),[c,m]=t.useState([]),[f,x]=t.useState(!0),v=t.useCallback(async()=>{if(!s.length){x(!1);return}try{const{data:j,error:w}=await M.from("products").select("id, brand, model, width, profile, diameter, season, price, sale_price, image_url, year, country").in("id",s);if(w)throw w;m(j)}catch(j){console.error("Error fetching favorites:",j)}finally{x(!1)}},[s]);t.useEffect(()=>{const j=setTimeout(()=>{s.length===0&&a()},300);return()=>clearTimeout(j)},[s,a]),t.useEffect(()=>{const w=setTimeout(async()=>{await v()},200);return()=>clearTimeout(w)},[v]);const g=j=>j.toLocaleString("uk-UA",{minimumFractionDigits:1,maximumFractionDigits:1})+" ₴",N=j=>{switch(j.toLowerCase()){case"winter":return"Зимние";case"summer":return"Летние";case"all-season":return"Всесезонные";default:return j}};return f?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-800"})}):e.jsxs("div",{children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h3",{className:"text-lg font-semibold text-center",children:"Обране"})}),c.length===0?e.jsx("div",{className:"p-4 text-center",children:"Избранное пустое"}):e.jsx("div",{className:"p-4 pr-2 overflow-y-auto",style:{maxHeight:"calc(90vh - 4rem)"},children:e.jsx("div",{className:"space-y-2",children:c.map(j=>{var E,y;const w=i.some(_=>_.product_id===j.id);return e.jsxs(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-white rounded-lg p-2 grid grid-cols-[60px_1fr] gap-3 items-center shadow-sm mb-2",children:[e.jsx(W,{to:`/product/${j.id}`,onClick:a,children:e.jsx("div",{className:"border rounded-md p-1 h-14 w-14 flex items-center justify-center bg-gray-50",children:(E=j.image_url)!=null&&E[0]?e.jsx("img",{src:j.image_url[0],alt:`${j.brand} ${j.model}`,className:"object-contain h-full w-full"}):e.jsx("div",{className:"text-gray-400 text-xs text-center",children:"Нет фото"})})}),e.jsxs("div",{className:"flex flex-col space-y-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs(W,{to:`/product/${j.id}`,className:"font-medium text-black hover:text-blue-800 text-sm line-clamp-1",onClick:a,children:[j.brand," ",j.model]}),e.jsxs("span",{className:"text-xs text-gray-500 font-bold",children:["арт: ",j.id.slice(0,8).toUpperCase()]})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Размер: ",j.width,"/",j.profile," R",j.diameter]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Сезон: ",N(j.season)]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("div",{className:"font-bold text-sm",children:j.sale_price&&j.sale_price<j.price?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-red-600",children:g(j.sale_price)}),e.jsx("span",{className:"line-through text-gray-400 text-xs ml-2",children:g(j.price)})]}):e.jsx("span",{className:"text-green-600",children:g(j.price)})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{w?n(j.id):l(j.id)},className:`p-1.5 rounded-md flex items-center justify-center ${w?"bg-blue-500 hover:bg-blue-600":"bg-green-500 hover:bg-green-600"}`,children:w?e.jsx(tt,{className:"w-3.5 h-3.5 text-white"}):e.jsx(Vs,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("button",{onClick:()=>r(j.id),className:"p-1.5 bg-red-500 hover:bg-red-600 rounded-md",children:e.jsx(Ys,{className:"w-3.5 h-3.5 text-white"})})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx("div",{className:"aspect-square rounded-full overflow-hidden border w-3 h-3 relative",children:e.jsx(jt,{countryCode:((y=j.country)==null?void 0:y.slice(0,2).toUpperCase())||"UA",svg:!0,className:"absolute top-1/2 left-1/2 w-[135%] h-[135%] -translate-x-1/2 -translate-y-1/2 object-cover",title:j.country||"UA","aria-label":j.country||"UA"})}),e.jsxs("span",{children:[j.year," рік"]})]})]})]},j.id)})})})]})},La=a=>{const[s,r]=te.useState(!1);return te.useEffect(()=>{const i=window.matchMedia(a),l=()=>r(i.matches);return i.addEventListener("change",l),r(i.matches),()=>i.removeEventListener("change",l)},[a]),s},Pa=({isOpen:a,onClose:s})=>{const r=La("(max-width: 768px)");return e.jsx(oe,{children:a&&e.jsx(A.div,{className:"fixed inset-0 z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:s,children:r?e.jsx(A.div,{className:"absolute w-full bg-white shadow-lg overflow-y-auto",style:{top:"4rem",maxHeight:"90vh"},initial:{y:"-100%"},animate:{y:0},exit:{y:"-100%"},transition:{duration:.5,ease:"easeInOut"},onClick:i=>i.stopPropagation(),children:e.jsx(zt,{isOpen:a,onClose:s})}):e.jsx(A.div,{className:"absolute right-0 bg-white shadow-lg overflow-y-auto",style:{top:"4rem",width:"400px",maxWidth:"90vw",maxHeight:"90vh",minHeight:"150px"},initial:{x:"100%",height:0},animate:{x:0,height:"auto"},exit:{x:"100%",height:0},transition:{duration:.5,ease:"easeInOut"},onClick:i=>i.stopPropagation(),children:e.jsx(zt,{isOpen:a,onClose:s})})},"sliding-favorites")})},Bt=t.memo(fs),Ra=({className:a=""})=>{const[s,r]=t.useState(!1),[i,l]=t.useState(""),[n,c]=t.useState(()=>{const F=sessionStorage.getItem("navbar_isScrolled");return F?JSON.parse(F):!1}),[m,f]=t.useState(()=>{const F=sessionStorage.getItem("navbar_showHeader");return F?JSON.parse(F):!0}),[x,v]=t.useState(()=>{const F=sessionStorage.getItem("navbar_lastScrollY");return F?Number(F):0}),[g,N]=t.useState(!1),[j,w]=t.useState(null),[E,y]=t.useState(!1),[_,b]=t.useState(!1),C=Ke(F=>F.items.length,(F,Z)=>F===Z),h=st(F=>F.favorites.length),R=G(),I=me(),k=t.useRef(null),o=Le();t.useEffect(()=>{(async()=>{const{data:{user:F}}=await M.auth.getUser();w(F)})()},[]);const d=Ft(),p=Ft(),u=t.useRef(h),S=t.useRef(C);t.useEffect(()=>{h>u.current&&d.start({x:-10,transition:{duration:.3}}).then(()=>d.start({x:0,transition:{duration:.3}})),u.current=h},[h,d]),t.useEffect(()=>{C>S.current&&p.start({x:-10,transition:{duration:.3}}).then(()=>p.start({x:0,transition:{duration:.3}})),S.current=C},[C,p]),t.useEffect(()=>{const F=Z=>{k.current&&!k.current.contains(Z.target)&&N(!1)};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[]),t.useEffect(()=>{const F=()=>{const Z=window.scrollY>50;c(Z),sessionStorage.setItem("navbar_isScrolled",JSON.stringify(Z))};return window.addEventListener("scroll",F,{passive:!0}),()=>window.removeEventListener("scroll",F)},[]),t.useEffect(()=>{const F=()=>{v(Z=>{const ce=window.scrollY;return ce>Z&&ce>380?(f(!1),sessionStorage.setItem("navbar_showHeader",JSON.stringify(!1))):(f(!0),sessionStorage.setItem("navbar_showHeader",JSON.stringify(!0))),sessionStorage.setItem("navbar_lastScrollY",ce.toString()),ce})};return window.addEventListener("scroll",F),()=>window.removeEventListener("scroll",F)},[]);const P=va(m?0:-100);t.useEffect(()=>{const F=document.querySelector('meta[name="theme-color"]');if(!F)return;const Z=se=>{se=se.replace(/^#/,""),se.length===3&&(se=se.split("").map(Q=>Q+Q).join(""));const re=parseInt(se,16);return{r:re>>16&255,g:re>>8&255,b:re&255}},ce=F.getAttribute("content")||(m?"#1e3fac":"#ffffff"),ee=Z(ce),ue=m?{r:30,g:63,b:172}:{r:255,g:255,b:255},le=300,Ce=performance.now(),fe=se=>{const re=se-Ce,Q=Math.min(re/le,1),_e=Math.round(ee.r+(ue.r-ee.r)*Q),ve=Math.round(ee.g+(ue.g-ee.g)*Q),pe=Math.round(ee.b+(ue.b-ee.b)*Q),ne=`#${((1<<24)+(_e<<16)+(ve<<8)+pe).toString(16).slice(1)}`;F.setAttribute("content",ne),Q<1&&requestAnimationFrame(fe)};requestAnimationFrame(fe)},[m]);const D=t.useCallback(()=>{b(!0)},[]),T=t.useCallback(()=>{j?R("/profile",{state:{from:I.pathname}}):R("/auth",{state:{from:I.pathname}})},[R,I.pathname,j]),B=t.useCallback(()=>y(!0),[]),ae=t.useCallback(F=>{F.preventDefault(),i.trim()&&(R(`/search?q=${encodeURIComponent(i.trim())}`),N(!1))},[i,R]),Y=()=>e.jsxs("div",{className:"flex items-center justify-between p-1 h-16 transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r(!0),"aria-label":"Открыть меню",className:"p-2 bg-transparent rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800 mt-1.5",style:{WebkitTapHighlightColor:"transparent"},children:e.jsx(Xs,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"-ml-0 pl-2 self-start",children:e.jsx(W,{to:"/",onClick:()=>r(!1),children:e.jsx(Bt,{className:"w-24"})})})]}),e.jsx(Ut,{variant:"mobile",favoritesCount:h,cartCount:C,favoritesControl:d,cartControl:p,onSearchClick:()=>N(!0),onFavoritesClick:B,onCartClick:D,onProfileClick:T,isAuthenticated:!!j})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block bg-[#1e3fac] text-white",children:e.jsx("div",{className:"mx-auto px-2 w-[960px]",children:e.jsxs("div",{className:"flex items-center justify-between py-2 text-xs border-b border-white/10",children:[e.jsxs("nav",{className:"flex items-center gap-4",children:[e.jsx(W,{to:"/delivery",className:"text-white hover:text-yellow-300 transition-colors",children:"Доставка і оплата"}),e.jsx(W,{to:"/warranty",className:"text-white hover:text-yellow-300 transition-colors",children:"Гарантія"}),e.jsx(W,{to:"/contacts",className:"text-white hover:text-yellow-300 transition-colors",children:"Контакти"}),e.jsx(W,{to:"/promotions",className:"text-white hover:text-yellow-300 transition-colors",children:"Акції"}),e.jsx(W,{to:"/articles",className:"text-white hover:text-yellow-300 transition-colors",children:"Статті"}),e.jsx(W,{to:"/about",className:"text-white hover:text-yellow-300 transition-colors",children:"Про нас"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("a",{href:"tel:09307594003",className:"text-yellow-300 hover:text-yellow-400 flex items-center gap-1",children:[e.jsx(Gs,{className:"w-3 h-3"}),"0930759403"]}),e.jsx("button",{className:"px-2 py-1 text-yellow-300 hover:text-yellow-400 transition-colors",children:"Замовити дзвінок"})]})]})})}),e.jsxs(A.header,{style:{y:P},animate:{y:m?0:-100},transition:{duration:.3},className:`bg-[#1e3fac] text-white z-50 sticky top-0 transition-shadow duration-300 ${a} ${n?"shadow-md":""}`,children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx("div",{className:"mx-auto px-2 w-[960px]",children:e.jsxs("div",{className:"flex items-center justify-between h-16 py-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(W,{to:"/",className:"flex items-center",children:e.jsx(Bt,{className:"w-28",align:"left"})}),e.jsx(ps,{})]}),e.jsxs("div",{className:"relative w-96",ref:k,children:[e.jsx(xs,{type:"search",placeholder:"Пошук",value:i,onChange:F=>l(F.target.value),onFocus:()=>N(!0),onKeyDown:F=>F.key==="Enter"&&ae(F),className:"pl-3 bg-white/10 border-white/20 placeholder:text-white/60"}),e.jsx(oe,{children:g&&!o&&e.jsx(bt,{onClose:()=>N(!1),externalFilter:i,onSearchChange:l})})]}),e.jsx(Ut,{variant:"desktop",favoritesCount:h,cartCount:C,favoritesControl:d,cartControl:p,onSearchClick:()=>{},onFavoritesClick:B,onCartClick:D,onProfileClick:T,isAuthenticated:!!j})]})})}),e.jsxs("div",{className:"lg:hidden relative",ref:k,children:[e.jsx(A.div,{animate:{opacity:s?0:1},transition:{duration:.3},children:Y()}),e.jsx(oe,{children:o&&g&&e.jsx(bt,{onClose:()=>N(!1),externalFilter:i,onSearchChange:l})})]})]}),g&&!o&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:F=>{F.preventDefault(),F.stopPropagation(),N(!1)}}),o&&e.jsx(_a,{isOpen:s,onClose:()=>r(!1),onProfileClick:T,onFavoritesClick:B,onCartClick:D,favoritesCount:h,cartCount:C,isAuthenticated:!!j}),e.jsx(Ia,{isOpen:_,onClose:()=>b(!1)}),e.jsx(Pa,{isOpen:E,onClose:()=>y(!1)})]})},Ma=t.memo(Ra),Da=Is("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 active:!transition-transform active:!duration-150",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90 active:bg-primary/80",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90 active:bg-destructive/80",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground active:bg-accent/50 active:text-accent-foreground/90",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80 active:bg-secondary/70",ghost:"hover:bg-accent hover:text-accent-foreground active:bg-accent/50 active:text-accent-foreground/90",link:"text-primary underline-offset-4 hover:underline active:text-primary/70"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),xe=t.forwardRef(({className:a,variant:s="default",size:r="default",style:i,...l},n)=>e.jsx("button",{style:{WebkitTapHighlightColor:"transparent",...i},className:$e(Da({variant:s,size:r,className:a}),"active:scale-[0.98]"),ref:n,...l}));xe.displayName="Button";function Ta(a,s){let r=!1;return function(...i){r||(a(...i),r=!0,setTimeout(()=>{r=!1},s))}}function Aa(a,s){if(!s)return[a];const r=new RegExp(`(${s})`,"gi");return a.split(r).map((l,n)=>r.test(l)?e.jsx("span",{className:"bg-yellow-200",children:l},n):l)}function J({multiple:a=!1,value:s,onValueChange:r,placeholder:i,children:l,className:n,disabled:c=!1,displayValue:m,...f}){const[x,v]=t.useState(!1),[g,N]=t.useState("down"),[j,w]=t.useState(""),E=t.useRef(null),y=t.useRef(null),_=t.useRef(null),b=o=>{if(a){const d=Array.isArray(s)?s:[],p=d.includes(o)?d.filter(u=>u!==o):[...d,o];r==null||r(p)}else r==null||r(o),v(!1)};t.useEffect(()=>{const o=d=>{var p;E.current&&!E.current.contains(d.target)&&_.current!==d.target&&!((p=_.current)!=null&&p.contains(d.target))&&v(!1)};return document.addEventListener("mousedown",o),document.addEventListener("touchstart",o),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("touchstart",o)}},[]),t.useEffect(()=>{const o=()=>{x&&window.innerWidth>=768&&v(!1)};return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[x]);const C=t.useCallback(()=>{if(E.current&&x){const o=E.current.getBoundingClientRect(),d=window.innerHeight-o.bottom;N(d<200?"up":"down")}},[x]);t.useEffect(()=>{C()},[x,C]),t.useEffect(()=>{const o=Ta(()=>C(),100);return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[C]);const h=a&&Array.isArray(s)?s.length>0?(m==null?void 0:m(s))??s.join(", "):i:s||i,R=t.Children.toArray(l).filter(o=>t.isValidElement(o)?String(o.props.children).toLowerCase().includes(j.toLowerCase()):!0),I=j===""&&R.length>6?R.slice(0,6):R,k=t.Children.map(I,o=>{if(t.isValidElement(o)&&o.type.displayName==="SelectItem"){const d=o.props.value,p=a?Array.isArray(s)&&s.includes(d):s===d;let u=o.props.children;return typeof u=="string"&&j.trim()!==""&&(u=Aa(u,j)),t.cloneElement(o,{onSelect:()=>b(d),isSelected:p,children:u})}return o});return e.jsxs("div",{ref:E,className:"relative",...f,children:[e.jsxs("button",{ref:y,type:"button",role:"combobox","aria-expanded":x,"aria-disabled":c,onClick:o=>{o.preventDefault(),o.stopPropagation(),c||(v(!x),w(""))},className:$e("flex h-9 w-full items-center justify-between rounded-md border","border-input bg-transparent px-3 py-2 text-sm shadow-sm","ring-offset-background placeholder:text-muted-foreground","focus:outline-none focus:ring-1 focus:ring-ring","disabled:cursor-not-allowed disabled:opacity-50",n),disabled:c,children:[e.jsx("span",{className:"truncate",children:h}),e.jsx(ls,{className:$e("h-4 w-4 opacity-50 transition-transform",x&&"rotate-180")})]}),x&&e.jsx("div",{role:"listbox",className:$e("absolute z-50 w-full rounded-md border shadow-lg animate-in fade-in-80",g==="down"?"mt-1":"bottom-full mb-1","bg-white"),children:e.jsxs("div",{className:"p-2",children:[e.jsx("input",{ref:_,type:"text",value:j,onChange:o=>w(o.target.value),onClick:o=>o.stopPropagation(),onMouseDown:o=>o.stopPropagation(),onTouchStart:o=>o.stopPropagation(),onTouchMove:o=>o.stopPropagation(),placeholder:"Пошук...",className:"mb-2 w-full border p-3 text-xs"}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:k})]})})]})}const X=t.forwardRef(({className:a,children:s,onSelect:r,isSelected:i,disabled:l=!1,...n},c)=>e.jsxs("div",{role:"option","aria-selected":i,"aria-disabled":l,ref:c,className:$e("relative flex cursor-default select-none items-center py-1.5 pl-8 pr-2 text-xs","outline-none focus:bg-accent focus:text-accent-foreground","transition-colors duration-200",i&&"bg-accent font-medium",l&&"opacity-50 pointer-events-none",a),onClick:l?void 0:m=>{m.preventDefault(),m.stopPropagation(),r==null||r()},...n,children:[i&&e.jsx("span",{className:"absolute left-2 text-xs text-current",children:"✓"}),s]}));X.displayName="SelectItem";t.memo(X);const $a=a=>{const s=a.name.split(".").pop();return`${Ls()}${s?`.${s}`:""}`},Oa=async(a,s,r)=>{const i=$a(a),{data:l,error:n}=await M.storage.from(s).upload(`${r}/${i}`,a,{cacheControl:"3600",upsert:!1});if(n)throw n;return{...l,fileName:i}},gs=(a,s)=>{const{data:r}=M.storage.from(a).getPublicUrl(s,{download:!1});return r.publicUrl},Wt={width:"Ширина",profile:"Профіль",diameter:"Діаметр",season:"Сезон",brand:"Бренд"},et={summer:"Літній",winter:"Зимній","all-season":"Всесезонний"},Fa=async()=>{const{data:a,error:s}=await M.from("products").select("width, profile, diameter, season, brand");if(s)throw new Error(s.message);if(a&&a.length>0){const r=Array.from(new Set(a.map(m=>m.width).filter(m=>m!==null).map(m=>Number(m)))).filter(m=>!isNaN(m)).sort((m,f)=>m-f).map(String),i=Array.from(new Set(a.map(m=>m.profile).filter(m=>m!==null).map(m=>Number(m)))).filter(m=>!isNaN(m)).sort((m,f)=>m-f).map(String),l=Array.from(new Set(a.map(m=>m.diameter).filter(m=>m!==null).map(m=>Number(m)))).filter(m=>!isNaN(m)).sort((m,f)=>m-f).map(String),n=Array.from(new Set(a.map(m=>m.season).filter(Boolean))).sort((m,f)=>m.localeCompare(f)),c=Array.from(new Set(a.map(m=>m.brand).filter(Boolean))).sort((m,f)=>m.localeCompare(f));return{width:r,profile:i,diameter:l,season:n,brand:c}}return{width:[],profile:[],diameter:[],season:[],brand:[]}},Ua=({className:a,shouldAnimate:s=!1})=>{const r=G(),i=t.useRef(null),[l,n]=t.useState({width:[],profile:[],diameter:[],season:[],brand:[]}),{data:c,isLoading:m,error:f,refetch:x}=rt({queryKey:["dynamicFilters"],queryFn:Fa,staleTime:6*60*60*1e3,initialData:{width:[],profile:[],diameter:[],season:[],brand:[]}});t.useEffect(()=>{c&&!c.width.length&&x()},[c,x]);const[v,g]=t.useState({width:[],profile:[],diameter:[],season:[],brand:[]});t.useEffect(()=>{c&&g({width:c.width.slice(0,6),profile:c.profile.slice(0,6),diameter:c.diameter.slice(0,6),season:c.season.slice(0,6),brand:c.brand.slice(0,6)})},[c]);const N=t.useCallback((h,R)=>{n(I=>({...I,[h]:R}))},[]),j=t.useCallback(()=>{const h=new URLSearchParams;if(Object.entries(l).forEach(([R,I])=>{I.length>0&&h.set(R,I.join(","))}),!h.toString().length){alert("Виберіть хоча б один параметр для пошуку");return}r(`/search-results?${h.toString()}`)},[l,r]),w=t.useCallback(()=>{r("/detailed-search")},[r]),[E,y]=t.useState(window.innerWidth>=768);t.useEffect(()=>{const h=()=>y(window.innerWidth>=768);return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const _=t.useMemo(()=>{const h=gs("Fon",void 0);return console.log("Background image URL:",h),h},[]);t.useEffect(()=>{const h=new Image;h.src=_},[_]);const b=t.useMemo(()=>({backgroundImage:`linear-gradient(
        to bottom,
        rgba(30,63,172,1) 0%,
        rgba(30,63,172,0.7) 30%,
        rgba(30,63,172,0.3) 150%,
        rgba(30,63,172,1) 180%
      ), url(${_})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",height:E?"280px":"320px"}),[_,E]);if(m)return e.jsx("section",{ref:i,className:`relative min-h-[200px] max-h-[400px] ${a||""} ${s?"fade-in":""}`,style:b,children:e.jsx("div",{className:"container mx-auto px-4 h-full flex items-center justify-center",children:e.jsx("div",{children:"Загрузка фільтрів..."})})});f&&console.error("Error loading dynamic filters:",f);const C=["width","profile","diameter","season","brand"];return e.jsx("section",{ref:i,className:`relative min-h-[200px] max-h-[400px] ${a||""} ${s?"fade-in":""}`,style:b,children:e.jsx("div",{className:"container mx-auto px-4 h-full flex items-center justify-center",children:e.jsxs("div",{className:"w-full md:max-w-[600px] mx-auto",children:[e.jsx("div",{className:"block md:hidden",children:e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-0 sm:grid-cols-3 md:grid-cols-7",children:[C.map(h=>{let R="rounded-none";return h==="width"?R="rounded-none rounded-tl-xl":h==="profile"&&(R="rounded-none rounded-tr-xl"),e.jsx("div",{className:`relative ${h==="brand"?"col-span-2 sm:col-span-1":""}`,children:e.jsx(J,{multiple:!0,value:l[h],onValueChange:I=>N(h,I),placeholder:Wt[h],className:`bg-white text-gray-500 hover:bg-gray-100 transition-colors active:!bg-gray-100 active:!opacity-100 
                        px-8 py-3 text-base sm:px-8 sm:py-3 sm:text-sm h-auto min-w-[120px] w-full ${R}`,...h==="season"?{displayValue:I=>I.map(k=>et[k.toLowerCase()]||k).join(", ")}:{},children:v[h].map(I=>e.jsx(X,{value:I,children:h==="season"&&et[I.toLowerCase()]||I},I))})},h)}),e.jsx("div",{className:"relative",children:e.jsx(xe,{onClick:w,className:`bg-blue-600 hover:bg-blue-700 text-white/90 
                    px-6 py-2 text-base sm:px-8 sm:py-2 sm:text-sm h-auto min-w-[120px] w-full flex items-center justify-center 
                    rounded-none rounded-bl-xl active:!bg-blue-800 active:!opacity-100`,children:"Детальний пошук"})}),e.jsx("div",{className:"relative",children:e.jsx(xe,{onClick:j,className:`bg-green-600 hover:bg-green-700 text-white/90 
                    px-6 py-2 text-base sm:px-8 sm:py-2 sm:text-sm h-auto min-w-[120px] w-full flex items-center justify-center 
                    rounded-none rounded-br-xl active:!bg-green-800 active:!opacity-100`,children:"Підібрати"})})]})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("div",{className:"grid grid-cols-5 gap-0",children:C.map(h=>{let R="rounded-none min-h-[56px]";return h==="width"?R="rounded-none rounded-tl-xl min-h-[56px]":h==="brand"&&(R="rounded-none rounded-tr-xl min-h-[56px]"),e.jsx("div",{className:"relative",children:e.jsx(J,{multiple:!0,value:l[h],onValueChange:I=>N(h,I),placeholder:Wt[h],className:`bg-white text-gray-500 hover:bg-gray-300 transition-colors active:!bg-gray-100 active:!opacity-100 
                        px-4 py-2 text-base w-full flex items-center justify-center ${R}`,...h==="season"?{displayValue:I=>I.map(k=>et[k.toLowerCase()]||k).join(", ")}:{},children:v[h].map(I=>e.jsx(X,{value:I,children:h==="season"&&et[I.toLowerCase()]||I},I))})},h)})}),e.jsxs("div",{className:"flex",children:[e.jsx(xe,{onClick:w,className:`bg-blue-600 hover:bg-blue-700 text-white/90 
                  px-6 py-2 text-base w-1/2 flex items-center justify-center 
                  rounded-none rounded-bl-xl active:!bg-blue-800 active:!opacity-100`,children:"Детальний пошук"}),e.jsx(xe,{onClick:j,className:`bg-green-600 hover:bg-green-700 text-white/90 
                  px-6 py-2 text-base w-1/2 flex items-center justify-center 
                  rounded-none rounded-br-xl active:!bg-green-800 active:!opacity-100`,children:"Підібрати"})]})]})]})})})},ge=({tooltip:a,children:s})=>{const r=Le(),[i,l]=t.useState(!1),n=t.useRef(null),[c,m]=t.useState(0),f=t.useRef(Date.now()+Math.random()),x=N=>{r||l(!0)},v=N=>{r||l(!1)},g=N=>{N.preventDefault(),N.stopPropagation(),r&&(i?l(!1):(window.dispatchEvent(new CustomEvent("tooltip:open",{detail:f.current})),l(!0)))};return t.useEffect(()=>{if(r&&i){const N=setTimeout(()=>l(!1),2e3);return()=>clearTimeout(N)}},[r,i]),t.useEffect(()=>{const N=j=>{j.detail!==f.current&&l(!1)};return window.addEventListener("tooltip:open",N),()=>{window.removeEventListener("tooltip:open",N)}},[]),t.useEffect(()=>{if(i&&n.current){const N=n.current.getBoundingClientRect();let j=0;const w=4;N.left<w?j=w-N.left:N.right>window.innerWidth-w&&(j=window.innerWidth-w-N.right),m(j)}},[i]),e.jsxs("div",{className:"relative inline-block",onMouseEnter:x,onMouseLeave:v,onClick:g,children:[s,i&&e.jsxs("div",{className:"absolute bottom-full left-1/2 z-20",ref:n,style:{transform:`translateX(calc(-50% + ${c}px))`},children:[e.jsx("div",{className:"bg-white text-black text-xs px-2 py-1 rounded shadow whitespace-nowrap",children:a}),e.jsx("div",{className:"flex justify-center",children:e.jsx("svg",{className:"w-2 h-2 fill-current text-white",style:{filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.2))"},viewBox:"0 0 4 4",children:e.jsx("polygon",{points:"0,0 4,0 2,2"})})})]})]})},he={4:"w-4 h-4",6:"w-6 h-6",8:"w-8 h-8"},qa=(a,s)=>`${a}?width=${s}&format=webp&quality=85`,wt=t.memo(function({id:s,brand:r,model:i,price:l,oldPrice:n,discount:c,image:m=[],"data-images":f=[],specs:x,year:v,country:g,articleNumber:N,productType:j,commentCount:w=0,initialRating:E=0,imageHeight:y="h-36",iconSize:_=4,heartSize:b=6,className:C,previewImage:h,showAvailability:R=!0,discountIconClass:I,heartClass:k}){const o=nt(),d=Ke(O=>O.addItem),p=st(O=>O.favorites),u=st(O=>O.toggleFavorite),S=Le(),P=G(),D=t.useCallback(O=>{O.forEach(V=>{const K=new Image;K.src=`${V}?width=300`,K.loading="eager",K.decoding="async"})},[]),T=async O=>{const{data:V,error:K}=await M.from("products").select("*").eq("id",O).single();if(K)throw new Error(K.message);return V},B=t.useCallback(()=>{o.prefetchQuery({queryKey:["product",s],queryFn:()=>(D(f.slice(0,2)),T(s))})},[s,f,o,D]),ae=t.useCallback(()=>{be(()=>import("./ProductDetail-DAE-fbPB.js"),__vite__mapDeps([0,1,2,3,4,5,6]))},[]),Y=t.useMemo(()=>(m.length>0?m:f).map(V=>qa(V,300)),[m,f]),[F,Z]=t.useState(E),[ce,ee]=t.useState(0),[ue,le]=t.useState(!1),[Ce,fe]=t.useState(!1),[se,re]=t.useState(!1),[Q,_e]=t.useState(!1),ve=t.useRef(null),pe=t.useRef(null),ne=t.useRef(null),de=t.useRef(null),Oe=500,Pe=10;t.useEffect(()=>{const O=new IntersectionObserver(([K])=>{K.isIntersecting&&!Q&&(_e(!0),O.disconnect())},{rootMargin:"200px",threshold:.1}),V=ve.current;return V&&O.observe(V),()=>{V&&O.unobserve(V),O.disconnect()}},[Q]),t.useEffect(()=>{if(!Q)return;const O=V=>{const K=new Image;return K.src=V,new Promise((Te,Ye)=>{K.onload=Te,K.onerror=Ye})};Promise.all(Y.slice(0,2).map(O)).catch(()=>re(!0))},[Q,Y]),t.useEffect(()=>(ue&&Y.length>1&&(pe.current=setInterval(()=>{ee(O=>(O+1)%Y.length)},3e3)),()=>{pe.current&&clearInterval(pe.current)}),[ue,Y.length]);const Fe=t.useCallback(()=>{le(!0),Y.length>1&&ee(1)},[Y.length]),Ue=t.useCallback(()=>{le(!1),ee(0)},[]),qe=t.useCallback(O=>{O.target.closest("button")||(B(),ae(),ne.current={startTime:Date.now(),startX:O.touches[0].clientX,startY:O.touches[0].clientY,moved:!1},Y.length>1&&(de.current=setTimeout(()=>{le(!0)},Oe)))},[Y.length,B,ae]),ze=t.useCallback(O=>{if(!ne.current)return;const{clientX:V,clientY:K}=O.touches[0],Te=Math.abs(V-ne.current.startX),Ye=Math.abs(K-ne.current.startY);(Te>Pe||Ye>Pe)&&(ne.current.moved=!0,de.current&&clearTimeout(de.current),le(!1))},[]),Be=t.useCallback(O=>{de.current&&clearTimeout(de.current),le(!1),ee(0),ne.current=null},[]),ye=t.useCallback(Kt(async O=>{try{const{error:V}=await M.from("products").update({rating:O}).eq("id",s);V||(await o.invalidateQueries({queryKey:["home-products"],exact:!1}),Z(O))}catch(V){console.error("Помилка оновлення рейтингу:",V)}},300),[s,o]),[we,Re]=t.useState(!1),Ee=t.useCallback(async O=>{if(!we){Re(!0);try{await O()}finally{setTimeout(()=>Re(!1),100)}}},[we]),Ie=p.includes(s),We=t.useCallback(async()=>{Ie?u(s):(u(s),await ye(F+1))},[u,s,Ie,F,ye]),Me=t.useCallback(async()=>{d(s),await ye(F+1)},[d,s,F,ye]),He=t.useCallback(()=>{P(`/product/${s}#comments`)},[s,P]),Je=t.useCallback(()=>j==="tire"&&x.width&&x.profile&&x.diameter?`${x.width}/${x.profile} R${x.diameter}`:j==="wheel"&&x.width&&x.diameter?`${x.width}J x R${x.diameter}`:x.size||"",[j,x]),Ve=t.useMemo(()=>Math.min(Math.floor(F/20),5),[F]),De=t.useCallback(O=>O.toLocaleString("uk-UA",{minimumFractionDigits:0,maximumFractionDigits:0})+" ₴",[]),lt=t.useMemo(()=>g&&g.length===2?g.toUpperCase():"US",[g]);return e.jsx(W,{to:`/product/${s}`,state:{preserveScroll:!0},className:"block",children:e.jsxs("div",{className:`group rounded-lg p-0 relative transition-shadow w-full pb-2 select-none bg-transparent border border-transparent md:group-hover:bg-white md:group-hover:border-gray-100 md:group-hover:shadow-lg ${C||""}`,children:[e.jsx("button",{onClick:O=>{O.stopPropagation(),O.preventDefault(),Ee(We)},className:`absolute right-2 z-10 ${k||"top-0"}`,disabled:we,"aria-label":"Додати до улюблених",children:e.jsx(Qs,{className:`${he[b]} stroke-2 transition-all duration-300 ${Ie?"text-red-500 fill-red-500":"text-gray-300 fill-gray-100"} ${we?"animate-pulse scale-125":""}`})}),c&&c>0&&e.jsx("div",{...!S&&{onMouseEnter:()=>fe(!0),onMouseLeave:()=>fe(!1)},className:`absolute top-1 ${I||"left-4 lg:translate-x-4"} z-10 transition-transform duration-300 ${Ce?"rotate-45":""}`,children:e.jsx(Ks,{className:"w-4 h-4 lg:w-5 lg:h-5"})}),e.jsxs("div",{ref:ve,className:`relative ${y} mb-2 flex items-center justify-center overflow-hidden rounded-lg bg-white`,...!S&&{onMouseEnter:Fe,onMouseLeave:Ue},onTouchStart:qe,onTouchMove:ze,onTouchEnd:Be,onTouchCancel:()=>{de.current&&clearTimeout(de.current),le(!1),ee(0),ne.current=null},children:[se?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gray-100",children:[e.jsx("p",{className:"text-red-500 text-sm mb-2",children:"Помилка завантаження"}),e.jsx(xe,{variant:"outline",size:"sm",onClick:()=>re(!1),children:"Спробувати знову"})]}):h||Y.map((O,V)=>e.jsx("img",{src:O,alt:`${r} ${i}`,className:`absolute max-h-full w-auto object-contain transition-all duration-500 ${V===ce?"opacity-100":"opacity-0"}`,loading:Q?"lazy":"eager",decoding:"async",onError:()=>re(!0)},O)),R&&e.jsx(Js,{className:"absolute top-24 -left-3 z-10"})]}),e.jsxs("div",{className:"px-2 pb-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1 mb-1",children:[e.jsxs("h3",{className:"text-sm font-bold text-black break-words",children:[r," ",i]}),e.jsx("span",{className:"text-sm font-bold text-black whitespace-nowrap",children:Je()}),x.load_index&&x.speed_index&&e.jsxs("span",{className:"text-sm font-bold text-black whitespace-nowrap",children:[x.load_index,x.speed_index]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between mb-2 gap-y-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Арт: ",N]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[[...Array(5)].map((O,V)=>e.jsx(Zs,{className:`${he[_]} ${V<Ve?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},V)),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",F,")"]})]}),e.jsxs("button",{onClick:O=>{O.stopPropagation(),O.preventDefault(),He()},className:"flex items-center gap-1 hover:opacity-75 transition-opacity","aria-label":"Коментарі",children:[e.jsx(ea,{className:he[_]}),w>0&&e.jsx("span",{className:"text-xs text-gray-500",children:w})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{tooltip:"Легкові шини",children:e.jsx(ta,{className:`${he[_]} text-blue-600`})}),x.season==="winter"?e.jsx(ge,{tooltip:"Зимова шина",children:e.jsx(cs,{className:`${he[_]} text-blue-600`})}):x.season==="summer"?e.jsx(ge,{tooltip:"Літня шина",children:e.jsx(os,{className:he[_]})}):x.season==="all-season"?e.jsx(ge,{tooltip:"Універсальна шина",children:e.jsx(ds,{className:he[_]})}):null,x.spikes&&e.jsx(ge,{tooltip:"Шиповані шини",children:e.jsx("div",{className:"bg-red-500 text-white text-xs px-1 py-0.5 rounded-sm",children:"Ш"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{tooltip:`Країна: ${g}`,children:e.jsx("div",{className:"aspect-square rounded-full overflow-hidden border w-4 h-4 relative",children:e.jsx(jt,{countryCode:lt,svg:!0,className:"absolute top-1/2 left-1/2 w-[135%] h-[135%] -translate-x-1/2 -translate-y-1/2 object-cover",title:g,"aria-label":g})})}),e.jsx("span",{className:"text-xs text-gray-500",children:v})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[x.fuel_Efficiency&&e.jsx(ge,{tooltip:`Ефективність палива: ${x.fuel_Efficiency}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(sa,{className:he[_]}),e.jsx("span",{className:"text-xs text-gray-700",children:x.fuel_Efficiency})]})}),x.wetGrip&&e.jsx(ge,{tooltip:`Зчеплення на мокрій дорозі: ${x.wetGrip}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(aa,{className:he[_]}),e.jsx("span",{className:"text-xs text-gray-700",children:x.wetGrip})]})}),x.noise&&e.jsx(ge,{tooltip:`Рівень шуму: ${x.noise} dB`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ra,{className:`${he[_]} text-blue-600`}),e.jsxs("span",{className:"text-xs text-gray-700",children:[x.noise," dB"]})]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx("div",{className:"flex-grow",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-red-600 font-bold text-sm break-words",children:De(l)}),e.jsx("div",{className:"text-gray-400 line-through text-xs",children:n?De(n):""})]}):e.jsx("div",{className:"text-green-600 font-bold text-sm break-words",children:De(l)})}),e.jsx(xe,{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-xs md:text-sm shadow-md transition-transform hover:scale-105 ml-3 z-20",onClick:O=>{O.stopPropagation(),O.preventDefault(),Ee(Me)},onTouchStart:O=>{O.stopPropagation(),O.preventDefault()},onTouchEnd:O=>{O.stopPropagation(),O.preventDefault(),Ee(Me)},"aria-label":"Купити",children:"Купити"})]})]})]})})});t.memo(wt);const bs=()=>{const a=G(),r=me().pathname==="/articles",{data:i=[],isLoading:l}=rt({queryKey:["articles"],queryFn:async()=>{const{data:n,error:c}=await M.from("articles").select("*");if(c)throw new Error(c.message);return n},staleTime:6*60*60*1e3});return t.useEffect(()=>{!l&&i.length>0&&i.forEach(n=>{if(n.image_path){const{data:{publicUrl:c}}=M.storage.from("articles-images").getPublicUrl(n.image_path);if(c){const m=new Image;m.src=c}}})},[l,i]),e.jsxs("div",{className:"container mx-auto p-1 sm:p-4 ",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-6",children:"Блог та Статті"}),r?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:i.map(n=>{const c=n.image_path&&M.storage.from("articles-images").getPublicUrl(n.image_path).data.publicUrl;return e.jsxs("div",{className:"cursor-pointer",onClick:()=>a(`/articles/${n.id}`),children:[c?e.jsx("img",{src:c,alt:n.title,className:"w-full h-64 object-cover rounded-lg"}):e.jsx("div",{className:"w-full h-64 bg-gray-300 rounded-lg flex items-center justify-center",children:"Нет изображения"}),e.jsx("h2",{className:"text-xl font-semibold text-center mt-2",children:n.title})]},n.id)})}):e.jsxs(e.Fragment,{children:[e.jsx(za,{articles:i}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{className:"px-2 py-2 rounded text-black border-2 border-green-600 bg-transparent hover:bg-blue-50 transition-all",onClick:()=>a("/articles"),children:"дивитись всі публікації"})})]})]})},za=({articles:a})=>{const s=G(),[r,i]=te.useState(window.innerWidth<640),[l,n]=te.useState(0),c=te.useRef(null);t.useEffect(()=>{const f=()=>i(window.innerWidth<640);return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]);const m=()=>{if(c.current){const f=c.current.scrollLeft,x=c.current.clientWidth,v=Math.round(f/x);n(v)}};return a.length===0?e.jsx("div",{children:"Нет статей для отображения"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:c,onScroll:r?m:void 0,className:"flex space-x-4 overflow-x-auto scroll-smooth snap-x snap-mandatory",children:a.map(f=>{const x=f.image_path&&M.storage.from("articles-images").getPublicUrl(f.image_path).data.publicUrl;return e.jsxs("div",{onClick:()=>s(`/articles/${f.id}`),className:"flex-shrink-0 w-full sm:w-1/2 md:w-1/3 cursor-pointer snap-start",children:[x?e.jsx("img",{src:x,alt:f.title,className:"w-full h-64 object-cover rounded-lg"}):e.jsx("div",{className:"w-full h-64 bg-gray-300 rounded-lg flex items-center justify-center",children:"Нет изображения"}),e.jsx("h2",{className:"text-xl font-semibold text-center mt-2",children:f.title})]},f.id)})}),r&&e.jsx("div",{className:"flex justify-center mt-2",children:a.map((f,x)=>e.jsx("div",{className:`mx-1 w-3 h-3 rounded-full ${x===l?"bg-blue-600":"bg-gray-300"}`},x))})]})},Ba={hasVisited:!1},Wa=t.createContext([Ba,()=>{}]),Ha=t.lazy(()=>be(()=>import("./SaleProductsSection-BXFS9jbG.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),Va=t.lazy(()=>be(()=>import("./NewArrivalsSection-IfmmO0D8.js"),__vite__mapDeps([8,1,2,3,4,5,6]))),Ya=t.lazy(()=>be(()=>import("./TopRatedSection-DY78iUV-.js"),__vite__mapDeps([9,1,2,3,4,5,6]))),Ga=t.lazy(()=>be(()=>import("./FooterSection-BS9PM11-.js"),__vite__mapDeps([10,1,2,3]))),ct=a=>{a()},Xa=()=>{const a=Le(),[s,r]=t.useState(0),[i,l]=t.useState(0),[n,c]=t.useState(0),[m,f]=t.useState(!1),x=t.useRef(0),v=t.useRef(0),g=t.useRef(!1),N=t.useCallback(u=>{x.current=u.touches[0].clientX,v.current=u.touches[0].clientY,g.current=!1,f(!0)},[]),j=t.useCallback(u=>{if(!m)return;const S=u.touches[0].clientX,P=u.touches[0].clientY,D=Math.abs(S-x.current),T=Math.abs(P-v.current);!g.current&&(D>10||T>10)&&(g.current=D>T),g.current&&(u.preventDefault(),c(S-x.current))},[m]);t.useEffect(()=>{const u=S=>{m&&g.current&&S.preventDefault()};return document.addEventListener("touchmove",u,{passive:!1}),()=>{document.removeEventListener("touchmove",u)}},[m]);const{data:w=[],isLoading:E}=rt({queryKey:["home-products"],queryFn:async()=>{const{data:u,error:S}=await M.from("products").select(`
          id,
          brand,
          model,
          price,
          sale_price,
          image_url,
          noise_level,
          year,
          country,
          created_at,
          type,
          width,
          profile,
          diameter,
          season,
          reviews (count),
          rating,
          spikes,
          fuel_efficiency,
          wet_grip,
          load_index,
          speed_index
        `).order("created_at",{ascending:!1}).limit(12);if(S)throw S;return u.map(P=>{var D;return{...P,comment_count:((D=P.reviews[0])==null?void 0:D.count)||0}})},staleTime:18e5});t.useEffect(()=>{!E&&w.length>0&&w.forEach(u=>{u.image_url.forEach(S=>{const P=new Image;P.src=S})})},[E,w]);const y=t.useCallback(u=>u.type==="tire"?{size:`${u.width}/${u.profile}R${u.diameter}`,season:u.season,spikes:u.spikes,fuel_Efficiency:u.fuel_efficiency,wetGrip:u.wet_grip,noise:u.noise_level}:{size:`${u.width}J x R${u.diameter}`},[]),_=t.useCallback((u,S=!0,P,D)=>e.jsx(wt,{id:u.id,brand:u.brand,model:u.model,price:u.sale_price||u.price,oldPrice:u.sale_price?u.price:void 0,discount:u.sale_price?Math.round((u.price-u.sale_price)/u.price*100):void 0,image:S?[]:u.image_url,"data-images":u.image_url,specs:y(u),articleNumber:u.id.slice(0,8).toUpperCase(),commentCount:u.comment_count||0,initialRating:u.rating,productType:u.type,year:u.year,country:u.country,className:P,...D},u.id),[y]),b=t.useMemo(()=>w.filter(u=>u.sale_price!==null&&u.sale_price<u.price),[w]),C=t.useMemo(()=>w.filter(u=>!b.some(S=>S.id===u.id)).slice(0,8),[w,b]),h=t.useMemo(()=>[...w].sort((S,P)=>(P.rating||0)-(S.rating||0)).slice(0,4),[w]),R=t.useCallback(u=>{const P=w.filter(T=>!T.sale_price||T.sale_price>=T.price).length,D=Math.ceil(P/4);r(T=>u==="next"?(T+1)%D:(T-1+D)%D)},[w]),I=t.useCallback(()=>{l(u=>(u-1+h.length)%h.length)},[h.length]),k=t.useCallback(()=>{l(u=>(u+1)%h.length)},[h.length]),o=t.useCallback(()=>{m&&g.current&&(n>50?I():n<-50&&k()),f(!1),c(0),g.current=!1},[m,n,I,k]),d=t.useCallback(u=>{},[]),p=t.useCallback(u=>S=>{S.preventDefault();const P=document.getElementById(u);if(P){const D=P.getBoundingClientRect().top+window.scrollY-80;window.scrollTo({top:D,behavior:"smooth"})}Le()&&S.currentTarget.blur()},[]);return e.jsxs("div",{children:[e.jsx("nav",{className:"py-4",children:e.jsxs("ul",{className:"flex justify-center gap-4",children:[e.jsx("li",{onMouseEnter:()=>ct(()=>be(()=>import("./TopRatedSection-DY78iUV-.js"),__vite__mapDeps([9,1,2,3,4,5,6]))),children:e.jsx("a",{href:"#top",onClick:p("top"),className:"bg-gray-100 hover:bg-gray-200 rounded-lg px-4 py-2 transition-colors",children:"Топові"})}),e.jsx("li",{onMouseEnter:()=>ct(()=>be(()=>import("./NewArrivalsSection-IfmmO0D8.js"),__vite__mapDeps([8,1,2,3,4,5,6]))),children:e.jsx("a",{href:"#new",onClick:p("new"),className:"bg-gray-100 hover:bg-gray-200 rounded-lg px-4 py-2 transition-colors",children:"Новинки"})}),e.jsx("li",{onMouseEnter:()=>ct(()=>be(()=>import("./SaleProductsSection-BXFS9jbG.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),children:e.jsx("a",{href:"#sale",onClick:p("sale"),className:"bg-gray-100 hover:bg-gray-200 rounded-lg px-4 py-2 transition-colors",children:"Акції"})})]})}),e.jsxs("main",{className:"py-8",children:[e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"min-h-[400px]"}),children:e.jsx(Ha,{saleProducts:b,renderProductCard:_,lastProductRef:d,isLoading:E,isMobile:a})}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"min-h-[400px]"}),children:e.jsx(Va,{newArrivals:C,currentSlide:s,onSlideChange:R,isMobile:a,renderProductCard:_,lastProductRef:d,isLoading:E})}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"min-h-[400px]"}),children:e.jsx(Ya,{topRated:h,currentTopIndex:i,onPrev:I,onNext:k,isMobile:a,renderProductCard:_,dragOffset:n,isDragging:m,handleTouchStart:N,handleTouchMove:j,handleTouchEnd:o,lastProductRef:d,isLoading:E})})]})]})},Qa=()=>{const[a,s]=t.useContext(Wa),[r,i]=t.useState(!1),l=me();return t.useEffect(()=>{if(!a.hasVisited){i(!0),s({...a,hasVisited:!0});const n=setTimeout(()=>i(!1),1500);return()=>clearTimeout(n)}},[a,s,l.key]),e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -top-4 left-0 right-0 h-[300px] bg-blue-800 z-[-1]"}),e.jsx(Ua,{shouldAnimate:r})]}),e.jsx("div",{className:r?"content-fadeIn":"",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"px-2 sm:px-6 lg:mx-auto lg:max-w-[1024px] lg:px-8",children:[e.jsx(Xa,{}),e.jsx("section",{className:"mt-8",children:e.jsx(bs,{})})]})})}),e.jsx(t.Suspense,{fallback:null,children:e.jsx(Ga,{})})]})},js=({currentPage:a,totalPages:s,onPageChange:r})=>{const i=()=>{window.scrollTo({top:0,behavior:"smooth"})},l=()=>{const f=[];let v=Math.max(1,a-2),g=Math.min(s,a+2);a-2<=1&&(g=Math.min(s,5)),a+2>=s&&(v=Math.max(1,s-4));for(let N=v;N<=g;N++)f.push(N);return v>1&&f.unshift(1),g<s&&f.push(s),f},n=f=>{r(f),i()},c=()=>{n(Math.max(1,a-1))},m=()=>{n(Math.min(s,a+1))};return e.jsxs("div",{className:"flex flex-col items-center gap-4 mt-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:c,disabled:a===1,className:`px-4 py-2 rounded ${a===1?"bg-gray-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"} text-white transition-colors`,children:"Попередня"}),e.jsx("div",{className:"flex gap-1",children:l().map((f,x,v)=>e.jsxs(te.Fragment,{children:[x>0&&v[x]-v[x-1]>1&&e.jsx("span",{className:"px-3 py-2",children:"..."}),e.jsx("button",{onClick:()=>n(f),className:`px-3 py-1 rounded ${a===f?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300"} transition-colors`,children:f})]},f))}),e.jsx("button",{onClick:m,disabled:a===s,className:`px-4 py-2 rounded ${a===s?"bg-gray-300 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"} text-white transition-colors`,children:"Наступна"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Сторінка ",a," з ",s]})]})},dt=()=>{const a=G(),{pathname:s}=me(),[r,i]=t.useState([]),[l,n]=t.useState(!0),[c,m]=Jt(),[f,x]=t.useState(null),[v,g]=t.useState(1),N=10,j=Math.ceil(r.length/N),w=t.useMemo(()=>{const k=(v-1)*N;return r.slice(k,k+N)},[r,v]),[E,y]=t.useState({brands:[],models:[],widths:[],profiles:[],diameters:[],seasons:[],countries:[],years:[]}),_=t.useMemo(()=>({brand:c.get("brand")||"",model:c.get("model")||"",width:c.get("width")||"",profile:c.get("profile")||"",diameter:c.get("diameter")||"",season:c.get("season")||"",country:c.get("country")||"",year:c.get("year")||"",spikes:c.get("spikes")||"",minPrice:c.get("minPrice")||"",maxPrice:c.get("maxPrice")||"",sale:c.get("sale")||"",tireSize:c.get("tireSize")||""}),[c]);t.useEffect(()=>{window.history.scrollRestoration="manual"},[s]);const b=t.useCallback(k=>{const{name:o,value:d,type:p,checked:u}=k.target,S=new URLSearchParams(c);p==="checkbox"?u?S.set(o,"true"):S.delete(o):d?S.set(o,d):S.delete(o),m(S),g(1)},[c,m]),C=t.useCallback((k,o)=>{const d=new URLSearchParams(c);o.length>0?d.set(k,o.join(",")):d.delete(k),m(d),g(1)},[c,m]),h=t.useCallback(()=>{m(new URLSearchParams),g(1)},[m]),R=t.useCallback(Kt(async(k,o)=>{try{n(!0),x(null);const d={...k};if(d.tireSize){const P=/^(\d+)[/](\d+)\s*R?(\d+)$/i,D=d.tireSize.match(P);if(D){const[,T,B,ae]=D;d.width=T,d.profile=B,d.diameter=ae}delete d.tireSize}let p=M.from("products").select("*");Object.entries(d).forEach(([P,D])=>{if(D)switch(P){case"sale":p=p.not("sale_price","is",null);break;case"brand":case"model":{const T=D.split(",");p=p.in(P,T);break}case"width":case"profile":case"diameter":case"year":case"minPrice":case"maxPrice":{const T=Number(D);isNaN(T)||(P==="minPrice"?p=p.gte("price",T):P==="maxPrice"?p=p.lte("price",T):p=p.eq(P,T));break}case"spikes":p=p.eq("spikes",D==="true");break;default:p=p.eq(P,D)}});const{data:u,error:S}=await p.abortSignal(o);if(S)throw S;i(u)}catch(d){o.aborted||(console.error("Error fetching products:",d),x("Ошибка загрузки. Попробуйте ещё раз."),i([]))}finally{o.aborted||n(!1)}},300),[]);t.useEffect(()=>{const k=new AbortController;return R(_,k.signal),()=>k.abort()},[_,R]),t.useEffect(()=>{(async()=>{try{const{data:o,error:d}=await M.from("products").select("brand, model, width, profile, diameter, season, country, year");if(d)throw d;o&&o.length>0&&y({brands:Array.from(new Set(o.map(p=>p.brand).filter(Boolean))).sort((p,u)=>p.localeCompare(u)),models:Array.from(new Set(o.map(p=>p.model).filter(Boolean))).sort((p,u)=>p.localeCompare(u)),widths:Array.from(new Set(o.map(p=>p.width).filter(p=>p!=null))).sort((p,u)=>p-u),profiles:Array.from(new Set(o.map(p=>p.profile).filter(p=>p!=null))).sort((p,u)=>p-u),diameters:Array.from(new Set(o.map(p=>p.diameter).filter(p=>p!=null))).sort((p,u)=>p-u),seasons:Array.from(new Set(o.map(p=>p.season).filter(Boolean))).sort((p,u)=>p.localeCompare(u)),countries:Array.from(new Set(o.map(p=>p.country).filter(Boolean))).sort((p,u)=>p.localeCompare(u)),years:Array.from(new Set(o.map(p=>p.year).filter(p=>p!=null))).sort((p,u)=>p-u)})}catch(o){console.error("Error fetching distinct filters",o)}})()},[]);const I=t.useMemo(()=>w.map(k=>{const o=k.sale_price&&k.price>k.sale_price,d=o?Math.round((k.price-(k.sale_price||0))/k.price*100):void 0;return e.jsx("div",{className:"relative group",children:e.jsx(wt,{...k,productType:k.type,price:k.sale_price||k.price,oldPrice:o?k.price:void 0,discount:d,image:k.image_url||[],initialRating:k.rating||0,specs:{season:k.season||"",width:k.width||0,profile:k.profile||0,diameter:k.diameter||0,spikes:k.spikes||!1},year:k.year||new Date().getFullYear(),country:k.country||"",articleNumber:k.id.slice(0,8)})},k.id)}),[w]);return e.jsx("div",{className:"bg-white min-h-screen relative",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Каталог шин"}),e.jsxs("button",{onClick:k=>{k.stopPropagation(),a(`/detailed-search?${c.toString()}`)},className:"flex items-center gap-2 text-blue-800 md:hidden",children:[e.jsx(us,{className:"w-5 h-5"}),e.jsx("span",{children:"Фільтри"})]})]}),f&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded-lg",children:f}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"hidden md:block md:w-1/4",children:e.jsx(Ka,{filters:_,onChange:b,onMultiSelectChange:C,distinctOptions:E})}),e.jsx("div",{className:"flex -mx-2 sm:mx-0",children:l?e.jsx(Ja,{}):r.length===0?e.jsx(Za,{onReset:h}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 gap-0 sm:px-0 justify-items-stretch",children:I}),j>1&&e.jsx(js,{currentPage:v,totalPages:j,onPageChange:k=>g(k)})]})})]})]})})},Ka=te.memo(({filters:a,onChange:s,onMultiSelectChange:r,distinctOptions:i})=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Фільтри"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Vt,{name:"sale",label:"Акційні товари",checked:a.sale==="true",onChange:s}),e.jsx(ke,{name:"brand",label:"Бренд",options:i.brands,value:a.brand?a.brand.split(","):[],onChange:r}),e.jsx(ke,{name:"model",label:"Модель",options:i.models,value:a.model?a.model.split(","):[],onChange:r}),e.jsx(ke,{name:"width",label:"Ширина",options:i.widths,value:a.width?a.width.split(","):[],onChange:r}),e.jsx(ke,{name:"profile",label:"Профіль",options:i.profiles,value:a.profile?a.profile.split(","):[],onChange:r}),e.jsx(ke,{name:"diameter",label:"Діаметр",options:i.diameters,value:a.diameter?a.diameter.split(","):[],onChange:r}),e.jsx(ke,{name:"season",label:"Сезон",options:i.seasons,value:a.season?a.season.split(","):[],onChange:r}),e.jsx(ke,{name:"country",label:"Країна",options:i.countries,value:a.country?a.country.split(","):[],onChange:r}),e.jsx(ke,{name:"year",label:"Рік",options:i.years,value:a.year?a.year.split(","):[],onChange:r}),e.jsx(Vt,{name:"spikes",label:"Шипи",checked:a.spikes==="true",onChange:s}),e.jsx(Ht,{name:"minPrice",label:"Мін. ціна",value:a.minPrice,onChange:s}),e.jsx(Ht,{name:"maxPrice",label:"Макс. ціна",value:a.maxPrice,onChange:s})]})]})),Ht=te.memo(({name:a,label:s,value:r,onChange:i})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s}),e.jsx("input",{name:a,type:"number",value:r,onChange:i,className:`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${r?"bg-blue-100":""}`,min:"0"})]})),ke=te.memo(({name:a,label:s,options:r,value:i,onChange:l})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:s}),e.jsx(J,{multiple:!0,value:i,onValueChange:n=>l(a,n),placeholder:`Выберите ${s.toLowerCase()}`,onMouseDown:n=>n.preventDefault(),className:i.length>0?"bg-blue-100":"",...a==="season"&&{displayValue:n=>n.map(c=>c==="summer"?"ЛІТНІ":c==="winter"?"ЗИМОВІ":c==="all-season"?"ВСЕСЕЗОННІ":c).join(", ")},children:r.map(n=>{const c=n.toString(),m=a==="season"?c==="summer"?"ЛІТНІ":c==="winter"?"ЗИМОВІ":c==="all-season"?"ВСЕСЕЗОННІ":c:c;return e.jsx(X,{value:c,children:m},c)})})]})),Vt=te.memo(({name:a,label:s,checked:r,onChange:i})=>e.jsx("div",{className:r?"bg-blue-100 p-1 rounded":"",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{name:a,type:"checkbox",checked:r,onChange:i,className:"form-checkbox h-4 w-4 text-blue-600 transition-colors"}),e.jsx("span",{className:"text-sm font-medium",children:s})]})})),Ja=te.memo(()=>e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-800"})})),Za=te.memo(({onReset:a})=>e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx("p",{className:"text-xl mb-2",children:"Товари не знайдені"}),e.jsx("p",{className:"text-sm mb-4",children:"Спробуйте змінити параметри фільтрів"}),e.jsx("button",{onClick:a,className:"text-blue-600 hover:text-blue-700 underline text-sm",children:"Скинути всі фільтри"})]})),er=()=>{const{id:a}=vt(),s=G(),r=me(),[i,l]=t.useState([]),[n,c]=t.useState(""),[m,f]=t.useState(5),[x,v]=t.useState(null),[g,N]=t.useState(!0);t.useEffect(()=>{(async()=>{const{data:{user:E}}=await M.auth.getUser();v(E),N(!1)})()},[]),t.useEffect(()=>{!g&&!x&&s("/auth",{state:{from:r.pathname}})},[g,x,s,r.pathname]),t.useEffect(()=>{a&&(async()=>{const{data:E,error:y}=await M.from("reviews").select("id, product_id, comment, created_at, user_id, rating").eq("product_id",a).order("created_at",{ascending:!1});!y&&E&&l(E)})()},[a]);const j=async w=>{if(w.preventDefault(),!n.trim())return;if(!x){s("/auth",{state:{from:r.pathname}});return}const{data:E,error:y}=await M.from("reviews").insert([{product_id:a,comment:n,rating:m,user_id:x.id}]).select();!y&&E&&(l([E[0],...i]),c(""),f(5))};return g?null:e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Відгуки про товар"}),e.jsxs("p",{className:"mb-6 text-sm text-gray-600",children:["Всього відгуків: ",i.length]}),e.jsxs("form",{onSubmit:j,className:"mb-8 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Ваша оцінка:"}),e.jsx("select",{value:m,onChange:w=>f(Number(w.target.value)),className:"w-full p-2 border rounded",children:[5,4,3,2,1].map(w=>e.jsxs("option",{value:w,children:[w," ★"]},w))})]}),e.jsx("textarea",{value:n,onChange:w=>c(w.target.value),className:"w-full p-2 border rounded mb-4",placeholder:"Напишіть ваш відгук...",rows:4,required:!0}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Опублікувати"})]}),e.jsx("div",{className:"space-y-6",children:i.length===0?e.jsx("p",{children:"Відгуків поки немає."}):i.map(w=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center",children:[...Array(5)].map((E,y)=>e.jsx("span",{className:`text-xl ${y<w.rating?"text-yellow-400":"text-gray-300"}`,children:"★"},y))}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(w.created_at).toLocaleDateString("uk-UA")})]}),e.jsx("p",{className:"text-gray-800 mb-2",children:w.comment}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Користувач: анонімний ",w.user_id.slice(0,6)]})]},w.id))})]})})},tr=()=>{var h;const[a,s]=t.useState(!0),[r,i]=t.useState(""),[l,n]=t.useState(""),[c,m]=t.useState(""),[f,x]=t.useState(""),[v,g]=t.useState(!1),[N,j]=t.useState(null),w=G(),y=((h=me().state)==null?void 0:h.from)||"/profile";t.useEffect(()=>{(async()=>{const{data:{user:I}}=await M.auth.getUser();I&&(j(I),w(y))})()},[w,y]);const _=async R=>{R.preventDefault(),g(!0);try{if(a){const{error:I}=await M.auth.signInWithPassword({email:r,password:l});if(I)throw I;q.success("Ви успішно увійшли в профіль!"),w(y)}else{if(!c||!f||!l){q.error("Будь ласка, заповніть усі обов’язкові поля: ім’я, пароль та номер телефону."),g(!1);return}const{error:I}=await M.auth.signInWithPassword({email:r,password:l});if(I)if(I.message==="Invalid login credentials"){const{error:k}=await M.auth.signUp({email:r,password:l});if(k)throw k;const{data:{user:o}}=await M.auth.getUser();if(o){const{error:d}=await M.from("users").insert([{id:o.id,name:c,phone:f,email:r}]);if(d)throw d}q.success("Реєстрацію успішно завершено!"),q.success("Ви успішно увійшли в профіль!"),w(y)}else throw I;else{q.error("Користувач з таким email вже зареєстрований."),g(!1);return}}}catch(I){q.error(I instanceof Error?I.message:"Сталася помилка")}finally{g(!1)}},b=async()=>{g(!0);try{const{error:R}=await M.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}${y}`}});if(R)throw R}catch(R){q.error(R instanceof Error?R.message:"Сталася помилка")}finally{g(!1)}},C=async()=>{try{const{error:R}=await M.auth.signOut();if(R)throw R;q.success("Ви успішно вийшли з профілю!"),j(null),w("/")}catch(R){q.error(R instanceof Error?R.message:"Сталася помилка")}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative",children:[e.jsx(yt,{}),N&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:C,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-500",children:"Вийти"})}),e.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-md",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-center text-3xl font-bold text-gray-900",children:a?"Увійти в акаунт":"Створити акаунт"})}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:_,children:[!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"sr-only",children:"Ім'я"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(hs,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"name",name:"name",type:"text",required:!0,value:c,onChange:R=>m(R.target.value),className:"appearance-none rounded-md relative block w-full px-3 py-2 pl-10 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Ім'я"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"sr-only",children:"Телефон"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(na,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"phone",name:"phone",type:"text",required:!0,value:f,onChange:R=>x(R.target.value),className:"appearance-none rounded-md relative block w-full px-3 py-2 pl-10 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Телефон"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ia,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,value:r,onChange:R=>i(R.target.value),className:"appearance-none rounded-md relative block w-full px-3 py-2 pl-10 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Email"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Пароль"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(la,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,value:l,onChange:R=>n(R.target.value),className:"appearance-none rounded-md relative block w-full px-3 py-2 pl-10 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Пароль"})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:v,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-800 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:v?e.jsx("div",{className:"w-5 h-5 border-t-2 border-white rounded-full animate-spin"}):a?"Увійти":"Зареєструватися"})}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:b,disabled:v,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:v?"Підключення...":"Увійти через Google"})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>s(!a),className:"text-sm text-blue-800 hover:text-blue-700",children:a?"Немає акаунту? Зареєструватися":"Вже є акаунт? Увійти"})})]})]})]})},sr=()=>{const a=G(),[s,r]=t.useState(null),[i,l]=t.useState([]),[n,c]=t.useState(!0),[m,f]=t.useState(!1),[x,v]=t.useState(!1),[g,N]=t.useState({name:"",phone:"",address:""}),j=t.useRef(!0);t.useEffect(()=>{(async()=>{await w(),await E()})()},[]);const w=async()=>{const{data:{user:b}}=await M.auth.getUser();if(!b){a("/auth");return}const{data:C,error:h}=await M.from("users").select("*").eq("id",b.id).maybeSingle();if(h){console.error("Error fetching user:",h),c(!1);return}if(!C){if(!x){v(!0);const{error:R,data:I}=await M.from("users").insert([{id:b.id,name:b.email,phone:"",address:""}]).select().maybeSingle();if(R){console.error("Error creating profile:",R),q.error("Помилка створення профілю"),c(!1);return}I&&(r(I),N({name:I.name||"",phone:I.phone||"",address:I.address||""}),q.success("Профіль успішно створено!"))}c(!1);return}r(C),N({name:C.name||"",phone:C.phone||"",address:C.address||""}),j.current&&(q.success("Вхід виконано успішно!"),j.current=!1),c(!1)},E=async()=>{const{data:{user:b}}=await M.auth.getUser();if(!b)return;const{data:C,error:h}=await M.from("orders").select("*").eq("user_id",b.id).order("created_at",{ascending:!1});h?(console.error("Error fetching orders:",h),q.error("Помилка завантаження замовлень")):l(C)},y=async b=>{if(b.preventDefault(),!!s)try{const{error:C}=await M.from("users").update(g).eq("id",s.id);if(C)throw C;f(!1),await w(),q.success("Профіль оновлено!")}catch(C){console.error("Update error:",C),q.error("Помилка оновлення профілю")}},_=async()=>{await M.auth.signOut(),q.success("Вихід виконано!"),a("/auth")};return n?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-800"})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Особистий кабінет"}),e.jsxs("button",{onClick:_,className:"flex items-center text-gray-600 hover:text-red-500",children:[e.jsx(pt,{className:"w-5 h-5 mr-2"}),"Вийти"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Профіль"}),e.jsx("button",{onClick:()=>f(!m),className:"text-blue-800 hover:text-blue-700 text-sm",children:m?"Скасувати":"Редагувати"})]}),m?e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ім'я"}),e.jsx("input",{type:"text",value:g.name,onChange:b=>N({...g,name:b.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Телефон"}),e.jsx("input",{type:"tel",value:g.phone,onChange:b=>N({...g,phone:b.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Адреса"}),e.jsx("input",{type:"text",value:g.address,onChange:b=>N({...g,address:b.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-800 text-white py-2 rounded-md hover:bg-blue-700",children:"Зберегти"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(hs,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsx("span",{children:(s==null?void 0:s.name)||"Не вказано"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(gt,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsx("span",{children:(s==null?void 0:s.phone)||"Не вказано"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(gt,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsx("span",{children:(s==null?void 0:s.address)||"Не вказано"})]})]})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Історія замовлень"}),i.length===0?e.jsx("p",{className:"text-gray-500",children:"У вас ще немає замовлень"}):e.jsx("div",{className:"space-y-4",children:i.map(b=>e.jsxs("div",{className:"border border-gray-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:new Date(b.created_at).toLocaleDateString()}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${b.status==="delivered"?"bg-green-100 text-green-800":b.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:b.status==="delivered"?"Доставлено":b.status==="pending"?"В обробці":"В дорозі"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:["Замовлення #",b.id.slice(0,8)]}),e.jsxs("span",{className:"font-bold",children:[b.total," ₴"]})]})]},b.id))})]})})]})]})})},ar="https://api.novaposhta.ua/v2.0/json/",rr=void 0,at=new Map,vs=30*60*1e3,ys=async(a,s,r,i=!1)=>{const l=`${a}_${s}_${JSON.stringify(r)}`;if(!i){const n=at.get(l);if(n&&Date.now()-n.timestamp<vs)return n.data}try{const n=await Ps.post(ar,{apiKey:rr,modelName:a,calledMethod:s,methodProperties:r});if(n.data.success)return at.set(l,{data:n.data.data,timestamp:Date.now()}),n.data.data;throw new Error(n.data.errors.join(", "))}catch(n){const c=n instanceof Error?n.message:"Unknown error occurred";throw new Error(`API Request failed: ${c}`)}},nr=async()=>{const a="all_cities",s=at.get(a);if(s&&Date.now()-s.timestamp<vs)return s.data;const r=[],i=300;let l=1,n=!0;try{for(;n;){const c=await ys("Address","getCities",{Page:l.toString(),Limit:i.toString(),Language:"UA"},!0);r.push(...c),c.length<i?n=!1:l++}return at.set(a,{data:r,timestamp:Date.now()}),r}catch(c){throw console.error("Error fetching cities:",c),c}},Yt=async a=>{try{const s={Page:"1",Limit:"300",Language:"UA",...a};return await ys("AddressGeneral","getWarehouses",s)}catch(s){return console.error("Error fetching warehouses:",s),[]}},ir=()=>{const a=G(),{items:s,clearCart:r,total:i}=Ke(),[l,n]=t.useState(!1),[c,m]=t.useState([]),[f,x]=t.useState(!1),[v,g]=t.useState(!1),[N,j]=t.useState([]),[w,E]=t.useState(null),[y,_]=t.useState({firstName:"",lastName:"",phone:"",cityRef:"",warehouseRef:"",delivery:"nova-poshta",payment:"card",city:"",warehouse:""});t.useEffect(()=>{const d=async()=>{if(!(c.length>0)){x(!0);try{const p=await nr();m(p.map(u=>({value:u.Ref,label:u.Description,ref:u.Ref})))}catch(p){console.error("Error loading cities:",p)}finally{x(!1)}}};y.delivery==="nova-poshta"&&d()},[y.delivery,c.length]);const b=t.useCallback(async d=>{if(!y.cityRef)return[];g(!0);try{return(await Yt({CityRef:y.cityRef,FindByString:d})).map(S=>({value:S.Ref||"",label:S.Description}))}catch(p){return console.error("Error loading warehouses by search:",p),[]}finally{g(!1)}},[y.cityRef]),C=t.useCallback(async d=>{if(d){g(!0);try{const u=(await Yt({CityRef:d})).map(S=>({value:S.Ref||"",label:S.Description}));j(u)}catch(p){console.error("Error loading warehouses:",p),j([])}finally{g(!1)}}},[]),h=t.useCallback(d=>{d?(E(d),_({...y,city:d.label,cityRef:d.value,warehouseRef:"",warehouse:""}),C(d.value)):(E(null),_({...y,city:"",cityRef:"",warehouseRef:"",warehouse:""}),j([]))},[y,C]),R=t.useCallback(d=>{_({...y,warehouse:(d==null?void 0:d.label)||"",warehouseRef:(d==null?void 0:d.value)||""})},[y]),I=t.useCallback(d=>{const p=d.target.value;p==="odessa-pickup"?(_({...y,delivery:p,city:"Одеса",warehouse:"Склад Одеса",cityRef:"",warehouseRef:""}),E(null),j([])):(_({...y,delivery:p,city:"",warehouse:"",cityRef:"",warehouseRef:""}),E(null),j([]))},[y]),k=()=>!y.firstName||!y.lastName||!y.phone?!1:y.delivery==="nova-poshta"?!!(y.cityRef&&y.warehouseRef):!0,o=async d=>{if(d.preventDefault(),!k()){alert("Будь ласка, заповніть всі обов'язкові поля");return}n(!0);try{const{data:{user:p}}=await M.auth.getUser();if(!p)throw new Error("Користувач не авторизований");const u=p.id,{data:S,error:P}=await M.from("orders").insert([{user_id:u,status:"pending",total:i(),first_name:y.firstName,last_name:y.lastName,customer_phone:y.phone,shipping_address:y.delivery==="nova-poshta"?`${y.city}, ${y.warehouse}`:"Одеса, самовивіз",delivery_method:y.delivery,payment_method:y.payment}]).select("*").single();if(P)throw P;const D=s.map(B=>({order_id:S.id,product_id:B.product_id,quantity:B.quantity,price:B.price})),{error:T}=await M.from("order_items").insert(D);if(T)throw T;r(),a("/profile")}catch(p){console.error("Помилка оформлення замовлення:",p),alert(p instanceof Error?p.message:"Сталася невідома помилка")}finally{n(!1)}};return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8",children:"Оформлення замовлення"}),e.jsxs("form",{onSubmit:o,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Контактні дані"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ім'я*"}),e.jsx("input",{type:"text",required:!0,value:y.firstName,onChange:d=>_({...y,firstName:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Прізвище*"}),e.jsx("input",{type:"text",required:!0,value:y.lastName,onChange:d=>_({...y,lastName:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Телефон*"}),e.jsx("input",{type:"tel",required:!0,value:y.phone,onChange:d=>_({...y,phone:d.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",pattern:"[0-9]{10}",placeholder:"0991234567"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Доставка"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",value:"nova-poshta",checked:y.delivery==="nova-poshta",onChange:I,className:"text-blue-600 focus:ring-blue-500"}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Dt,{className:"w-5 h-5 mr-2"})," Нова Пошта"]})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",value:"odessa-pickup",checked:y.delivery==="odessa-pickup",onChange:I,className:"text-blue-600 focus:ring-blue-500"}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Dt,{className:"w-5 h-5 mr-2"})," Зібрати зі складу (Одеса)"]})]})]}),y.delivery==="nova-poshta"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Місто*"}),e.jsx(Rs,{options:c,value:w,onChange:h,placeholder:"Оберіть місто...",noOptionsMessage:()=>"Місто не знайдено",loadingMessage:()=>"Завантаження...",isSearchable:!0,isLoading:f,className:"react-select-container",classNamePrefix:"react-select",styles:{control:d=>({...d,border:"1px solid #e5e7eb",borderRadius:"0.375rem",padding:"0.25rem"})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Відділення*"}),e.jsx(Ms,{cacheOptions:!0,defaultOptions:N,loadOptions:b,onChange:R,isDisabled:!y.cityRef,placeholder:y.cityRef?"Оберіть відділення...":"Спочатку оберіть місто",noOptionsMessage:()=>"Відділення не знайдено",loadingMessage:()=>"Завантаження...",isLoading:v,className:"react-select-container",classNamePrefix:"react-select",styles:{control:d=>({...d,border:"1px solid #e5e7eb",borderRadius:"0.375rem",padding:"0.25rem"})}},y.cityRef),y.cityRef&&N.length===0&&!v&&e.jsx("p",{className:"text-sm text-yellow-600 mt-1",children:"Завантаження відділень... Якщо список порожній, спробуйте ввести перші букви вулиці або номер відділення."})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Оплата"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",value:"card",checked:y.payment==="card",onChange:d=>_({...y,payment:d.target.value}),className:"text-blue-600 focus:ring-blue-500"}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Tt,{className:"w-5 h-5 mr-2"})," Оплата карткою онлайн"]})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",value:"cash",checked:y.payment==="cash",onChange:d=>_({...y,payment:d.target.value}),className:"text-blue-600 focus:ring-blue-500"}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Tt,{className:"w-5 h-5 mr-2"})," Оплата при отриманні"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Ваше замовлення"}),e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Загальна сума:"}),e.jsxs("span",{children:[i().toFixed(2)," грн"]})]})})]}),e.jsx("button",{type:"submit",disabled:l||!k(),className:"w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex justify-center items-center",children:l?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):"Підтвердити замовлення"})]})]})})},lr=()=>{const{id:a}=vt(),[s,r]=t.useState(null),[i,l]=t.useState(!0),n=c=>{const{data:m}=M.storage.from("articles-images").getPublicUrl(c);return m.publicUrl};return t.useEffect(()=>{(async()=>{const{data:m,error:f}=await M.from("articles").select("*").eq("id",a).single();f?console.error("Error fetching article:",f):r(m),l(!1)})()},[a]),i?e.jsx("div",{children:"Loading..."}):s?e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:s.title}),s.image_path&&e.jsx("img",{src:n(s.image_path),alt:s.title,className:"w-full h-64 object-cover mb-4 rounded-lg"}),e.jsx("div",{className:"prose max-w-none",children:e.jsx("pre",{className:"whitespace-pre-wrap",children:s.content})})]}):e.jsx("div",{children:"Article not found"})},or=()=>{const a=G();return t.useEffect(()=>{(async()=>{try{const r=new URLSearchParams(window.location.search).get("code");if(!r){a("/login");return}const i=await fetch(void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r})});if(!i.ok)throw new Error("Ошибка при получении токена");const l=await i.json(),{data:{user:n},error:c}=await M.auth.signInWithIdToken({provider:"google",token:l.access_token});if(c)throw new Error(c.message);if(!n)throw new Error("Пользователь не найден");const m=localStorage.getItem("guest_id");if(m){const{error:f}=await M.rpc("migrate_guest_data",{guest_id:m,user_id:n.id});f?(console.error("Ошибка миграции гостевых данных:",f),q.warning("Не удалось перенести гостевые данные")):(q.success("Данные гостя успешно перенесены"),localStorage.removeItem("guest_id"))}q.success("Успешная аутентификация!"),a("/admin")}catch(r){const i=r instanceof Error?r.message:"Неизвестная ошибка";console.error("Ошибка аутентификации:",r),q.error(`Ошибка аутентификации: ${i}`),a("/login")}})()},[a]),e.jsx("div",{className:"auth-callback-container",children:e.jsx("div",{className:"spinner"})})},ws=t.forwardRef(({message:a,duration:s=3e3,onClose:r},i)=>{const[l,n]=t.useState(!0),[c,m]=t.useState(!1),[f,x]=t.useState(null),v=t.useRef(null),[g,N]=t.useState(!1);t.useEffect(()=>{const y=()=>{N(window.innerWidth<768)};return y(),window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]),t.useEffect(()=>{const y=document.createElement("style");return y.innerHTML=`
        @keyframes slideIn {
          from { transform: translateY(100%); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideOut {
          from { transform: translateY(0); opacity: 1; }
          to { transform: translateY(100%); opacity: 0; }
        }
        @keyframes fadeOut {
          from { opacity: 1; }
          to { opacity: 0; }
        }
      `,document.head.appendChild(y),()=>{document.head.removeChild(y)}},[]),t.useEffect(()=>(v.current=window.setTimeout(()=>{c||(x("auto"),m(!0))},s),()=>{v.current&&clearTimeout(v.current)}),[s,c]),t.useImperativeHandle(i,()=>({dismiss:(y="manual")=>{c||(v.current&&clearTimeout(v.current),x(y),m(!0))}}),[c]);const j=()=>{c&&(n(!1),r())};if(!l)return null;const w=c?f==="manual"?"fadeOut 0.5s ease-out forwards":"slideOut 0.5s ease-out forwards":"slideIn 0.5s ease-out forwards",E=g?{position:"fixed",bottom:"16px",left:"16px",right:"16px",textAlign:"center",zIndex:50,backgroundColor:"red",color:"white",padding:"8px 16px",borderRadius:"4px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",animation:w}:{position:"fixed",top:"16px",right:"16px",zIndex:50,backgroundColor:"red",color:"white",padding:"8px 16px",borderRadius:"4px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",animation:w};return e.jsx("div",{style:E,onAnimationEnd:j,children:a})});ws.displayName="Toast";const cr=()=>{const a=G(),[s]=Jt(),[r,i]=t.useState([]),[l,n]=t.useState([]),[c,m]=t.useState([]),[f,x]=t.useState([]),[v,g]=t.useState([]),[N,j]=t.useState([]),[w,E]=t.useState([]),[y,_]=t.useState([]),[b,C]=t.useState([]),[h,R]=t.useState([]),[I,k]=t.useState([]),[o,d]=t.useState([]),[p,u]=t.useState([]),[S,P]=t.useState(""),[D,T]=t.useState(""),[B,ae]=t.useState(0),[Y,F]=t.useState(0),[Z,ce]=t.useState(0),[ee,ue]=t.useState(!1),[le,Ce]=t.useState([]),[fe,se]=t.useState([]),[re,Q]=t.useState([]),[_e,ve]=t.useState([]),[pe,ne]=t.useState([]),[de,Oe]=t.useState([]),[Pe,Fe]=t.useState([]),[Ue,qe]=t.useState([]),[ze,Be]=t.useState([]),[ye,we]=t.useState([]),[Re,Ee]=t.useState([]),[Ie,We]=t.useState([]),[Me,He]=t.useState([]),[Je,Ve]=t.useState(!1),[De,lt]=t.useState(!1),[O,V]=t.useState(!0),[K,Te]=t.useState(""),[Ye,Nt]=t.useState(!1),Ne=t.useCallback(L=>{Te(L),Nt(!0)},[]),ot=t.useCallback(()=>{Nt(!1),Te("")},[]);t.useEffect(()=>{const L=s.get("brand");L&&Ce(L.split(","));const U=s.get("model");U&&se(U.split(","));const ie=s.get("width");ie&&Q(ie.split(","));const z=s.get("diameter");z&&ve(z.split(","));const Ge=s.get("profile");Ge&&ne(Ge.split(","));const Ze=s.get("season");Ze&&Oe(Ze.split(","));const Xe=s.get("noiseLevel");Xe&&Fe(Xe.split(","));const $=s.get("country");$&&qe($.split(","));const H=s.get("year");H&&Be(H.split(","));const kt=s.get("wetGrip");kt&&we(kt.split(","));const Ct=s.get("fuelEfficiency");Ct&&Ee(Ct.split(","));const _t=s.get("loadIndex");_t&&We(_t.split(","));const Et=s.get("speedIndex");Et&&He(Et.split(","));const It=s.get("spikes");It&&Ve(It==="true");const Lt=s.get("sale");Lt&&ue(Lt==="true");const Pt=s.get("minPrice");Pt&&P(Pt);const Rt=s.get("maxPrice");Rt&&T(Rt)},[s]),t.useEffect(()=>{(async()=>{try{const{data:U,error:ie}=await M.from("products").select(`brand, model, width, diameter, profile, season, price,
             noise_level, country, year, wet_grip, fuel_efficiency,
             load_index, speed_index, spikes`);if(ie)throw ie;if(U&&U.length>0){const z={brands:Array.from(new Set(U.map($=>$.brand))).filter(Boolean).sort(($,H)=>$.localeCompare(H)),models:Array.from(new Set(U.map($=>$.model))).filter(Boolean).sort(($,H)=>$.localeCompare(H)),widths:Array.from(new Set(U.map($=>$.width))).filter($=>$!==null).sort(($,H)=>$-H),diameters:Array.from(new Set(U.map($=>$.diameter))).filter($=>$!==null).sort(($,H)=>$-H),profiles:Array.from(new Set(U.map($=>$.profile))).filter($=>$!==null).sort(($,H)=>$-H),seasons:Array.from(new Set(U.map($=>$.season))).filter(Boolean).sort(($,H)=>$.localeCompare(H)),noiseLevels:Array.from(new Set(U.map($=>$.noise_level))).filter($=>$!==null).sort(($,H)=>$-H),countries:Array.from(new Set(U.map($=>$.country))).filter(Boolean).sort(($,H)=>$.localeCompare(H)),years:Array.from(new Set(U.map($=>$.year))).filter($=>$!==null).sort(($,H)=>$-H),wetGrips:Array.from(new Set(U.map($=>$.wet_grip))).filter(Boolean).sort(($,H)=>$.localeCompare(H)),fuelEfficiencies:Array.from(new Set(U.map($=>$.fuel_efficiency))).filter(Boolean).sort(($,H)=>$.localeCompare(H)),loadIndexes:Array.from(new Set(U.map($=>$.load_index))).filter(Boolean).sort(($,H)=>$.localeCompare(H)),speedIndexes:Array.from(new Set(U.map($=>$.speed_index))).filter(Boolean).sort(($,H)=>$.localeCompare(H))};i(z.brands),n(z.models),m(z.widths),x(z.diameters),g(z.profiles),j(z.seasons),E(z.noiseLevels),_(z.countries),C(z.years),R(z.wetGrips),k(z.fuelEfficiencies),d(z.loadIndexes),u(z.speedIndexes);const Ge=U.map($=>$.price),Ze=Math.min(...Ge),Xe=Math.max(...Ge);ae(Ze),F(Xe),ce(Xe)}}catch(U){console.error("Error fetching filters:",U),Ne("Помилка завантаження фільтрів")}finally{V(!1)}})()},[Ne]);const St=(L,U)=>{const ie=L.target.value.replace(/\D/g,"");ot(),U==="min"?P(ie):T(ie)},Ns=L=>{const U=Number(L.target.value);ce(U),P(B.toString()),T(U.toString())},Ss=()=>{if(D==="")return;const L=parseInt(D);if(L<B){Ne(`Максимальна ціна не може бути нижчою за ${B}`);return}if(L>Y){Ne(`Максимальна ціна не може бути вищою за ${Y}`);return}(S?parseInt(S):B)>=L&&Ne("Максимальне значення має бути більшим за мінімальне")},ks=L=>{L.preventDefault();const U=S?parseInt(S):B,ie=D?parseInt(D):Y;if(ie<B){Ne(`Максимальна ціна не може бути нижчою за ${B}`);return}if(ie>Y){Ne(`Максимальна ціна не може бути вищою за ${Y}`);return}if(U>=ie){Ne("Максимальне значення має бути більшим за мінімальне");return}const z=new URLSearchParams;z.set("minPrice",U.toString()),z.set("maxPrice",ie.toString()),le.length>0&&z.set("brand",le.join(",")),fe.length>0&&z.set("model",fe.join(",")),re.length>0&&z.set("width",re.join(",")),_e.length>0&&z.set("diameter",_e.join(",")),pe.length>0&&z.set("profile",pe.join(",")),de.length>0&&z.set("season",de.join(",")),Pe.length>0&&z.set("noiseLevel",Pe.join(",")),Ue.length>0&&z.set("country",Ue.join(",")),ze.length>0&&z.set("year",ze.join(",")),ye.length>0&&z.set("wetGrip",ye.join(",")),Re.length>0&&z.set("fuelEfficiency",Re.join(",")),Ie.length>0&&z.set("loadIndex",Ie.join(",")),Me.length>0&&z.set("speedIndex",Me.join(",")),Je&&z.set("spikes","true"),ee&&z.set("sale","true"),a(`/search-results?${z.toString()}`)},Cs=()=>{P(""),T(""),Ce([]),se([]),Q([]),ve([]),ne([]),Oe([]),Fe([]),qe([]),Be([]),we([]),Ee([]),We([]),He([]),Ve(!1),ue(!1),ot()};return e.jsx("div",{className:"bg-white min-h-screen",children:e.jsxs("div",{className:"container mx-auto p-4 relative",children:[Ye&&e.jsx(ws,{message:K,duration:5e3,onClose:ot}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Детальний пошук"}),e.jsxs("form",{onSubmit:ks,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"ЦІНОВИЙ ДІАПАЗОН"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:"sale",checked:ee,onChange:L=>ue(L.target.checked),className:"form-checkbox"}),e.jsx("label",{htmlFor:"sale",className:"text-sm font-medium",children:"Акційні товари"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",placeholder:"Мінімум",value:S,onChange:L=>St(L,"min"),className:"w-full p-2 border rounded",inputMode:"numeric"}),e.jsx("input",{type:"text",placeholder:"Максимум",value:D,onChange:L=>St(L,"max"),onBlur:Ss,className:"w-full p-2 border rounded",inputMode:"numeric"})]}),!O&&Y>B&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium",children:"Швидкий вибір максимальної ціни"}),e.jsx("input",{type:"range",min:B,max:Y,value:Z,onChange:Ns,className:"w-full"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Вибрано: до ",Z]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"БАЗОВІ ПАРАМЕТРИ"}),e.jsx(J,{multiple:!0,value:le,onValueChange:L=>Ce(L),placeholder:O?"Завантаження...":"ВСІ БРЕНДИ",disabled:O,children:r.map(L=>e.jsx(X,{value:L,children:L.toUpperCase()},L))}),e.jsx(J,{multiple:!0,value:fe,onValueChange:L=>se(L),placeholder:"ВСІ МОДЕЛІ",children:l.map(L=>e.jsx(X,{value:L,children:L.toUpperCase()},L))}),e.jsx(J,{multiple:!0,value:_e,onValueChange:L=>ve(L),placeholder:"ВИБЕРІТЬ ДІАМЕТР",children:f.map(L=>{const U=L.toString();return e.jsx(X,{value:U,children:`R${L}`},L)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"ШИРИНА"}),e.jsx(J,{multiple:!0,value:re,onValueChange:L=>Q(L),placeholder:"ВИБЕРІТЬ ШИРИНУ",children:c.map(L=>{const U=L.toString();return e.jsx(X,{value:U,children:L},L)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"ПРОФІЛЬ"}),e.jsx(J,{multiple:!0,value:pe,onValueChange:L=>ne(L),placeholder:"ВИБЕРІТЬ ПРОФІЛЬ",children:v.map(L=>{const U=L.toString();return e.jsx(X,{value:U,children:L},L)})})]})]}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx("h3",{className:"font-medium mb-2",children:"СЕЗОН"}),e.jsx(J,{multiple:!0,value:de,onValueChange:L=>Oe(L),placeholder:"ВИБЕРІТЬ СЕЗОН",displayValue:L=>L.map(U=>U==="summer"?"ЛІТНІ":U==="winter"?"ЗИМОВІ":"ВСЕСЕЗОННІ").join(", "),children:N.map(L=>e.jsx(X,{value:L,children:L==="summer"?"ЛІТНІ":L==="winter"?"ЗИМОВІ":"ВСЕСЕЗОННІ"},L))})]}),e.jsx("div",{className:"mt-6",children:e.jsx(xe,{type:"button",onClick:()=>lt(L=>!L),className:"bg-blue-600 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded w-full md:w-auto",children:De?"Сховати додаткові параметри":"Показати додаткові параметри"})}),De&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"УРОВЕНЬ ШУМУ"}),e.jsx(J,{multiple:!0,value:Pe,onValueChange:L=>Fe(L),placeholder:"ВИБЕРІТЬ",children:w.map(L=>{const U=L.toString();return e.jsx(X,{value:U,children:L},L)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"КРАЇНА"}),e.jsx(J,{multiple:!0,value:Ue,onValueChange:L=>qe(L),placeholder:"ВИБЕРІТЬ КРАЇНУ",children:y.map(L=>e.jsx(X,{value:L,children:L.toUpperCase()},L))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"ГОД"}),e.jsx(J,{multiple:!0,value:ze,onValueChange:L=>Be(L),placeholder:"ВИБЕРІТЬ РІК",children:b.map(L=>{const U=L.toString();return e.jsx(X,{value:U,children:L},L)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"СЦЕПЛЕННЯ"}),e.jsx(J,{multiple:!0,value:ye,onValueChange:L=>we(L),placeholder:"ВИБЕРІТЬ",children:h.map(L=>e.jsx(X,{value:L,children:L.toUpperCase()},L))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"ЕФЕКТИВНІСТЬ ПАЛИВА"}),e.jsx(J,{multiple:!0,value:Re,onValueChange:L=>Ee(L),placeholder:"ВИБЕРІТЬ",children:I.map(L=>e.jsx(X,{value:L,children:L.toUpperCase()},L))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"ІНДЕКС НАВАНТАЖЕННЯ"}),e.jsx(J,{multiple:!0,value:Ie,onValueChange:L=>We(L),placeholder:"ВИБЕРІТЬ",children:o.map(L=>e.jsx(X,{value:L,children:L.toUpperCase()},L))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"ІНДЕКС ШВИДКОСТІ"}),e.jsx(J,{multiple:!0,value:Me,onValueChange:L=>He(L),placeholder:"ВИБЕРІТЬ",children:p.map(L=>e.jsx(X,{value:L,children:L.toUpperCase()},L))})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"spikes",checked:Je,onChange:L=>Ve(L.target.checked),className:"form-checkbox"}),e.jsx("label",{htmlFor:"spikes",className:"ml-2 select-none",children:"ШИПИ"})]})})]}),e.jsxs("div",{className:"mt-8 flex items-center justify-between gap-4",children:[e.jsx(xe,{type:"button",onClick:Cs,className:"bg-red-500 hover:bg-red-600 text-white text-sm px-4 py-2 rounded",children:"Скасувати"}),e.jsx(xe,{type:"submit",className:"bg-green-500 hover:bg-green-600 text-white text-sm px-8 py-2 rounded",children:"Пошук"})]})]})]})})},dr=()=>{const[a,s]=t.useState(!1),[r,i]=t.useState("chevron"),l=ya();t.useEffect(()=>{const f=Ds(()=>{const x=window.scrollY>150;s(v=>v!==x?x:v)},100);return window.addEventListener("scroll",f,{passive:!0}),()=>window.removeEventListener("scroll",f)},[]),t.useEffect(()=>{if(!a)return;const f=setInterval(()=>{i(x=>x==="chevron"?"filter":"chevron")},5e3);return()=>clearInterval(f)},[a]);const n=t.useCallback(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]),m={initial:{opacity:0,y:100},animate:{opacity:1,y:0,transition:l?{type:"tween",duration:.3}:{type:"spring",stiffness:200,damping:25,mass:.5}},exit:{opacity:0,y:100,transition:{duration:.2}}};return e.jsx(oe,{mode:"wait",children:a&&e.jsx(A.button,{...m,className:"fixed z-50 flex items-center justify-center w-12 h-12 rounded-full bg-blue-600/60 shadow-lg bottom-20 right-4 backdrop-blur-sm hover:bg-blue-700/70 transition-colors",onTouchStart:f=>f.preventDefault(),onClick:n,"aria-label":"Scroll to top",children:e.jsx(A.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},children:r==="chevron"?e.jsx(oa,{className:"w-6 h-6 text-white",strokeWidth:2.5}):e.jsx(us,{className:"w-6 h-6 text-white",strokeWidth:2.5})},r)},"mini-btn")})},mr=()=>{const{id:a}=vt(),s=me(),r=G(),{pathname:i}=s,[l,n]=t.useState([{pathname:"/",title:"Головна"}]),[c,m]=t.useState(null),f=t.useRef(null),x=t.useRef(null),v=t.useRef(!1),g=t.useRef(0),N=t.useRef(0),j=I=>{if(I==="/")return"Головна";const k={"detailed-search":"Розширений пошук","search-results":"Результати пошуку",product:"Товар",tires:"Шини",wheels:"Диски",auth:"Авторизація",profile:"Профіль",checkout:"Оформлення",admin:"Адмінпанель",articles:"Статті"},o=I.split("/")[1];return k[o]||o.replace(/-/g," ")};t.useEffect(()=>{n(I=>{const k=I.findIndex(d=>d.pathname===i);if(k!==-1)return I.slice(0,k+1);const o=a&&c?c:j(i);return[...I,{pathname:i,title:o}]})},[i,a,c]),t.useEffect(()=>{a&&(i.startsWith("/product/")?(async()=>{const{data:k,error:o}=await M.from("products").select("brand, model").eq("id",a).single();if(!o&&k){const d=`${k.brand} ${k.model}`;m(d),n(p=>p.map(u=>u.pathname===i?{...u,title:d}:u))}else console.error("Error fetching product data:",o)})():i.startsWith("/articles/")&&(async()=>{const{data:k,error:o}=await M.from("articles").select("title").eq("id",a).single();if(!o&&k){const d=k.title;m(d),n(p=>p.map(u=>u.pathname===i?{...u,title:d}:u))}else console.error("Error fetching article data:",o)})())},[a,i]);const w=(I,k)=>o=>{o.preventDefault(),n(d=>d.slice(0,I+1)),r(k)};t.useEffect(()=>{const I=x.current;if(I&&I.scrollWidth>I.clientWidth){const k=I.scrollLeft,o=I.scrollWidth-I.clientWidth,d=800;let p=null;const u=S=>{p||(p=S);const P=S-p,D=Math.min(P/d,1),T=1-Math.pow(1-D,3);I.scrollLeft=k+(o-k)*T,D<1?requestAnimationFrame(u):f.current&&(f.current.classList.add("bounce"),setTimeout(()=>{f.current&&f.current.classList.remove("bounce")},500))};requestAnimationFrame(u)}},[l]);const E=I=>{const k=x.current;k&&(v.current=!0,g.current=I.pageX-k.offsetLeft,N.current=k.scrollLeft)},y=()=>{v.current=!1},_=()=>{v.current=!1},b=I=>{const k=x.current;if(!k||!v.current)return;I.preventDefault();const d=I.pageX-k.offsetLeft-g.current;k.scrollLeft=N.current-d},C=I=>{const k=x.current;k&&(v.current=!0,g.current=I.touches[0].pageX-k.offsetLeft,N.current=k.scrollLeft)},h=()=>{v.current=!1},R=I=>{const k=x.current;if(!k||!v.current)return;const d=I.touches[0].pageX-k.offsetLeft-g.current;k.scrollLeft=N.current-d};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes bounce {
          0% { transform: translateY(0); }
          30% { transform: translateY(-8px); }
          50% { transform: translateY(0); }
          70% { transform: translateY(-4px); }
          100% { transform: translateY(0); }
        }
        .bounce {
          animation: bounce 0.5s ease-out;
        }
      `}),e.jsx("nav",{"aria-label":"breadcrumb",className:"p-3 bg-gray-100 text-xs",children:e.jsx("div",{ref:x,className:"overflow-x-auto whitespace-nowrap select-none",onMouseDown:E,onMouseLeave:y,onMouseUp:_,onMouseMove:b,onTouchStart:C,onTouchEnd:h,onTouchMove:R,children:e.jsx("ol",{className:"flex items-center space-x-1",children:l.map((I,k)=>{const o=k===l.length-1;return e.jsxs("li",{className:"flex items-center",ref:o?f:void 0,children:[k!==0&&e.jsx("span",{className:"mx-1",children:"-•-"}),o?e.jsx("span",{className:"text-gray-500",children:I.title}):e.jsx("a",{href:I.pathname,onClick:w(k,I.pathname),children:I.title})]},k)})})})})]})};Qe.setAppElement("#root");const ur=()=>{const a=G(),[s,r]=t.useState(!1),[i,l]=t.useState(!1),[n,c]=t.useState(!1),[m,f]=t.useState([]),[x,v]=t.useState(!0),[g,N]=t.useState(""),j=t.useRef(null),w=t.useMemo(()=>[{to:"/admin",icon:e.jsx(ca,{}),text:"Панель"},{to:"/admin/products",icon:e.jsx(gt,{}),text:"Товари"},{to:"/admin/orders",icon:e.jsx(da,{}),text:"Замовлення"},{to:"/admin/sessions",icon:e.jsx(ma,{}),text:"Сесії"},{to:"/admin/analytics",icon:e.jsx(ua,{}),text:"Аналітика"},{to:"/admin/settings",icon:e.jsx(ha,{}),text:"Налаштування"},{to:"/admin/articles",icon:e.jsx(xa,{}),text:"Статті"}],[]),E=t.useCallback(async()=>{try{v(!0);const{data:o,error:d}=await M.from("sessions").select("*").order("last_activity",{ascending:!1});if(d)throw d;f(o||[]),N("")}catch(o){N("Не удалось загрузить данные сессий"),console.error("Ошибка загрузки сессий:",o),q.error("Ошибка загрузки данных сессий")}finally{v(!1)}},[]),y=()=>crypto.randomUUID(),_=async()=>{try{const o=localStorage.getItem("session_id"),d=new Date().toISOString();if(o){let p=localStorage.getItem("guest_id");p||(p=y(),localStorage.setItem("guest_id",p));const u={user_id:null,guest_id:p,last_activity:d,is_online:!0},{data:S,error:P}=await M.from("sessions").update(u).eq("id",o).select();if(P)throw console.error("Ошибка обновления сессии до гостевой:",P),q.error(`Ошибка обновления сессии: ${P.message}`),P;return console.log("Сессия успешно обновлена до гостевой:",S),S}else{const p=y(),u={user_id:null,guest_id:p,last_activity:new Date().toISOString(),is_online:!0},{data:S,error:P}=await M.from("sessions").insert(u).select();if(P)throw console.error("Ошибка создания гостевой сессии:",P),q.error(`Ошибка гостевой сессии: ${P.message}`),P;return console.log("Гостевая сессия успешно создана:",S),S&&S.length>0&&(localStorage.setItem("session_id",S[0].id),localStorage.setItem("guest_id",p)),S}}catch(o){return console.error("Ошибка в updateSessionToGuest:",o),q.error("Не удалось обновить сессию до гостевой"),null}},b=async()=>{try{const{data:o,error:d}=await M.auth.getUser();if(d)throw console.error("Ошибка получения пользователя:",d),d;const p=o==null?void 0:o.user,u=new Date().toISOString();if(p){const S=localStorage.getItem("guest_id");if(S){const{data:B,error:ae}=await M.rpc("migrate_guest_data",{p_guest_id:S,p_user_id:p.id});if(ae)ae.message.includes("duplicate key value violates unique constraint")?localStorage.removeItem("guest_id"):(console.error("Ошибка миграции:",ae),q.error(`Ошибка миграции: ${ae.message}`));else if(B)return q.success("Данные гостя успешно перенесены"),localStorage.removeItem("guest_id"),localStorage.setItem("session_id",B),localStorage.getItem("loggedInToastShown")||(q.success("Вы успешно авторизовались"),localStorage.setItem("loggedInToastShown","true")),B}const P={user_id:p.id,guest_id:null,last_activity:u,is_online:!0},{data:D,error:T}=await M.from("sessions").upsert(P,{onConflict:"user_id"}).select();if(T)throw console.error("Ошибка создания/обновления сессии:",T),q.error(`Ошибка сессии: ${T.message}`),T;return console.log("Сессия успешно создана/обновлена:",D),D&&D.length>0&&localStorage.setItem("session_id",D[0].id),localStorage.getItem("loggedInToastShown")||(q.success("Вы успешно авторизовались"),localStorage.setItem("loggedInToastShown","true")),D}else return await _()}catch(o){return console.error("Ошибка в createSession:",o),q.error("Не удалось создать сессию"),null}};t.useEffect(()=>{let o=!0;const d=async()=>{try{o&&(await b(),await E())}catch(u){console.error("Ошибка в fetchData:",u),o&&N("Не удалось загрузить или создать сессию")}};d();const p=setInterval(d,1e4);return()=>{o=!1,clearInterval(p)}},[E]);const C=t.useMemo(()=>({total:m.length,active:m.reduce((o,d)=>d.is_online?o+1:o,0),guests:m.reduce((o,d)=>d.guest_id?o+1:o,0),users:m.reduce((o,d)=>d.user_id?o+1:o,0)}),[m]),h=t.useCallback(o=>{j.current&&!j.current.contains(o.target)&&r(!1)},[]);t.useEffect(()=>(s&&document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)),[s,h]);const R=async()=>{try{c(!0),await _();const{error:o}=await M.auth.signOut();if(o)throw o;localStorage.removeItem("sb-auth-token"),sessionStorage.removeItem("sb-session"),localStorage.removeItem("loggedInToastShown"),a("/",{replace:!0}),q.success("Выход выполнен успешно")}catch{q.error("Ошибка при выходе. Пожалуйста, попробуйте снова.")}finally{c(!1),l(!1)}},I={open:{x:0},closed:{x:"-100%"}},k=t.useCallback(({to:o,icon:d,text:p})=>e.jsxs(Ts,{to:o,onClick:()=>r(!1),className:({isActive:u})=>`flex items-center px-4 py-2 rounded-lg transition-colors 
         ${u?"bg-blue-800 text-white":"text-gray-300 hover:bg-blue-800 hover:text-white"}`,children:[te.cloneElement(d,{className:"w-5 h-5 mr-3"}),p]},o),[]);return e.jsxs("div",{className:"min-h-screen bg-gray-100 relative overflow-hidden",children:[e.jsx("button",{onClick:()=>r(!s),className:"absolute top-4 right-4 p-2 bg-blue-900 text-white rounded-lg z-50 lg:hidden","aria-label":"Меню",children:e.jsx(fa,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex relative",children:[e.jsxs(A.div,{ref:j,className:"hidden lg:block w-64 bg-blue-900 min-h-screen p-4 z-40",initial:"open",animate:"open",children:[e.jsx("div",{className:"text-white font-bold text-xl mb-8 mt-16",children:"SHINAGO Admin"}),e.jsxs("nav",{className:"space-y-2",children:[w.map(k),e.jsx("div",{className:"px-4 py-2 space-y-2 text-gray-300",children:x?e.jsx("div",{className:"animate-pulse flex space-x-4",children:e.jsxs("div",{className:"flex-1 space-y-2 py-1",children:[e.jsx("div",{className:"h-4 bg-blue-800 rounded"}),e.jsx("div",{className:"h-4 bg-blue-800 rounded"})]})}):g?e.jsx("div",{className:"text-red-300 text-sm",children:g}):e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:`p-2 rounded ${C.active>0?"bg-green-500":"bg-gray-500"} text-white`,children:["Активных: ",C.active]}),e.jsxs("div",{className:"p-2 rounded bg-blue-500 text-white",children:["Всего: ",C.total]}),e.jsxs("div",{className:"p-2 rounded bg-purple-500 text-white",children:["Гостей: ",C.guests]}),e.jsxs("div",{className:"p-2 rounded bg-orange-500 text-white",children:["Пользователей: ",C.users]})]})}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center text-gray-300 hover:text-white hover:bg-blue-800 px-4 py-2 rounded-lg w-full transition-colors",children:[e.jsx(pt,{className:"w-5 h-5 mr-3"}),"Вийти"]})]})]}),e.jsx(oe,{children:s&&e.jsxs(A.div,{ref:j,variants:I,initial:"closed",animate:"open",exit:"closed",className:"fixed lg:hidden w-64 bg-blue-900 min-h-screen p-4 z-40",children:[e.jsx("div",{className:"text-white font-bold text-xl mb-8 mt-16",children:"SHINAGO Admin"}),e.jsxs("nav",{className:"space-y-2",children:[w.map(k),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center text-gray-300 hover:text-white hover:bg-blue-800 px-4 py-2 rounded-lg w-full transition-colors",children:[e.jsx(pt,{className:"w-5 h-5 mr-3"}),"Вийти"]})]})]})}),e.jsx("div",{className:"flex-1 p-8 mt-16",children:g?e.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg",children:g}):e.jsx(Zt,{context:{sessions:m,refreshSessions:E,isLoading:x}})})]}),e.jsxs(Qe,{isOpen:i,onRequestClose:()=>l(!1),shouldCloseOnOverlayClick:!0,className:"modal",overlayClassName:"modal-overlay",ariaHideApp:!0,contentLabel:"Підтвердження виходу",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Ви впевнені, що хочете вийти?"}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>l(!1),className:"px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400 transition-colors",children:"Скасувати"}),e.jsxs("button",{onClick:R,disabled:n,className:"px-4 py-2 bg-red-500 text-white rounded-lg flex items-center gap-2 hover:bg-red-600 transition-colors",children:[n&&e.jsx("div",{className:"w-4 h-4 border-2 border-white rounded-full animate-spin"}),n?"Выход...":"Вийти"]})]})]})]})},hr=te.memo(()=>{const[a,s]=t.useState(new Date);return t.useEffect(()=>{const r=setInterval(()=>s(new Date),1e3);return()=>clearInterval(r)},[]),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-cyan-500",children:a.toLocaleTimeString()}),e.jsx("div",{className:"mt-2 text-xs sm:text-sm text-gray-500",children:a.toLocaleDateString()})]})}),xr=()=>{const[a,s]=t.useState(!1),[r,i]=t.useState(null),[l,n]=t.useState(!0),c=G(),m=g=>{q.error(g,{position:"top-center",autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,theme:"colored",className:"bg-red-800 text-white"})},f=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(g=>{x(g.coords.latitude,g.coords.longitude)},g=>{let N="Ошибка получения местоположения: ";switch(g.code){case g.PERMISSION_DENIED:N+="Доступ к геолокации запрещен";break;case g.POSITION_UNAVAILABLE:N+="Информация о местоположении недоступна";break;case g.TIMEOUT:N+="Превышено время ожидания";break;default:N+="Неизвестная ошибка"}m(N),n(!1)},{enableHighAccuracy:!0,timeout:5e3}):(m("Ваш браузер не поддерживает геолокацию"),n(!1))},x=async(g,N)=>{try{const j=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${g}&lon=${N}&appid=695605c4006a81a3e07c2f064ba1f851&units=metric&lang=ru`);if(!j.ok)throw new Error("Ошибка получения данных о погоде");const w=await j.json();i({temp:Math.round(w.main.temp),description:w.weather[0].description,icon:w.weather[0].icon,city:w.name})}catch{m("Не удалось получить данные о погоде")}finally{n(!1)}};t.useEffect(()=>{f()},[]);const v=async()=>{try{s(!0);const{error:g}=await M.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/admin"}});if(g)throw g;c("/admin")}catch(g){const N=g instanceof Error?g.message:"Произошла неизвестная ошибка";m(`Ошибка авторизации: ${N}`)}finally{s(!1)}};return e.jsxs("div",{className:"relative min-h-screen w-full bg-gray-900 overflow-hidden",children:[e.jsx(yt,{}),e.jsx("div",{className:"absolute inset-0 bg-gray-800 opacity-20"}),e.jsx("div",{className:"relative z-10 flex min-h-screen items-center justify-center p-4",children:e.jsxs(A.div,{className:"w-full max-w-md space-y-6 rounded-2xl border border-gray-800 bg-gray-900/80 p-4 sm:p-6 md:p-8 backdrop-blur-xl",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(hr,{}),e.jsx("div",{className:"mt-4 rounded-lg bg-gray-800/50 p-3 sm:p-4",children:l?e.jsx("div",{className:"text-gray-400",children:"Получение погоды..."}):r?e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-4",children:[e.jsx("img",{src:`https://openweathermap.org/img/wn/${r.icon}@2x.png`,alt:"Погода",className:"h-10 w-10 sm:h-12 sm:w-12"}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"text-base sm:text-lg font-semibold text-white",children:[r.temp,"°C"]}),e.jsx("div",{className:"text-xs sm:text-sm text-gray-400",children:r.city}),e.jsx("div",{className:"text-xs text-gray-500",children:r.description})]})]}):null}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 grid h-12 w-12 sm:h-16 sm:w-16 place-items-center rounded-full bg-cyan-500/10",children:e.jsx("svg",{className:"h-6 w-6 sm:h-8 sm:w-8 text-cyan-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white",children:"Система управления"}),e.jsx("p",{className:"mt-2 text-xs sm:text-sm text-gray-400",children:"Авторизация администратора"})]}),e.jsx(A.button,{onClick:v,disabled:a,className:"group relative mt-6 sm:mt-8 flex w-full items-center justify-center gap-3 overflow-hidden rounded-lg bg-gradient-to-r from-cyan-500 to-blue-500 p-1 text-white transition-all hover:from-cyan-600 hover:to-blue-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 focus:ring-offset-gray-900 disabled:opacity-70",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs("span",{className:"flex w-full items-center justify-center gap-3 rounded-md bg-gray-900 px-4 sm:px-5 py-2.5 sm:py-3 transition-all group-hover:bg-transparent",children:[e.jsx("svg",{className:"h-4 w-4 sm:h-5 sm:w-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.254-3.138C18.189 1.186 15.479 0 12.24 0c-6.635 0-12 5.365-12 12s5.365 12 12 12c6.926 0 11.52-4.869 11.52-11.726 0-.788-.085-1.39-.189-1.989H12.24z"})}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:a?"Подключение...":"Войти через Google"})]})}),e.jsx("div",{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-500",children:[e.jsx("svg",{className:"h-3 w-3 sm:h-4 sm:w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("span",{className:"text-xs",children:"Защищенное соединение"})]})})]})})]})};function it(){const[a,s]=t.useState({isAdmin:!1,loading:!0}),r=(l,n)=>{console.log(`[useAdmin] ${l}`,n||"")},i=async()=>{try{s(f=>({...f,loading:!0}));const{data:{user:l},error:n}=await M.auth.getUser();if(n||!l){r("User not authenticated",{error:n==null?void 0:n.message}),s({isAdmin:!1,loading:!1});return}const{data:c,error:m}=await M.from("admins").select("user_id").eq("user_id",l.id).single();s({isAdmin:!m&&!!c,loading:!1})}catch(l){r("Error in admin check",{error:l}),s({isAdmin:!1,loading:!1})}};return t.useEffect(()=>{i();const{data:l}=M.auth.onAuthStateChange(n=>{r("Auth state changed",{event:n}),i()});return()=>{l==null||l.subscription.unsubscribe()}},[]),a}async function je(a,s={}){try{const{error:r}=await M.rpc("track_event",{event_name:a,event_data:JSON.stringify(s)});if(r)throw r}catch(r){console.error("Error tracking event:",r)}}const fr=(a,s,r)=>{console.error(`[FRONTEND] Error in ${s}:`,a,r||""),je("error",{context:s,error:a.message,...r})},pr=()=>{const{isAdmin:a,loading:s}=it(),[r,i]=t.useState({total_orders:0,total_revenue:0,products_count:0}),[l,n]=t.useState([]),[c,m]=t.useState(!0),f=G(),x=l.filter(w=>w.user_id),v=l.filter(w=>w.guest_id&&!w.user_id);t.useEffect(()=>{!a&&!s&&f("/")},[a,s,f]),t.useEffect(()=>{if(!a||s)return;(async()=>{await g(),je("admin_dashboard_view");const E=N(),y=setInterval(j,5e3);return()=>{E(),clearInterval(y)}})().catch(E=>{q.error(`Ошибка инициализации: ${E.message}`)})},[a,s]);const g=async()=>{try{m(!0);const{data:w,error:E}=await M.rpc("get_dashboard_stats");if(E)throw E;i(w)}catch(w){const E=w instanceof Error?w.message:"Неизвестная ошибка";q.error(`Ошибка загрузки статистики: ${E}`),je("dashboard_stats_error",{error:E})}finally{m(!1)}},N=()=>{const w=M.channel("sessions_realtime").on("postgres_changes",{event:"*",schema:"public",table:"sessions"},()=>j()).subscribe();return()=>M.removeChannel(w)},j=async()=>{try{const w=new Date(Date.now()-25e3).toISOString(),{data:E,error:y}=await M.from("sessions").select(`
          id,
          user_id,
          guest_id,
          session_start,
          last_activity,
          is_online,
          user:user_id (email, is_admin)
        `).gte("last_activity",w).order("last_activity",{ascending:!1});if(y)throw y;const _=(E||[]).map(b=>({id:b.id,user_id:b.user_id,guest_id:b.guest_id,session_start:b.session_start,last_activity:b.last_activity,is_online:b.is_online,user:Array.isArray(b.user)?b.user[0]:b.user}));n(_)}catch(w){console.error("Ошибка загрузки сессий:",w),q.error("Ошибка обновления списка сессий"),n([])}};return s||c?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-gray-600",children:"Загрузка данных..."})}):a?e.jsxs("div",{className:"p-4 sm:p-6 fade-in",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-6 sm:mb-8",children:"Панель управления"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:gap-6 sm:grid-cols-2 lg:grid-cols-2",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Всего заказов"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.total_orders})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Общий доход"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["₴",r.total_revenue]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Товаров в каталоге"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r.products_count})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4",children:["Активные сессии (",l.length,")"]}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[x.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-600",children:["Зарегистрированные пользователи (",x.length,")"]}),x.map(w=>e.jsx(Gt,{session:w},w.id))]}),v.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-600",children:["Гостевые сессии (",v.length,")"]}),v.map(w=>e.jsx(Gt,{session:w},w.id))]}),l.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Нет активных сессий"})]})]})]})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Несанкционированный доступ"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"У вас нет прав для просмотра этой страницы."})]})},Gt=({session:a})=>{var s,r,i,l;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:((s=a.user)==null?void 0:s.email)||`Гость (${(r=a.guest_id)==null?void 0:r.slice(0,8)})`}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Последняя активность: ",new Date(a.last_activity).toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a.is_online?"bg-green-500":"bg-gray-400"}`}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${(i=a.user)!=null&&i.is_admin?"bg-blue-100 text-blue-800":a.user_id?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:(l=a.user)!=null&&l.is_admin?"Админ":a.user_id?"Пользователь":"Гость"})]})]})},gr=({onFilterChange:a,onSortChange:s})=>{const[r,i]=t.useState(""),[l,n]=t.useState(0),[c,m]=t.useState(1e6);t.useEffect(()=>{c<l&&m(l)},[l,c]);const f=()=>{a({type:r.trim(),minPrice:Math.max(0,l),maxPrice:Math.max(l,c)})},x=N=>{s(N.target.value)},v=N=>{const j=Math.max(0,Number(N)||0);n(j),c<j&&m(j)},g=N=>{const j=Math.max(l,Number(N)||l);m(j)};return e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Тип"}),e.jsxs("select",{value:r,onChange:N=>i(N.target.value),className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Всі товари"}),e.jsx("option",{value:"tire",children:"Шини"}),e.jsx("option",{value:"wheel",children:"Диски"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Мінімальна ціна"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:l,onChange:N=>v(N.target.value),className:"w-full border border-gray-300 rounded-md p-2 pr-8 focus:ring-2 focus:ring-blue-500",min:"0",placeholder:"Від"}),e.jsx("span",{className:"absolute right-3 top-3 text-gray-400",children:"₴"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Максимальна ціна"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:c,onChange:N=>g(N.target.value),className:"w-full border border-gray-300 rounded-md p-2 pr-8 focus:ring-2 focus:ring-blue-500",min:l,placeholder:"До"}),e.jsx("span",{className:"absolute right-3 top-3 text-gray-400",children:"₴"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Сортування"}),e.jsxs("select",{onChange:x,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",defaultValue:"created_at_desc",children:[e.jsx("option",{value:"created_at_desc",children:"Новіші спочатку"}),e.jsx("option",{value:"created_at_asc",children:"Старіші спочатку"}),e.jsx("option",{value:"price_asc",children:"Від дешевих"}),e.jsx("option",{value:"price_desc",children:"Від дорогих"}),e.jsx("option",{value:"rating_asc",children:"За рейтингом (↑)"}),e.jsx("option",{value:"rating_desc",children:"За рейтингом (↓)"})]})]})]}),e.jsxs("button",{onClick:f,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-colors flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z",clipRule:"evenodd"})}),"Застосувати фільтри"]})]})},br=[{value:"summer",label:"Літо"},{value:"winter",label:"Зима"},{value:"all-season",label:"Всесезон"}],Xt=["A","B","C","D","E"],jr=({isOpen:a,product:s,onClose:r,onSave:i})=>{const l=nt(),[n,c]=t.useState(s),[m,f]=t.useState(null),[x,v]=t.useState(!1),[g,N]=t.useState(s.image_url||[]),[j,w]=t.useState([]),[E,y]=t.useState(new Set),_=t.useRef(null);t.useEffect(()=>{s&&(c(s),N(s.image_url||[]),w([]),y(new Set))},[s]);const b=d=>{const{name:p,value:u}=d.target;y(S=>new Set(S).add(p)),c(S=>({...S,[p]:["price","sale_price","width","profile","diameter","year","noise_level","wheel_width"].includes(p)?u===""?null:Number(u):u}))},C=d=>{const{name:p,checked:u}=d.target;y(S=>new Set(S).add(p)),c(S=>({...S,[p]:u}))},h=()=>["brand","model","price"].filter(u=>{var S;return!((S=n[u])!=null&&S.toString().trim())}).length>0?(f("Обовʼязкові поля: Бренд, Модель, Ціна"),!1):n.price&&n.price<=0?(f("Ціна повинна бути більше нуля"),!1):!0,R=d=>{if(d.target.files&&d.target.files.length>0){const p=Array.from(d.target.files);w(u=>[...u,...p]),y(u=>new Set(u).add("image_url"))}},I=(d,p)=>{y(u=>new Set(u).add("image_url")),p?w(u=>u.filter((S,P)=>P!==d)):N(u=>u.filter((S,P)=>P!==d))},k=async d=>{const p=d.name.split(".").pop(),u=`products/${n.id}/${Date.now()}.${p}`,{error:S}=await M.storage.from("product-images").upload(u,d);if(S)throw S;const{data:{publicUrl:P}}=M.storage.from("product-images").getPublicUrl(u);return P},o=async d=>{if(d.preventDefault(),f(null),!!h()){v(!0);try{let p=[...g];if(j.length>0){const P=j.map(T=>k(T)),D=await Promise.all(P);p=[...p,...D]}const u={updated_at:new Date().toISOString(),...E.has("brand")&&{brand:n.brand},...E.has("model")&&{model:n.model},...E.has("price")&&{price:n.price},...E.has("sale_price")&&{sale_price:n.sale_price},...E.has("width")&&{width:n.width},...E.has("profile")&&{profile:n.profile},...E.has("diameter")&&{diameter:n.diameter},...E.has("season")&&{season:n.season},...E.has("country")&&{country:n.country},...E.has("year")&&{year:n.year},...E.has("type")&&{type:n.type},...E.has("noise_level")&&{noise_level:n.noise_level},...E.has("wet_grip")&&{wet_grip:n.wet_grip},...E.has("fuel_efficiency")&&{fuel_efficiency:n.fuel_efficiency},...E.has("wheel_width")&&{wheel_width:n.wheel_width},...E.has("load_index")&&{load_index:n.load_index},...E.has("speed_index")&&{speed_index:n.speed_index},...E.has("spikes")&&{spikes:n.spikes},...E.has("image_url")&&{image_url:p}},{error:S}=await M.from("products").update(u).eq("id",n.id);if(S)throw S;await l.invalidateQueries({queryKey:["products"]}),je("admin_product_edit",{product_id:n.id}),i({...s,...u}),r()}catch(p){const u=p instanceof Error?p.message:"Помилка оновлення товару";f(u),je("admin_product_edit_error",{error:u})}finally{v(!1)}}};return e.jsx(Qe,{isOpen:a,onRequestClose:r,className:"modal bg-white rounded-lg p-4 sm:p-6 mx-4 sm:mx-auto max-w-[95vw] sm:max-w-2xl w-full shadow-xl",overlayClassName:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",closeTimeoutMS:200,ariaHideApp:!1,children:e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold",children:"Редагування товару"}),e.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-700 transition-colors text-2xl",children:"×"})]}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Бренд *"}),e.jsx("input",{type:"text",name:"brand",value:n.brand||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Модель *"}),e.jsx("input",{type:"text",name:"model",value:n.model||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ціна *"}),e.jsx("input",{type:"number",name:"price",value:n.price||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",min:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Акційна ціна"}),e.jsx("input",{type:"number",name:"sale_price",value:n.sale_price||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",min:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ширина"}),e.jsx("input",{type:"number",name:"width",value:n.width||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Профіль"}),e.jsx("input",{type:"number",name:"profile",value:n.profile||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Діаметр"}),e.jsx("input",{type:"number",name:"diameter",value:n.diameter||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",min:"0"})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Зображення товару"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[g.map((d,p)=>e.jsxs("div",{className:"relative w-24 h-24 border rounded-md overflow-hidden group",children:[e.jsx("img",{src:d,alt:`Товар ${n.brand} ${n.model}`,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>I(p,!1),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:"×"})]},`current-${p}`)),j.map((d,p)=>e.jsxs("div",{className:"relative w-24 h-24 border rounded-md overflow-hidden group",children:[e.jsx("img",{src:URL.createObjectURL(d),alt:`Новое изображение ${p+1}`,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>I(p,!0),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:"×"})]},`new-${p}`)),e.jsx("button",{type:"button",onClick:()=>{var d;return(d=_.current)==null?void 0:d.click()},className:"w-24 h-24 border-2 border-dashed border-gray-300 rounded-md flex items-center justify-center text-gray-500 hover:bg-gray-50 transition-colors",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsx("input",{ref:_,type:"file",multiple:!0,accept:"image/*",onChange:R,className:"hidden"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Країна виробник"}),e.jsx("input",{type:"text",name:"country",value:n.country||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Рік виробництва"}),e.jsx("input",{type:"number",name:"year",value:n.year||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Сезонність *"}),e.jsx("select",{name:"season",value:n.season||"summer",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",required:!0,children:br.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Тип товару *"}),e.jsxs("select",{name:"type",value:n.type||"tire",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"tire",children:"Шина"}),e.jsx("option",{value:"wheel",children:"Диск"})]})]})]}),n.type==="tire"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Рівень шуму (dB)"}),e.jsx("input",{type:"number",name:"noise_level",value:n.noise_level||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Сцепление на мокрой дороге"}),e.jsx("select",{name:"wet_grip",value:n.wet_grip||"A",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",children:Xt.map(d=>e.jsx("option",{value:d,children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Топливная эффективность"}),e.jsx("select",{name:"fuel_efficiency",value:n.fuel_efficiency||"A",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",children:Xt.map(d=>e.jsx("option",{value:d,children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Индекс нагрузки"}),e.jsx("input",{type:"text",name:"load_index",value:n.load_index||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",placeholder:"Наприклад: 92Y"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Индекс скорости"}),e.jsx("input",{type:"text",name:"speed_index",value:n.speed_index||"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",placeholder:"Наприклад: Y"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("input",{type:"checkbox",id:"spikesCheckbox",name:"spikes",checked:n.spikes||!1,onChange:C,className:"h-4 w-4"}),e.jsx("label",{htmlFor:"spikesCheckbox",className:"text-sm",children:"Шипованные"})]})]}),n.type==="wheel"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ширина диска (мм)"}),e.jsx("input",{type:"number",name:"wheel_width",value:n.wheel_width??"",onChange:b,className:"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500",min:"100",max:"500"})]})}),m&&e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},className:"text-red-600 text-sm p-2 bg-red-100 rounded",children:m}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 mt-6",children:[e.jsx(A.button,{type:"button",onClick:r,className:"w-full sm:w-auto px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-md",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Скасувати"}),e.jsx(A.button,{type:"submit",className:"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",disabled:x,whileHover:{scale:1.05},whileTap:{scale:.95},children:x?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Збереження..."]}):"Зберегти зміни"})]})]})]})})};Qe.setAppElement("#root");const vr={summer:"Літо",winter:"Зима","all-season":"Всесезон"},yr=()=>{const a=G(),s=me(),{isAdmin:r,loading:i}=it(),l=nt(),[n,c]=t.useState(1),[m,f]=t.useState({type:"",minPrice:0,maxPrice:1e6}),[x,v]=t.useState("created_at_desc"),[g,N]=t.useState(!1),[j,w]=t.useState(null),[E,y]=t.useState(null),[_,b]=t.useState(0),C=t.useCallback(()=>l.refetchQueries({queryKey:["products",n,m,x]}),[n,m,x,l]),{data:h,isLoading:R,error:I}=rt({queryKey:["products",n,m,x],queryFn:async()=>{const[o,d]=x.split("_");let p=M.from("products").select(`
          *,
          reviews:reviews(count)
        `,{count:"exact"}).gte("price",Math.max(0,m.minPrice)).lte("price",Math.max(m.minPrice,m.maxPrice));m.type&&(p=p.eq("type",m.type));const{data:u,error:S,count:P}=await p.order(o==="created"?"created_at":o,{ascending:d==="asc"}).range((n-1)*10,n*10-1);if(S)throw S;return b(P||0),(u==null?void 0:u.map(D=>{var T;return{...D,reviews_count:((T=D.reviews)==null?void 0:T.length)||0,wheel_width:D.wheel_width?Number(D.wheel_width):void 0}}))||[]},enabled:r,retry:1});t.useEffect(()=>{var o;(o=s.state)!=null&&o.shouldResetPagination&&(c(1),a(s.pathname,{replace:!0,state:{}}))},[s.state,a,s.pathname]),t.useEffect(()=>{let o;return(async()=>{o=M.channel("realtime-products").on("postgres_changes",{event:"*",schema:"public",table:"products"},()=>C()).subscribe()})(),()=>{o==null||o.unsubscribe().catch(console.error)}},[C]);const k=qs({mutationFn:async o=>{const d=h==null?void 0:h.find(u=>u.id===o);d!=null&&d.image_url&&await Promise.all(d.image_url.map(async u=>{const S=u.split("/").pop();if(S){const P=d.type==="tire"?"tires":"wheels",{error:D}=await M.storage.from("products").remove([`${P}/${S}`]);if(D&&D.message!=="Object not found")throw D}}));const{error:p}=await M.from("products").delete().eq("id",o);if(p)throw p},onSuccess:()=>{l.invalidateQueries({queryKey:["products"]}),je("admin_product_delete",{product_id:j})},onError:o=>{je("admin_product_delete_error",{error:o.message}),console.error("Delete error:",o)},onSettled:()=>{w(null),N(!1)}});return i?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(A.div,{animate:{rotate:360},transition:{duration:1.5,repeat:1/0},className:"border-4 border-blue-200 rounded-full w-16 h-16"})}):r?e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-3",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Управління товарами"}),e.jsx(A.button,{onClick:()=>a("/admin/products/new"),className:"bg-blue-500 text-white px-3 py-1.5 sm:px-4 sm:py-2 rounded hover:bg-blue-600 text-sm sm:text-base",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Додати товар"})]}),e.jsx(gr,{onFilterChange:f,onSortChange:v}),e.jsx(oe,{children:I&&e.jsx(A.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},className:"mb-3 p-2 sm:p-3 bg-red-100 text-red-600 rounded-lg text-xs sm:text-sm",children:I.message})}),R?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(A.div,{animate:{rotate:360},transition:{duration:1.2,repeat:1/0},className:"border-3 border-blue-400 rounded-full w-12 h-12"})}):e.jsxs(e.Fragment,{children:[e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:h==null?void 0:h.map(o=>{var d;return e.jsxs(A.div,{whileHover:{y:-3},transition:{duration:.2},className:"border p-2 sm:p-3 rounded shadow bg-white",children:[((d=o.image_url)==null?void 0:d[0])&&e.jsx("img",{src:o.image_url[0],alt:o.name,className:"w-full h-28 sm:h-32 md:h-40 object-cover mb-2 rounded"}),e.jsxs("h3",{className:"font-bold text-sm sm:text-base mb-1",children:[o.brand," ",o.model]}),e.jsxs("div",{className:"text-gray-600 text-xs sm:text-sm space-y-1",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("span",{className:`font-medium ${o.sale_price?"text-red-500 line-through":"text-gray-800"}`,children:[o.price," грн"]}),o.sale_price&&e.jsxs("span",{className:"font-medium text-green-600",children:[o.sale_price," грн"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1",children:[e.jsxs("p",{children:["Тип: ",o.type==="tire"?"Шина":"Диск"]}),e.jsxs("p",{children:["Розмір: ",o.width,"/",o.profile,"R",o.diameter]}),e.jsxs("p",{children:["Країна: ",o.country]}),e.jsxs("p",{children:["Рік: ",o.year]})]}),o.type==="tire"&&e.jsxs("div",{className:"grid grid-cols-2 gap-x-2",children:[e.jsxs("p",{children:["Сезон: ",vr[o.season]]}),e.jsxs("p",{children:["Шум: ",o.noise_level,"dB"]}),o.wet_grip&&e.jsxs("p",{children:["Сцепление: ",o.wet_grip]}),o.fuel_efficiency&&e.jsxs("p",{children:["Экономия: ",o.fuel_efficiency]}),o.load_index&&e.jsxs("p",{children:["Нагрузка: ",o.load_index]}),o.speed_index&&e.jsxs("p",{children:["Скорость: ",o.speed_index]}),e.jsxs("p",{children:["Шипы: ",o.spikes?"Да":"Нет"]})]}),o.type==="wheel"&&o.wheel_width!==void 0&&e.jsx("div",{className:"grid grid-cols-2 gap-x-2",children:e.jsxs("p",{children:["Ширина диска: ",o.wheel_width,"мм"]})}),e.jsx("div",{className:"flex items-center gap-1.5 mt-1",children:e.jsxs("span",{className:"text-gray-500 text-xs",children:["Відгуків: ",o.reviews_count]})})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between",children:e.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[e.jsx(A.button,{onClick:()=>y(o),className:"text-blue-600 hover:text-blue-800 text-xs sm:text-sm",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Редагувати"}),e.jsx(A.button,{onClick:()=>{w(o.id),N(!0)},className:"text-red-600 hover:text-red-800 text-xs sm:text-sm",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Видалити"})]})})]},o.id)})}),e.jsx(js,{currentPage:n,totalPages:Math.ceil(_/10)||1,onPageChange:c})]}),e.jsxs(Qe,{isOpen:g,onRequestClose:()=>N(!1),className:"modal bg-white rounded-lg p-4 sm:p-6 max-w-md mx-auto shadow-xl",overlayClassName:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold mb-3",children:"Видалити товар?"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm sm:text-base",children:"Ви дійсно хочете видалити цей товар? Цю дію не можна скасувати."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>N(!1),className:"px-3 py-1.5 text-gray-600 hover:bg-gray-100 rounded text-sm sm:text-base",children:"Скасувати"}),e.jsx("button",{onClick:()=>j&&k.mutate(j),className:"px-3 py-1.5 bg-red-500 text-white rounded hover:bg-red-600 text-sm sm:text-base",disabled:k.isPending,children:k.isPending?"Видалення...":"Видалити"})]})]})]}),E&&e.jsx(jr,{isOpen:!!E,product:E,onClose:()=>y(null),onSave:async o=>{await M.from("products").update(o).eq("id",o.id),await l.invalidateQueries({queryKey:["products"]}),y(null)}})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Несанкціонований доступ"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"У вас немає прав для перегляду цієї сторінки."})]})},wr=5*1024*1024,Qt=["image/jpeg","image/png","image/webp"],Nr=({onUpload:a,onUploading:s})=>{const[r,i]=t.useState(0),[l,n]=t.useState(0),[c,m]=t.useState(null),[f,x]=t.useState(!1),v=async g=>{if(f){alert("Завантаження вже виконується. Будь ласка, зачекайте.");return}if(!g||g.length===0){alert("Будь ласка, виберіть файли для завантаження");return}x(!0),m(g),s==null||s(!0);const N=[];let j=0;try{for(let w=0;w<g.length;w++){const E=g[w];let y="";try{if(!Qt.includes(E.type))throw new Error(`Файл "${E.name}": недопустимий формат`);if(E.size>wr)throw new Error(`Файл "${E.name}": перевищує 5MB`);const{path:_}=await Oa(E,"products","tires");y=gs("products",_),N.push(y),j++}catch(_){console.error(`Помилка з файлом ${E.name}:`,_),alert(_ instanceof Error?_.message:"Невідома помилка");continue}i((w+1)/g.length*100),n(j)}a(N)}finally{x(!1),s==null||s(!1),i(0),n(0)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block",children:e.jsx("input",{type:"file",multiple:!0,accept:Qt.join(","),onChange:g=>v(g.target.files),className:`block w-full text-sm text-gray-500
            file:mr-4 file:py-2 file:px-4
            file:rounded-full file:border-0
            file:text-sm file:font-semibold
            file:bg-blue-50 file:text-blue-700
            hover:file:bg-blue-100`,disabled:f})}),r>0&&e.jsxs(A.div,{initial:{opacity:0},animate:{opacity:1},className:"relative pt-1",children:[e.jsx("div",{className:"flex h-2 overflow-hidden bg-gray-200 rounded",children:e.jsx("div",{className:"transition-all duration-300 ease-out bg-blue-500",style:{width:`${r}%`}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[`Завантажено ${l} з 
            ${(c==null?void 0:c.length)||0} файлів 
            (${Math.round(r)}%)`," // Отображение количества загруженных файлов"]})]})]})},Sr=()=>{var u;const a=G(),s=nt(),{isAdmin:r,loading:i}=it(),[l,n]=t.useState(!1),[c,m]=t.useState(!1),[f,x]=t.useState(null),[v,g]=t.useState([]),[N,j]=t.useState([]),[w,E]=t.useState({brands:[],models:[]}),[y,_]=t.useState({type:"tire",brand:"",model:"",width:195,diameter:16,profile:55,price:0,sale_price:void 0,image_url:[],country:"UA",year:new Date().getFullYear(),season:"summer",noise_level:70,wet_grip:"A",fuel_efficiency:"A",wheel_width:void 0,load_index:"",speed_index:"",spikes:!1}),b=t.useCallback(async()=>{try{const{data:S}=await M.from("products").select("brand").not("brand","is",null),{data:P}=await M.from("products").select("model").not("model","is",null);if(S){const D=[...new Set(S.map(T=>T.brand))];g(D),E(T=>({...T,brands:D.slice(0,5)}))}if(P){const D=[...new Set(P.map(T=>T.model))];j(D)}}catch(S){console.error("Ошибка загрузки данных:",S)}},[]);t.useEffect(()=>{b()},[b]);const C=S=>{const P=S.target.value.trim();_(T=>({...T,brand:P,model:""}));const D=P.length>0?v.filter(T=>T.toLowerCase().includes(P.toLowerCase())).slice(0,5):v.slice(0,5);E(T=>({...T,brands:D}))},h=S=>{const P=S.target.value.trim();_(T=>({...T,model:P}));const D=P.length>0?N.filter(T=>T.toLowerCase().includes(P.toLowerCase())).slice(0,5):N.slice(0,5);E(T=>({...T,models:D}))},R=S=>{const{name:P,value:D,type:T}=S.target;_(B=>({...B,[P]:T==="number"?D===""?null:Number(D):D}))},I=S=>{const{name:P,value:D}=S.target;_(T=>({...T,[P]:D===""?void 0:BigInt(D)}))},k=S=>{_(P=>({...P,image_url:[...new Set([...P.image_url||[],...S])]}))},o=S=>{_(P=>{var D;return{...P,image_url:((D=P.image_url)==null?void 0:D.filter((T,B)=>B!==S))||[]}})},d=async S=>{S.preventDefault(),n(!0),x(null);try{const P={...y,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:D,error:T}=await M.from("products").insert([P]).select().single();if(T)throw T;je("admin_product_create",{product_id:D.id,product_name:`${y.brand} ${y.model}`}),await s.invalidateQueries({queryKey:["products"],exact:!1,refetchType:"all"}),a("/admin/products",{state:{successMessage:"Товар успішно створено",shouldResetPagination:!0}})}catch(P){const D=P instanceof Error?P.message:"Помилка при створенні товару";console.error("Помилка створення:",D),x(D),je("admin_product_create_error",{error:D,product_data:y})}finally{n(!1)}},p=S=>(S==null?void 0:S.toString())||"";return i?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(A.div,{className:"relative w-16 h-16",animate:{rotate:360},transition:{repeat:1/0,duration:1.5,ease:"linear"}})}):r?e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Додати новий товар"}),e.jsx(A.button,{onClick:()=>a("/admin/products"),className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Назад до списку"})]}),e.jsxs("form",{onSubmit:d,className:"space-y-6 bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Тип ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"type",value:y.type,onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"tire",children:"Шина"}),e.jsx("option",{value:"wheel",children:"Диск"})]})]}),y.type==="tire"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Сезон ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"season",value:y.season,onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"summer",children:"Літо"}),e.jsx("option",{value:"winter",children:"Зима"}),e.jsx("option",{value:"all-season",children:"Всесезон"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Рівень шуму (dB)"}),e.jsx("input",{type:"number",name:"noise_level",value:y.noise_level||"",onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",min:"0",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Сцепление на мокрой дороге"}),e.jsx("select",{name:"wet_grip",value:y.wet_grip,onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",children:["A","B","C","D","E"].map(S=>e.jsx("option",{value:S,children:S},S))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Топливная эффективность"}),e.jsx("select",{name:"fuel_efficiency",value:y.fuel_efficiency,onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",children:["A","B","C","D","E"].map(S=>e.jsx("option",{value:S,children:S},S))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Индекс нагрузки"}),e.jsx("input",{type:"text",name:"load_index",value:y.load_index,onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",placeholder:"Например: 92Y"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Индекс скорости"}),e.jsx("input",{type:"text",name:"speed_index",value:y.speed_index,onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",placeholder:"Например: Y"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"spikes",checked:y.spikes||!1,onChange:S=>_(P=>({...P,spikes:S.target.checked})),className:"h-4 w-4"}),e.jsx("label",{className:"text-sm",children:"Шипованные"})]})]}),y.type==="wheel"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ширина диска (мм)"}),e.jsx("input",{type:"number",name:"wheel_width",value:p(y.wheel_width),onChange:I,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",min:"100",max:"500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Бренд ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",list:"brands-list",name:"brand",value:y.brand,onChange:C,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("datalist",{id:"brands-list",children:w.brands.map((S,P)=>e.jsx("option",{value:S},P))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Модель ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",list:"models-list",name:"model",value:y.model,onChange:h,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("datalist",{id:"models-list",children:w.models.map((S,P)=>e.jsx("option",{value:S},P))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Ширина ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"width",value:y.width||"",onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",required:!0,min:"100",max:"500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Профіль (%) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"profile",value:y.profile||"",onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",required:!0,min:"20",max:"100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Діаметр ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"diameter",value:y.diameter||"",onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",required:!0,min:"10",max:"30"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Ціна (грн) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"price",value:y.price||"",onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",required:!0,min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Акційна ціна (грн)"}),e.jsx("input",{type:"number",name:"sale_price",value:y.sale_price||"",onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Країна виробник"}),e.jsx("input",{type:"text",name:"country",value:y.country,onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Рік виробництва"}),e.jsx("input",{type:"number",name:"year",value:y.year||"",onChange:R,className:"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500",min:"2000",max:new Date().getFullYear()+1})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Зображення"}),e.jsx(Nr,{onUpload:k,onUploading:m}),e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-2",children:(u=y.image_url)==null?void 0:u.map((S,P)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:S,alt:`Preview ${P+1}`,className:"h-24 w-full object-cover rounded border transition-opacity group-hover:opacity-75"}),e.jsx("button",{type:"button",onClick:()=>o(P),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:"×"})]},P))})]})]}),f&&e.jsx(A.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-red-600 p-3 bg-red-100 rounded-lg",children:f}),e.jsxs("div",{className:"flex justify-end gap-4 mt-8",children:[e.jsx(A.button,{type:"button",onClick:()=>a("/admin/products"),className:"bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Скасувати"}),e.jsx(A.button,{type:"submit",disabled:l||c,className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:l?e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-3",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Створення..."]}):"Створити товар"})]})]})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Несанкціонований доступ"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"У вас немає прав для перегляду цієї сторінки."})]})},kr=()=>{const[a,s]=t.useState(""),[r,i]=t.useState(""),[l,n]=t.useState(null),[c,m]=t.useState(!1),[f,x]=t.useState([]),v=G();t.useEffect(()=>{g()},[]);const g=async()=>{const{data:_,error:b}=await M.from("articles").select("*").order("id",{ascending:!1});b?console.error("Ошибка загрузки статей:",b.message):_&&x(_)},N=async _=>{_.preventDefault(),m(!0);let b="";if(l){const h=`${Date.now()}_${l.name}`,{error:R}=await M.storage.from("articles-images").upload(h,l);if(R){console.error("Ошибка загрузки изображения:",R.message),m(!1);return}b=h}const{error:C}=await M.from("articles").insert([{title:a,content:r,image_path:b}]);C?console.error("Ошибка добавления статьи:",C.message):(s(""),i(""),n(null),alert("Статья успешно добавлена!"),g()),m(!1)},j=_=>{const{data:b}=M.storage.from("articles-images").getPublicUrl(_);return b.publicUrl},w=_=>{v(`/admin/articles/${_.id}`)},E=_=>{x(b=>{const C=b.filter(h=>h.id!==_.id);return[_,...C]})},y=async _=>{if(window.confirm(`Удалить статью "${_.title}"?`)){const{error:b}=await M.from("articles").delete().eq("id",_.id);b?console.error("Ошибка удаления статьи:",b.message):x(C=>C.filter(h=>h.id!==_.id))}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"max-w-3xl mx-auto bg-white shadow rounded-lg p-6 mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Добавить новую статью"}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Заголовок"}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",value:a,onChange:_=>s(_.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Контент"}),e.jsx("textarea",{className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:6,value:r,onChange:_=>i(_.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Изображение"}),e.jsx("input",{type:"file",accept:"image/*",onChange:_=>_.target.files&&n(_.target.files[0]),className:"w-full"})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:c?"Загрузка...":"Добавить статью"})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Все статьи"}),f.length===0?e.jsx("p",{children:"Статей нет"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:f.map(_=>e.jsxs("div",{className:"bg-white shadow rounded p-6 cursor-pointer flex flex-col",children:[e.jsxs("div",{onClick:()=>w(_),className:"flex-1",children:[e.jsx("h3",{className:"font-bold mb-3 text-lg",children:_.title}),_.image_path&&e.jsx("img",{src:j(_.image_path),alt:_.title,className:"w-full h-40 object-cover mb-3 rounded"}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",style:{whiteSpace:"pre-wrap"},children:_.content})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>E(_),className:"bg-green-500 hover:bg-green-600 text-white text-xs py-1 px-2 rounded transition-colors",children:"В начало"}),e.jsx("button",{onClick:()=>y(_),className:"bg-red-500 hover:bg-red-600 text-white text-xs py-1 px-2 rounded transition-colors",children:"Удалить"})]})]},_.id))})]})]})},Cr=()=>{const{sessions:a,refreshSessions:s}=As(),[r,i]=t.useState({key:"last_activity",direction:"desc"}),l=t.useMemo(()=>[...a].sort((v,g)=>{switch(r.key){case"last_activity":{const N=new Date(v.last_activity).getTime(),j=new Date(g.last_activity).getTime();return r.direction==="asc"?N-j:j-N}case"user_id":case"guest_id":{const N=v[r.key]||"",j=g[r.key]||"";return r.direction==="asc"?N.localeCompare(j):j.localeCompare(N)}case"is_online":return r.direction==="asc"?Number(v.is_online)-Number(g.is_online):Number(g.is_online)-Number(v.is_online);default:return 0}}),[a,r]),n=async()=>{const{data:{user:v}}=await M.auth.getUser();if(!v)return q.error("Пользователь не найден"),!1;const{data:g,error:N}=await M.from("admins").select("*").eq("user_id",v.id).single();return N||!g?(q.error("Недостаточно прав для удаления"),!1):!0},c=async v=>{if(await n())try{const{error:g}=await M.from("sessions").delete().eq("id",v);if(g)throw g;await s(),q.success("Сессия успешно удалена")}catch(g){q.error("Ошибка при удалении сессии"),console.error("Delete error:",g)}},m=async()=>{if(await n())try{const{error:v}=await M.from("sessions").delete().eq("is_online",!1);if(v)throw v;await s(),q.success(`Удалено ${a.filter(g=>!g.is_online).length} неактивных сессий`)}catch(v){q.error("Ошибка при удалении сессий"),console.error("Delete inactive error:",v)}},f=t.useCallback(v=>{const g=new Date(v.last_activity).getTime(),j=Date.now()-g,w=Math.floor(j/(1e3*60*60)),E=Math.floor(j%(1e3*60*60)/(1e3*60));return`${w}ч ${E}м`},[]),x=v=>{i(g=>({key:v,direction:g.key===v&&g.direction==="asc"?"desc":"asc"}))};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 md:p-6 mx-2 md:mx-0 h-[calc(100vh-160px)] md:h-auto",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-center justify-between mb-4 md:mb-6",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-foreground",children:["Активные сессии (",a.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"p-2 hover:bg-red-50 rounded-lg transition-colors text-red-600",title:"Удалить все неактивные сессии",children:e.jsx(pa,{className:"w-5 h-5"})}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-muted rounded-lg transition-colors","aria-label":"Обновить данные",children:e.jsx(ga,{className:"w-5 h-5 text-primary"})})]})]}),e.jsx("div",{className:"md:hidden space-y-3 overflow-y-auto h-[calc(100%-60px)]",children:l.map(v=>{var g;return e.jsxs("div",{className:"border-b pb-3 animate-fadeIn",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-foreground",children:v.user_id?"Пользователь":"Гость"}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["ID: ",v.user_id||((g=v.guest_id)==null?void 0:g.slice(0,8))]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${v.is_online?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:v.is_online?"Онлайн":"Офлайн"}),e.jsx("button",{onClick:()=>c(v.id),className:"text-red-500 hover:text-red-700",children:e.jsx(tt,{size:16})})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(At,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:f(v)})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(v.last_activity).toLocaleTimeString()})]})]},v.id)})}),e.jsx("div",{className:"hidden md:block overflow-x-auto max-h-[70vh]",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"sticky top-0 bg-background",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-foreground",children:"Действия"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-foreground cursor-pointer",onClick:()=>x("user_id"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["ID",r.key==="user_id"&&(r.direction==="asc"?e.jsx($t,{size:14,className:"text-primary"}):e.jsx(Ot,{size:14,className:"text-primary"}))]})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-foreground cursor-pointer",onClick:()=>x("is_online"),children:"Статус"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-foreground cursor-pointer",onClick:()=>x("last_activity"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Последняя активность",r.key==="last_activity"&&(r.direction==="asc"?e.jsx($t,{size:14,className:"text-primary"}):e.jsx(Ot,{size:14,className:"text-primary"}))]})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-foreground",children:"Время активности"})]})}),e.jsx("tbody",{children:l.map(v=>e.jsxs("tr",{className:"border-b hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>c(v.id),className:"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50",children:e.jsx(tt,{size:18})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-foreground font-mono",children:v.user_id||v.guest_id}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-sm ${v.is_online?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:v.is_online?"Онлайн":"Офлайн"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-foreground",children:new Date(v.last_activity).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{children:f(v)})]})})]},v.id))})]})}),l.length===0&&e.jsx("div",{className:"text-center py-6 text-muted-foreground text-sm md:text-base",children:"Нет активных сессий"})]})},_r=({children:a})=>{const{isAdmin:s,loading:r}=it(),i=me();return r?e.jsx("div",{className:"flex justify-center items-center h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs(A.div,{className:"relative w-32 h-32 mx-auto",initial:{rotate:0},animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:[e.jsx(A.div,{className:"absolute inset-0 border-4 border-blue-200 rounded-full",animate:{scale:[1,1.2,1],opacity:[.6,1,.6]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"}}),e.jsx(A.div,{className:"absolute inset-2 border-4 border-blue-400 rounded-full",animate:{scale:[1,.8,1],rotate:[0,-180,-360]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),e.jsx(A.div,{className:"absolute inset-4 bg-blue-600 rounded-full",animate:{scale:[1,1.1,1],borderRadius:["50%","40%","50%"]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})]}),e.jsx(A.p,{className:"text-blue-800 font-medium text-lg",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:"Проверка прав доступа..."})]})}):s?e.jsx(e.Fragment,{children:a}):e.jsx(es,{to:"/admin/login",state:{from:i}})},Er=t.lazy(()=>be(()=>import("./ProductDetail-DAE-fbPB.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ir=new zs({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1,staleTime:60*1e3}}});function Lr(a,s){let r;return function(...i){clearTimeout(r),r=setTimeout(()=>a(...i),s)}}const Pr=()=>{const a=me(),s=t.useMemo(()=>["/","/tires","/wheels","/search-results","/detailed-search"],[]);return e.jsxs(e.Fragment,{children:[e.jsx(Ma,{}),e.jsx(Fs,{}),a.pathname!=="/"&&e.jsx(mr,{}),s.some(r=>a.pathname.startsWith(r))&&e.jsx(dr,{}),e.jsx(Zt,{})]})},Rr=t.memo(()=>e.jsx("div",{children:e.jsx(Qa,{})})),Mr=$s([{path:"/",element:e.jsx(Pr,{}),children:[{index:!0,element:e.jsx(Rr,{})},{path:"tires",element:e.jsx(dt,{})},{path:"wheels",element:e.jsx(dt,{})},{path:"search-results",element:e.jsx(dt,{})},{path:"detailed-search",element:e.jsx(cr,{})},{path:"product/:id",element:e.jsx(t.Suspense,{fallback:null,children:e.jsx(Er,{})})},{path:"product/:id/comment",element:e.jsx(er,{})},{path:"auth",element:e.jsx(tr,{})},{path:"profile",element:e.jsx(sr,{})},{path:"checkout",element:e.jsx(ir,{})},{path:"auth/callback",element:e.jsx(or,{})},{path:"articles",element:e.jsx(ts.KeepAlive,{children:e.jsx(bs,{})})},{path:"articles/:id",element:e.jsx(lr,{})},{path:"*",element:e.jsx(es,{to:"/",replace:!0})}]},{path:"/admin",element:e.jsx(_r,{children:e.jsx(ur,{})}),children:[{index:!0,element:e.jsx(pr,{})},{path:"products",element:e.jsx(yr,{})},{path:"products/new",element:e.jsx(Sr,{})},{path:"products/edit/:id",element:e.jsx("div",{children:"Edit Product Page"})},{path:"sessions",element:e.jsx(Cr,{})},{path:"articles",element:e.jsx(kr,{})}]},{path:"/admin/login",element:e.jsx(xr,{})}]);function Dr(){return t.useEffect(()=>{let a=setTimeout(s,18e5);function s(){window.location.reload()}const r=()=>{clearTimeout(a),a=setTimeout(s,30*60*1e3)},i=["mousemove","keydown","scroll","touchstart","click"];return i.forEach(l=>window.addEventListener(l,r)),()=>{clearTimeout(a),i.forEach(l=>window.removeEventListener(l,r))}},[]),null}function Tr(){const[a,s]=t.useState(!1),r=t.useRef(new Date),[i,l]=t.useState({someData:"значение"});t.useEffect(()=>{const f=localStorage.getItem("savedState");if(f)try{const x=JSON.parse(f);l(x)}catch(x){console.error("Ошибка парсинга сохранённого состояния:",x)}},[]),t.useEffect(()=>{const f=()=>s(!0);if(document.readyState==="complete")f();else return window.addEventListener("load",f),()=>window.removeEventListener("load",f)},[]);const n=t.useCallback(async()=>{const{data:{user:f}}=await M.auth.getUser();if(!f){let x=localStorage.getItem("guest_id");x||(x=crypto.randomUUID(),localStorage.setItem("guest_id",x),await M.from("sessions").upsert({guest_id:x,last_activity:new Date().toISOString(),is_online:!0},{onConflict:"guest_id"}))}},[]);t.useEffect(()=>{n()},[n]);const c=t.useCallback(async f=>{const{data:{user:x}}=await M.auth.getUser(),v=localStorage.getItem("guest_id"),g={last_activity:new Date().toISOString(),is_online:f};try{x?await M.from("sessions").update(g).eq("user_id",x.id):v&&await M.from("sessions").upsert({...g,guest_id:v},{onConflict:"guest_id"})}catch(N){console.error("Session update error:",N)}},[]),m=t.useCallback(Lr(()=>{r.current=new Date,c(!0)},5e3),[c]);return t.useEffect(()=>{const f=["mousemove","keydown","scroll","touchstart","click"];return f.forEach(x=>window.addEventListener(x,m)),()=>f.forEach(x=>window.removeEventListener(x,m))},[m]),t.useEffect(()=>{const f=setInterval(()=>{new Date().getTime()-r.current.getTime()>25e3&&c(!1)},25e3);return()=>clearInterval(f)},[c]),t.useEffect(()=>{const f=()=>{c(!1),localStorage.setItem("savedState",JSON.stringify(i))};return window.addEventListener("beforeunload",f),()=>{window.removeEventListener("beforeunload",f),c(!1)}},[c,i]),a?e.jsxs(Bs,{client:Ir,children:[e.jsx(Dr,{}),e.jsx(ts.AliveScope,{children:e.jsx("div",{"data-router":!0,children:e.jsx(Os,{router:Mr})})}),e.jsx(yt,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]}):null}class Ar extends te.Component{constructor(s){super(s),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(s,r){fr(s,"ErrorBoundary",{componentStack:r.componentStack,location:typeof window<"u"?window.location.pathname:"server"})}render(){return this.state.hasError?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Упс! Щось пішло не так"}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",onClick:()=>typeof window<"u"&&window.location.reload(),children:"Спробувати знову"})]}):this.props.children}}Us(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"loading-overlay"}),children:e.jsx(Ar,{children:e.jsx(Tr,{})})})}));export{xe as B,Le as a,zr as b,M as s,Ke as u};
//# sourceMappingURL=index-DL2gia46.js.map
