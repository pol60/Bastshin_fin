{"version":3,"mappings":"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","names":["supabaseUrl","supabaseAnonKey","supabase","createClient","input","init","cn","inputs","twMerge","clsx","Input","React.forwardRef","className","type","props","ref","jsx","useCartStore","createWithEqualityFn","persist","set","get","productId","quantity","state","item","acc","createJSONStorage","shallow","useFavoritesStore","id","user","data","error","favoritesIds","logoCache","CACHE_TTL","LogoNavBar","memo","align","logoUrl","setLogoUrl","useState","isLoading","setIsLoading","alignmentClass","useEffect","bucket","fileName","useIsMobile","isMobile","setIsMobile","handleResize","useTouchHandlers","onSwipe","isTouching","setIsTouching","touchTimer","useRef","touchStart","setTouchStart","touchEnd","setTouchEnd","minSwipeDistance","handleTouchStart","e","handleTouchEnd","distance","direction","handleTouchCancel","handleTouchMove","SearchDropdown","onClose","externalFilter","onSearchChange","products","setProducts","setError","isLoaded","setIsLoaded","containerRef","handleClickOutside","event","popularSizes","useMemo","sizesMap","product","size","a","b","entry","popularBrands","brandsMap","filteredSizes","filteredBrands","brand","hasNoResults","slideVariants","baseClasses","jsxs","motion","RiCloseLine","AnimatePresence","RiErrorWarningLine","Fragment","index","Link","TireCatalogDropdown","open","setOpen","buttonRef","dropdownRef","handleMouseEnter","handleMouseLeave","related","modalVariants","seasonOptions","SunIcon","SnowflakeIcon","SnowSunIcon","sizeOptions","diameterOptions","autoTypeOptions","tireBrandOptions","renderSeasonOptions","option","renderAutoTypes","renderSizes","renderDiameters","diameter","renderBrands","dropdownClassNames","modalContent","X","prev","ChevronDown","createPortal","IconButton","icon","label","onClick","href","buttonContent","MobileMenu","isOpen","onProfileClick","onFavoritesClick","onCartClick","favoritesCount","cartCount","isAuthenticated","scrollPositionRef","isSearchDropdownOpen","setIsSearchDropdownOpen","searchQuery","setSearchQuery","showPersonalOffersStub","setShowPersonalOffersStub","location","useLocation","prevLocation","useLayoutEffect","overlayVariants","menuVariants","_event","info","RiPhoneFill","RiUserFill","RiCheckFill","RiUserLine","RiHeartFill","RiSearchLine","RiShoppingCartFill","NavIcons","variant","isScrolled","favoritesControl","cartControl","onSearchClick","Cart","isClosing","items","removeItem","updateQuantity","initialEmpty","preservedItems","setPreservedItems","loading","setLoading","formatSeason","season","formatPrice","value","relevantItems","productsMap","displayedItems","calculateTotal","total","price","handleRemoveItem","isLastItem","renderCartContent","cartItems","imageUrl","countryCode","ReactCountryFlag","Trash2","useMediaQuery","query","matches","setMatches","media","listener","SlidingCart","visualState","setVisualState","handleCloseCart","handleBackgroundClick","handleCartClick","FavoritesLike","favorites","toggleFavorite","addItem","favoriteProducts","setFavoriteProducts","fetchFavoriteProducts","useCallback","timer","isInCart","_a","ShoppingCart","XCircle","_b","React","SlidingFavorites","MemoizedLogo","NavBar","isMenuOpen","setIsMenuOpen","setIsScrolled","saved","showHeader","setShowHeader","_lastScrollY","setLastScrollY","setUser","isSlidingFavoritesOpen","setIsSlidingFavoritesOpen","isSlidingCartOpen","setIsSlidingCartOpen","next","navigate","useNavigate","searchContainerRef","useAnimation","prevFavoritesRef","prevCartRef","handleScrollShadow","scrolled","handleScroll","prevScrollY","currentScrollY","yMotion","useMotionValue","metaThemeColor","hexToRgb","hex","c","intVal","currentColorHex","currentColor","targetColor","duration","startTime","animate","now","elapsed","ratio","r","g","newColor","handleProfileClick","handleFavoritesClick","handleSearch","renderMobileHeaderContent","RiMenu3Line","FiPhone","buttonVariants","cva","Button","forwardRef","style","throttle","func","limit","inThrottle","args","highlightText","text","searchTerm","regex","part","Select","multiple","onValueChange","placeholder","children","disabled","displayValue","rest","setIsOpen","React.useState","dropdownDirection","setDropdownDirection","setSearchTerm","React.useRef","inputRef","handleSelect","newValue","currentValue","newValues","v","React.useEffect","recalcDropdownDirection","React.useCallback","rect","spaceBelow","displayText","filteredChildren","React.Children","child","React.isValidElement","displayedChildren","renderedChildren","childValue","isSelected","newChildren","React.cloneElement","SelectItem","onSelect","React.memo","generateUniqueFileName","file","extension","uuidv4","uploadFile","folder","getPublicUrl","path","filterLabels","seasonMapping","fetchDynamicFilters","widths","val","profiles","diameters","seasons","brands","HeroSection","shouldAnimate","heroRef","quickFilters","setQuickFilters","dynamicOptions","refetch","useQuery","visibleOptions","setVisibleOptions","handleFilterSelect","filterType","values","handleQuickSearch","params","key","handleDetailedSearch","isDesktop","setIsDesktop","url","img","backgroundStyle","filters","filter","extraClasses","TooltipIcon","tooltip","visible","setVisible","tooltipRef","offsetX","setOffsetX","tooltipIdRef","_e","handleClick","handleTooltipOpen","tooltipRect","newOffset","padding","sizeClasses","optimizeImage","width","ProductCard","model","oldPrice","discount","image","dataImages","specs","year","country","articleNumber","productType","commentCount","initialRating","imageHeight","iconSize","heartSize","previewImage","showAvailability","discountIconClass","heartClass","queryClient","useQueryClient","preloadImages","urls","fetchProductDetails","prefetchProduct","prefetchProductDetails","__vitePreload","imagesToLoad","rating","setRating","currentImageIndex","setCurrentImageIndex","isHovered","setIsHovered","discountHovered","setDiscountHovered","errorLoading","setErrorLoading","mounted","setMounted","imageContainerRef","intervalRef","touchInfoRef","interactionTimeoutRef","LONG_PRESS_DURATION","MOVE_THRESHOLD","observer","currentRef","preloadImage","resolve","reject","handleImageContainerMouseEnter","handleImageContainerMouseLeave","clientX","clientY","deltaX","deltaY","updateRating","debounce","newRating","_error","isClicked","setIsClicked","handleInteraction","handler","isFavorited","handleFavoriteToggle","handleBuy","handleComments","formatSize","ratingStars","Heart","DiscountIcon","Stock","_","i","Star","MessageCircle","CustomCarIcon","GasPumpIcon","CloudRainIcon","VolumIcon","ArticleWindow","isFullPage","articles","article","publicUrl","ArticleCarousel","currentSlide","setCurrentSlide","scrollLeft","slideWidth","defaultHomeState","HomeStateContext","createContext","LazySaleProductsSection","lazy","LazyNewArrivalsSection","LazyTopRatedSection","LazyFooterSection","prefetchComponent","importFunc","HomeContent","currentTopIndex","setCurrentTopIndex","dragOffset","setDragOffset","isDragging","setIsDragging","touchStartX","touchStartY","isHorizontalSwipe","currentX","currentY","handleGlobalTouchMove","p","getProductSpecs","renderProductCard","isLazy","customProps","saleProducts","newArrivals","sp","topRated","handleSlideChange","totalItems","totalSlides","handleTopRatedPrev","handleTopRatedNext","lastProductCallbackRef","handleNavClick","targetId","targetElement","offset","Suspense","Home","homeState","setHomeState","useContext","setShouldAnimate","Pagination","currentPage","totalPages","onPageChange","scrollToTop","getVisiblePages","visiblePages","start","end","handlePageChange","page","handlePrevious","handleNext","arr","ProductList","pathname","searchParams","setSearchParams","useSearchParams","setCurrentPage","itemsPerPage","displayedProducts","startIndex","distinctOptions","setDistinctOptions","currentFilters","handleFilterChange","name","checked","newParams","handleMultiSelectChange","resetFilters","fetchProducts","signal","processedFilters","tireSizePattern","match","profile","numValue","err","controller","productList","hasDiscount","discountPercent","Filter","FilterPanel","LoadingSpinner","EmptyState","onChange","onMultiSelectChange","FilterCheckbox","FilterSelectMultiple","FilterNumberInput","options","vals","optionString","onReset","CommentsPage","useParams","reviews","setReviews","newComment","setNewComment","loadingAuth","setLoadingAuth","handleSubmit","num","review","Auth","isLogin","setIsLogin","email","setEmail","password","setPassword","setName","phone","setPhone","redirectTo","toast","signInError","signUpError","profileError","handleGoogleLogin","handleLogout","ToastContainer","User","Phone","Mail","Lock","Profile","orders","setOrders","editing","setEditing","profileCreationAttempted","setProfileCreationAttempted","formData","setFormData","initialLogin","fetchUserData","fetchOrders","authUser","insertError","insertedData","handleUpdateProfile","LogOut","UserIcon","Package","order","NOVA_BASE_URL","NOVA_API_KEY","cache","CACHE_EXPIRY","makeRequest","modelName","calledMethod","methodProperties","skipCache","cacheKey","cachedData","response","axios","errorMessage","getCities","allCities","morePages","cities","getWarehouses","Checkout","clearCart","setCities","isCitiesLoading","setIsCitiesLoading","isWarehousesLoading","setIsWarehousesLoading","warehouses","setWarehouses","selectedCity","setSelectedCity","loadCities","citiesData","city","loadWarehousesBySearch","inputValue","wh","loadWarehousesDefault","cityRef","defaultWarehouses","handleCityChange","selected","handleWarehouseChange","handleDeliveryChange","isFormValid","userId","orderError","orderItems","itemsError","Truck","base","AsyncSelect","CreditCard","ArticleDetailPage","setArticle","imagePath","AuthCallback","code","authError","guestId","migrateError","message","Toast","exiting","setExiting","exitType","setExitType","timerRef","styleElement","useImperativeHandle","handleAnimationEnd","animationStyle","toastStyle","DetailedSearch","setBrands","models","setModels","setWidths","setDiameters","setProfiles","setSeasons","noiseLevels","setNoiseLevels","countries","setCountries","years","setYears","wetGrips","setWetGrips","fuelEfficiencies","setFuelEfficiencies","loadIndexes","setLoadIndexes","speedIndexes","setSpeedIndexes","minPrice","setMinPrice","maxPrice","setMaxPrice","minDbPrice","setMinDbPrice","maxDbPrice","setMaxDbPrice","sliderValue","setSliderValue","sale","setSale","selectedBrands","setSelectedBrands","selectedModels","setSelectedModels","selectedWidths","setSelectedWidths","selectedDiameters","setSelectedDiameters","selectedProfiles","setSelectedProfiles","selectedSeasons","setSelectedSeasons","selectedNoiseLevels","setSelectedNoiseLevels","selectedCountries","setSelectedCountries","selectedYears","setSelectedYears","selectedWetGrips","setSelectedWetGrips","selectedFuelEfficiencies","setSelectedFuelEfficiencies","selectedLoadIndexes","setSelectedLoadIndexes","selectedSpeedIndexes","setSelectedSpeedIndexes","spikes","setSpikes","showAdvanced","setShowAdvanced","toastMessage","setToastMessage","showToast","setShowToast","showToastMessage","handleToastClose","brandsParam","modelsParam","widthsParam","diametersParam","profilesParam","seasonsParam","noiseLevelParam","countryParam","yearParam","wetGripParam","fuelEfficiencyParam","loadIndexParam","speedIndexParam","spikesParam","saleParam","minPriceParam","maxPriceParam","uniqueData","prices","dbMinPrice","dbMaxPrice","handlePriceChange","handleSliderChange","validatePrice","effectiveMax","effectiveMinPrice","effectiveMaxPrice","handleReset","noise","wg","fe","li","si","MiniButton","showMiniFilter","setShowMiniFilter","setIcon","shouldReduceMotion","useReducedMotion","shouldShow","interval","animationConfig","ChevronUp","BC","navHistory","setNavHistory","itemTitle","setItemTitle","lastBreadcrumbRef","scrollContainerRef","isDown","startX","scrollLeftRef","getTitle","translations","segment","existingIndex","title","handleBreadcrumbClick","container","startScroll","targetScroll","timestamp","progress","easeOutProgress","handleMouseDown","handleMouseUp","handleMouseMove","walk","isLast","Modal","AdminLayout","isSidebarOpen","setIsSidebarOpen","isLogoutModalOpen","setIsLogoutModalOpen","isLoggingOut","setIsLoggingOut","sessions","setSessions","isLoadingSessions","setIsLoadingSessions","sessionsError","setSessionsError","sidebarRef","navItems","LayoutDashboard","ShoppingBag","Users","BarChart","Settings","FileText","refreshSessions","generateGuestId","updateSessionToGuest","storedSessionId","updatedSession","newSession","createSession","userData","userError","migratedId","isMounted","fetchData","sessionStats","s","sidebarVariants","renderNavLink","to","NavLink","isActive","Menu","Outlet","Clock","time","setTime","AdminLogin","weather","setWeather","weatherLoading","setWeatherLoading","showErrorToast","requestLocation","position","getWeather","latitude","longitude","useAdmin","setState","logEvent","details","checkAdmin","authListener","trackEvent","eventName","eventData","logError","context","additionalData","Dashboard","isAdmin","adminLoading","stats","setStats","activeSessions","setActiveSessions","dataLoading","setDataLoading","registeredUsers","guests","fetchDashboardStats","realtimeCleanup","setupRealtimeSessions","updateSessionsList","msg","channel","since","session","SessionItem","_c","Filters","onFilterChange","onSortChange","setType","handleApplyFilters","handleSortChange","handleMinPriceChange","numericValue","handleMaxPriceChange","efficiencyGrades","EditProductModal","onSave","isSubmitting","setIsSubmitting","images","setImages","newImages","setNewImages","changedFields","setChangedFields","fileInputRef","handleChange","handleCheckboxChange","validateForm","field","handleImageSelect","files","handleImageRemove","isNewImage","uploadImage","fileExt","filePath","uploadError","updatedImageUrls","uploadPromises","uploadedUrls","rawPayload","grade","seasonLabels","Products","setPage","setFilters","sort","setSort","isDeleteModalOpen","setIsDeleteModalOpen","productToDelete","setProductToDelete","editProduct","setEditProduct","totalCount","setTotalCount","stableRefetch","count","deleteMutation","useMutation","updatedProduct","MAX_FILE_SIZE","ALLOWED_FILE_TYPES","ImageUploader","onUpload","onUploading","setProgress","uploadedCount","setUploadedCount","selectedFiles","setSelectedFiles","isUploading","setIsUploading","handleFileUpload","successCount","ProductCreatePage","isImageUploading","setIsImageUploading","allBrands","setAllBrands","allModels","setAllModels","suggestions","setSuggestions","fetchExistingData","brandsData","modelsData","uniqueBrands","uniqueModels","handleBrandInput","filtered","handleModelInput","handleBigIntChange","handleImageUpload","handleRemoveImage","formDataToSubmit","productData","productError","bigIntToString","NewArticle","setTitle","content","setContent","imageFile","setImageFile","setArticles","fetchArticles","handleArticleClick","handleMoveToTop","handleDelete","SessionsPage","useOutletContext","sortConfig","setSortConfig","sortedSessions","aDate","bDate","aValue","bValue","adminData","adminError","deleteSession","sessionId","deleteInactiveSessions","getSessionDuration","diff","hours","minutes","handleSort","UserX","RefreshCw","ArrowDownAZ","ArrowUpZA","AdminRoute","Navigate","LazyProductDetail","QueryClient","delay","timeoutId","PublicLayout","publicPaths","ScrollRestoration","HomeWrapper","router","createBrowserRouter","KeepAlive","AutoReload","reloadPage","resetTimer","events","App","lastActivityRef","appState","setAppState","savedState","parsedState","handleLoad","initGuestSession","storedGuestId","updateSessionStatus","isOnline","currentGuestId","updateData","handleActivity","handleBeforeUnload","QueryClientProvider","AliveScope","RouterProvider","ErrorBoundary","errorInfo","createRoot","StrictMode"],"ignoreList":[],"sources":["../../src/lib/supabaseClient.ts","../../src/lib/utils.ts","../../src/components/ui/input.tsx","../../src/stores/cartStore.ts","../../src/stores/favoritesStore.ts","../../src/pagesHome/HomeSections/NavBar/LogoNavBar.tsx","../../src/hooks/useIsMobile.ts","../../src/pagesHome/HomeSections/NavBar/SearchDropdown.tsx","../../src/pagesHome/HomeSections/NavBar/TireCatalogDropdown.tsx","../../src/pagesHome/HomeSections/NavBar/MobileMenu.tsx","../../src/pagesHome/HomeSections/NavBar/NavIcons.tsx","../../src/pagesHome/HomeSections/NavBar/Cart.tsx","../../src/pagesHome/HomeSections/NavBar/SlidingCart.tsx","../../src/pagesHome/HomeSections/NavBar/favoritesLike.tsx","../../src/pagesHome/HomeSections/NavBar/SlidingFavorites.tsx","../../src/pagesHome/HomeSections/NavBar/NavBar.tsx","../../src/components/ui/button.constants.ts","../../src/components/ui/button.tsx","../../src/components/ui/select.tsx","../../src/lib/storage.ts","../../src/pagesHome/HeroSection.tsx","../../src/pagesHome/ProductCard.tsx","../../src/FAKT_Info/ArticleWindow.tsx","../../src/pagesHome/Home.tsx","../../src/components/ui/adminProducts/Pagination.tsx","../../src/pages/ProductList.tsx","../../src/pages/CommentsPage.tsx","../../src/pages/Auth.tsx","../../src/pages/Profile.tsx","../../src/lib/nova.ts","../../src/pages/Checkout.tsx","../../src/FAKT_Info/ArticleDetailPage.tsx","../../src/pages/auth/AuthCallback.tsx","../../src/components/ui/Toast.tsx","../../src/pages/DetailedSearch.tsx","../../src/components/ui/MiniButton.tsx","../../src/BC.tsx","../../src/pages/admin/AdminLayout.tsx","../../src/pages/admin/AdminLogin.tsx","../../src/hooks/useAdmin.ts","../../src/lib/analytics.ts","../../src/pages/admin/Dashboard.tsx","../../src/components/ui/adminProducts/Filters.tsx","../../src/components/ui/adminProducts/EditProductModal.tsx","../../src/pages/admin/Products.tsx","../../src/components/ImageUploader.tsx","../../src/pages/admin/ProductCreatePage.tsx","../../src/pages/admin/NewArticle.tsx","../../src/pages/admin/SessionsPage.tsx","../../src/middleware/AdminRoute.tsx","../../src/App.tsx","../../src/ErrorBoundary.tsx","../../src/main.tsx"],"sourcesContent":["// src/lib/supabaseClient.ts\nimport { createClient, SupabaseClient } from '@supabase/supabase-js';\nimport type { Database } from '../types/database.types';\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.error('❌ Supabase: отсутствует VITE_SUPABASE_URL или VITE_SUPABASE_ANON_KEY');\n  throw new Error('Supabase URL или ANON_KEY не заданы в окружении');\n}\n\nexport const supabase: SupabaseClient<Database> = createClient<Database>(\n  supabaseUrl,\n  supabaseAnonKey,\n  {\n    auth: {\n      persistSession: true,\n      autoRefreshToken: true,\n    },\n    global: {\n      fetch: (input, init) =>\n        fetch(input, {\n          ...init,\n          cache: 'default',\n        }),\n    },\n  }\n);\n","import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}","import * as React from \"react\"\nimport { cn } from \"../../lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {\n  type?: string;\n}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type = \"text\", ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px- py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }","import { createWithEqualityFn } from 'zustand/traditional';\nimport { persist, createJSONStorage } from 'zustand/middleware';\nimport { shallow } from 'zustand/shallow';\nimport { OrderItem } from '../types/database.types';\n\ninterface CartStore {\n  items: OrderItem[];\n  addItem: (productId: string, quantity?: number) => void;\n  removeItem: (productId: string) => void;\n  updateQuantity: (productId: string, quantity: number) => void;\n  clearCart: () => void;\n  total: () => number;\n}\n\nexport const useCartStore = createWithEqualityFn<CartStore>()(\n  persist(\n    (set, get) => ({\n      items: [],\n      addItem: (productId: string, quantity = 1) =>\n        set((state) => {\n          const existingItem = state.items.find(\n            (item) => item.product_id === productId\n          );\n\n          if (existingItem) {\n            return {\n              items: state.items.map((item) =>\n                item.product_id === productId\n                  ? { ...item, quantity: item.quantity + quantity }\n                  : item\n              ),\n            };\n          }\n\n          return {\n            items: [\n              ...state.items,\n              {\n                id: crypto.randomUUID(),\n                order_id: '', // Will be set when order is created\n                product_id: productId,\n                quantity,\n                price: 0, // Should be populated from product data\n                created_at: new Date().toISOString(),\n              },\n            ],\n          };\n        }),\n      removeItem: (productId: string) =>\n        set((state) => ({\n          items: state.items.filter((item) => item.product_id !== productId),\n        })),\n      updateQuantity: (productId: string, quantity: number) =>\n        set((state) => ({\n          items: state.items.map((item) =>\n            item.product_id === productId ? { ...item, quantity } : item\n          ),\n        })),\n      clearCart: () => set({ items: [] }),\n      total: () =>\n        get().items.reduce(\n          (acc, item) => acc + item.price * item.quantity,\n          0\n        ),\n    }),\n    {\n      name: 'cart-store',\n      storage: createJSONStorage(() => localStorage),\n    }\n  ),\n  shallow\n);\n\n\n","import { createWithEqualityFn } from 'zustand/traditional';\nimport { persist, createJSONStorage } from 'zustand/middleware';\nimport { shallow } from 'zustand/shallow';\nimport { supabase } from '../lib/supabaseClient';\n\ninterface FavoriteData {\n  product_id: string;\n}\n\ninterface FavoritesStore {\n  favorites: string[];\n  toggleFavorite: (productId: string) => void;\n  loadFavorites: () => Promise<void>;\n}\n\nexport const useFavoritesStore = createWithEqualityFn<FavoritesStore>()(\n  persist(\n    (set) => ({\n      favorites: [],\n      toggleFavorite: async (productId: string) => {\n        // Immediate local state update\n        set((state) => {\n          const isFav = state.favorites.includes(productId);\n          return {\n            favorites: isFav\n              ? state.favorites.filter((id) => id !== productId)\n              : [...state.favorites, productId],\n          };\n        });\n\n        // Sync with server for authenticated users\n        const { data: { user } } = await supabase.auth.getUser();\n        if (user) {\n          const { data } = await supabase\n            .from('favorites')\n            .select('*')\n            .eq('user_id', user.id)\n            .eq('product_id', productId)\n            .single();\n\n          if (data) {\n            await supabase\n              .from('favorites')\n              .delete()\n              .eq('user_id', user.id)\n              .eq('product_id', productId);\n          } else {\n            await supabase\n              .from('favorites')\n              .insert([{ user_id: user.id, product_id: productId }]);\n          }\n        }\n      },\n      loadFavorites: async () => {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (user) {\n          const { data, error } = await supabase\n            .from('favorites')\n            .select('product_id')\n            .eq('user_id', user.id);\n\n          if (!error && data) {\n            const favoritesIds = (data as FavoriteData[]).map(\n              (item) => item.product_id\n            );\n            set({ favorites: favoritesIds });\n          }\n        }\n      },\n    }),\n    {\n      name: 'favorites-store',\n      storage: createJSONStorage(() => localStorage),\n    }\n  ),\n  shallow\n);","import { FC, memo, useEffect, useState } from \"react\";\nimport { supabase } from \"../../../lib/supabaseClient\";\n\ninterface LogoProps {\n  className?: string;\n  align?: \"left\" | \"center\" | \"right\";\n}\n\n// Глобальный кэш для URL логотипа\nlet logoCache: { url: string; timestamp: number } | null = null;\nconst CACHE_TTL = 3600000; // 1 час\n\nconst LogoNavBar: FC<LogoProps> = memo(({ className = \"w-28\", align = \"left\" }) => {\n  const [logoUrl, setLogoUrl] = useState(logoCache?.url || \"\");\n  const [isLoading, setIsLoading] = useState(!logoCache);\n  \n  const alignmentClass = \n    align === 'left' ? 'ml-0' : \n    align === 'right' ? 'mr-0' : 'mx-auto';\n\n  useEffect(() => {\n    const fetchLogo = async () => {\n      try {\n        // Используем кэш если он валиден\n        if (logoCache && Date.now() - logoCache.timestamp < CACHE_TTL) {\n          setLogoUrl(logoCache.url);\n          setIsLoading(false);\n          return;\n        }\n\n        const bucket = import.meta.env.VITE_SUPABASE_BUCKET || \"Logo\";\n        const fileName = import.meta.env.VITE_SUPABASE_LOGO_FILENAME || \"logo.png\";\n        \n        // Метод getPublicUrl возвращает только data\n        const { data } = supabase.storage\n          .from(bucket)\n          .getPublicUrl(fileName);\n\n        if (!data.publicUrl) {\n          throw new Error(\"Logo load error: publicUrl is undefined\");\n        }\n\n        // Обновляем кэш\n        logoCache = { \n          url: data.publicUrl, \n          timestamp: Date.now() \n        };\n        setLogoUrl(data.publicUrl);\n      } catch (error) {\n        console.error('Logo load error:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    if (!logoUrl) fetchLogo();\n  }, [logoUrl]);\n\n  if (isLoading) {\n    return (\n      <div \n        className={`${className} ${alignmentClass} bg-gray-200 animate-pulse rounded-md`}\n        aria-label=\"Loading logo...\"\n      />\n    );\n  }\n\n  if (!logoUrl) {\n    return (\n      <div className={`${className} ${alignmentClass} bg-gray-200 flex items-center justify-center text-xs`}>\n        ShinaGo\n      </div>\n    );\n  }\n\n  return (\n    <img\n      src={logoUrl}\n      alt=\"ShinaGo\"\n      className={`${className} ${alignmentClass} h-auto object-contain`}\n      style={{\n        transform: 'translateZ(0)',\n        imageRendering: 'crisp-edges',\n        contentVisibility: 'auto',\n      }}\n      loading=\"eager\"\n      decoding=\"async\"\n    />\n  );\n});\n\nexport default LogoNavBar;\n","import { useState, useEffect, useRef } from 'react';\n\ninterface UseTouchHandlersProps {\n  onSwipe?: (direction: 'left' | 'right') => void;\n}\n\n// Хук теперь инициализирует начальное значение на основе window.innerWidth,\n// если window доступен. Это позволяет сразу правильно определить, нужно ли показывать мобильную версию.\nexport const useIsMobile = () => {\n  const [isMobile, setIsMobile] = useState(() => {\n    if (typeof window !== 'undefined') {\n      return window.innerWidth < 768;\n    }\n    return false;\n  });\n\n  useEffect(() => {\n    const handleResize = () => setIsMobile(window.innerWidth < 768);\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return isMobile;\n};\n\nexport const useTouchHandlers = ({ onSwipe }: UseTouchHandlersProps = {}) => {\n  const [isTouching, setIsTouching] = useState(false);\n  const touchTimer = useRef<NodeJS.Timeout | null>(null);\n  const [touchStart, setTouchStart] = useState(0);\n  const [touchEnd, setTouchEnd] = useState(0);\n  const minSwipeDistance = 50;\n\n  const handleTouchStart = (e: React.TouchEvent) => {\n    if (touchTimer.current) {\n      clearTimeout(touchTimer.current);\n    }\n\n    setTouchStart(e.targetTouches[0].clientX);\n    setTouchEnd(e.targetTouches[0].clientX);\n\n    touchTimer.current = setTimeout(() => {\n      setIsTouching(true);\n    }, 100);\n  };\n\n  const handleTouchEnd = () => {\n    if (touchTimer.current) {\n      clearTimeout(touchTimer.current);\n    }\n    setIsTouching(false);\n\n    const distance = touchStart - touchEnd;\n    if (Math.abs(distance) > minSwipeDistance) {\n      const direction = distance > 0 ? 'left' : 'right';\n      onSwipe?.(direction);\n    }\n  };\n\n  const handleTouchCancel = () => {\n    if (touchTimer.current) {\n      clearTimeout(touchTimer.current);\n    }\n    setIsTouching(false);\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    setTouchEnd(e.targetTouches[0].clientX);\n  };\n\n  useEffect(() => {\n    return () => {\n      if (touchTimer.current) {\n        clearTimeout(touchTimer.current);\n      }\n    };\n  }, []);\n\n  return {\n    isTouching,\n    handleTouchStart,\n    handleTouchEnd,\n    handleTouchCancel,\n    handleTouchMove,\n  };\n};\n","import React, { useState, useEffect, useMemo, memo, useRef } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { RiCloseLine, RiErrorWarningLine } from \"react-icons/ri\";\nimport { supabase } from \"../../../lib/supabaseClient\";\nimport { useIsMobile } from \"../../../hooks/useIsMobile\";\n\ninterface Product {\n  id: string;\n  brand: string;\n  rating: number;\n  width?: number;\n  profile?: number | string;\n  diameter?: number;\n}\n\ninterface SearchDropdownProps {\n  onClose: () => void;\n  externalFilter?: string;\n  onSearchChange?: (value: string) => void;\n}\n\nconst SearchDropdown: React.FC<SearchDropdownProps> = ({\n  onClose,\n  externalFilter = \"\",\n  onSearchChange,\n}) => {\n  const [products, setProducts] = useState<Product[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [isLoaded, setIsLoaded] = useState<boolean>(false);\n  const isMobile = useIsMobile();\n\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Обработчик клика вне окна: первое нажатие закрывает окно и предотвращает дальнейшие клики на элементы под ним\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        event.stopPropagation();\n        event.preventDefault();\n        onClose();\n      }\n    };\n\n    document.addEventListener(\"click\", handleClickOutside, { capture: true });\n    return () => {\n      document.removeEventListener(\"click\", handleClickOutside, { capture: true });\n    };\n  }, [onClose]);\n\n  useEffect(() => {\n    const fetchProducts = async () => {\n      const { data, error } = await supabase\n        .from(\"products\")\n        .select(\"id, brand, rating, width, profile, diameter\")\n        .gte(\"rating\", 20);\n\n      if (error) {\n        console.error(\"Supabase error:\", error);\n        setError(\"Ошибка загрузки данных\");\n      } else if (data) {\n        setProducts(data as Product[]);\n      }\n      setIsLoaded(true);\n    };\n    fetchProducts();\n  }, []);\n\n  const popularSizes = useMemo(() => {\n    const sizesMap = new Map<string, number>();\n    products.forEach((product) => {\n      if (product.width && product.profile && product.diameter) {\n        const size = `${product.width}/${product.profile} R${product.diameter}`;\n        sizesMap.set(size, (sizesMap.get(size) || 0) + 1);\n      }\n    });\n    return Array.from(sizesMap.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 8)\n      .map((entry) => entry[0]);\n  }, [products]);\n\n  const popularBrands = useMemo(() => {\n    const brandsMap = new Map<string, number>();\n    products.forEach((product) => {\n      if (product.brand) {\n        brandsMap.set(product.brand, (brandsMap.get(product.brand) || 0) + 1);\n      }\n    });\n    return Array.from(brandsMap.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 8)\n      .map((entry) => entry[0]);\n  }, [products]);\n\n  const filteredSizes = useMemo(() => {\n    if (!externalFilter.trim()) return popularSizes;\n    return popularSizes.filter((size) =>\n      size.toLowerCase().includes(externalFilter.toLowerCase())\n    );\n  }, [externalFilter, popularSizes]);\n\n  const filteredBrands = useMemo(() => {\n    if (!externalFilter.trim()) return popularBrands;\n    return popularBrands.filter((brand) =>\n      brand.toLowerCase().includes(externalFilter.toLowerCase())\n    );\n  }, [externalFilter, popularBrands]);\n\n  if (!isLoaded) return null;\n\n  const hasNoResults =\n    externalFilter.trim() !== \"\" &&\n    filteredSizes.length === 0 &&\n    filteredBrands.length === 0;\n\n  // Варианты анимации для мобильной и десктопной версий\n  const slideVariants = isMobile\n    ? {\n        initial: { y: \"-100%\", opacity: 0 },\n        animate: { y: 0, opacity: 1, transition: { duration: 0.5, ease: \"easeInOut\" } },\n        exit: { y: \"-100%\", opacity: 0, transition: { duration: 0.5, ease: \"easeInOut\" } },\n      }\n    : {\n        initial: { y: \"-10%\", opacity: 0 },\n        animate: { y: \"0%\", opacity: 1, transition: { duration: 0.3, ease: \"easeInOut\" } },\n        exit: { y: \"-10%\", opacity: 0, transition: { duration: 0.3, ease: \"easeInOut\" } },\n      };\n\n  const baseClasses = isMobile\n    ? \"fixed inset-x-0 top-16 z-50 bg-white shadow-lg p-4 overflow-hidden max-h-[80vh]\"\n    : \"absolute z-50 top-full left-0 w-full bg-white shadow-lg rounded-lg mt-1 p-4 max-h-[80vh] overflow-y-auto\";\n\n  return (\n    <motion.div\n      ref={containerRef}\n      className={baseClasses}\n      onClick={(e) => e.stopPropagation()}\n      variants={slideVariants}\n      initial=\"initial\"\n      animate=\"animate\"\n      exit=\"exit\"\n    >\n      <button\n        onClick={(e) => {\n          e.stopPropagation();\n          onClose();\n        }}\n        className=\"absolute top-2 right-2 text-gray-600 text-2xl p-2 hover:bg-gray-100 rounded-full transition-transform duration-150 active:scale-150\"\n        aria-label=\"Закрыть поиск\"\n      >\n        <RiCloseLine />\n      </button>\n\n      {isMobile && (\n        <div className=\"mb-4\" onTouchStart={(e) => e.stopPropagation()}>\n          <input\n            type=\"text\"\n            value={externalFilter}\n            onChange={(e) => onSearchChange?.(e.target.value)}\n            onPointerDown={(e) => e.stopPropagation()}\n            onMouseDown={(e) => e.stopPropagation()}\n            onTouchStart={(e) => e.stopPropagation()}\n            placeholder=\"Пошук...\"\n            className=\"w-full px-3 py-2 border border-gray-300 text-black rounded-lg focus:outline-none text-lg\"\n          />\n        </div>\n      )}\n\n      {/* Анимация для результатов поиска */}\n      <AnimatePresence>\n        {(externalFilter.trim() === \"\" ||\n          filteredSizes.length > 0 ||\n          filteredBrands.length > 0 ||\n          hasNoResults) && (\n          <motion.div\n            key=\"search-results\"\n            initial={{ opacity: 0, height: 0 }}\n            animate={{\n              opacity: 1,\n              height: \"auto\",\n              transition: { duration: 0.3, ease: \"easeInOut\" },\n            }}\n            exit={{\n              opacity: 0,\n              y: -10,\n              transition: { duration: 0.3, ease: \"easeInOut\" },\n            }}\n            style={{ overflow: \"hidden\" }}\n            onClick={(e) => e.stopPropagation()}\n            onPointerDown={(e) => e.stopPropagation()}\n            onTouchStart={(e) => e.stopPropagation()}\n          >\n            {error ? (\n              <div className=\"flex items-center text-red-500 gap-2 p-4\">\n                <RiErrorWarningLine className=\"text-2xl\" />\n                <p>{error}</p>\n              </div>\n            ) : products.length === 0 ? (\n              <p className=\"text-center p-4 text-gray-500\">Нет данных</p>\n            ) : hasNoResults ? (\n              <motion.div\n                initial={{ opacity: 0, y: -10 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"flex flex-col items-center justify-center p-4 bg-yellow-50 rounded-lg\"\n              >\n                <RiErrorWarningLine className=\"text-yellow-600 text-3xl mb-2\" />\n                <p className=\"text-yellow-800 text-center\">\n                  За вашим запитом{\" \"}\n                  <span className=\"font-semibold\">\"{externalFilter}\"</span> нічого не знайдено\n                </p>\n                <p className=\"text-yellow-700 text-sm mt-1 text-center\">\n                  Спробуйте інші ключові слова або перевірте правильність введення\n                </p>\n              </motion.div>\n            ) : (\n              <>\n                <div className=\"mt-6\">\n                  {externalFilter.trim() === \"\" && (\n                    <h2 className=\"text-xl text-black md:text-lg font-bold mb-2\">\n                      Популярні типорозміри\n                    </h2>\n                  )}\n                  <div className=\"grid grid-cols-4 gap-2\">\n                    {filteredSizes.map((size, index) => (\n                      <Link\n                        to={`/search?size=${encodeURIComponent(size)}`}\n                        key={index}\n                        className=\"text-xs font-medium p-2 text-black bg-gray-100 hover:bg-gray-200 rounded transition-colors\"\n                        onClick={onClose}\n                      >\n                        {size}\n                      </Link>\n                    ))}\n                  </div>\n                </div>\n                <div className=\"mt-6\">\n                  {externalFilter.trim() === \"\" && (\n                    <h2 className=\"text-xl text-black md:text-lg font-bold mb-2\">\n                      Популярні бренди\n                    </h2>\n                  )}\n                  <div className=\"grid grid-cols-4 gap-2\">\n                    {filteredBrands.map((brand, index) => (\n                      <Link\n                        to={`/search?brand=${encodeURIComponent(brand)}`}\n                        key={index}\n                        className=\"text-xs font-medium p-2 text-black bg-gray-100 hover:bg-gray-200 rounded transition-colors\"\n                        onClick={onClose}\n                      >\n                        {brand}\n                      </Link>\n                    ))}\n                  </div>\n                </div>\n              </>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n};\n\nexport default memo(SearchDropdown);\n","import React, { useState, useRef } from 'react';\nimport { Link } from 'react-router-dom';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, X } from 'lucide-react';\nimport { createPortal } from 'react-dom';\nimport { useIsMobile } from '../../../hooks/useIsMobile';\nimport SnowflakeIcon from '../../../components/icons/SnowflakeIcon';\nimport SunIcon from '../../../components/icons/SunIcon';\nimport SnowSunIcon from '../../../components/icons/SnowSunIcon';\n\nconst TireCatalogDropdown: React.FC = () => {\n  const [open, setOpen] = useState(false);\n  const buttonRef = useRef<HTMLButtonElement>(null);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n  const isMobile = useIsMobile();\n\n  // Для десктопа: обработка событий мыши для кнопки и выпадающего окна.\n  const handleMouseEnter = () => {\n    if (!isMobile) {\n      setOpen(true);\n    }\n  };\n\n  const handleMouseLeave = (e: React.MouseEvent) => {\n    if (!isMobile) {\n      const related = e.relatedTarget as Node;\n      if (\n        buttonRef.current &&\n        dropdownRef.current &&\n        !buttonRef.current.contains(related) &&\n        !dropdownRef.current.contains(related)\n      ) {\n        setOpen(false);\n      }\n    }\n  };\n\n  const modalVariants = {\n    hidden: { opacity: 0, y: -10 },\n    visible: { opacity: 1, y: 0, transition: { duration: 0.3, ease: 'easeInOut' } },\n    exit: { opacity: 0, y: -10, transition: { duration: 0.3, ease: 'easeInOut' } },\n  };\n\n  // Опции для меню\n  const seasonOptions = [\n    { label: 'Літні', to: '/tires?season=summer', icon: <SunIcon className=\"w-4 h-4\" /> },\n    { label: 'Зимові', to: '/tires?season=winter', icon: <SnowflakeIcon className=\"w-4 h-4\" /> },\n    { label: 'Всесезонні', to: '/tires?season=all-season', icon: <SnowSunIcon className=\"w-4 h-4\" /> },\n  ];\n\n  const sizeOptions = [\n    '225/65 R17',\n    '225/60 R17',\n    '205/60 R16',\n    '205/55 R16',\n    '195/65 R15',\n    '215/60 R16',\n    '185/65 R15',\n    '215/65 R16',\n    '235/60 R18',\n    '215/55 R17'\n  ];\n\n  const diameterOptions = [\n    'R13', 'R14', 'R14C', 'R15', 'R15C',\n    'R16', 'R16C', 'R17', 'R17.5', 'R18',\n    'R19', 'R19.5', 'R20', 'R21', 'R22', 'R23', 'R24'\n  ];\n\n  const autoTypeOptions = [\n    { label: 'Легкові', to: '/tires?autoType=passenger' },\n    { label: 'Вантажні', to: '/tires?autoType=heavy' },\n    { label: 'Легковантажні', to: '/tires?autoType=light-truck' },\n    { label: 'Позашляхові', to: '/tires?autoType=offroad' },\n  ];\n\n  const tireBrandOptions = [\n    'Michelin', 'Continental', 'Goodyear', 'Debica', 'Kapsen',\n    'Gislaved', 'Triangle', 'Premiorri', 'Funtoma', 'Arivo',\n    'Kelly', 'Rosava', 'Dunlop', 'Nexen', 'Bridgestone',\n    'Nokian', 'Uniroyal', 'Tigar', 'Matador', 'Hankook'\n  ];\n\n  const renderSeasonOptions = () => (\n    <div>\n      <h3 className=\"font-medium mb-4 text-sm text-left\">За сезоном</h3>\n      <div className=\"inline-grid p-2 gap-2\">\n        {seasonOptions.map((option) => (\n          <Link\n            key={option.to}\n            to={option.to}\n            onClick={() => setOpen(false)}\n            className=\"flex items-center gap-2 text-sm transition-colors rounded hover:bg-blue-500 hover:text-white px-2\"\n          >\n            {option.icon}\n            <span>{option.label}</span>\n          </Link>\n        ))}\n      </div>\n    </div>\n  );\n\n  const renderAutoTypes = () => (\n    <div>\n      <h3 className=\"font-medium mb-4 text-sm text-left\">За типом авто</h3>\n      <div className=\"inline-grid p-2 gap-2\">\n        {autoTypeOptions.map((option) => (\n          <Link\n            key={option.to}\n            to={option.to}\n            onClick={() => setOpen(false)}\n            className=\"text-sm transition-colors rounded hover:bg-blue-500 hover:text-white px-2\"\n          >\n            {option.label}\n          </Link>\n        ))}\n      </div>\n    </div>\n  );\n\n  const renderSizes = () => (\n    <div>\n      <h3 className=\"font-medium mb-4 text-sm text-left\">Типорозміри</h3>\n      <div className=\"inline-grid grid-cols-3 gap-x-2 gap-y-2 justify-items-center\">\n        {sizeOptions.map((size) => (\n          <Link\n            key={size}\n            to={`/tires?tireSize=${size}`}\n            onClick={() => setOpen(false)}\n            className=\"whitespace-nowrap px-1 py-1 border border-gray-300 rounded text-center text-xs transition-colors hover:bg-blue-500 hover:text-white hover:font-medium\"\n          >\n            {size}\n          </Link>\n        ))}\n      </div>\n    </div>\n  );\n\n  const renderDiameters = () => (\n    <div>\n      <h3 className=\"font-medium mb-4 text-sm text-left\">Діаметри</h3>\n      <div className=\"inline-grid grid-cols-5 gap-x-2 gap-y-2 justify-items-center\">\n        {diameterOptions.map((diameter) => (\n          <Link\n            key={diameter}\n            to={`/tires?diameter=${diameter.replace('R', '')}`}\n            onClick={() => setOpen(false)}\n            className=\"w-full h-full flex justify-center items-center px-1 py-1 border border-gray-300 rounded text-center text-xs transition-colors hover:bg-blue-500 hover:text-white hover:font-medium\"\n          >\n            {diameter}\n          </Link>\n        ))}\n      </div>\n    </div>\n  );\n\n  const renderBrands = () => (\n    <div>\n      <h3 className=\"font-medium mb-4 text-sm text-left\">За брендом</h3>\n      <div className=\"inline-grid grid-cols-2 gap-2\">\n        {tireBrandOptions.map((brand) => (\n          <Link\n            key={brand}\n            to={`/tires?brand=${brand}`}\n            onClick={() => setOpen(false)}\n            className=\"text-sm transition-colors rounded hover:bg-blue-500 hover:text-white md:px-3\"\n          >\n            {brand}\n          </Link>\n        ))}\n      </div>\n    </div>\n  );\n\n  // В десктопе окно фиксированное вплотную к нижней границе NavBar (64px)\n  const dropdownClassNames = isMobile\n    ? \"absolute top-full left-0 right-0 mt-2 z-50\"\n    : \"fixed left-0 right-0 top-16 z-50\";\n\n  const modalContent = (\n    <AnimatePresence>\n      {open && (\n        <motion.div\n          ref={dropdownRef}\n          variants={modalVariants}\n          initial=\"hidden\"\n          animate=\"visible\"\n          exit=\"exit\"\n          className={dropdownClassNames}\n          onMouseEnter={handleMouseEnter}\n          onMouseLeave={handleMouseLeave}\n        >\n          <div className=\"bg-white text-black mx-auto w-full max-w-6xl rounded-lg shadow-xl\">\n            <div className=\"flex justify-end p-2 border-b\">\n              <button\n                onClick={() => setOpen(false)}\n                className=\"text-black transition-colors hover:text-blue-600\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n            <div className=\"p-2\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div className=\"flex flex-col space-y-6\">\n                  {renderSeasonOptions()}\n                  {renderAutoTypes()}\n                </div>\n                <div className=\"flex flex-col space-y-4\">\n                  {renderSizes()}\n                  {renderDiameters()}\n                </div>\n                <div className=\"flex flex-col\">\n                  {renderBrands()}\n                </div>\n              </div>\n            </div>\n          </div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n\n  return (\n    <div onMouseLeave={handleMouseLeave} className=\"relative\">\n      <button\n  ref={buttonRef}\n  type=\"button\"\n  onClick={() => setOpen((prev) => !prev)}\n  onMouseEnter={handleMouseEnter}\n  className={`\n    w-full md:w-auto flex items-center justify-center gap-2 text-md md:text-sm transition-colors px-4 py-1.5 md:rounded-md rounded-xl shadow\n    bg-blue-500/60 md:bg-white/10 md:border-white/20  ${open ? \"text-yellow-400\" : \"text-white md:text-white/60 hover:text-yellow-400\"}\n  `}\n>\n        Каталог шин\n        <ChevronDown className={`w-5 h-5 transition-transform ${open ? 'rotate-180' : ''}`} />\n      </button>\n      {isMobile ? modalContent : createPortal(modalContent, document.body)}\n    </div>\n  );\n};\n\nexport default TireCatalogDropdown;\n","import React, { FC, memo, useLayoutEffect, useRef, useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"react-router-dom\";\nimport { AnimatePresence, motion } from \"framer-motion\";\nimport {\n  RiCloseLine,\n  RiUserLine,\n  RiUserFill,\n  RiCheckFill,\n  RiHeartFill,\n  RiSearchLine,\n  RiPhoneFill,\n  RiShoppingCartFill,\n} from \"react-icons/ri\";\nimport LogoNavBar from \"./LogoNavBar\";\nimport SearchDropdown from \"./SearchDropdown\";\nimport TireCatalogDropdown from \"./TireCatalogDropdown\";\n\ninterface MobileMenuProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onProfileClick: () => void;\n  onFavoritesClick: () => void;\n  onCartClick: () => void;\n  favoritesCount: number;\n  cartCount: number;\n  isAuthenticated: boolean;\n}\n\ninterface IconButtonProps {\n  icon: React.ReactNode;\n  label: string;\n  onClick?: (e?: React.MouseEvent<HTMLButtonElement>) => void;\n  href?: string;\n}\n\nconst IconButton: FC<IconButtonProps> = memo(({ icon, label, onClick, href }) => {\n  const buttonContent = (\n    <button\n      onClick={onClick}\n      aria-label={label}\n      className=\"p-2 bg-transparent text-white rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800 focus:outline-none focus:ring-0\"\n      style={{ WebkitTapHighlightColor: \"transparent\", touchAction: \"manipulation\" }}\n    >\n      {icon}\n    </button>\n  );\n  return href ? <a href={href} aria-label={label}>{buttonContent}</a> : buttonContent;\n});\n\nconst MobileMenu: FC<MobileMenuProps> = ({\n  isOpen,\n  onClose,\n  onProfileClick,\n  onFavoritesClick,\n  onCartClick,\n  favoritesCount,\n  cartCount,\n  isAuthenticated,\n}) => {\n  const scrollPositionRef = useRef(0);\n  const [isSearchDropdownOpen, setIsSearchDropdownOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [showPersonalOffersStub, setShowPersonalOffersStub] = useState(false);\n  const location = useLocation();\n  const prevLocation = useRef(location);\n\n  // Закрываем меню только если произошла реальная смена маршрута\n  useEffect(() => {\n    if (isOpen && prevLocation.current.pathname !== location.pathname) {\n      onClose();\n    }\n    prevLocation.current = location;\n  }, [location, isOpen, onClose]);\n\n  // Фиксирование скролла при открытии меню\n  useLayoutEffect(() => {\n    if (isOpen) {\n      scrollPositionRef.current = window.pageYOffset;\n      document.body.style.position = \"fixed\";\n      document.body.style.top = `-${scrollPositionRef.current}px`;\n      document.body.style.left = \"0\";\n      document.body.style.right = \"0\";\n    } else {\n      document.body.style.position = \"\";\n      document.body.style.top = \"\";\n      document.body.style.left = \"\";\n      document.body.style.right = \"\";\n      requestAnimationFrame(() => {\n        window.scrollTo(0, scrollPositionRef.current);\n      });\n    }\n    return () => {\n      document.body.style.position = \"\";\n      document.body.style.top = \"\";\n      document.body.style.left = \"\";\n      document.body.style.right = \"\";\n    };\n  }, [isOpen]);\n\n  // Варианты анимации для оверлея\n  const overlayVariants = {\n    hidden: { opacity: 0 },\n    visible: { opacity: 1, transition: { duration: 0.3, ease: \"easeInOut\" } },\n    exit: { opacity: 0, transition: { duration: 0.3, ease: \"easeInOut\" } },\n  };\n\n  // Варианты анимации для выезжающего меню\n  const menuVariants = {\n    hidden: { x: \"-100%\" },\n    visible: { x: 0, transition: { duration: 0.3, ease: \"easeInOut\" } },\n    exit: { x: \"-100%\", transition: { duration: 0.3, ease: \"easeInOut\" } },\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Оверлей для закрытия мобильного меню */}\n          <motion.div\n            key=\"overlay\"\n            variants={overlayVariants}\n            initial=\"hidden\"\n            animate=\"visible\"\n            exit=\"exit\"\n            className=\"fixed inset-0 bg-black/50 z-40\"\n            onClick={() => {\n              if (!isSearchDropdownOpen) {\n                onClose();\n              }\n            }}\n            role=\"presentation\"\n          />\n          {/* Меню с анимацией заезда/выезда */}\n          <motion.nav\n            key=\"menu\"\n            variants={menuVariants}\n            initial=\"hidden\"\n            animate=\"visible\"\n            exit=\"exit\"\n            drag=\"x\"\n            dragConstraints={{ left: 0, right: 0 }}\n            dragElastic={0.3}\n            onDragEnd={(_event, info) => {\n              if (info.offset.x < -10) {\n                onClose();\n              }\n            }}\n            className=\"fixed inset-y-0 left-0 w-72 bg-[#1e3fac] z-50 overflow-y-auto\"\n            aria-label=\"Основне меню\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <div className=\"p-4 text-white\">\n              {/* Шапка: кнопка закрытия и логотип */}\n              <header className=\"flex justify-between items-center mb-4\">\n                <IconButton\n                  icon={<RiCloseLine className=\"w-6 h-6\" />}\n                  label=\"Закрити меню\"\n                  onClick={onClose}\n                />\n                <Link to=\"/\" onClick={onClose}>\n                  <LogoNavBar className=\"w-28\" align=\"left\" />\n                </Link>\n              </header>\n\n              {/* Блок с иконками */}\n              <div className=\"mb-4\">\n                <hr className=\"border-white/20\" />\n                <div className=\"mt-2 flex justify-around\">\n                  <IconButton\n                    href=\"tel:09307594003\"\n                    icon={<RiPhoneFill className=\"w-6 h-6 text-white\" />}\n                    label=\"Зателефонувати\"\n                  />\n                  <div className=\"relative\">\n                    <IconButton\n                      label=\"Профіль\"\n                      onClick={onProfileClick}\n                      icon={\n                        isAuthenticated ? (\n                          <div className=\"relative\">\n                            <RiUserFill className=\"w-6 h-6\" fill=\"white\" stroke=\"white\" strokeWidth={1} />\n                            <motion.span\n                              initial={{ scale: 0 }}\n                              animate={{ scale: 1 }}\n                              className=\"absolute -top-3 left-4 -right-3 flex items-center justify-center\"\n                              style={{ transform: \"rotate(15deg)\", transformOrigin: \"center\" }}\n                            >\n                              <div className=\"bg-green-500/90 rounded-full w-4 h-4 flex items-center justify-center shadow-sm\">\n                                <RiCheckFill className=\"w-2.5 h-2.5 text-white\" strokeWidth={1.8} />\n                              </div>\n                            </motion.span>\n                          </div>\n                        ) : (\n                          <RiUserLine className=\"w-6 h-6 text-white\" />\n                        )\n                      }\n                    />\n                  </div>\n                  <div className=\"relative\">\n                    <IconButton\n                      icon={<RiHeartFill className={`w-6 h-6 ${favoritesCount > 0 ? \"text-red-500\" : \"text-white\"}`} />}\n                      label=\"Вибране\"\n                      onClick={onFavoritesClick}\n                    />\n                    {favoritesCount > 0 && (\n                      <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center\">\n                        {favoritesCount}\n                      </span>\n                    )}\n                  </div>\n                  <IconButton\n                    icon={<RiSearchLine className=\"w-6 h-6 text-white\" />}\n                    label=\"Пошук\"\n                    onClick={() => setIsSearchDropdownOpen(true)}\n                  />\n                  <div className=\"relative\">\n                    <IconButton\n                      icon={<RiShoppingCartFill className={`w-6 h-6 ${cartCount > 0 ? \"text-yellow-500\" : \"text-white\"}`} />}\n                      label=\"Кошик\"\n                      onClick={onCartClick}\n                    />\n                    {cartCount > 0 && (\n                      <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center\">\n                        {cartCount}\n                      </span>\n                    )}\n                  </div>\n                </div>\n                <hr className=\"mt-2 border-white/20\" />\n              </div>\n\n              {/* Основна навігація з розділювальною лінією */}\n              <section className=\"space-y-5 mb-4\">\n                <div className=\"mb-4 flex flex-col gap-3\">\n                  <TireCatalogDropdown />\n                  <Link\n  to=\"/detailed-search\"\n  onClick={onClose}\n  className=\"w-full md:self-start inline-block py-1.5 text-md bg-blue-500/60 rounded-xl px-4 shadow font-medium hover:text-yellow-300 transition-colors text-center\"\n>\n                    Детальний пошук\n                    </Link>\n{/* Кнопка с заглушкой для \"Особисті пропозиції\" */}\n<button\n  onClick={() => setShowPersonalOffersStub(true)}\n  className=\"w-full md:self-start inline-block py-1.5 text-md bg-blue-500/60 rounded-xl px-4 shadow font-medium hover:text-yellow-300 transition-colors text-center\"\n>\n                    Особисті пропозиції\n                  </button>\n                </div>\n                <hr className=\"border-white/20\" />\n                <nav aria-label=\"Основна навігація\" className=\"text-sm\">\n                  <Link\n                    to=\"/akcii\"\n                    onClick={onClose}\n                    className=\"block py-2 font-medium hover:text-yellow-300 transition-colors\"\n                  >\n                    Акції\n                  </Link>\n                  <Link\n                    to=\"/statti\"\n                    onClick={onClose}\n                    className=\"block py-2 font-medium hover:text-yellow-300 transition-colors\"\n                  >\n                    Статті\n                  </Link>\n                  <Link\n                    to=\"/pro-nas\"\n                    onClick={onClose}\n                    className=\"block py-2 font-medium hover:text-yellow-300 transition-colors\"\n                  >\n                    Про нас\n                  </Link>\n                  <Link\n                    to=\"/delivery\"\n                    onClick={onClose}\n                    className=\"block py-2 font-medium hover:text-yellow-300 transition-colors\"\n                  >\n                    Доставка і оплата\n                  </Link>\n                  <Link\n                    to=\"/contacts\"\n                    onClick={onClose}\n                    className=\"block py-2 font-medium hover:text-yellow-300 transition-colors\"\n                  >\n                    Контакти\n                  </Link>\n                  <Link\n                    to=\"/warranty\"\n                    onClick={onClose}\n                    className=\"block py-2 font-medium hover:text-yellow-300 transition-colors\"\n                  >\n                    Гарантія\n                  </Link>\n                </nav>\n              </section>\n\n              {/* Додаткова інформація */}\n              <section className=\"mt-6 space-y-4\">\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center\">\n                    <svg className=\"w-6 h-6\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                    </svg>\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold\">Гарантія якості</h3>\n                    <p className=\"text-sm opacity-80\">Тільки оригінальна продукція</p>\n                  </div>\n                </div>\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center\">\n                    <svg className=\"w-6 h-6\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                    </svg>\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold\">Швидка доставка</h3>\n                    <p className=\"text-sm opacity-80\">По всій Україні</p>\n                  </div>\n                </div>\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"w-12 h-12 bg-white/10 rounded-full flex items-center justify-center\">\n                    <svg className=\"w-6 h-6\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\" />\n                    </svg>\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold\">Зручна оплата</h3>\n                    <p className=\"text-sm opacity-80\">Готівка, карта, безготівковий</p>\n                  </div>\n                </div>\n              </section>\n\n              <footer className=\"mt-6 text-sm\">\n                <p>Графік роботи кол-центра:</p>\n                <p>Пн-Пт: 9:00-21:00</p>\n                <p>Сб: 9:00-19:00, Нд: 9:00-18:00</p>\n              </footer>\n            </div>\n          </motion.nav>\n          {/* Оверлей для закриття пошуку */}\n          <AnimatePresence>\n            {isSearchDropdownOpen && (\n              <motion.div\n                key=\"search-overlay\"\n                className=\"fixed inset-0 z-50\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                transition={{ duration: 0.2 }}\n                onClick={() => setIsSearchDropdownOpen(false)}\n              >\n                <SearchDropdown\n                  onClose={() => setIsSearchDropdownOpen(false)}\n                  externalFilter={searchQuery}\n                  onSearchChange={setSearchQuery}\n                />\n              </motion.div>\n            )}\n          </AnimatePresence>\n          {/* Оверлей для заглушки \"Особисті пропозиції\" */}\n          <AnimatePresence>\n            {showPersonalOffersStub && (\n              <motion.div\n                key=\"personal-offers-stub\"\n                className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                transition={{ duration: 0.2 }}\n                onClick={() => setShowPersonalOffersStub(false)}\n              >\n                <motion.div\n                  className=\"bg-white p-4 rounded shadow-md text-center\"\n                  initial={{ scale: 0.8 }}\n                  animate={{ scale: 1 }}\n                  exit={{ scale: 0.8 }}\n                  transition={{ duration: 0.2 }}\n                >\n                  <p>Поки що немає особистих пропозицій</p>\n                  <button\n                    onClick={() => setShowPersonalOffersStub(false)}\n                    className=\"mt-4 px-4 py-2 bg-blue-500 text-white rounded\"\n                  >\n                    Закрити\n                  </button>\n                </motion.div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default memo(MobileMenu);\n","import React from \"react\";\nimport { motion, AnimationControls } from \"framer-motion\";\nimport {\n  RiSearchLine,\n  RiHeartFill,\n  RiUserFill,\n  RiUserLine,\n  RiCheckFill,\n  RiShoppingCartFill,\n} from \"react-icons/ri\";\n\nexport interface NavIconsProps {\n  variant: \"mobile\" | \"desktop\";\n  isScrolled?: boolean;\n  favoritesCount: number;\n  cartCount: number;\n  favoritesControl: AnimationControls;\n  cartControl: AnimationControls;\n  onSearchClick: () => void;\n  onFavoritesClick: () => void;\n  onCartClick: () => void;\n  onProfileClick: () => void; // теперь обязательно передавать этот коллбэк\n  isAuthenticated: boolean;\n  \n  \n  \n}\n\nconst NavIcons: React.FC<NavIconsProps> = ({\n  variant,\n  isScrolled,\n  favoritesCount,\n  cartCount,\n  favoritesControl,\n  cartControl,\n  onSearchClick,\n  onFavoritesClick,\n  onCartClick,\n  onProfileClick,\n  isAuthenticated,\n  \n}) => {\n  const renderMobileIcons = () => (\n    <motion.div\n      animate={{ x: isScrolled ? -20 : 0 }}\n      className=\"flex items-center gap-2 mr-4\"\n    >\n      {/* Иконка поиска */}\n      <button\n        onClick={onSearchClick}\n        aria-label=\"Поиск\"\n        className=\"p-2 bg-transparent rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800\"\n      >\n        <RiSearchLine className=\"w-6 h-6 text-white\" />\n      </button>\n      {/* Иконка профиля с анимацией перехода */}\n      <motion.button\n        onClick={onProfileClick}\n        aria-label=\"Профиль\"\n        className=\"p-2 bg-transparent rounded-lg transition-transform duration-150 hover:bg-blue-800\"\n        whileTap={{ scale: 0.9 }}\n      >\n        {isAuthenticated ? (\n          <div className=\"relative\">\n            <RiUserFill className=\"w-6 h-6 text-white\" />\n            <motion.span\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              className=\"absolute -top-2.5 -right-2.5 flex items-center justify-center\"\n            >\n              <div className=\"bg-green-500/90 rounded-full w-4 h-4 flex items-center justify-center shadow-sm\">\n                <RiCheckFill className=\"w-2.5 h-2.5 text-white\" />\n              </div>\n            </motion.span>\n          </div>\n        ) : (\n          <RiUserLine className=\"w-6 h-6 text-white\" />\n        )}\n      </motion.button>\n      {/* Иконка избранного */}\n      <motion.div animate={favoritesControl} className=\"relative\">\n        <motion.button\n          aria-label=\"Избранное\"\n          onClick={onFavoritesClick}\n          className=\"p-2 bg-transparent rounded-lg transition-transform duration-150 hover:bg-blue-800 active:scale-150\"\n        >\n          <RiHeartFill\n            className={`w-6 h-6 ${\n              favoritesCount > 0 ? \"text-red-500\" : \"text-white\"\n            }`}\n          />\n        </motion.button>\n        {favoritesCount > 0 && (\n          <motion.span\n            key={favoritesCount}\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            transition={{ type: \"spring\", stiffness: 300 }}\n            className=\"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center\"\n          >\n            {favoritesCount}\n          </motion.span>\n        )}\n      </motion.div>\n      {/* Иконка корзины */}\n      <motion.div animate={cartControl} className=\"relative\">\n        <button\n          aria-label=\"Корзина\"\n          onClick={onCartClick}\n          className=\"p-2 bg-transparent rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800\"\n        >\n          <RiShoppingCartFill\n            className={`w-6 h-6 ${\n              cartCount > 0 ? \"text-yellow-500\" : \"text-white\"\n            }`}\n          />\n        </button>\n        {cartCount > 0 && (\n          <motion.span\n            key={cartCount}\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            transition={{ type: \"spring\", stiffness: 300 }}\n            className=\"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center\"\n          >\n            {cartCount}\n          </motion.span>\n        )}\n      </motion.div>\n    </motion.div>\n  );\n\n  const renderDesktopIcons = () => (\n    <motion.div\n      animate={{ x: isScrolled ? -20 : 0 }}\n      transition={{ type: \"spring\", stiffness: 300 }}\n      className=\"flex items-center gap-4\"\n    >\n      {/* Иконка профиля с анимацией перехода */}\n      <motion.button\n        aria-label=\"Профиль\"\n        onClick={onProfileClick}\n        className=\"flex items-center relative p-2 bg-transparent rounded-lg transition-transform duration-150 hover:bg-blue-800\"\n        whileTap={{ scale: 0.9 }}\n      >\n        {isAuthenticated ? (\n          <div className=\"relative\">\n            <RiUserFill className=\"w-6 h-6 text-white\" />\n            <motion.span\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              className=\"absolute -top-3 left-4 -right-3 flex items-center justify-center\"\n              style={{ transform: \"rotate(15deg)\", transformOrigin: \"center\" }}\n            >\n              <div className=\"bg-green-500/90 rounded-full w-4 h-4 flex items-center justify-center shadow-sm\">\n                <RiCheckFill className=\"w-2.5 h-2.5 text-white\" />\n              </div>\n            </motion.span>\n          </div>\n        ) : (\n          <RiUserLine className=\"w-6 h-6 text-white\" />\n        )}\n      </motion.button>\n      {/* Иконка избранного */}\n      <motion.div animate={favoritesControl} className=\"relative\">\n        <motion.button\n          aria-label=\"Избранное\"\n          onClick={onFavoritesClick}\n          className=\"p-2 bg-transparent rounded-lg transition-transform duration-150 hover:bg-blue-800 active:scale-150\"\n        >\n          <RiHeartFill\n            className={`w-6 h-6 ${\n              favoritesCount > 0 ? \"text-red-500\" : \"text-white\"\n            }`}\n          />\n        </motion.button>\n        {favoritesCount > 0 && (\n          <motion.span\n            key={favoritesCount}\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            transition={{ type: \"spring\", stiffness: 300 }}\n            className=\"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center\"\n          >\n            {favoritesCount}\n          </motion.span>\n        )}\n      </motion.div>\n      {/* Иконка корзины */}\n      <motion.div animate={cartControl} className=\"relative\">\n        <button\n          aria-label=\"Корзина\"\n          onClick={onCartClick}\n          className=\"p-2 bg-transparent rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800\"\n        >\n          <RiShoppingCartFill\n            className={`w-6 h-6 ${\n              cartCount > 0 ? \"text-yellow-500\" : \"text-white\"\n            }`}\n          />\n        </button>\n        {cartCount > 0 && (\n          <motion.span\n            key={cartCount}\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            transition={{ type: \"spring\", stiffness: 300 }}\n            className=\"absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 text-black text-xs rounded-full flex items-center justify-center\"\n          >\n            {cartCount}\n          </motion.span>\n        )}\n      </motion.div>\n    </motion.div>\n  );\n\n  return variant === \"mobile\" ? renderMobileIcons() : renderDesktopIcons();\n};\n\nexport default NavIcons;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Trash2 } from 'lucide-react';\nimport ReactCountryFlag from 'react-country-flag';\nimport { motion } from 'framer-motion';\nimport { useCartStore } from '../../../stores/cartStore';\nimport { Product } from '../../../types/database.types';\nimport { supabase } from '../../../lib/supabaseClient';\n\ninterface CartProps {\n  onClose: () => void;\n  isClosing: boolean;\n}\n\nexport const Cart: React.FC<CartProps> = ({ onClose, isClosing }) => {\n  const { items, removeItem, updateQuantity } = useCartStore();\n  // Фиксируем, была ли корзина изначально пустой\n  const initialEmpty = useRef(items.length === 0);\n  // Сохраняем последний набор товаров для визуализации при удалении последнего элемента\n  const [preservedItems, setPreservedItems] = useState(items);\n  const [products, setProducts] = useState<Record<string, Product>>({});\n  const [loading, setLoading] = useState(true);\n\n  // Если корзина не пуста, обновляем сохранённые товары\n  useEffect(() => {\n    if (items.length > 0) {\n      setPreservedItems(items);\n    }\n  }, [items]);\n\n  // Функция форматирования сезона на русском\n  const formatSeason = (season: string) => {\n    switch (season.toLowerCase()) {\n      case 'winter': return 'Зимние';\n      case 'summer': return 'Летние';\n      case 'all-season': return 'Всесезонные';\n      default: return season;\n    }\n  };\n\n  // Форматирование цены\n  const formatPrice = (value: number) =>\n    value.toLocaleString('uk-UA', {\n      minimumFractionDigits: 1,\n      maximumFractionDigits: 1,\n    }) + ' ₴';\n\n  useEffect(() => {\n    const fetchProducts = async () => {\n      // Используем для запроса товары из актуального состояния или из сохранённого\n      const relevantItems = items.length > 0 ? items : preservedItems;\n      if (relevantItems.length === 0) {\n        setLoading(false);\n        return;\n      }\n      const { data, error } = await supabase\n        .from('products')\n        .select('*')\n        .in('id', relevantItems.map(item => item.product_id));\n\n      if (error) {\n        console.error('Error fetching products:', error);\n      } else if (data) {\n        const productsMap = (data as Product[]).reduce((acc, product) => {\n          acc[product.id] = product;\n          return acc;\n        }, {} as Record<string, Product>);\n        setProducts(productsMap);\n      }\n      setLoading(false);\n    };\n\n    fetchProducts();\n  }, [items, preservedItems]);\n\n  // Если корзина изначально пуста, показываем статичное сообщение\n  if (items.length === 0 && initialEmpty.current) {\n    return (\n      <div className=\"p-4\">\n        <div className=\"text-center\">\n          <h1 className=\"text-xl font-bold mb-2\">Кошик порожній</h1>\n          <p className=\"text-gray-600 mb-4\">Додайте товари для оформлення замовлення</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Если товаров нет в items, используем сохранённые для отображения (анимация затухания)\n  const displayedItems = items.length > 0 ? items : preservedItems;\n\n  // Расчёт общей суммы для отображаемых товаров\n  const calculateTotal = () => {\n    return displayedItems.reduce((total, item) => {\n      const product = products[item.product_id];\n      if (!product) return total;\n      const price =\n        product.sale_price && product.sale_price < product.price\n          ? product.sale_price\n          : product.price;\n      return total + price * item.quantity;\n    }, 0);\n  };\n\n  // Обработчик удаления товара. Если это последний товар – инициируем одновременное закрытие.\n  const handleRemoveItem = (productId: string) => {\n    const isLastItem = displayedItems.length === 1;\n    removeItem(productId);\n    if (isLastItem) {\n      // Запуск закрытия окна сразу после удаления\n      onClose();\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-800\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 overflow-y-auto max-h-full\">\n      {renderCartContent(displayedItems)}\n    </div>\n  );\n\n  // Функция для отрисовки содержимого корзины (список товаров, итог и ссылки)\n  function renderCartContent(cartItems: typeof items) {\n    return (\n      <>\n        <h1 className=\"text-xl font-bold mb-4\">Кошик</h1>\n        <div className=\"space-y-4\">\n          {cartItems.map((item) => {\n            const product = products[item.product_id];\n            if (!product) return null;\n            const imageUrl =\n              product.image_url && product.image_url[0]\n                ? product.image_url[0]\n                : 'https://via.placeholder.com/56';\n            const countryCode = product.country\n              ? product.country.slice(0, 2).toUpperCase()\n              : 'UA';\n\n            return (\n              <motion.div\n                key={item.product_id}\n                className=\"bg-white rounded-lg shadow p-3 flex items-center gap-3 relative\"\n                initial={{ opacity: 1, y: 0 }}\n                animate={{ opacity: isClosing ? 0 : 1, y: isClosing ? 10 : 0 }}\n                exit={{ opacity: 0, y: 10 }}\n                transition={{ duration: 0.5 }}\n              >\n                <Link to={`/product/${product.id}`} onClick={onClose} className=\"block\">\n                  <img\n                    src={imageUrl}\n                    alt={`${product.brand} ${product.model}`}\n                    className=\"w-14 h-14 object-contain\"\n                  />\n                </Link>\n\n                <div className=\"flex-1\">\n                  <div className=\"relative\">\n                    <Link\n                      to={`/product/${product.id}`}\n                      onClick={onClose}\n                      className=\"font-medium text-black hover:text-blue-800 text-sm line-clamp-1\"\n                    >\n                      {product.brand} {product.model}\n                    </Link>\n                    <span className=\"absolute top-0 right-[-8rem] text-xs text-gray-500 font-bold whitespace-nowrap\">\n                      арт: {product.id.slice(0, 8).toUpperCase()}\n                    </span>\n                  </div>\n\n                  <div className=\"text-xs text-gray-600 mt-1\">\n                    Размер: {product.width}/{product.profile} R{product.diameter}\n                  </div>\n\n                  <div className=\"text-xs text-gray-600\">\n                    Сезон: {formatSeason(product.season ?? 'all-season')}\n                  </div>\n\n                  <div className=\"flex items-center gap-1 text-xs text-gray-600\">\n                    <div className=\"aspect-square rounded-full overflow-hidden border w-3 h-3 relative\">\n                      <ReactCountryFlag\n                        countryCode={countryCode}\n                        svg\n                        className=\"absolute top-1/2 left-1/2 w-[135%] h-[135%] -translate-x-1/2 -translate-y-1/2 object-cover\"\n                        title={product.country || 'UA'}\n                        aria-label={product.country || 'UA'}\n                      />\n                    </div>\n                    <span>{product.year} рік</span>\n                  </div>\n\n                  <div className=\"mt-2\">\n                    {product.sale_price && product.sale_price < product.price ? (\n                      <>\n                        <span className=\"text-sm font-bold text-red-500\">\n                          {formatPrice(product.sale_price)}\n                        </span>\n                        <span className=\"text-xs text-gray-400 line-through ml-2\">\n                          {formatPrice(product.price)}\n                        </span>\n                      </>\n                    ) : (\n                      <span className=\"text-sm font-bold\">\n                        {formatPrice(product.price)}\n                      </span>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"flex items-center border border-gray-300 rounded\">\n                    <button\n                      onClick={() => handleRemoveItem(item.product_id)}\n                      className=\"px-2 py-1 text-gray-600 hover:bg-gray-100\"\n                      disabled={isClosing}\n                    >\n                      -\n                    </button>\n                    <input\n                      type=\"number\"\n                      min=\"1\"\n                      value={item.quantity}\n                      onChange={(e) =>\n                        updateQuantity(\n                          item.product_id,\n                          Math.max(1, parseInt(e.target.value) || 1)\n                        )\n                      }\n                      className=\"w-12 text-center border-x border-gray-300 py-1 text-xs\"\n                      disabled={isClosing}\n                    />\n                    <button\n                      onClick={() => updateQuantity(item.product_id, item.quantity + 1)}\n                      className=\"px-2 py-1 text-gray-600 hover:bg-gray-100\"\n                      disabled={isClosing}\n                    >\n                      +\n                    </button>\n                  </div>\n\n                  <button\n                    onClick={() => handleRemoveItem(item.product_id)}\n                    className=\"text-gray-500 hover:text-red-500\"\n                    disabled={isClosing}\n                  >\n                    <Trash2 className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              </motion.div>\n            );\n          })}\n        </div>\n\n        <motion.div \n          className=\"mt-4 border-t pt-4\"\n          initial={{ opacity: 1 }}\n          animate={{ opacity: isClosing ? 0 : 1 }}\n          transition={{ duration: 0.5 }}\n        >\n          <div className=\"flex justify-between text-sm font-bold\">\n            <span>Товари ({displayedItems.length})</span>\n            <span>{formatPrice(calculateTotal())}</span>\n          </div>\n          <Link\n            to=\"/checkout\"\n            onClick={onClose}\n            className=\"block mt-4 bg-green-600 text-white text-center px-4 py-2 rounded-md hover:bg-green-700 text-sm\"\n          >\n            Оформити замовлення\n          </Link>\n        </motion.div>\n      </>\n    );\n  }\n};\n\nexport default Cart;\n","import React, { useState, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Cart } from \"./Cart\";\n\ninterface SlidingCartProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst useMediaQuery = (query: string) => {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = () => setMatches(media.matches);\n    media.addEventListener(\"change\", listener);\n    \n    return () => media.removeEventListener(\"change\", listener);\n  }, [query]);\n\n  return matches;\n};\n\nconst SlidingCart: React.FC<SlidingCartProps> = ({ isOpen, onClose }) => {\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\n  // visualState управляет анимацией окна: открыто, закрывается или закрыто\n  const [visualState, setVisualState] = useState<'closed' | 'open' | 'closing'>('closed');\n\n  useEffect(() => {\n    if (isOpen) {\n      setVisualState('open');\n    }\n  }, [isOpen]);\n  \n  // При закрытии окна запускается анимация закрытия\n  const handleCloseCart = () => {\n    setVisualState('closing');\n    setTimeout(() => {\n      onClose();\n      setVisualState('closed');\n    }, 100); // длительность анимации – 0.1 сек\n  };\n\n  const handleBackgroundClick = () => handleCloseCart();\n  const handleCartClick = (e: React.MouseEvent) => e.stopPropagation();\n\n  return (\n    <AnimatePresence>\n      {(isOpen || visualState === 'closing') && (\n        <motion.div\n          className=\"fixed inset-0 z-50\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ duration: 0.5 }}\n          onClick={handleBackgroundClick}\n          key=\"cart-backdrop\"\n        >\n          {isMobile ? (\n            <motion.div\n              className=\"absolute w-full bg-white shadow-lg overflow-y-auto\"\n              style={{ top: \"4rem\", maxHeight: \"90vh\" }}\n              initial={{ y: \"-100%\" }}\n              animate={{ y: 0 }}\n              exit={{ y: \"-100%\" }}\n              transition={{ duration: 0.5, ease: \"easeInOut\" }}\n              onClick={handleCartClick}\n              key=\"cart-content-mobile\"\n            >\n              <Cart onClose={handleCloseCart} isClosing={visualState === 'closing'} />\n            </motion.div>\n          ) : (\n            <motion.div\n              className=\"absolute right-0 bg-white shadow-lg overflow-y-auto\"\n              style={{ \n                top: \"4rem\",\n                width: \"400px\",\n                maxWidth: \"90vw\",\n                maxHeight: \"90vh\",\n                minHeight: \"150px\"\n              }}\n              initial={{ x: \"100%\" }}\n              animate={{ x: 0 }}\n              exit={{ x: \"100%\" }}\n              transition={{ duration: 0.5, ease: \"easeInOut\" }}\n              onClick={handleCartClick}\n              key=\"cart-content-desktop\"\n            >\n              <Cart onClose={handleCloseCart} isClosing={visualState === 'closing'} />\n            </motion.div>\n          )}\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default SlidingCart;\n","import React, { useState, useEffect, useCallback } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { useFavoritesStore } from \"../../../stores/favoritesStore\";\nimport { useCartStore } from \"../../../stores/cartStore\";\nimport { supabase } from \"../../../lib/supabaseClient\";\nimport ReactCountryFlag from \"react-country-flag\";\nimport { ShoppingCart, Trash2, XCircle } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\n\ninterface FavoriteProduct {\n  id: string;\n  brand: string;\n  model: string;\n  width: number;\n  profile: number;\n  diameter: number;\n  season: string;\n  price: number;\n  sale_price?: number | null;\n  image_url?: string[];\n  year: number;\n  country: string;\n}\n\nconst FavoritesLike: React.FC<{ isOpen: boolean; onClose: () => void }> = ({ onClose }) => {\n  const { favorites, toggleFavorite } = useFavoritesStore();\n  const { items, addItem, removeItem } = useCartStore();\n  const [favoriteProducts, setFavoriteProducts] = useState<FavoriteProduct[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchFavoriteProducts = useCallback(async () => {\n    if (!favorites.length) {\n      setLoading(false);\n      return;\n    }\n    \n    try {\n      const { data, error } = await supabase\n        .from(\"products\")\n        .select(\"id, brand, model, width, profile, diameter, season, price, sale_price, image_url, year, country\")\n        .in(\"id\", favorites);\n      \n      if (error) throw error;\n      setFavoriteProducts(data as FavoriteProduct[]);\n    } catch (error) {\n      console.error(\"Error fetching favorites:\", error);\n    } finally {\n      setLoading(false);\n    }\n  }, [favorites]);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      if (favorites.length === 0) onClose();\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [favorites, onClose]);\n\n  useEffect(() => {\n    const loadData = async () => {\n      await fetchFavoriteProducts();\n    };\n    \n    const timer = setTimeout(loadData, 200);\n    return () => clearTimeout(timer);\n  }, [fetchFavoriteProducts]);\n\n  const formatPrice = (value: number) =>\n    value.toLocaleString(\"uk-UA\", {\n      minimumFractionDigits: 1,\n      maximumFractionDigits: 1,\n    }) + \" ₴\";\n\n  const formatSeason = (season: string) => {\n    switch (season.toLowerCase()) {\n      case \"winter\":\n        return \"Зимние\";\n      case \"summer\":\n        return \"Летние\";\n      case \"all-season\":\n        return \"Всесезонные\";\n      default:\n        return season;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-800\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"p-4 border-b\">\n        <h3 className=\"text-lg font-semibold text-center\">Обране</h3>\n      </div>\n      \n      {favoriteProducts.length === 0 ? (\n        <div className=\"p-4 text-center\">Избранное пустое</div>\n      ) : (\n        <div className=\"p-4 pr-2 overflow-y-auto\" style={{ maxHeight: \"calc(90vh - 4rem)\" }}>\n          <div className=\"space-y-2\">\n            {favoriteProducts.map((product) => {\n              const isInCart = items.some((item) => item.product_id === product.id);\n              return (\n                <motion.div\n                  key={product.id}\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  exit={{ opacity: 0 }}\n                  className=\"bg-white rounded-lg p-2 grid grid-cols-[60px_1fr] gap-3 items-center shadow-sm mb-2\"\n                >\n                  <Link to={`/product/${product.id}`} onClick={onClose}>\n                    <div className=\"border rounded-md p-1 h-14 w-14 flex items-center justify-center bg-gray-50\">\n                      {product.image_url?.[0] ? (\n                        <img\n                          src={product.image_url[0]}\n                          alt={`${product.brand} ${product.model}`}\n                          className=\"object-contain h-full w-full\"\n                        />\n                      ) : (\n                        <div className=\"text-gray-400 text-xs text-center\">Нет фото</div>\n                      )}\n                    </div>\n                  </Link>\n\n                  <div className=\"flex flex-col space-y-0\">\n                    <div className=\"flex justify-between items-start\">\n                      <Link\n                        to={`/product/${product.id}`}\n                        className=\"font-medium text-black hover:text-blue-800 text-sm line-clamp-1\"\n                        onClick={onClose}\n                      >\n                        {product.brand} {product.model}\n                      </Link>\n                      <span className=\"text-xs text-gray-500 font-bold\">\n                        арт: {product.id.slice(0, 8).toUpperCase()}\n                      </span>\n                    </div>\n                    \n                    <div className=\"text-xs text-gray-600\">\n                      Размер: {product.width}/{product.profile} R{product.diameter}\n                    </div>\n                    \n                    <div className=\"text-xs text-gray-600\">\n                      Сезон: {formatSeason(product.season)}\n                    </div>\n\n                    <div className=\"flex items-center justify-between mt-1\">\n                      <div className=\"font-bold text-sm\">\n                        {product.sale_price && product.sale_price < product.price ? (\n                          <>\n                            <span className=\"text-red-600\">\n                              {formatPrice(product.sale_price)}\n                            </span>\n                            <span className=\"line-through text-gray-400 text-xs ml-2\">\n                              {formatPrice(product.price)}\n                            </span>\n                          </>\n                        ) : (\n                          <span className=\"text-green-600\">\n                            {formatPrice(product.price)}\n                          </span>\n                        )}\n                      </div>\n\n                      <div className=\"flex gap-1\">\n                        <button\n                          onClick={() => {\n                            if (isInCart) {\n                              removeItem(product.id);\n                            } else {\n                              addItem(product.id);\n                            }\n                          }}\n                          className={`p-1.5 rounded-md flex items-center justify-center ${\n                            isInCart ? \"bg-blue-500 hover:bg-blue-600\" : \"bg-green-500 hover:bg-green-600\"\n                          }`}\n                        >\n                          {isInCart ? (\n                            <Trash2 className=\"w-3.5 h-3.5 text-white\" />\n                          ) : (\n                            <ShoppingCart className=\"w-3.5 h-3.5 text-white\" />\n                          )}\n                        </button>\n\n                        <button\n                          onClick={() => toggleFavorite(product.id)}\n                          className=\"p-1.5 bg-red-500 hover:bg-red-600 rounded-md\"\n                        >\n                          <XCircle className=\"w-3.5 h-3.5 text-white\" />\n                        </button>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-1 text-xs text-gray-600\">\n                      <div className=\"aspect-square rounded-full overflow-hidden border w-3 h-3 relative\">\n                        <ReactCountryFlag\n                          countryCode={product.country?.slice(0, 2).toUpperCase() || \"UA\"}\n                          svg\n                          className=\"absolute top-1/2 left-1/2 w-[135%] h-[135%] -translate-x-1/2 -translate-y-1/2 object-cover\"\n                          title={product.country || \"UA\"}\n                          aria-label={product.country || \"UA\"}\n                        />\n                      </div>\n                      <span>{product.year} рік</span>\n                    </div>\n                  </div>\n                </motion.div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default FavoritesLike;\n","// SlidingFavorites.tsx\nimport React from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport FavoritesLike from \"./favoritesLike\";\n\ninterface SlidingFavoritesProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst useMediaQuery = (query: string) => {\n  const [matches, setMatches] = React.useState(false);\n\n  React.useEffect(() => {\n    const media = window.matchMedia(query);\n    const listener = () => setMatches(media.matches);\n    media.addEventListener(\"change\", listener);\n    setMatches(media.matches);\n    return () => media.removeEventListener(\"change\", listener);\n  }, [query]);\n\n  return matches;\n};\n\nconst SlidingFavorites: React.FC<SlidingFavoritesProps> = ({ isOpen, onClose }) => {\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          key=\"sliding-favorites\"\n          className=\"fixed inset-0 z-50\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ duration: 0.3 }}\n          onClick={onClose}\n        >\n          {isMobile ? (\n            <motion.div\n              className=\"absolute w-full bg-white shadow-lg overflow-y-auto\"\n              style={{ top: \"4rem\", maxHeight: \"90vh\" }}\n              initial={{ y: \"-100%\" }}\n              animate={{ y: 0 }}\n              exit={{ y: \"-100%\" }}\n              transition={{ duration: 0.5, ease: \"easeInOut\" }}\n              onClick={(e) => e.stopPropagation()}\n            >\n              <FavoritesLike isOpen={isOpen} onClose={onClose} />\n            </motion.div>\n          ) : (\n            <motion.div\n              className=\"absolute right-0 bg-white shadow-lg overflow-y-auto\"\n              style={{ \n                top: \"4rem\",\n                width: \"400px\",\n                maxWidth: \"90vw\",\n                maxHeight: \"90vh\",\n                minHeight: \"150px\"\n              }}\n              initial={{ x: \"100%\", height: 0 }}\n              animate={{ x: 0, height: \"auto\" }}\n              exit={{ x: \"100%\", height: 0 }}\n              transition={{ duration: 0.5, ease: \"easeInOut\" }}\n              onClick={(e) => e.stopPropagation()}\n            >\n              <FavoritesLike isOpen={isOpen} onClose={onClose} />\n            </motion.div>\n          )}\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default SlidingFavorites;","import React, {\n  useState,\n  useEffect,\n  useCallback,\n  memo,\n  useRef,\n} from \"react\";\nimport { Link, useNavigate, useLocation } from \"react-router-dom\";\nimport {\n  motion,\n  AnimatePresence,\n  useAnimation,\n  useMotionValue,\n} from \"framer-motion\";\nimport { RiMenu3Line } from \"react-icons/ri\";\nimport { FiPhone } from \"react-icons/fi\";\nimport { Input } from \"../../../components/ui/input\";\nimport { useCartStore } from \"../../../stores/cartStore\";\nimport { useFavoritesStore } from \"../../../stores/favoritesStore\";\nimport MobileMenu from \"./MobileMenu\";\nimport LogoNavBar from \"./LogoNavBar\";\nimport { supabase } from \"../../../lib/supabaseClient\";\nimport { useIsMobile } from \"../../../hooks/useIsMobile\";\nimport { User } from \"@supabase/supabase-js\";\nimport NavIcons from \"./NavIcons\";\nimport SlidingCart from \"./SlidingCart\";\nimport SlidingFavorites from \"./SlidingFavorites\";\nimport SearchDropdown from \"./SearchDropdown\";\nimport TireCatalogDropdown from \"./TireCatalogDropdown\";\n\nconst MemoizedLogo = memo(LogoNavBar);\n\nconst NavBar: React.FC<{ className?: string }> = ({ className = \"\" }) => {\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isScrolled, setIsScrolled] = useState(() => {\n    const saved = sessionStorage.getItem(\"navbar_isScrolled\");\n    return saved ? JSON.parse(saved) : false;\n  });\n  const [showHeader, setShowHeader] = useState(() => {\n    const saved = sessionStorage.getItem(\"navbar_showHeader\");\n    return saved ? JSON.parse(saved) : true;\n  });\n  // Для переменной, значение которой не используется напрямую, добавляем префикс \"_\"\n  const [_lastScrollY, setLastScrollY] = useState(() => {\n    const saved = sessionStorage.getItem(\"navbar_lastScrollY\");\n    return saved ? Number(saved) : 0;\n  });\n  const [isSearchDropdownOpen, setIsSearchDropdownOpen] = useState(false);\n  const [user, setUser] = useState<User | null>(null);\n  const [isSlidingFavoritesOpen, setIsSlidingFavoritesOpen] = useState(false);\n  const [isSlidingCartOpen, setIsSlidingCartOpen] = useState(false);\n\n  const cartCount: number = useCartStore(\n    (state) => state.items.length,\n    (prev, next) => prev === next\n  );\n  const favoritesCount: number = useFavoritesStore(\n    (state) => state.favorites.length\n  );\n\n  const navigate = useNavigate();\n  const location = useLocation();\n  const searchContainerRef = useRef<HTMLDivElement>(null);\n  const isMobile: boolean = useIsMobile();\n\n  useEffect(() => {\n    (async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      setUser(user);\n    })();\n  }, []);\n\n  const favoritesControl = useAnimation();\n  const cartControl = useAnimation();\n\n  const prevFavoritesRef = useRef<number>(favoritesCount);\n  const prevCartRef = useRef<number>(cartCount);\n\n  useEffect(() => {\n    if (favoritesCount > prevFavoritesRef.current) {\n      favoritesControl\n        .start({ x: -10, transition: { duration: 0.3 } })\n        .then(() =>\n          favoritesControl.start({ x: 0, transition: { duration: 0.3 } })\n        );\n    }\n    prevFavoritesRef.current = favoritesCount;\n  }, [favoritesCount, favoritesControl]);\n\n  useEffect(() => {\n    if (cartCount > prevCartRef.current) {\n      cartControl\n        .start({ x: -10, transition: { duration: 0.3 } })\n        .then(() =>\n          cartControl.start({ x: 0, transition: { duration: 0.3 } })\n        );\n    }\n    prevCartRef.current = cartCount;\n  }, [cartCount, cartControl]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        searchContainerRef.current &&\n        !searchContainerRef.current.contains(event.target as Node)\n      ) {\n        setIsSearchDropdownOpen(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () =>\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, []);\n\n  // Обновление тени навбара – сохраняем состояние в sessionStorage\n  useEffect(() => {\n    const handleScrollShadow = () => {\n      const scrolled = window.scrollY > 50;\n      setIsScrolled(scrolled);\n      sessionStorage.setItem(\"navbar_isScrolled\", JSON.stringify(scrolled));\n    };\n    window.addEventListener(\"scroll\", handleScrollShadow, { passive: true });\n    return () => window.removeEventListener(\"scroll\", handleScrollShadow);\n  }, []);\n\n  // Эффект скрытия/показа навбара (срабатывает при прокрутке свыше 380px)\n  useEffect(() => {\n    const handleScroll = () => {\n      setLastScrollY((prevScrollY) => {\n        const currentScrollY = window.scrollY;\n        if (currentScrollY > prevScrollY && currentScrollY > 380) {\n          setShowHeader(false);\n          sessionStorage.setItem(\"navbar_showHeader\", JSON.stringify(false));\n        } else {\n          setShowHeader(true);\n          sessionStorage.setItem(\"navbar_showHeader\", JSON.stringify(true));\n        }\n        sessionStorage.setItem(\"navbar_lastScrollY\", currentScrollY.toString());\n        return currentScrollY;\n      });\n    };\n\n    window.addEventListener(\"scroll\", handleScroll);\n    return () => window.removeEventListener(\"scroll\", handleScroll);\n  }, []);\n\n  // Инициализируем motionValue исходя из сохранённого состояния showHeader,\n  // чтобы при монтировании компонент отражал актуальное положение (0 для показанного, -100 для скрытого)\n  const yMotion = useMotionValue(showHeader ? 0 : -100);\n\n  // Динамическая анимация смены theme-color в зависимости от состояния навбара\n  useEffect(() => {\n    const metaThemeColor = document.querySelector('meta[name=\"theme-color\"]');\n    if (!metaThemeColor) return;\n\n    const hexToRgb = (hex: string) => {\n      hex = hex.replace(/^#/, \"\");\n      if (hex.length === 3) {\n        hex = hex.split(\"\").map(c => c + c).join(\"\");\n      }\n      const intVal = parseInt(hex, 16);\n      return {\n        r: (intVal >> 16) & 255,\n        g: (intVal >> 8) & 255,\n        b: intVal & 255,\n      };\n    };\n\n    const currentColorHex =\n      metaThemeColor.getAttribute(\"content\") || (showHeader ? \"#1e3fac\" : \"#ffffff\");\n    const currentColor = hexToRgb(currentColorHex);\n    const targetColor = showHeader ? { r: 30, g: 63, b: 172 } : { r: 255, g: 255, b: 255 };\n\n    const duration = 300;\n    const startTime = performance.now();\n\n    const animate = (now: number) => {\n      const elapsed = now - startTime;\n      const ratio = Math.min(elapsed / duration, 1);\n      const r = Math.round(currentColor.r + (targetColor.r - currentColor.r) * ratio);\n      const g = Math.round(currentColor.g + (targetColor.g - currentColor.g) * ratio);\n      const b = Math.round(currentColor.b + (targetColor.b - currentColor.b) * ratio);\n      const newColor = `#${((1 << 24) + (r << 16) + (g << 8) + b)\n        .toString(16)\n        .slice(1)}`;\n      metaThemeColor.setAttribute(\"content\", newColor);\n      if (ratio < 1) {\n        requestAnimationFrame(animate);\n      }\n    };\n\n    requestAnimationFrame(animate);\n  }, [showHeader]);\n\n  const handleCartClick = useCallback(() => {\n    setIsSlidingCartOpen(true);\n  }, []);\n\n  const handleProfileClick = useCallback(() => {\n    if (!user) {\n      navigate(\"/auth\", { state: { from: location.pathname } });\n    } else {\n      navigate(\"/profile\", { state: { from: location.pathname } });\n    }\n  }, [navigate, location.pathname, user]);\n\n  const handleFavoritesClick = useCallback(() => setIsSlidingFavoritesOpen(true), []);\n  \n  const handleSearch = useCallback(\n    (e: React.FormEvent | React.KeyboardEvent) => {\n      e.preventDefault();\n      if (searchQuery.trim()) {\n        navigate(`/search?q=${encodeURIComponent(searchQuery.trim())}`);\n        setIsSearchDropdownOpen(false);\n      }\n    },\n    [searchQuery, navigate]\n  );\n\n  const renderMobileHeaderContent = () => (\n    <div className=\"flex items-center justify-between p-1 h-16 transition-all duration-300\">\n      <div className=\"flex items-center gap-4\">\n        <button\n          onClick={() => setIsMenuOpen(true)}\n          aria-label=\"Открыть меню\"\n          className=\"p-2 bg-transparent rounded-lg transition-transform duration-150 active:scale-150 hover:bg-blue-800 mt-1.5\"\n          style={{ WebkitTapHighlightColor: \"transparent\" }}\n        >\n          <RiMenu3Line className=\"w-6 h-6 text-white\" />\n        </button>\n        <div className=\"-ml-0 pl-2 self-start\">\n          <Link to=\"/\" onClick={() => setIsMenuOpen(false)}>\n            <MemoizedLogo className=\"w-24\" />\n          </Link>\n        </div>\n      </div>\n      <NavIcons\n        variant=\"mobile\"\n        favoritesCount={favoritesCount}\n        cartCount={cartCount}\n        favoritesControl={favoritesControl}\n        cartControl={cartControl}\n        onSearchClick={() => setIsSearchDropdownOpen(true)}\n        onFavoritesClick={handleFavoritesClick}\n        onCartClick={handleCartClick}\n        onProfileClick={handleProfileClick}\n        isAuthenticated={Boolean(user)}\n      />\n    </div>\n  );\n\n  return (\n    <>\n      {/* Десктопная версия */}\n      <div className=\"hidden lg:block bg-[#1e3fac] text-white\">\n        <div className=\"mx-auto px-2 w-[960px]\">\n          <div className=\"flex items-center justify-between py-2 text-xs border-b border-white/10\">\n            <nav className=\"flex items-center gap-4\">\n              <Link\n                to=\"/delivery\"\n                className=\"text-white hover:text-yellow-300 transition-colors\"\n              >\n                Доставка і оплата\n              </Link>\n              <Link\n                to=\"/warranty\"\n                className=\"text-white hover:text-yellow-300 transition-colors\"\n              >\n                Гарантія\n              </Link>\n              <Link\n                to=\"/contacts\"\n                className=\"text-white hover:text-yellow-300 transition-colors\"\n              >\n                Контакти\n              </Link>\n              <Link\n                to=\"/promotions\"\n                className=\"text-white hover:text-yellow-300 transition-colors\"\n              >\n                Акції\n              </Link>\n              <Link\n                to=\"/articles\"\n                className=\"text-white hover:text-yellow-300 transition-colors\"\n              >\n                Статті\n              </Link>\n              <Link\n                to=\"/about\"\n                className=\"text-white hover:text-yellow-300 transition-colors\"\n              >\n                Про нас\n              </Link>\n            </nav>\n            <div className=\"flex items-center gap-4\">\n              <a\n                href=\"tel:09307594003\"\n                className=\"text-yellow-300 hover:text-yellow-400 flex items-center gap-1\"\n              >\n                <FiPhone className=\"w-3 h-3\" />\n                0930759403\n              </a>\n              <button className=\"px-2 py-1 text-yellow-300 hover:text-yellow-400 transition-colors\">\n                Замовити дзвінок\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <motion.header\n        style={{ y: yMotion }}\n        animate={{ y: showHeader ? 0 : -100 }}\n        transition={{ duration: 0.3 }}\n        className={`bg-[#1e3fac] text-white z-50 sticky top-0 transition-shadow duration-300 ${className} ${isScrolled ? \"shadow-md\" : \"\"}`}\n      >\n        <div className=\"hidden lg:block\">\n          <div className=\"mx-auto px-2 w-[960px]\">\n            <div className=\"flex items-center justify-between h-16 py-2\">\n              <div className=\"flex items-center gap-4\">\n                <Link to=\"/\" className=\"flex items-center\">\n                  <MemoizedLogo className=\"w-28\" align=\"left\" />\n                </Link>\n                <TireCatalogDropdown />\n              </div>\n              <div className=\"relative w-96\" ref={searchContainerRef}>\n                <Input\n                  type=\"search\"\n                  placeholder=\"Пошук\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  onFocus={() => setIsSearchDropdownOpen(true)}\n                  onKeyDown={(e) => e.key === \"Enter\" && handleSearch(e)}\n                  className=\"pl-3 bg-white/10 border-white/20 placeholder:text-white/60\"\n                />\n                <AnimatePresence>\n                  {isSearchDropdownOpen && !isMobile && (\n                    <SearchDropdown\n                      onClose={() => setIsSearchDropdownOpen(false)}\n                      externalFilter={searchQuery}\n                      onSearchChange={setSearchQuery}\n                    />\n                  )}\n                </AnimatePresence>\n              </div>\n              <NavIcons\n                variant=\"desktop\"\n                favoritesCount={favoritesCount}\n                cartCount={cartCount}\n                favoritesControl={favoritesControl}\n                cartControl={cartControl}\n                onSearchClick={() => {}}\n                onFavoritesClick={handleFavoritesClick}\n                onCartClick={handleCartClick}\n                onProfileClick={handleProfileClick}\n                isAuthenticated={Boolean(user)}\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Мобильная версия */}\n        <div className=\"lg:hidden relative\" ref={searchContainerRef}>\n          <motion.div\n            animate={{ opacity: isMenuOpen ? 0 : 1 }}\n            transition={{ duration: 0.3 }}\n          >\n            {renderMobileHeaderContent()}\n          </motion.div>\n          <AnimatePresence>\n            {isMobile && isSearchDropdownOpen && (\n              <SearchDropdown\n                onClose={() => setIsSearchDropdownOpen(false)}\n                externalFilter={searchQuery}\n                onSearchChange={setSearchQuery}\n              />\n            )}\n          </AnimatePresence>\n        </div>\n      </motion.header>\n\n      {isSearchDropdownOpen && !isMobile && (\n        <div\n          className=\"fixed inset-0 z-40\"\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            setIsSearchDropdownOpen(false);\n          }}\n        />\n      )}\n\n      {isMobile && (\n        <MobileMenu\n          isOpen={isMenuOpen}\n          onClose={() => setIsMenuOpen(false)}\n          onProfileClick={handleProfileClick}\n          onFavoritesClick={handleFavoritesClick}\n          onCartClick={handleCartClick}\n          favoritesCount={favoritesCount}\n          cartCount={cartCount}\n          isAuthenticated={Boolean(user)}\n        />\n      )}\n\n      <SlidingCart\n        isOpen={isSlidingCartOpen}\n        onClose={() => setIsSlidingCartOpen(false)}\n      />\n      <SlidingFavorites\n        isOpen={isSlidingFavoritesOpen}\n        onClose={() => setIsSlidingFavoritesOpen(false)}\n      />\n    </>\n  );\n};\n\nexport default memo(NavBar);\n","import { cva } from \"class-variance-authority\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 active:!transition-transform active:!duration-150\",\n  {\n    variants: {\n      variant: {\n        default: \n          \"bg-primary text-primary-foreground shadow hover:bg-primary/90 active:bg-primary/80\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90 active:bg-destructive/80\",\n        outline:\n          \"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground active:bg-accent/50 active:text-accent-foreground/90\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80 active:bg-secondary/70\",\n        ghost: \n          \"hover:bg-accent hover:text-accent-foreground active:bg-accent/50 active:text-accent-foreground/90\",\n        link: \n          \"text-primary underline-offset-4 hover:underline active:text-primary/70\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 text-xs\",\n        lg: \"h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport { buttonVariants }","import { forwardRef } from \"react\"\nimport { buttonVariants } from \"./button.constants\"\nimport { cn } from \"../../lib/utils\"\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: \"default\" | \"destructive\" | \"outline\" | \"secondary\" | \"ghost\" | \"link\";\n  size?: \"default\" | \"sm\" | \"lg\" | \"icon\";\n}\n\nconst Button = forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant = \"default\", size = \"default\", style, ...props }, ref) => {\n    return (\n      <button\n        // Добавляем свойство для отключения стандартного эффекта выделения на мобильных устройствах\n        style={{ WebkitTapHighlightColor: \"transparent\", ...style }}\n        className={cn(\n          buttonVariants({ variant, size, className }),\n          \"active:scale-[0.98]\"\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button }\n","import * as React from \"react\";\nimport { ChevronDown } from \"lucide-react\";\nimport { cn } from \"../../lib/utils\";\n\n// Функция throttle для ограниченного вызова функции\nfunction throttle<T extends (...args: unknown[]) => void>(\n  func: T,\n  limit: number\n): T {\n  let inThrottle = false;\n  return function (...args: Parameters<T>): void {\n    if (!inThrottle) {\n      func(...args);\n      inThrottle = true;\n      setTimeout(() => {\n        inThrottle = false;\n      }, limit);\n    }\n  } as T;\n}\n\n// Функция для подсветки совпадающих частей текста\nfunction highlightText(text: string, searchTerm: string): React.ReactNode[] {\n  if (!searchTerm) return [text];\n  const regex = new RegExp(`(${searchTerm})`, \"gi\");\n  const parts = text.split(regex);\n  return parts.map((part, index) =>\n    regex.test(part) ? (\n      <span key={index} className=\"bg-yellow-200\">\n        {part}\n      </span>\n    ) : (\n      part\n    )\n  );\n}\n\nexport interface SelectProps extends React.HTMLAttributes<HTMLDivElement> {\n  multiple?: boolean;\n  value?: string | string[];\n  onValueChange?: (value: string | string[]) => void;\n  placeholder?: string;\n  children: React.ReactNode;\n  className?: string;\n  disabled?: boolean;\n  displayValue?: (value: string[]) => string;\n}\n\nexport function Select({\n  multiple = false,\n  value,\n  onValueChange,\n  placeholder,\n  children,\n  className,\n  disabled = false,\n  displayValue,\n  ...rest\n}: SelectProps) {\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [dropdownDirection, setDropdownDirection] = React.useState<\"up\" | \"down\">(\"down\");\n  const [searchTerm, setSearchTerm] = React.useState(\"\");\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const buttonRef = React.useRef<HTMLButtonElement>(null);\n  const inputRef = React.useRef<HTMLInputElement>(null);\n\n  const handleSelect = (newValue: string) => {\n    if (multiple) {\n      const currentValue = Array.isArray(value) ? value : [];\n      const newValues = currentValue.includes(newValue)\n        ? currentValue.filter((v) => v !== newValue)\n        : [...currentValue, newValue];\n      onValueChange?.(newValues);\n    } else {\n      onValueChange?.(newValue);\n      setIsOpen(false);\n    }\n  };\n\n  // Закрытие выпадающего списка при клике вне контейнера, включая нажатие на другие кнопки\n  React.useEffect(() => {\n    const handleClickOutside = (event: MouseEvent | TouchEvent) => {\n      if (\n        containerRef.current && \n        !containerRef.current.contains(event.target as Node) &&\n        inputRef.current !== event.target &&\n        !inputRef.current?.contains(event.target as Node)\n      ) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    document.addEventListener(\"touchstart\", handleClickOutside); // Для мобильных устройств\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n      document.removeEventListener(\"touchstart\", handleClickOutside);\n    };\n  }, []);\n\n  // Закрытие списка при скролле (только на десктопе)\n  React.useEffect(() => {\n    const handleScroll = () => {\n      if (isOpen && window.innerWidth >= 768) {\n        setIsOpen(false);\n      }\n    };\n    window.addEventListener(\"scroll\", handleScroll);\n    return () => window.removeEventListener(\"scroll\", handleScroll);\n  }, [isOpen]);\n\n  const recalcDropdownDirection = React.useCallback(() => {\n    if (containerRef.current && isOpen) {\n      const rect = containerRef.current.getBoundingClientRect();\n      const spaceBelow = window.innerHeight - rect.bottom;\n      setDropdownDirection(spaceBelow < 200 ? \"up\" : \"down\");\n    }\n  }, [isOpen]);\n\n  React.useEffect(() => {\n    recalcDropdownDirection();\n  }, [isOpen, recalcDropdownDirection]);\n\n  React.useEffect(() => {\n    const handleResize = throttle(() => recalcDropdownDirection(), 100);\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, [recalcDropdownDirection]);\n\n  const displayText =\n    multiple && Array.isArray(value)\n      ? value.length > 0\n        ? displayValue?.(value) ?? value.join(\", \")\n        : placeholder\n      : (value as string) || placeholder;\n\n  // Фильтрация элементов по введённому тексту\n  const filteredChildren = React.Children.toArray(children).filter((child) => {\n    if (React.isValidElement(child)) {\n      const text = String(child.props.children).toLowerCase();\n      return text.includes(searchTerm.toLowerCase());\n    }\n    return true;\n  });\n  // Если поиск не ведётся и элементов больше 6 – показываем только первые 6\n  const displayedChildren =\n    searchTerm === \"\" && filteredChildren.length > 6\n      ? filteredChildren.slice(0, 6)\n      : filteredChildren;\n\n  const renderedChildren = React.Children.map(displayedChildren, (child) => {\n    if (\n      React.isValidElement(child) &&\n      (child.type as React.ComponentType).displayName === \"SelectItem\"\n    ) {\n      const childValue = child.props.value;\n      const isSelected = multiple\n        ? Array.isArray(value) && value.includes(childValue)\n        : value === childValue;\n      \n      // Подсветка совпадающих частей текста, если ведётся поиск\n      let newChildren = child.props.children;\n      if (typeof newChildren === \"string\" && searchTerm.trim() !== \"\") {\n        newChildren = highlightText(newChildren, searchTerm);\n      }\n      \n      return React.cloneElement(child as React.ReactElement<SelectItemProps>, {\n        onSelect: () => handleSelect(childValue),\n        isSelected,\n        children: newChildren,\n      });\n    }\n    return child;\n  });\n\n  return (\n    <div ref={containerRef} className=\"relative\" {...rest}>\n      <button\n        ref={buttonRef}\n        type=\"button\"\n        role=\"combobox\"\n        aria-expanded={isOpen}\n        aria-disabled={disabled}\n        onClick={(e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          if (!disabled) {\n            setIsOpen(!isOpen);\n            setSearchTerm(\"\"); // сброс поиска при открытии\n          }\n        }}\n        className={cn(\n          \"flex h-9 w-full items-center justify-between rounded-md border\",\n          \"border-input bg-transparent px-3 py-2 text-sm shadow-sm\",\n          \"ring-offset-background placeholder:text-muted-foreground\",\n          \"focus:outline-none focus:ring-1 focus:ring-ring\",\n          \"disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        disabled={disabled}\n      >\n        <span className=\"truncate\">{displayText}</span>\n        <ChevronDown\n          className={cn(\"h-4 w-4 opacity-50 transition-transform\", isOpen && \"rotate-180\")}\n        />\n      </button>\n      \n      {isOpen && (\n        <div\n          role=\"listbox\"\n          className={cn(\n            \"absolute z-50 w-full rounded-md border shadow-lg animate-in fade-in-80\",\n            dropdownDirection === \"down\" ? \"mt-1\" : \"bottom-full mb-1\",\n            \"bg-white\"\n          )}\n        >\n          <div className=\"p-2\">\n            {/* Окно поиска с предотвращением закрытия при клике на него */}\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              onClick={(e) => e.stopPropagation()}\n              onMouseDown={(e) => e.stopPropagation()}\n              onTouchStart={(e) => e.stopPropagation()} // Для мобильных устройств\n              onTouchMove={(e) => e.stopPropagation()} // Для предотвращения закрытия при движении пальца\n              placeholder=\"Пошук...\"\n              className=\"mb-2 w-full border p-3 text-xs\"\n            />\n            {/* Список опций с ограниченной высотой (первые 6 элементов видны, остальное – скролл) */}\n            <div className=\"max-h-48 overflow-y-auto\">\n              {renderedChildren}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface SelectItemProps extends React.HTMLAttributes<HTMLDivElement> {\n  value: string;\n  onSelect?: () => void;\n  isSelected?: boolean;\n  disabled?: boolean;\n}\n\nexport const SelectItem = React.forwardRef<HTMLDivElement, SelectItemProps>(\n  ({ className, children, onSelect, isSelected, disabled = false, ...props }, ref) => (\n    <div\n      role=\"option\"\n      aria-selected={isSelected}\n      aria-disabled={disabled}\n      ref={ref}\n      className={cn(\n        \"relative flex cursor-default select-none items-center py-1.5 pl-8 pr-2 text-xs\",\n        \"outline-none focus:bg-accent focus:text-accent-foreground\",\n        \"transition-colors duration-200\",\n        isSelected && \"bg-accent font-medium\",\n        disabled && \"opacity-50 pointer-events-none\",\n        className\n      )}\n      onClick={\n        !disabled\n          ? (e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              onSelect?.();\n            }\n          : undefined\n      }\n      {...props}\n    >\n      {isSelected && <span className=\"absolute left-2 text-xs text-current\">✓</span>}\n      {children}\n    </div>\n  )\n);\nSelectItem.displayName = \"SelectItem\";\n\nexport const MemoSelectItem = React.memo(SelectItem);\n","import { v4 as uuidv4 } from 'uuid';\nimport { supabase } from './supabaseClient';\n\n// Функция для генерации уникального имени файла (ТОЛЬКО UUID + расширение)\nconst generateUniqueFileName = (file: File): string => {\n  const extension = file.name.split('.').pop(); // Получаем расширение файла\n  return `${uuidv4()}${extension ? `.${extension}` : ''}`; // Формат: uuid.ext\n};\n\nexport const uploadFile = async (\n  file: File,\n  bucket: string,\n  folder: string\n) => {\n  const fileName = generateUniqueFileName(file);\n  \n  const { data, error } = await supabase.storage\n    .from(bucket)\n    .upload(`${folder}/${fileName}`, file, {\n      cacheControl: '3600',\n      upsert: false\n    });\n\n  if (error) throw error;\n  return { ...data, fileName };\n};\n\nexport const getPublicUrl = (bucket: string, path: string) => {\n  const { data } = supabase.storage\n    .from(bucket)\n    .getPublicUrl(path, {\n      download: false\n    });\n  \n  return data.publicUrl;\n};","import React, { useState, useRef, useEffect, useMemo, useCallback } from \"react\";\nimport { Button } from \"../components/ui/button\";\nimport { Select, SelectItem } from \"../components/ui/select\";\nimport { supabase } from \"../lib/supabaseClient\";\nimport { getPublicUrl } from '../lib/storage';\nimport { useNavigate } from \"react-router-dom\";\nimport { useQuery } from \"@tanstack/react-query\";\n\ntype FilterType = \"width\" | \"profile\" | \"diameter\" | \"season\" | \"brand\";\n\n// Интерфейс для динамически загружаемых опций фильтров\ntype DynamicFilterOptions = Record<FilterType, string[]>;\n\nconst filterLabels: Record<FilterType, string> = {\n  width: \"Ширина\",\n  profile: \"Профіль\",\n  diameter: \"Діаметр\",\n  season: \"Сезон\",\n  brand: \"Бренд\",\n};\n\n// Маппинг для перевода значений сезона на украинский\nconst seasonMapping: Record<string, string> = {\n  summer: \"Літній\",\n  winter: \"Зимній\",\n  \"all-season\": \"Всесезонний\",\n};\n\n// Функция для загрузки фильтров из базы через Supabase\nconst fetchDynamicFilters = async (): Promise<DynamicFilterOptions> => {\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"width, profile, diameter, season, brand\");\n  if (error) throw new Error(error.message);\n  if (data && data.length > 0) {\n    const widths = Array.from(\n      new Set(\n        data\n          .map((item) => item.width)\n          .filter((val) => val !== null)\n          .map((val) => Number(val))\n      )\n    )\n      .filter((val) => !isNaN(val))\n      .sort((a, b) => a - b)\n      .map(String);\n    const profiles = Array.from(\n      new Set(\n        data\n          .map((item) => item.profile)\n          .filter((val) => val !== null)\n          .map((val) => Number(val))\n      )\n    )\n      .filter((val) => !isNaN(val))\n      .sort((a, b) => a - b)\n      .map(String);\n    const diameters = Array.from(\n      new Set(\n        data\n          .map((item) => item.diameter)\n          .filter((val) => val !== null)\n          .map((val) => Number(val))\n      )\n    )\n      .filter((val) => !isNaN(val))\n      .sort((a, b) => a - b)\n      .map(String);\n    const seasons = Array.from(\n      new Set(data.map((item) => item.season).filter(Boolean))\n    ).sort((a, b) => a.localeCompare(b));\n    const brands = Array.from(\n      new Set(data.map((item) => item.brand).filter(Boolean))\n    ).sort((a, b) => a.localeCompare(b));\n\n    return {\n      width: widths,\n      profile: profiles,\n      diameter: diameters,\n      season: seasons,\n      brand: brands,\n    };\n  }\n  return { width: [], profile: [], diameter: [], season: [], brand: [] };\n};\n\nexport const HeroSection: React.FC<{ \n  className?: string;\n  shouldAnimate?: boolean;\n}> = ({ className, shouldAnimate = false }) => {\n  const navigate = useNavigate();\n  const heroRef = useRef<HTMLDivElement>(null);\n\n  // Состояние для выбранных значений фильтров\n  const [quickFilters, setQuickFilters] = useState<Record<FilterType, string[]>>({\n    width: [],\n    profile: [],\n    diameter: [],\n    season: [],\n    brand: [],\n  });\n\n  // Загрузка динамических опций фильтров через React Query\n  const { data: dynamicOptions, isLoading, error, refetch } = useQuery<DynamicFilterOptions>({\n    queryKey: [\"dynamicFilters\"],\n    queryFn: fetchDynamicFilters,\n    staleTime: 6 * 60 * 60 * 1000,    \n    initialData: { \n      width: [], \n      profile: [], \n      diameter: [], \n      season: [], \n      brand: [] \n    },\n  });\n  \n  useEffect(() => {\n    if (dynamicOptions && !dynamicOptions.width.length) {\n      refetch();\n    }\n  }, [dynamicOptions, refetch]);\n\n  // Состояние для отображаемых опций с пагинацией (начинаем с первых 6 элементов)\n  const [visibleOptions, setVisibleOptions] = useState<DynamicFilterOptions>({\n    width: [],\n    profile: [],\n    diameter: [],\n    season: [],\n    brand: [],\n  });\n\n  useEffect(() => {\n    if (dynamicOptions) {\n      setVisibleOptions({\n        width: dynamicOptions.width.slice(0, 6),\n        profile: dynamicOptions.profile.slice(0, 6),\n        diameter: dynamicOptions.diameter.slice(0, 6),\n        season: dynamicOptions.season.slice(0, 6),\n        brand: dynamicOptions.brand.slice(0, 6),\n      });\n    }\n  }, [dynamicOptions]);\n\n  // Обработчик выбора опций фильтра\n  const handleFilterSelect = useCallback(\n    (filterType: FilterType, values: string[]) => {\n      setQuickFilters((prev) => ({ ...prev, [filterType]: values }));\n    },\n    []\n  );\n\n  // Быстрый поиск по выбранным фильтрам\n  const handleQuickSearch = useCallback(() => {\n    const params = new URLSearchParams();\n    Object.entries(quickFilters).forEach(([key, values]) => {\n      if (values.length > 0) params.set(key, values.join(\",\"));\n    });\n    if (!params.toString().length) {\n      alert(\"Виберіть хоча б один параметр для пошуку\");\n      return;\n    }\n    navigate(`/search-results?${params.toString()}`);\n  }, [quickFilters, navigate]);\n\n  const handleDetailedSearch = useCallback(() => {\n    navigate(\"/detailed-search\");\n  }, [navigate]);\n\n  const [isDesktop, setIsDesktop] = useState(window.innerWidth >= 768);\n  useEffect(() => {\n    const handleResize = () => setIsDesktop(window.innerWidth >= 768);\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n\n  const imageUrl = useMemo(() => {\n    // Используем функцию getPublicUrl для получения ссылки на фон\n    const url = getPublicUrl('Fon', import.meta.env.VITE_BACKGROUND_IMAGE_NAME);\n    console.log('Background image URL:', url); // Для отладки\n    return url;\n  }, []);\n\n  useEffect(() => {\n    const img = new Image();\n    img.src = imageUrl;\n  }, [imageUrl]);\n\n  const backgroundStyle = useMemo(\n    () => ({\n      backgroundImage: `linear-gradient(\n        to bottom,\n        rgba(30,63,172,1) 0%,\n        rgba(30,63,172,0.7) 30%,\n        rgba(30,63,172,0.3) 150%,\n        rgba(30,63,172,1) 180%\n      ), url(${imageUrl})`,\n      backgroundSize: \"cover\",\n      backgroundPosition: \"center\",\n      backgroundRepeat: \"no-repeat\",\n      height: isDesktop ? \"280px\" : \"320px\",\n    }),\n    [imageUrl, isDesktop]\n  );\n\n  if (isLoading) {\n    return (\n      <section\n        ref={heroRef}\n        className={`relative min-h-[200px] max-h-[400px] ${className || \"\"} ${shouldAnimate ? \"fade-in\" : \"\"}`}\n        style={backgroundStyle}\n      >\n        <div className=\"container mx-auto px-4 h-full flex items-center justify-center\">\n          <div>Загрузка фільтрів...</div>\n        </div>\n      </section>\n    );\n  }\n\n  if (error) {\n    console.error(\"Error loading dynamic filters:\", error);\n  }\n\n  const filters: FilterType[] = [\"width\", \"profile\", \"diameter\", \"season\", \"brand\"];\n\n  return (\n    <section\n      ref={heroRef}\n      className={`relative min-h-[200px] max-h-[400px] ${className || \"\"} ${shouldAnimate ? \"fade-in\" : \"\"}`}\n      style={backgroundStyle}\n    >\n      <div className=\"container mx-auto px-4 h-full flex items-center justify-center\">\n        <div className=\"w-full md:max-w-[600px] mx-auto\">\n          {/* Мобильная версия */}\n          <div className=\"block md:hidden\">\n            <div className=\"mb-4 grid grid-cols-2 gap-0 sm:grid-cols-3 md:grid-cols-7\">\n              {filters.map((filter) => {\n                let extraClasses = \"rounded-none\";\n                if (filter === \"width\") extraClasses = \"rounded-none rounded-tl-xl\";\n                else if (filter === \"profile\") extraClasses = \"rounded-none rounded-tr-xl\";\n\n                return (\n                  <div key={filter} className={`relative ${filter === \"brand\" ? \"col-span-2 sm:col-span-1\" : \"\"}`}>\n                    <Select\n                      multiple\n                      value={quickFilters[filter]}\n                      onValueChange={(newValue) => handleFilterSelect(filter, newValue as string[])}\n                      placeholder={filterLabels[filter]}\n                      className={`bg-white text-gray-500 hover:bg-gray-100 transition-colors active:!bg-gray-100 active:!opacity-100 \n                        px-8 py-3 text-base sm:px-8 sm:py-3 sm:text-sm h-auto min-w-[120px] w-full ${extraClasses}`}\n                      // Для фильтра \"season\" отображаем выбранные значения по-украински\n                      {...(filter === \"season\"\n                        ? {\n                            displayValue: (values: string[]) =>\n                              values.map((val) => seasonMapping[val.toLowerCase()] || val).join(\", \"),\n                          }\n                        : {})}\n                    >\n                      {visibleOptions[filter].map((option: string) => (\n                        <SelectItem key={option} value={option}>\n                          {filter === \"season\"\n                            ? seasonMapping[option.toLowerCase()] || option\n                            : option}\n                        </SelectItem>\n                      ))}\n                    </Select>\n                  </div>\n                );\n              })}\n              {/* Поменяли местами кнопки: сначала Детальний пошук, затем Підібрати */}\n              <div className=\"relative\">\n                <Button\n                  onClick={handleDetailedSearch}\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white/90 \n                    px-6 py-2 text-base sm:px-8 sm:py-2 sm:text-sm h-auto min-w-[120px] w-full flex items-center justify-center \n                    rounded-none rounded-bl-xl active:!bg-blue-800 active:!opacity-100\"\n                >\n                  Детальний пошук\n                </Button>\n              </div>\n              <div className=\"relative\">\n                <Button\n                  onClick={handleQuickSearch}\n                  className=\"bg-green-600 hover:bg-green-700 text-white/90 \n                    px-6 py-2 text-base sm:px-8 sm:py-2 sm:text-sm h-auto min-w-[120px] w-full flex items-center justify-center \n                    rounded-none rounded-br-xl active:!bg-green-800 active:!opacity-100\"\n                >\n                  Підібрати\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Десктоп и планшет версия */}\n          <div className=\"hidden md:block\">\n            <div className=\"grid grid-cols-5 gap-0\">\n              {filters.map((filter) => {\n                let extraClasses = \"rounded-none min-h-[56px]\";\n                if (filter === \"width\") extraClasses = \"rounded-none rounded-tl-xl min-h-[56px]\";\n                else if (filter === \"brand\") extraClasses = \"rounded-none rounded-tr-xl min-h-[56px]\";\n\n                return (\n                  <div key={filter} className=\"relative\">\n                    <Select\n                      multiple\n                      value={quickFilters[filter]}\n                      onValueChange={(newValue) => handleFilterSelect(filter, newValue as string[])}\n                      placeholder={filterLabels[filter]}\n                      className={`bg-white text-gray-500 hover:bg-gray-300 transition-colors active:!bg-gray-100 active:!opacity-100 \n                        px-4 py-2 text-base w-full flex items-center justify-center ${extraClasses}`}\n                      {...(filter === \"season\"\n                        ? {\n                            displayValue: (values: string[]) =>\n                              values.map((val) => seasonMapping[val.toLowerCase()] || val).join(\", \"),\n                          }\n                        : {})}\n                    >\n                      {visibleOptions[filter].map((option: string) => (\n                        <SelectItem key={option} value={option}>\n                          {filter === \"season\"\n                            ? seasonMapping[option.toLowerCase()] || option\n                            : option}\n                        </SelectItem>\n                      ))}\n                    </Select>\n                  </div>\n                );\n              })}\n            </div>\n            {/* Поменяли кнопки местами */}\n            <div className=\"flex\">\n              <Button\n                onClick={handleDetailedSearch}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white/90 \n                  px-6 py-2 text-base w-1/2 flex items-center justify-center \n                  rounded-none rounded-bl-xl active:!bg-blue-800 active:!opacity-100\"\n              >\n                Детальний пошук\n              </Button>\n              <Button\n                onClick={handleQuickSearch}\n                className=\"bg-green-600 hover:bg-green-700 text-white/90 \n                  px-6 py-2 text-base w-1/2 flex items-center justify-center \n                  rounded-none rounded-br-xl active:!bg-green-800 active:!opacity-100\"\n              >\n                Підібрати\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default HeroSection;\n","import React, {\n  useState,\n  useEffect,\n  useRef,\n  useCallback,\n  useMemo,\n  memo\n} from 'react';\nimport { Heart, Star } from 'lucide-react';\nimport ReactCountryFlag from 'react-country-flag';\nimport { Button } from \"../components/ui/button\";\nimport { useCartStore } from '../stores/cartStore';\nimport { useFavoritesStore } from '../stores/favoritesStore';\nimport { supabase } from '../lib/supabaseClient';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { useIsMobile } from '../hooks/useIsMobile';\nimport { useNavigate, Link } from 'react-router-dom';\nimport Stock from '../components/icons/StockIcons';\nimport CustomCarIcon from '../components/icons/CustomCarIcon';\nimport GasPumpIcon from '../components/icons/GasPumpIcon';\nimport CloudRainIcon from '../components/icons/CloudRainIcon';\nimport VolumIcon from '../components/icons/VolumIcon';\nimport SnowflakeIcon from '../components/icons/SnowflakeIcon';\nimport SunIcon from '../components/icons/SunIcon';\nimport SnowSunIcon from '../components/icons/SnowSunIcon';\nimport MessageCircle from '../components/icons/MessageCircle';\nimport DiscountIcon from '../components/icons/Discount';\nimport { debounce } from 'lodash-es';\n\n// Компонент TooltipIcon для отображения подсказки с тенью на стрелочке\nconst TooltipIcon = ({\n  tooltip,\n  children\n}: {\n  tooltip: string;\n  children: React.ReactNode;\n}) => {\n  const isMobile = useIsMobile();\n  const [visible, setVisible] = useState(false);\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const [offsetX, setOffsetX] = useState(0);\n\n  // Генерируем уникальный идентификатор для данного тултипа\n  const tooltipIdRef = useRef<number>(Date.now() + Math.random());\n\n  const handleMouseEnter = (_e: React.MouseEvent) => {\n    if (!isMobile) setVisible(true);\n  };\n\n  const handleMouseLeave = (_e: React.MouseEvent) => {\n    if (!isMobile) setVisible(false);\n  };\n\n  const handleClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (isMobile) {\n      // Если подсказка закрыта – открываем её и уведомляем все остальные\n      if (!visible) {\n        window.dispatchEvent(new CustomEvent('tooltip:open', { detail: tooltipIdRef.current }));\n        setVisible(true);\n      } else {\n        setVisible(false);\n      }\n    }\n  };\n\n  // Закрытие подсказки через 2 секунды в мобильной версии\n  useEffect(() => {\n    if (isMobile && visible) {\n      const timer = setTimeout(() => setVisible(false), 2000);\n      return () => clearTimeout(timer);\n    }\n  }, [isMobile, visible]);\n\n  // Слушатель события для закрытия подсказок, если открывается другая\n  useEffect(() => {\n    const handleTooltipOpen = (e: CustomEvent) => {\n      if (e.detail !== tooltipIdRef.current) {\n        setVisible(false);\n      }\n    };\n    window.addEventListener('tooltip:open', handleTooltipOpen as EventListener);\n    return () => {\n      window.removeEventListener('tooltip:open', handleTooltipOpen as EventListener);\n    };\n  }, []);\n\n  // Пересчёт смещения подсказки, если она близко к краям окна\n  useEffect(() => {\n    if (visible && tooltipRef.current) {\n      const tooltipRect = tooltipRef.current.getBoundingClientRect();\n      let newOffset = 0;\n      const padding = 4;\n      if (tooltipRect.left < padding) {\n         newOffset = padding - tooltipRect.left;\n      } else if (tooltipRect.right > window.innerWidth - padding) {\n         newOffset = window.innerWidth - padding - tooltipRect.right;\n      }\n      setOffsetX(newOffset);\n    }\n  }, [visible]);\n\n  return (\n    <div\n      className=\"relative inline-block\"\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n      onClick={handleClick}\n    >\n      {children}\n      {visible && (\n        <div\n          className=\"absolute bottom-full left-1/2 z-20\"\n          ref={tooltipRef}\n          style={{ transform: `translateX(calc(-50% + ${offsetX}px))` }}\n        >\n          <div className=\"bg-white text-black text-xs px-2 py-1 rounded shadow whitespace-nowrap\">\n            {tooltip}\n          </div>\n          <div className=\"flex justify-center\">\n            <svg\n              className=\"w-2 h-2 fill-current text-white\"\n              style={{ filter: 'drop-shadow(0 1px 2px rgba(0,0,0,0.2))' }}\n              viewBox=\"0 0 4 4\"\n            >\n              <polygon points=\"0,0 4,0 2,2\" />\n            </svg>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport interface ProductCardProps {\n  id: string;\n  brand: string;\n  model: string;\n  price: number;\n  oldPrice?: number | null;\n  discount?: number;\n  image?: string[];\n  'data-images'?: string[];\n  specs: {\n    noise?: number | null;\n    size?: string;\n    profile?: number;\n    season?: 'winter' | 'summer' | 'all-season';\n    width?: number;\n    offset?: string;\n    diameter?: number;\n    load_index?: string;\n    speed_index?: string;\n    wheel_width?: number;\n    spikes?: boolean;\n    fuel_Efficiency?: string;\n    wetGrip?: string;\n  };\n  year: number;\n  country: string;\n  articleNumber: string;\n  productType?: 'tire' | 'wheel';\n  commentCount?: number;\n  initialRating: number;\n  imageHeight?: string;\n  iconSize?: 4 | 6 | 8;\n  heartSize?: 4 | 6 | 8;\n  className?: string;\n  previewImage?: JSX.Element;\n  isFavoritesView?: boolean;\n  onRemoveFavorite?: () => void;\n  showAvailability?: boolean;\n  discountIconClass?: string;\n  heartClass?: string;\n}\n\ninterface TouchInfo {\n  startTime: number;\n  startX: number;\n  startY: number;\n  moved: boolean;\n}\n\nconst sizeClasses = {\n  4: 'w-4 h-4',\n  6: 'w-6 h-6',\n  8: 'w-8 h-8',\n} as const;\n\nconst optimizeImage = (url: string, width: number) =>\n  `${url}?width=${width}&format=webp&quality=85`;\n\nexport const ProductCard = memo(function ProductCard({\n  id,\n  brand,\n  model,\n  price,\n  oldPrice,\n  discount,\n  image = [],\n  'data-images': dataImages = [],\n  specs,\n  year,\n  country,\n  articleNumber,\n  productType,\n  commentCount = 0,\n  initialRating = 0,\n  imageHeight = \"h-36\",\n  iconSize = 4,\n  heartSize = 6,\n  className,\n  previewImage,\n  showAvailability = true,\n  discountIconClass,\n  heartClass,\n}: ProductCardProps) {\n  const queryClient = useQueryClient();\n  const addItem = useCartStore(state => state.addItem);\n  const favorites = useFavoritesStore((state) => state.favorites);\n  const toggleFavorite = useFavoritesStore((state) => state.toggleFavorite);\n  const isMobile = useIsMobile();\n  const navigate = useNavigate();\n\n  // Предзагрузка изображений и выборка данных товара\n  const preloadImages = useCallback((urls: string[]) => {\n    urls.forEach(url => {\n      const img = new Image();\n      img.src = `${url}?width=300`;\n      img.loading = 'eager';\n      img.decoding = 'async';\n    });\n  }, []);\n\n  const fetchProductDetails = async (productId: string) => {\n    const { data, error } = await supabase\n      .from('products')\n      .select('*')\n      .eq('id', productId)\n      .single();\n    if (error) {\n      throw new Error(error.message);\n    }\n    return data;\n  };\n\n  const prefetchProduct = useCallback(() => {\n    queryClient.prefetchQuery({\n      queryKey: ['product', id],\n      queryFn: () => {\n        preloadImages(dataImages.slice(0, 2));\n        return fetchProductDetails(id);\n      }\n    });\n  }, [id, dataImages, queryClient, preloadImages]);\n\n  const prefetchProductDetails = useCallback(() => {\n    import('../pages/ProductDetail');\n  }, []);\n\n  // ------------------------------------------------------------------------------\n\n  const imagesToLoad = useMemo(() => {\n    const imgs = image.length > 0 ? image : dataImages;\n    return imgs.map((img) => optimizeImage(img, 300));\n  }, [image, dataImages]);\n\n  const [rating, setRating] = useState(initialRating);\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n  const [isHovered, setIsHovered] = useState(false);\n  const [discountHovered, setDiscountHovered] = useState(false);\n  const [errorLoading, setErrorLoading] = useState(false);\n  const [mounted, setMounted] = useState(false);\n  const imageContainerRef = useRef<HTMLDivElement>(null);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n  const touchInfoRef = useRef<TouchInfo | null>(null);\n  const interactionTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  const LONG_PRESS_DURATION = 500;\n  const MOVE_THRESHOLD = 10;\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && !mounted) {\n          setMounted(true);\n          observer.disconnect();\n        }\n      },\n      { rootMargin: '200px', threshold: 0.1 }\n    );\n    const currentRef = imageContainerRef.current;\n    if (currentRef) observer.observe(currentRef);\n    return () => {\n      if (currentRef) observer.unobserve(currentRef);\n      observer.disconnect();\n    };\n  }, [mounted]);\n\n  useEffect(() => {\n    if (!mounted) return;\n    const preloadImage = (url: string) => {\n      const img = new Image();\n      img.src = url;\n      return new Promise((resolve, reject) => {\n        img.onload = resolve;\n        img.onerror = reject;\n      });\n    };\n    Promise.all(imagesToLoad.slice(0, 2).map(preloadImage))\n      .catch(() => setErrorLoading(true));\n  }, [mounted, imagesToLoad]);\n\n  // Циклическая смена изображения при hover\n  useEffect(() => {\n    if (isHovered && imagesToLoad.length > 1) {\n      intervalRef.current = setInterval(() => {\n        setCurrentImageIndex((prev) => (prev + 1) % imagesToLoad.length);\n      }, 3000);\n    }\n    return () => {\n      if (intervalRef.current) clearInterval(intervalRef.current);\n    };\n  }, [isHovered, imagesToLoad.length]);\n\n  const handleImageContainerMouseEnter = useCallback(() => {\n    setIsHovered(true);\n    if (imagesToLoad.length > 1) {\n      setCurrentImageIndex(1);\n    }\n  }, [imagesToLoad.length]);\n\n  const handleImageContainerMouseLeave = useCallback(() => {\n    setIsHovered(false);\n    setCurrentImageIndex(0);\n  }, []);\n\n  const handleTouchStart = useCallback((e: React.TouchEvent) => {\n    const target = e.target as HTMLElement;\n    if (target.closest('button')) return;\n    prefetchProduct();\n    prefetchProductDetails();\n    touchInfoRef.current = {\n      startTime: Date.now(),\n      startX: e.touches[0].clientX,\n      startY: e.touches[0].clientY,\n      moved: false,\n    };\n    if (imagesToLoad.length > 1) {\n      interactionTimeoutRef.current = setTimeout(() => {\n        setIsHovered(true);\n      }, LONG_PRESS_DURATION);\n    }\n  }, [imagesToLoad.length, prefetchProduct, prefetchProductDetails]);\n\n  const handleTouchMove = useCallback((e: React.TouchEvent) => {\n    if (!touchInfoRef.current) return;\n    const { clientX, clientY } = e.touches[0];\n    const deltaX = Math.abs(clientX - touchInfoRef.current.startX);\n    const deltaY = Math.abs(clientY - touchInfoRef.current.startY);\n    if (deltaX > MOVE_THRESHOLD || deltaY > MOVE_THRESHOLD) {\n      touchInfoRef.current.moved = true;\n      if (interactionTimeoutRef.current) {\n        clearTimeout(interactionTimeoutRef.current);\n      }\n      setIsHovered(false);\n    }\n  }, []);\n\n  const handleTouchEnd = useCallback((_e: React.TouchEvent) => {\n    if (interactionTimeoutRef.current) {\n      clearTimeout(interactionTimeoutRef.current);\n    }\n    setIsHovered(false);\n    setCurrentImageIndex(0);\n    touchInfoRef.current = null;\n  }, []);\n\n  const updateRating = useCallback(debounce(async (newRating: number) => {\n    try {\n      const { error } = await supabase\n        .from('products')\n        .update({ rating: newRating })\n        .eq('id', id);\n      if (!error) {\n        await queryClient.invalidateQueries({\n          queryKey: ['home-products'],\n          exact: false,\n        });\n        setRating(newRating);\n      }\n    } catch (_error) {\n      console.error('Помилка оновлення рейтингу:', _error);\n    }\n  }, 300), [id, queryClient]);\n\n  const [isClicked, setIsClicked] = useState(false);\n  const handleInteraction = useCallback(async (handler: () => Promise<void>) => {\n    if (isClicked) return;\n    setIsClicked(true);\n    try {\n      await handler();\n    } finally {\n      setTimeout(() => setIsClicked(false), 100);\n    }\n  }, [isClicked]);\n\n  const isFavorited = favorites.includes(id);\n  const handleFavoriteToggle = useCallback(async () => {\n    if (!isFavorited) {\n      toggleFavorite(id);\n      await updateRating(rating + 1);\n    } else {\n      toggleFavorite(id);\n    }\n  }, [toggleFavorite, id, isFavorited, rating, updateRating]);\n\n  const handleBuy = useCallback(async () => {\n    addItem(id);\n    await updateRating(rating + 1);\n  }, [addItem, id, rating, updateRating]);\n\n  const handleComments = useCallback(() => {\n    navigate(`/product/${id}#comments`);\n  }, [id, navigate]);\n\n  const formatSize = useCallback(() => {\n    if (productType === 'tire' && specs.width && specs.profile && specs.diameter) {\n      return `${specs.width}/${specs.profile} R${specs.diameter}`;\n    }\n    if (productType === 'wheel' && specs.width && specs.diameter) {\n      return `${specs.width}J x R${specs.diameter}`;\n    }\n    return specs.size || '';\n  }, [productType, specs]);\n  \n\n  const ratingStars = useMemo(() => Math.min(Math.floor(rating / 20), 5), [rating]);\n\n  const formatPrice = useCallback(\n    (value: number) =>\n      value.toLocaleString('uk-UA', {\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 0,\n      }) + ' ₴',\n    []\n  );\n\n  const countryCode = useMemo(\n    () => (country && country.length === 2 ? country.toUpperCase() : 'US'),\n    [country]\n  );\n\n  return (\n    <Link\n      to={`/product/${id}`}\n      state={{ preserveScroll: true }}\n      className=\"block\"\n    >\n      <div\n        className={`group rounded-lg p-0 relative transition-shadow w-full pb-2 select-none bg-transparent border border-transparent md:group-hover:bg-white md:group-hover:border-gray-100 md:group-hover:shadow-lg ${className || ''}`}\n      >\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            e.preventDefault();\n            handleInteraction(handleFavoriteToggle);\n          }}\n          className={`absolute right-2 z-10 ${heartClass ? heartClass : 'top-0'}`}\n          disabled={isClicked}\n          aria-label=\"Додати до улюблених\"\n        >\n          <Heart\n            className={`${sizeClasses[heartSize]} stroke-2 transition-all duration-300 ${\n              isFavorited ? 'text-red-500 fill-red-500' : 'text-gray-300 fill-gray-100'\n            } ${isClicked ? 'animate-pulse scale-125' : ''}`}\n          />\n        </button>\n\n        {discount && discount > 0 && (\n          <div\n            {...(!isMobile && {\n              onMouseEnter: () => setDiscountHovered(true),\n              onMouseLeave: () => setDiscountHovered(false)\n            })}\n            className={`absolute top-1 ${discountIconClass ? discountIconClass : 'left-4 lg:translate-x-4'} z-10 transition-transform duration-300 ${\n              discountHovered ? 'rotate-45' : ''\n            }`}\n          >\n            <DiscountIcon className=\"w-4 h-4 lg:w-5 lg:h-5\" />\n          </div>\n        )}\n\n        <div\n          ref={imageContainerRef}\n          className={`relative ${imageHeight} mb-2 flex items-center justify-center overflow-hidden rounded-lg bg-white`}\n          {...(!isMobile && {\n            onMouseEnter: handleImageContainerMouseEnter,\n            onMouseLeave: handleImageContainerMouseLeave,\n          })}\n          onTouchStart={handleTouchStart}\n          onTouchMove={handleTouchMove}\n          onTouchEnd={handleTouchEnd}\n          onTouchCancel={() => {\n            if (interactionTimeoutRef.current) {\n              clearTimeout(interactionTimeoutRef.current);\n            }\n            setIsHovered(false);\n            setCurrentImageIndex(0);\n            touchInfoRef.current = null;\n          }}\n        >\n          {errorLoading ? (\n            <div className=\"w-full h-full flex flex-col items-center justify-center bg-gray-100\">\n              <p className=\"text-red-500 text-sm mb-2\">Помилка завантаження</p>\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setErrorLoading(false)}>\n                Спробувати знову\n              </Button>\n            </div>\n          ) : previewImage ? (\n            previewImage\n          ) : (\n            imagesToLoad.map((img, index) => (\n              <img\n                key={img}\n                src={img}\n                alt={`${brand} ${model}`}\n                className={`absolute max-h-full w-auto object-contain transition-all duration-500 ${\n                  index === currentImageIndex ? 'opacity-100' : 'opacity-0'\n                }`}\n                loading={mounted ? 'lazy' : 'eager'}\n                decoding=\"async\"\n                onError={() => setErrorLoading(true)}\n              />\n            ))\n          )}\n          {showAvailability && (\n            <Stock className=\"absolute top-24 -left-3 z-10\" />\n          )}\n        </div>\n\n        <div className=\"px-2 pb-2\">\n          <div className=\"flex flex-wrap items-center gap-1 mb-1\">\n            <h3 className=\"text-sm font-bold text-black break-words\">\n              {brand} {model}\n            </h3>\n            <span className=\"text-sm font-bold text-black whitespace-nowrap\">\n              {formatSize()}\n            </span>\n            {specs.load_index && specs.speed_index && (\n              <span className=\"text-sm font-bold text-black whitespace-nowrap\">\n                {specs.load_index}\n                {specs.speed_index}\n              </span>\n            )}\n          </div>\n\n          <div className=\"flex flex-wrap items-center justify-between mb-2 gap-y-1\">\n            <span className=\"text-xs text-gray-500\">Арт: {articleNumber}</span>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"flex items-center gap-0.5\">\n                {[...Array(5)].map((_, i) => (\n                  <Star\n                    key={i}\n                    className={`${sizeClasses[iconSize]} ${\n                      i < ratingStars ? 'text-yellow-400 fill-yellow-400' : 'text-gray-300'\n                    }`}\n                  />\n                ))}\n                <span className=\"text-xs text-gray-500 ml-1\">({rating})</span>\n              </div>\n              <button\n                onClick={(e) => {\n                  e.stopPropagation();\n                  e.preventDefault();\n                  handleComments();\n                }}\n                className=\"flex items-center gap-1 hover:opacity-75 transition-opacity\"\n                aria-label=\"Коментарі\"\n              >\n                <MessageCircle className={sizeClasses[iconSize]} />\n                {commentCount > 0 && (\n                  <span className=\"text-xs text-gray-500\">{commentCount}</span>\n                )}\n              </button>\n            </div>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-2 mb-2\">\n            <div className=\"flex items-center gap-2\">\n              <TooltipIcon tooltip=\"Легкові шини\">\n                <CustomCarIcon className={`${sizeClasses[iconSize]} text-blue-600`} />\n              </TooltipIcon>\n              {specs.season === 'winter' ? (\n                <TooltipIcon tooltip=\"Зимова шина\">\n                  <SnowflakeIcon className={`${sizeClasses[iconSize]} text-blue-600`} />\n                </TooltipIcon>\n              ) : specs.season === 'summer' ? (\n                <TooltipIcon tooltip=\"Літня шина\">\n                  <SunIcon className={sizeClasses[iconSize]} />\n                </TooltipIcon>\n              ) : specs.season === 'all-season' ? (\n                <TooltipIcon tooltip=\"Універсальна шина\">\n                  <SnowSunIcon className={sizeClasses[iconSize]} />\n                </TooltipIcon>\n              ) : null}\n              {specs.spikes && (\n                <TooltipIcon tooltip=\"Шиповані шини\">\n                  <div className=\"bg-red-500 text-white text-xs px-1 py-0.5 rounded-sm\">\n                    Ш\n                  </div>\n                </TooltipIcon>\n              )}\n            </div>\n            <div className=\"flex items-center gap-2\">\n            <TooltipIcon tooltip={`Країна: ${country}`}>\n  <div className=\"aspect-square rounded-full overflow-hidden border w-4 h-4 relative\">\n    <ReactCountryFlag\n      countryCode={countryCode}\n      svg\n      className=\"absolute top-1/2 left-1/2 w-[135%] h-[135%] -translate-x-1/2 -translate-y-1/2 object-cover\"\n      title={country}\n      aria-label={country}\n    />\n  </div>\n</TooltipIcon>\n              <span className=\"text-xs text-gray-500\">{year}</span>\n            </div>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-2 mb-2\">\n            {specs.fuel_Efficiency && (\n              <TooltipIcon tooltip={`Ефективність палива: ${specs.fuel_Efficiency}`}>\n                <div className=\"flex items-center gap-1\">\n                  <GasPumpIcon className={sizeClasses[iconSize]} />\n                  <span className=\"text-xs text-gray-700\">{specs.fuel_Efficiency}</span>\n                </div>\n              </TooltipIcon>\n            )}\n            {specs.wetGrip && (\n              <TooltipIcon tooltip={`Зчеплення на мокрій дорозі: ${specs.wetGrip}`}>\n                <div className=\"flex items-center gap-1\">\n                  <CloudRainIcon className={sizeClasses[iconSize]} />\n                  <span className=\"text-xs text-gray-700\">{specs.wetGrip}</span>\n                </div>\n              </TooltipIcon>\n            )}\n            {specs.noise && (\n              <TooltipIcon tooltip={`Рівень шуму: ${specs.noise} dB`}>\n                <div className=\"flex items-center gap-1\">\n                  <VolumIcon className={`${sizeClasses[iconSize]} text-blue-600`} />\n                  <span className=\"text-xs text-gray-700\">{specs.noise} dB</span>\n                </div>\n              </TooltipIcon>\n            )}\n          </div>\n\n          <div className=\"flex items-center justify-between pt-2\">\n            <div className=\"flex-grow\">\n              {discount ? (\n                <>\n                  <div className=\"text-red-600 font-bold text-sm break-words\">\n                    {formatPrice(price)}\n                  </div>\n                  <div className=\"text-gray-400 line-through text-xs\">\n                    {oldPrice ? formatPrice(oldPrice) : ''}\n                  </div>\n                </>\n              ) : (\n                <div className=\"text-green-600 font-bold text-sm break-words\">\n                  {formatPrice(price)}\n                </div>\n              )}\n            </div>\n            <Button\n              className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-xs md:text-sm shadow-md transition-transform hover:scale-105 ml-3 z-20\"\n              onClick={(e) => {\n                e.stopPropagation();\n                e.preventDefault();\n                handleInteraction(handleBuy);\n              }}\n              onTouchStart={(e) => {\n                e.stopPropagation();\n                e.preventDefault();\n              }}\n              onTouchEnd={(e) => {\n                e.stopPropagation();\n                e.preventDefault();\n                handleInteraction(handleBuy);\n              }}\n              aria-label=\"Купити\"\n            >\n              Купити\n            </Button>\n          </div>\n        </div>\n      </div>\n    </Link>\n  );\n});\n\nexport default memo(ProductCard);\n","import React, { useEffect } from \"react\";\nimport { supabase } from \"../lib/supabaseClient\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { useQuery } from \"@tanstack/react-query\";\n\nexport interface Article {\n  id: number;\n  title: string;\n  content: string;\n  image_path: string;\n}\n\nconst ArticleWindow: React.FC = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const isFullPage = location.pathname === \"/articles\";\n\n  // Загрузка статей с кэшированием на 6 часов (360 минут)\n  const { data: articles = [], isLoading } = useQuery<Article[]>({\n    queryKey: [\"articles\"],\n    queryFn: async () => {\n      const { data, error } = await supabase.from(\"articles\").select(\"*\");\n      if (error) throw new Error(error.message);\n      return data;\n    },\n    staleTime: 6 * 60 * 60 * 1000,\n  });\n\n  // Предзагрузка изображений статей для кэширования в браузере\n  useEffect(() => {\n    if (!isLoading && articles.length > 0) {\n      articles.forEach((article) => {\n        if (article.image_path) {\n          const {\n            data: { publicUrl },\n          } = supabase.storage.from(\"articles-images\").getPublicUrl(article.image_path);\n          if (publicUrl) {\n            const img = new Image();\n            img.src = publicUrl;\n          }\n        }\n      });\n    }\n  }, [isLoading, articles]);\n\n  return (\n    <div className=\"container mx-auto p-1 sm:p-4 \">\n      <h1 className=\"text-2xl font-bold text-center mb-6\">Блог та Статті</h1>\n      {isFullPage ? (\n        // Полноэкранный режим: сетка с 3 колонками на десктопе\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4\">\n          {articles.map((article) => {\n            const publicUrl =\n              article.image_path &&\n              supabase.storage.from(\"articles-images\").getPublicUrl(article.image_path).data.publicUrl;\n            return (\n              <div\n                key={article.id}\n                className=\"cursor-pointer\"\n                onClick={() => navigate(`/articles/${article.id}`)}\n              >\n                {publicUrl ? (\n                  <img\n                    src={publicUrl}\n                    alt={article.title}\n                    className=\"w-full h-64 object-cover rounded-lg\"\n                  />\n                ) : (\n                  <div className=\"w-full h-64 bg-gray-300 rounded-lg flex items-center justify-center\">\n                    Нет изображения\n                  </div>\n                )}\n                <h2 className=\"text-xl font-semibold text-center mt-2\">\n                  {article.title}\n                </h2>\n              </div>\n            );\n          })}\n        </div>\n      ) : (\n        <>\n          <ArticleCarousel articles={articles} />\n          <div className=\"text-center mt-6\">\n            <button\n              className=\"px-2 py-2 rounded text-black border-2 border-green-600 bg-transparent hover:bg-blue-50 transition-all\"\n              onClick={() => navigate(\"/articles\")}\n            >\n              дивитись всі публікації\n            </button>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\ninterface ArticleCarouselProps {\n  articles: Article[];\n}\n\nconst ArticleCarousel: React.FC<ArticleCarouselProps> = ({ articles }) => {\n  const navigate = useNavigate();\n\n  // Всегда вызываем хуки в начале компонента\n  const [isMobile, setIsMobile] = React.useState(window.innerWidth < 640);\n  const [currentSlide, setCurrentSlide] = React.useState(0);\n  const containerRef = React.useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const handleResize = () => setIsMobile(window.innerWidth < 640);\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n\n  const handleScroll = () => {\n    if (containerRef.current) {\n      const scrollLeft = containerRef.current.scrollLeft;\n      const slideWidth = containerRef.current.clientWidth;\n      const index = Math.round(scrollLeft / slideWidth);\n      setCurrentSlide(index);\n    }\n  };\n\n  // Если статей нет, выводим сообщение, но хуки вызываются всегда\n  if (articles.length === 0) {\n    return <div>Нет статей для отображения</div>;\n  }\n\n  return (\n    <>\n      {/* Карусель с поддержкой scroll snap для мобильных устройств */}\n      <div\n        ref={containerRef}\n        onScroll={isMobile ? handleScroll : undefined}\n        className=\"flex space-x-4 overflow-x-auto scroll-smooth snap-x snap-mandatory\"\n      >\n        {articles.map((article) => {\n          const publicUrl =\n            article.image_path &&\n            supabase.storage.from(\"articles-images\").getPublicUrl(article.image_path).data.publicUrl;\n          return (\n            <div\n              key={article.id}\n              onClick={() => navigate(`/articles/${article.id}`)}\n              className=\"flex-shrink-0 w-full sm:w-1/2 md:w-1/3 cursor-pointer snap-start\"\n            >\n              {publicUrl ? (\n                <img\n                  src={publicUrl}\n                  alt={article.title}\n                  className=\"w-full h-64 object-cover rounded-lg\"\n                />\n              ) : (\n                <div className=\"w-full h-64 bg-gray-300 rounded-lg flex items-center justify-center\">\n                  Нет изображения\n                </div>\n              )}\n              <h2 className=\"text-xl font-semibold text-center mt-2\">\n                {article.title}\n              </h2>\n            </div>\n          );\n        })}\n      </div>\n      {/* Индикатор текущего слайда (точки) – только для мобильной версии */}\n      {isMobile && (\n        <div className=\"flex justify-center mt-2\">\n          {articles.map((_, i) => (\n            <div\n              key={i}\n              className={`mx-1 w-3 h-3 rounded-full ${i === currentSlide ? \"bg-blue-600\" : \"bg-gray-300\"}`}\n            />\n          ))}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default ArticleWindow;\n","import React, {\n  useCallback,\n  useState,\n  Suspense,\n  lazy,\n  useEffect,\n  useRef,\n  useMemo,\n  createContext,\n  useContext,\n} from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useLocation } from 'react-router-dom';\nimport { HeroSection } from './HeroSection';\nimport { ProductCard, ProductCardProps } from './ProductCard';\nimport { supabase } from '../lib/supabaseClient';\nimport { useIsMobile } from '../hooks/useIsMobile';\nimport ArticleWindow from '../FAKT_Info/ArticleWindow';\n\n/* ------------------- Интерфейсы и глобальный стор для Home ------------------- */\n\ninterface ReviewCount {\n  count: number;\n}\n\nexport interface Product {\n  id: string;\n  brand: string;\n  model: string;\n  price: number;\n  sale_price: number | null;\n  image_url: string[];\n  noise_level: number | null;\n  year: number;\n  country: string;\n  created_at: string;\n  type: 'tire' | 'wheel';\n  width?: number;\n  profile?: number;\n  diameter?: number;\n  season?: 'summer' | 'winter' | 'all-season';\n  reviews: ReviewCount[];\n  comment_count?: number;\n  rating: number;\n  spikes?: boolean;\n  fuel_efficiency?: string;\n  wet_grip?: string;\n  load_index?: string;\n  speed_index?: string;\n}\n\ninterface HomeState {\n  hasVisited: boolean;\n}\n\nconst defaultHomeState: HomeState = {\n  hasVisited: false,\n};\n\nconst HomeStateContext = createContext<\n  [HomeState, React.Dispatch<React.SetStateAction<HomeState>>]\n>([defaultHomeState, () => {}]);\n\nconst HomeStateProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [state, setState] = useState<HomeState>(() => {\n    const saved = sessionStorage.getItem('homeState');\n    return saved ? JSON.parse(saved) : defaultHomeState;\n  });\n\n  useEffect(() => {\n    sessionStorage.setItem('homeState', JSON.stringify(state));\n  }, [state]);\n\n  return (\n    <HomeStateContext.Provider value={[state, setState]}>\n      {children}\n    </HomeStateContext.Provider>\n  );\n};\n\n/* ------------------- Ленивые секции ------------------- */\n\nconst LazySaleProductsSection = lazy(() => import('./HomeSections/SaleProductsSection'));\nconst LazyNewArrivalsSection = lazy(() => import('./HomeSections/NewArrivalsSection'));\nconst LazyTopRatedSection = lazy(() => import('./HomeSections/TopRatedSection'));\nconst LazyFooterSection = lazy(() => import('./HomeSections/FooterSection'));\n\nconst prefetchComponent = (importFunc: () => Promise<unknown>): void => {\n  importFunc();\n};\n\n/* ------------------- Компонент HomeContent ------------------- */\n\nconst HomeContent: React.FC = () => {\n  const isMobile = useIsMobile();\n  const [currentSlide, setCurrentSlide] = useState(0);\n  const [currentTopIndex, setCurrentTopIndex] = useState(0);\n  const [dragOffset, setDragOffset] = useState(0);\n  const [isDragging, setIsDragging] = useState(false);\n  const touchStartX = useRef<number>(0);\n  const touchStartY = useRef<number>(0);\n  const isHorizontalSwipe = useRef<boolean>(false);\n\n  const handleTouchStart = useCallback((e: React.TouchEvent) => {\n    touchStartX.current = e.touches[0].clientX;\n    touchStartY.current = e.touches[0].clientY;\n    isHorizontalSwipe.current = false;\n    setIsDragging(true);\n  }, []);\n\n  const handleTouchMove = useCallback((e: React.TouchEvent) => {\n    if (!isDragging) return;\n    const currentX = e.touches[0].clientX;\n    const currentY = e.touches[0].clientY;\n    const deltaX = Math.abs(currentX - touchStartX.current);\n    const deltaY = Math.abs(currentY - touchStartY.current);\n\n    if (!isHorizontalSwipe.current && (deltaX > 10 || deltaY > 10)) {\n      isHorizontalSwipe.current = deltaX > deltaY;\n    }\n\n    if (isHorizontalSwipe.current) {\n      e.preventDefault();\n      setDragOffset(currentX - touchStartX.current);\n    }\n  }, [isDragging]);\n\n  useEffect(() => {\n    const handleGlobalTouchMove = (e: TouchEvent) => {\n      if (isDragging && isHorizontalSwipe.current) {\n        e.preventDefault();\n      }\n    };\n    document.addEventListener('touchmove', handleGlobalTouchMove, { passive: false });\n    return () => {\n      document.removeEventListener('touchmove', handleGlobalTouchMove);\n    };\n  }, [isDragging]);\n\n  // Используем react-query для загрузки товаров с кэшированием на 30 минут (1800000 мс)\n  const { data: products = [], isLoading } = useQuery<Product[]>({\n    queryKey: ['home-products'],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('products')\n        .select(`\n          id,\n          brand,\n          model,\n          price,\n          sale_price,\n          image_url,\n          noise_level,\n          year,\n          country,\n          created_at,\n          type,\n          width,\n          profile,\n          diameter,\n          season,\n          reviews (count),\n          rating,\n          spikes,\n          fuel_efficiency,\n          wet_grip,\n          load_index,\n          speed_index\n        `)\n        .order('created_at', { ascending: false })\n        .limit(12);\n      if (error) throw error;\n      return data.map((p) => ({\n        ...p,\n        comment_count: p.reviews[0]?.count || 0,\n      })) as Product[];\n    },\n    staleTime: 1800000, // 30 минут\n  });\n\n  // Предзагрузка изображений товаров для кэширования в браузере\n  useEffect(() => {\n    if (!isLoading && products.length > 0) {\n      products.forEach((product) => {\n        product.image_url.forEach((url) => {\n          const img = new Image();\n          img.src = url;\n        });\n      });\n    }\n  }, [isLoading, products]);\n\n  const getProductSpecs = useCallback((product: Product) => {\n    return product.type === 'tire'\n      ? {\n          size: `${product.width}/${product.profile}R${product.diameter}`,\n          season: product.season,\n          spikes: product.spikes,\n          fuel_Efficiency: product.fuel_efficiency,\n          wetGrip: product.wet_grip,\n          noise: product.noise_level,\n        }\n      : {\n          size: `${product.width}J x R${product.diameter}`,\n        };\n  }, []);\n\n  const renderProductCard = useCallback(\n    (\n      product: Product,\n      isLazy = true,\n      className?: string,\n      customProps?: Partial<ProductCardProps>\n    ) => (\n      <ProductCard\n        key={product.id}\n        id={product.id}\n        brand={product.brand}\n        model={product.model}\n        price={product.sale_price || product.price}\n        oldPrice={product.sale_price ? product.price : undefined}\n        discount={\n          product.sale_price\n            ? Math.round(((product.price - product.sale_price) / product.price) * 100)\n            : undefined\n        }\n        image={isLazy ? [] : product.image_url}\n        data-images={product.image_url}\n        specs={getProductSpecs(product)}\n        articleNumber={product.id.slice(0, 8).toUpperCase()}\n        commentCount={product.comment_count || 0}\n        initialRating={product.rating}\n        productType={product.type}\n        year={product.year}\n        country={product.country}\n        className={className}\n        {...customProps}\n      />\n    ),\n    [getProductSpecs]\n  );\n\n  const saleProducts = useMemo(\n    () => products.filter((p) => p.sale_price !== null && p.sale_price < p.price),\n    [products]\n  );\n  const newArrivals = useMemo(\n    () =>\n      products.filter((p) => !saleProducts.some((sp) => sp.id === p.id)).slice(0, 8),\n    [products, saleProducts]\n  );\n  const topRated = useMemo(() => {\n    const sorted = [...products].sort((a, b) => (b.rating || 0) - (a.rating || 0));\n    return sorted.slice(0, 4);\n  }, [products]);\n\n  const handleSlideChange = useCallback(\n    (direction: 'next' | 'prev') => {\n      const slidesToShow = 4;\n      const totalItems = products.filter((p) => !p.sale_price || p.sale_price >= p.price)\n        .length;\n      const totalSlides = Math.ceil(totalItems / slidesToShow);\n      setCurrentSlide((prev) =>\n        direction === 'next'\n          ? (prev + 1) % totalSlides\n          : (prev - 1 + totalSlides) % totalSlides\n      );\n    },\n    [products]\n  );\n\n  const handleTopRatedPrev = useCallback(() => {\n    setCurrentTopIndex((prev) => (prev - 1 + topRated.length) % topRated.length);\n  }, [topRated.length]);\n\n  const handleTopRatedNext = useCallback(() => {\n    setCurrentTopIndex((prev) => (prev + 1) % topRated.length);\n  }, [topRated.length]);\n\n  const handleTouchEnd = useCallback(() => {\n    const swipeThreshold = 50;\n    if (isDragging && isHorizontalSwipe.current) {\n      if (dragOffset > swipeThreshold) {\n        handleTopRatedPrev();\n      } else if (dragOffset < -swipeThreshold) {\n        handleTopRatedNext();\n      }\n    }\n    setIsDragging(false);\n    setDragOffset(0);\n    isHorizontalSwipe.current = false;\n  }, [isDragging, dragOffset, handleTopRatedPrev, handleTopRatedNext]);\n\n  const lastProductCallbackRef = useCallback((_: HTMLDivElement | null) => {}, []);\n\n  const handleNavClick = useCallback(\n    (targetId: string) => (e: React.MouseEvent<HTMLAnchorElement>) => {\n      e.preventDefault();\n      const targetElement = document.getElementById(targetId);\n      if (targetElement) {\n        const offset = targetElement.getBoundingClientRect().top + window.scrollY - 80;\n        window.scrollTo({ top: offset, behavior: 'smooth' });\n      }\n      if (useIsMobile()) {\n        e.currentTarget.blur();\n      }\n    },\n    []\n  );\n\n  return (\n    <div>\n      <nav className=\"py-4\">\n        <ul className=\"flex justify-center gap-4\">\n          <li onMouseEnter={() => prefetchComponent(() => import('./HomeSections/TopRatedSection'))}>\n            <a\n              href=\"#top\"\n              onClick={handleNavClick('top')}\n              className=\"bg-gray-100 hover:bg-gray-200 rounded-lg px-4 py-2 transition-colors\"\n            >\n              Топові\n            </a>\n          </li>\n          <li onMouseEnter={() => prefetchComponent(() => import('./HomeSections/NewArrivalsSection'))}>\n            <a\n              href=\"#new\"\n              onClick={handleNavClick('new')}\n              className=\"bg-gray-100 hover:bg-gray-200 rounded-lg px-4 py-2 transition-colors\"\n            >\n              Новинки\n            </a>\n          </li>\n          <li onMouseEnter={() => prefetchComponent(() => import('./HomeSections/SaleProductsSection'))}>\n            <a\n              href=\"#sale\"\n              onClick={handleNavClick('sale')}\n              className=\"bg-gray-100 hover:bg-gray-200 rounded-lg px-4 py-2 transition-colors\"\n            >\n              Акції\n            </a>\n          </li>\n        </ul>\n      </nav>\n      <main className=\"py-8\">\n        <Suspense fallback={<div className=\"min-h-[400px]\" />}>\n          <LazySaleProductsSection\n            saleProducts={saleProducts}\n            renderProductCard={renderProductCard}\n            lastProductRef={lastProductCallbackRef}\n            isLoading={isLoading}\n            isMobile={isMobile}\n          />\n        </Suspense>\n        <Suspense fallback={<div className=\"min-h-[400px]\" />}>\n          <LazyNewArrivalsSection\n            newArrivals={newArrivals}\n            currentSlide={currentSlide}\n            onSlideChange={handleSlideChange}\n            isMobile={isMobile}\n            renderProductCard={renderProductCard}\n            lastProductRef={lastProductCallbackRef}\n            isLoading={isLoading}\n          />\n        </Suspense>\n        <Suspense fallback={<div className=\"min-h-[400px]\" />}>\n          <LazyTopRatedSection\n            topRated={topRated}\n            currentTopIndex={currentTopIndex}\n            onPrev={handleTopRatedPrev}\n            onNext={handleTopRatedNext}\n            isMobile={isMobile}\n            renderProductCard={renderProductCard}\n            dragOffset={dragOffset}\n            isDragging={isDragging}\n            handleTouchStart={handleTouchStart}\n            handleTouchMove={handleTouchMove}\n            handleTouchEnd={handleTouchEnd}\n            lastProductRef={lastProductCallbackRef}\n            isLoading={isLoading}\n          />\n        </Suspense>\n      </main>\n    </div>\n  );\n};\n\n/* ------------------- Компонент Home с сохранением глобального состояния ------------------- */\n\nexport const Home: React.FC = () => {\n  const [homeState, setHomeState] = useContext(HomeStateContext);\n  const [shouldAnimate, setShouldAnimate] = useState(false);\n  const location = useLocation();\n\n  useEffect(() => {\n    if (!homeState.hasVisited) {\n      setShouldAnimate(true);\n      setHomeState({ ...homeState, hasVisited: true });\n      const timer = setTimeout(() => setShouldAnimate(false), 1500);\n      return () => clearTimeout(timer);\n    }\n  }, [homeState, setHomeState, location.key]);\n\n  return (\n    <div className=\"min-h-screen\">\n      <div className=\"relative\">\n        <div className=\"absolute -top-4 left-0 right-0 h-[300px] bg-blue-800 z-[-1]\" />\n        <HeroSection shouldAnimate={shouldAnimate} />\n      </div>\n      <div className={shouldAnimate ? 'content-fadeIn' : ''}>\n        <div className=\"w-full\">\n          <div className=\"px-2 sm:px-6 lg:mx-auto lg:max-w-[1024px] lg:px-8\">\n            <HomeContent />\n            <section className=\"mt-8\">\n              <ArticleWindow />\n            </section>\n          </div>\n        </div>\n      </div>\n      <Suspense fallback={null}>\n        <LazyFooterSection />\n      </Suspense>\n    </div>\n  );\n};\n\n/* ------------------- Обёртка для экспорта с провайдером глобального состояния ------------------- */\n\nconst HomeWithProvider: React.FC = () => (\n  <HomeStateProvider>\n    <Home />\n  </HomeStateProvider>\n);\n\nexport default HomeWithProvider;\n","import React from 'react';\n\ninterface PaginationProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n}\n\nexport const Pagination: React.FC<PaginationProps> = ({ \n  currentPage, \n  totalPages, \n  onPageChange \n}) => {\n  const scrollToTop = () => {\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  const getVisiblePages = () => {\n    const visiblePages = [];\n    const range = 2; // Количество отображаемых страниц вокруг текущей\n\n    let start = Math.max(1, currentPage - range);\n    let end = Math.min(totalPages, currentPage + range);\n\n    if (currentPage - range <= 1) end = Math.min(totalPages, 1 + range * 2);\n    if (currentPage + range >= totalPages) start = Math.max(1, totalPages - range * 2);\n\n    for (let i = start; i <= end; i++) {\n      visiblePages.push(i);\n    }\n\n    if (start > 1) visiblePages.unshift(1);\n    if (end < totalPages) visiblePages.push(totalPages);\n\n    return visiblePages;\n  };\n\n  const handlePageChange = (page: number) => {\n    onPageChange(page);\n    scrollToTop();\n  };\n\n  const handlePrevious = () => {\n    handlePageChange(Math.max(1, currentPage - 1));\n  };\n\n  const handleNext = () => {\n    handlePageChange(Math.min(totalPages, currentPage + 1));\n  };\n\n  return (\n    <div className=\"flex flex-col items-center gap-4 mt-8\">\n      <div className=\"flex items-center gap-2\">\n        <button\n          onClick={handlePrevious}\n          disabled={currentPage === 1}\n          className={`px-4 py-2 rounded ${\n            currentPage === 1 \n              ? 'bg-gray-300 cursor-not-allowed' \n              : 'bg-blue-500 hover:bg-blue-600'\n          } text-white transition-colors`}\n        >\n          Попередня\n        </button>\n\n        <div className=\"flex gap-1\">\n          {getVisiblePages().map((page, index, arr) => (\n            <React.Fragment key={page}>\n              {index > 0 && arr[index] - arr[index - 1] > 1 && (\n                <span className=\"px-3 py-2\">...</span>\n              )}\n              <button\n                onClick={() => handlePageChange(page)}\n                className={`px-3 py-1 rounded ${\n                  currentPage === page \n                    ? 'bg-blue-500 text-white' \n                    : 'bg-gray-200 hover:bg-gray-300'\n                } transition-colors`}\n              >\n                {page}\n              </button>\n            </React.Fragment>\n          ))}\n        </div>\n\n        <button\n          onClick={handleNext}\n          disabled={currentPage === totalPages}\n          className={`px-4 py-2 rounded ${\n            currentPage === totalPages \n              ? 'bg-gray-300 cursor-not-allowed' \n              : 'bg-blue-500 hover:bg-blue-600'\n          } text-white transition-colors`}\n        >\n          Наступна\n        </button>\n      </div>\n\n      <span className=\"text-sm text-gray-600\">\n        Сторінка {currentPage} з {totalPages}\n      </span>\n    </div>\n  );\n};\n","import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useNavigate, useSearchParams, useLocation } from 'react-router-dom';\nimport { Filter } from 'lucide-react';\nimport { ProductCard } from '../pagesHome/ProductCard';\nimport { Product } from '../types/database.types';\nimport { supabase } from '../lib/supabaseClient';\nimport { debounce } from 'lodash-es';\nimport { Select, SelectItem } from '../components/ui/select';\nimport { Pagination } from '../components/ui/adminProducts/Pagination';\n\ninterface Filters {\n  [key: string]: string;\n}\n\ninterface DistinctOptions {\n  brands: string[];\n  models: string[];\n  widths: number[];\n  profiles: number[];\n  diameters: number[];\n  seasons: string[];\n  countries: string[];\n  years: number[];\n}\n\nexport const ProductList: React.FC = () => {\n  const navigate = useNavigate();\n  const { pathname } = useLocation();\n  const [products, setProducts] = useState<Product[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [error, setError] = useState<string | null>(null);\n\n  // Пагинация: 8 товаров на странице\n  const [currentPage, setCurrentPage] = useState(1);\n  const itemsPerPage = 10;\n  const totalPages = Math.ceil(products.length / itemsPerPage);\n  const displayedProducts = useMemo(() => {\n    const startIndex = (currentPage - 1) * itemsPerPage;\n    return products.slice(startIndex, startIndex + itemsPerPage);\n  }, [products, currentPage]);\n\n  // Списки фильтров\n  const [distinctOptions, setDistinctOptions] = useState<DistinctOptions>({\n    brands: [],\n    models: [],\n    widths: [],\n    profiles: [],\n    diameters: [],\n    seasons: [],\n    countries: [],\n    years: [],\n  });\n\n  // Текущие фильтры из URL\n  const currentFilters = useMemo(() => ({\n    brand: searchParams.get('brand') || '',\n    model: searchParams.get('model') || '',\n    width: searchParams.get('width') || '',\n    profile: searchParams.get('profile') || '',\n    diameter: searchParams.get('diameter') || '',\n    season: searchParams.get('season') || '',\n    country: searchParams.get('country') || '',\n    year: searchParams.get('year') || '',\n    spikes: searchParams.get('spikes') || '',\n    minPrice: searchParams.get('minPrice') || '',\n    maxPrice: searchParams.get('maxPrice') || '',\n    sale: searchParams.get('sale') || '',\n    tireSize: searchParams.get('tireSize') || '',\n  }), [searchParams]);\n\n  // Отключение автоматического скролла при изменении параметров\n  useEffect(() => {\n    window.history.scrollRestoration = 'manual';\n  }, [pathname]);\n\n  // Обработка одиночных полей (input, checkbox)\n  const handleFilterChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\n      const { name, value, type, checked } = e.target as HTMLInputElement;\n      const newParams = new URLSearchParams(searchParams);\n      if (type === 'checkbox') {\n        if (checked) {\n          newParams.set(name, 'true');\n        } else {\n          newParams.delete(name);\n        }\n      } else {\n        if (value) {\n          newParams.set(name, value);\n        } else {\n          newParams.delete(name);\n        }\n      }\n      setSearchParams(newParams);\n      setCurrentPage(1);\n    },\n    [searchParams, setSearchParams]\n  );\n\n  // Обработка мультиселектов\n  const handleMultiSelectChange = useCallback(\n    (name: string, values: string[]) => {\n      const newParams = new URLSearchParams(searchParams);\n      if (values.length > 0) {\n        newParams.set(name, values.join(','));\n      } else {\n        newParams.delete(name);\n      }\n      setSearchParams(newParams);\n      setCurrentPage(1);\n    },\n    [searchParams, setSearchParams]\n  );\n\n  const resetFilters = useCallback(() => {\n    setSearchParams(new URLSearchParams());\n    setCurrentPage(1);\n  }, [setSearchParams]);\n\n  // Загрузка товаров из Supabase\n  const fetchProducts = useCallback(\n    debounce(async (filters: Filters, signal: AbortSignal) => {\n      try {\n        setLoading(true);\n        setError(null);\n        const processedFilters = { ...filters };\n\n        if (processedFilters.tireSize) {\n          const tireSizePattern = /^(\\d+)[/](\\d+)\\s*R?(\\d+)$/i;\n          const match = processedFilters.tireSize.match(tireSizePattern);\n          if (match) {\n            const [, width, profile, diameter] = match;\n            processedFilters.width = width;\n            processedFilters.profile = profile;\n            processedFilters.diameter = diameter;\n          }\n          delete processedFilters.tireSize;\n        }\n\n        let query = supabase.from('products').select('*');\n\n        Object.entries(processedFilters).forEach(([key, value]) => {\n          if (!value) return;\n          switch (key) {\n            case 'sale':\n              query = query.not('sale_price', 'is', null);\n              break;\n            case 'brand':\n            case 'model': {\n              const values = value.split(',');\n              query = query.in(key, values);\n              break;\n            }\n            case 'width':\n            case 'profile':\n            case 'diameter':\n            case 'year':\n            case 'minPrice':\n            case 'maxPrice': {\n              const numValue = Number(value);\n              if (!isNaN(numValue)) {\n                if (key === 'minPrice') {\n                  query = query.gte('price', numValue);\n                } else if (key === 'maxPrice') {\n                  query = query.lte('price', numValue);\n                } else {\n                  query = query.eq(key, numValue);\n                }\n              }\n              break;\n            }\n            case 'spikes':\n              query = query.eq('spikes', value === 'true');\n              break;\n            default:\n              query = query.eq(key, value);\n          }\n        });\n\n        const { data, error } = await query.abortSignal(signal);\n        if (error) throw error;\n        setProducts(data as Product[]);\n      } catch (err) {\n        if (!signal.aborted) {\n          console.error('Error fetching products:', err);\n          setError('Ошибка загрузки. Попробуйте ещё раз.');\n          setProducts([]);\n        }\n      } finally {\n        if (!signal.aborted) setLoading(false);\n      }\n    }, 300),\n    []\n  );\n\n  useEffect(() => {\n    const controller = new AbortController();\n    fetchProducts(currentFilters, controller.signal);\n    return () => controller.abort();\n  }, [currentFilters, fetchProducts]);\n\n  // Загрузка списков для фильтров\n  useEffect(() => {\n    const fetchDistinctFilters = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('products')\n          .select('brand, model, width, profile, diameter, season, country, year');\n        if (error) throw error;\n        if (data && data.length > 0) {\n          setDistinctOptions({\n            brands: Array.from(new Set(data.map(item => item.brand).filter(Boolean) as string[])).sort((a, b) => a.localeCompare(b)),\n            models: Array.from(new Set(data.map(item => item.model).filter(Boolean) as string[])).sort((a, b) => a.localeCompare(b)),\n            widths: Array.from(new Set(data.map(item => item.width).filter(val => val != null) as number[])).sort((a, b) => a - b),\n            profiles: Array.from(new Set(data.map(item => item.profile).filter(val => val != null) as number[])).sort((a, b) => a - b),\n            diameters: Array.from(new Set(data.map(item => item.diameter).filter(val => val != null) as number[])).sort((a, b) => a - b),\n            seasons: Array.from(new Set(data.map(item => item.season).filter(Boolean) as string[])).sort((a, b) => a.localeCompare(b)),\n            countries: Array.from(new Set(data.map(item => item.country).filter(Boolean) as string[])).sort((a, b) => a.localeCompare(b)),\n            years: Array.from(new Set(data.map(item => item.year).filter(val => val != null) as number[])).sort((a, b) => a - b),\n          });\n        }\n      } catch (err) {\n        console.error('Error fetching distinct filters', err);\n      }\n    };\n    fetchDistinctFilters();\n  }, []);\n\n  const productList = useMemo(() =>\n    displayedProducts.map(product => {\n      const hasDiscount = product.sale_price && product.price > product.sale_price;\n      const discountPercent = hasDiscount\n        ? Math.round(((product.price - (product.sale_price || 0)) / product.price * 100))\n        : undefined;\n\n      return (\n        <div key={product.id} className=\"relative group\">\n          <ProductCard\n            {...product}\n            productType={product.type as 'tire' | 'wheel'}\n            price={product.sale_price || product.price}\n            oldPrice={hasDiscount ? product.price : undefined}\n            discount={discountPercent}\n            image={product.image_url || []}\n            initialRating={product.rating || 0}\n            specs={{\n              season: product.season as 'winter' | 'summer' | 'all-season' || '',\n              width: product.width || 0,\n              profile: product.profile || 0,\n              diameter: product.diameter || 0,\n              spikes: product.spikes || false,\n            }}\n            year={product.year || new Date().getFullYear()}\n            country={product.country || ''}\n            articleNumber={product.id.slice(0, 8)}\n          />\n        </div>\n      );\n    }), [displayedProducts]);\n\n  return (\n    <div className=\"bg-white min-h-screen relative\">\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <h1 className=\"text-2xl font-bold\">Каталог шин</h1>\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              navigate(`/detailed-search?${searchParams.toString()}`);\n            }}\n            className=\"flex items-center gap-2 text-blue-800 md:hidden\"\n          >\n            <Filter className=\"w-5 h-5\" />\n            <span>Фільтри</span>\n          </button>\n        </div>\n\n        {error && (\n          <div className=\"mb-4 p-4 bg-red-100 text-red-700 rounded-lg\">\n            {error}\n          </div>\n        )}\n\n        <div className=\"flex flex-col md:flex-row gap-8\">\n          <div className=\"hidden md:block md:w-1/4\">\n            <FilterPanel\n              filters={currentFilters}\n              onChange={handleFilterChange}\n              onMultiSelectChange={handleMultiSelectChange}\n              distinctOptions={distinctOptions}\n            />\n          </div>\n\n          <div className=\"flex -mx-2 sm:mx-0\">\n            {loading ? (\n              <LoadingSpinner />\n            ) : products.length === 0 ? (\n              <EmptyState onReset={resetFilters} />\n            ) : (\n              <>\n                <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 gap-0 sm:px-0 justify-items-stretch\">\n                  {productList}\n                </div>\n                {totalPages > 1 && (\n                  <Pagination \n                    currentPage={currentPage} \n                    totalPages={totalPages} \n                    onPageChange={(page) => setCurrentPage(page)} \n                  />\n                )}\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst FilterPanel = React.memo(({\n  filters,\n  onChange,\n  onMultiSelectChange,\n  distinctOptions\n}: {\n  filters: Filters;\n  onChange: (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => void;\n  onMultiSelectChange: (name: string, values: string[]) => void;\n  distinctOptions: DistinctOptions;\n}) => (\n  <div className=\"bg-white p-4 rounded-lg shadow\">\n    <h2 className=\"text-lg font-semibold mb-4\">Фільтри</h2>\n    <div className=\"space-y-4\">\n      <FilterCheckbox\n        name=\"sale\"\n        label=\"Акційні товари\"\n        checked={filters.sale === 'true'}\n        onChange={onChange}\n      />\n      <FilterSelectMultiple\n        name=\"brand\"\n        label=\"Бренд\"\n        options={distinctOptions.brands}\n        value={filters.brand ? filters.brand.split(',') : []}\n        onChange={onMultiSelectChange}\n      />\n      <FilterSelectMultiple\n        name=\"model\"\n        label=\"Модель\"\n        options={distinctOptions.models}\n        value={filters.model ? filters.model.split(',') : []}\n        onChange={onMultiSelectChange}\n      />\n      <FilterSelectMultiple\n        name=\"width\"\n        label=\"Ширина\"\n        options={distinctOptions.widths}\n        value={filters.width ? filters.width.split(',') : []}\n        onChange={onMultiSelectChange}\n      />\n      <FilterSelectMultiple\n        name=\"profile\"\n        label=\"Профіль\"\n        options={distinctOptions.profiles}\n        value={filters.profile ? filters.profile.split(',') : []}\n        onChange={onMultiSelectChange}\n      />\n      <FilterSelectMultiple\n        name=\"diameter\"\n        label=\"Діаметр\"\n        options={distinctOptions.diameters}\n        value={filters.diameter ? filters.diameter.split(',') : []}\n        onChange={onMultiSelectChange}\n      />\n      <FilterSelectMultiple\n        name=\"season\"\n        label=\"Сезон\"\n        options={distinctOptions.seasons}\n        value={filters.season ? filters.season.split(',') : []}\n        onChange={onMultiSelectChange}\n      />\n      <FilterSelectMultiple\n        name=\"country\"\n        label=\"Країна\"\n        options={distinctOptions.countries}\n        value={filters.country ? filters.country.split(',') : []}\n        onChange={onMultiSelectChange}\n      />\n      <FilterSelectMultiple\n        name=\"year\"\n        label=\"Рік\"\n        options={distinctOptions.years}\n        value={filters.year ? filters.year.split(',') : []}\n        onChange={onMultiSelectChange}\n      />\n      <FilterCheckbox\n        name=\"spikes\"\n        label=\"Шипи\"\n        checked={filters.spikes === 'true'}\n        onChange={onChange}\n      />\n      <FilterNumberInput\n        name=\"minPrice\"\n        label=\"Мін. ціна\"\n        value={filters.minPrice}\n        onChange={onChange}\n      />\n      <FilterNumberInput\n        name=\"maxPrice\"\n        label=\"Макс. ціна\"\n        value={filters.maxPrice}\n        onChange={onChange}\n      />\n    </div>\n  </div>\n));\n\nconst FilterNumberInput = React.memo(({\n  name,\n  label,\n  value,\n  onChange,\n}: {\n  name: string;\n  label: string;\n  value: string;\n  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n}) => (\n  <div>\n    <label className=\"block text-sm font-medium mb-1\">{label}</label>\n    <input\n      name={name}\n      type=\"number\"\n      value={value}\n      onChange={onChange}\n      className={`w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent ${\n        value ? \"bg-blue-100\" : \"\"\n      }`}\n      min=\"0\"\n    />\n  </div>\n));\n\nconst FilterSelectMultiple = React.memo(({\n  name,\n  label,\n  options,\n  value,\n  onChange,\n}: {\n  name: string;\n  label: string;\n  options: Array<string | number>;\n  value: string[];\n  onChange: (name: string, values: string[]) => void;\n}) => {\n  return (\n    <div>\n      <label className=\"block text-sm font-medium mb-1\">{label}</label>\n      <Select\n        multiple\n        value={value}\n        onValueChange={(val) => onChange(name, val as string[])}\n        placeholder={`Выберите ${label.toLowerCase()}`}\n        onMouseDown={(e) => e.preventDefault()}\n        className={value.length > 0 ? \"bg-blue-100\" : \"\"}\n        {...(name === \"season\" && {\n          displayValue: (vals: string[]) =>\n            vals\n              .map((v) =>\n                v === \"summer\"\n                  ? \"ЛІТНІ\"\n                  : v === \"winter\"\n                  ? \"ЗИМОВІ\"\n                  : v === \"all-season\"\n                  ? \"ВСЕСЕЗОННІ\"\n                  : v\n              )\n              .join(\", \"),\n        })}\n      >\n        {options.map((option) => {\n          const optionString = option.toString();\n          const displayText =\n            name === \"season\"\n              ? optionString === \"summer\"\n                ? \"ЛІТНІ\"\n                : optionString === \"winter\"\n                ? \"ЗИМОВІ\"\n                : optionString === \"all-season\"\n                ? \"ВСЕСЕЗОННІ\"\n                : optionString\n              : optionString;\n          return (\n            <SelectItem key={optionString} value={optionString}>\n              {displayText}\n            </SelectItem>\n          );\n        })}\n      </Select>\n    </div>\n  );\n});\n\nconst FilterCheckbox = React.memo(({\n  name,\n  label,\n  checked,\n  onChange,\n}: {\n  name: string;\n  label: string;\n  checked: boolean;\n  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n}) => (\n  <div className={checked ? \"bg-blue-100 p-1 rounded\" : \"\"}>\n    <label className=\"flex items-center gap-2\">\n      <input\n        name={name}\n        type=\"checkbox\"\n        checked={checked}\n        onChange={onChange}\n        className=\"form-checkbox h-4 w-4 text-blue-600 transition-colors\"\n      />\n      <span className=\"text-sm font-medium\">{label}</span>\n    </label>\n  </div>\n));\n\nconst LoadingSpinner = React.memo(() => (\n  <div className=\"flex justify-center items-center h-64\">\n    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-800\"></div>\n  </div>\n));\n\nconst EmptyState = React.memo(({ onReset }: { onReset: () => void }) => (\n  <div className=\"text-center text-gray-500 py-8\">\n    <p className=\"text-xl mb-2\">Товари не знайдені</p>\n    <p className=\"text-sm mb-4\">Спробуйте змінити параметри фільтрів</p>\n    <button onClick={onReset} className=\"text-blue-600 hover:text-blue-700 underline text-sm\">\n      Скинути всі фільтри\n    </button>\n  </div>\n));\n\nexport default ProductList;\n","import { useState, useEffect } from 'react';\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\nimport { supabase } from '../lib/supabaseClient';\nimport { User } from '@supabase/supabase-js';\n\ninterface Review {\n  id: string;\n  product_id: string;\n  comment: string;\n  created_at: string;\n  user_id: string;\n  rating: number;\n}\n\nconst CommentsPage = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [reviews, setReviews] = useState<Review[]>([]);\n  const [newComment, setNewComment] = useState('');\n  const [rating, setRating] = useState(5);\n  const [user, setUser] = useState<User | null>(null);\n  const [loadingAuth, setLoadingAuth] = useState(true);\n\n  // Проверка авторизации при загрузке\n  useEffect(() => {\n    const checkAuth = async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      setUser(user);\n      setLoadingAuth(false);\n    };\n    checkAuth();\n  }, []);\n\n  // Если проверка завершена и пользователь не авторизован – редирект\n  useEffect(() => {\n    if (!loadingAuth && !user) {\n      navigate('/auth', { state: { from: location.pathname } });\n    }\n  }, [loadingAuth, user, navigate, location.pathname]);\n\n  // Загрузка отзывов для товара\n  useEffect(() => {\n    const loadReviews = async () => {\n      const { data, error } = await supabase\n        .from('reviews')\n        .select('id, product_id, comment, created_at, user_id, rating')\n        .eq('product_id', id)\n        .order('created_at', { ascending: false });\n      if (!error && data) {\n        setReviews(data as Review[]);\n      }\n    };\n\n    if (id) {\n      loadReviews();\n    }\n  }, [id]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newComment.trim()) return;\n\n    if (!user) {\n      navigate('/auth', { state: { from: location.pathname } });\n      return;\n    }\n\n    const { data, error } = await supabase\n      .from('reviews')\n      .insert([{ product_id: id, comment: newComment, rating, user_id: user.id }])\n      .select();\n\n    if (!error && data) {\n      setReviews([data[0] as Review, ...reviews]);\n      setNewComment('');\n      setRating(5);\n    }\n  };\n\n  // Не рендерим ничего, пока идет проверка авторизации\n  if (loadingAuth) return null;\n\n  return (\n    <div className=\"container mx-auto p-4\">\n      <div className=\"max-w-2xl mx-auto\">\n        <h1 className=\"text-2xl font-bold mb-2\">Відгуки про товар</h1>\n        <p className=\"mb-6 text-sm text-gray-600\">Всього відгуків: {reviews.length}</p>\n\n        <form onSubmit={handleSubmit} className=\"mb-8 bg-gray-50 p-4 rounded-lg\">\n          <div className=\"mb-4\">\n            <label className=\"block mb-2 font-medium\">Ваша оцінка:</label>\n            <select\n              value={rating}\n              onChange={(e) => setRating(Number(e.target.value))}\n              className=\"w-full p-2 border rounded\"\n            >\n              {[5, 4, 3, 2, 1].map((num) => (\n                <option key={num} value={num}>\n                  {num} ★\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <textarea\n            value={newComment}\n            onChange={(e) => setNewComment(e.target.value)}\n            className=\"w-full p-2 border rounded mb-4\"\n            placeholder=\"Напишіть ваш відгук...\"\n            rows={4}\n            required\n          />\n\n          <button\n            type=\"submit\"\n            className=\"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700\"\n          >\n            Опублікувати\n          </button>\n        </form>\n\n        <div className=\"space-y-6\">\n          {reviews.length === 0 ? (\n            <p>Відгуків поки немає.</p>\n          ) : (\n            reviews.map((review) => (\n              <div key={review.id} className=\"bg-white p-4 rounded-lg shadow-sm border\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <div className=\"flex items-center\">\n                    {[...Array(5)].map((_, i) => (\n                      <span\n                        key={i}\n                        className={`text-xl ${i < review.rating ? 'text-yellow-400' : 'text-gray-300'}`}\n                      >\n                        ★\n                      </span>\n                    ))}\n                  </div>\n                  <span className=\"text-sm text-gray-500\">\n                    {new Date(review.created_at).toLocaleDateString('uk-UA')}\n                  </span>\n                </div>\n                <p className=\"text-gray-800 mb-2\">{review.comment}</p>\n                <div className=\"text-sm text-gray-500\">\n                  Користувач: анонімний {review.user_id.slice(0, 6)}\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CommentsPage;\n","import React, { useState, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { Mail, Lock, User, Phone } from 'lucide-react';\nimport { supabase } from '../lib/supabaseClient';\nimport { toast, ToastContainer } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { User as SupabaseUser } from '@supabase/supabase-js';\n\nexport const Auth: React.FC = () => {\n  const [isLogin, setIsLogin] = useState(true);\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [name, setName] = useState('');\n  const [phone, setPhone] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [user, setUser] = useState<SupabaseUser | null>(null);\n  const navigate = useNavigate();\n  const location = useLocation();\n  // Если в state передан параметр \"from\", используем его, иначе - перенаправляем на /profile\n  const redirectTo = (location.state as { from?: string })?.from || '/profile';\n\n  useEffect(() => {\n    const getUser = async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user) {\n        setUser(user);\n        // Если пользователь уже аутентифицирован, перенаправляем сразу\n        navigate(redirectTo);\n      }\n    };\n    getUser();\n  }, [navigate, redirectTo]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      if (isLogin) {\n        const { error } = await supabase.auth.signInWithPassword({\n          email,\n          password,\n        });\n        if (error) throw error;\n        toast.success(\"Ви успішно увійшли в профіль!\");\n        navigate(redirectTo);\n      } else {\n        if (!name || !phone || !password) {\n          toast.error(\"Будь ласка, заповніть усі обов’язкові поля: ім’я, пароль та номер телефону.\");\n          setLoading(false);\n          return;\n        }\n\n        // Пытаемся выполнить вход, чтобы проверить, существует ли уже пользователь\n        const { error: signInError } = await supabase.auth.signInWithPassword({\n          email,\n          password,\n        });\n\n        if (signInError) {\n          if (signInError.message === \"Invalid login credentials\") {\n            // Если пользователя нет — регистрируем\n            const { error: signUpError } = await supabase.auth.signUp({\n              email,\n              password,\n            });\n            if (signUpError) throw signUpError;\n\n            // После регистрации получаем данные нового пользователя и создаем профиль\n            const { data: { user } } = await supabase.auth.getUser();\n            if (user) {\n              const { error: profileError } = await supabase\n                .from('users')\n                .insert([{ id: user.id, name, phone, email }]);\n              if (profileError) throw profileError;\n            }\n            toast.success(\"Реєстрацію успішно завершено!\");\n            toast.success(\"Ви успішно увійшли в профіль!\");\n            navigate(redirectTo);\n          } else {\n            throw signInError;\n          }\n        } else {\n          toast.error(\"Користувач з таким email вже зареєстрований.\");\n          setLoading(false);\n          return;\n        }\n      }\n    } catch (err) {\n      toast.error(err instanceof Error ? err.message : 'Сталася помилка');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleGoogleLogin = async () => {\n    setLoading(true);\n    try {\n      const { error } = await supabase.auth.signInWithOAuth({\n        provider: 'google',\n        options: {\n          redirectTo: `${window.location.origin}${redirectTo}`,\n        },\n      });\n      if (error) throw error;\n    } catch (err) {\n      toast.error(err instanceof Error ? err.message : 'Сталася помилка');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      const { error } = await supabase.auth.signOut();\n      if (error) throw error;\n      toast.success(\"Ви успішно вийшли з профілю!\");\n      setUser(null);\n      navigate('/');\n    } catch (err) {\n      toast.error(err instanceof Error ? err.message : 'Сталася помилка');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex flex-col items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative\">\n      <ToastContainer />\n\n      {user && (\n        <div className=\"mb-4\">\n          <button\n            onClick={handleLogout}\n            className=\"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-500\"\n          >\n            Вийти\n          </button>\n        </div>\n      )}\n\n      <div className=\"max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-md\">\n        <div>\n          <h2 className=\"text-center text-3xl font-bold text-gray-900\">\n            {isLogin ? 'Увійти в акаунт' : 'Створити акаунт'}\n          </h2>\n        </div>\n\n        <form className=\"mt-8 space-y-6\" onSubmit={handleSubmit}>\n          {!isLogin && (\n            <>\n              <div>\n                <label htmlFor=\"name\" className=\"sr-only\">Ім'я</label>\n                <div className=\"relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <User className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    id=\"name\"\n                    name=\"name\"\n                    type=\"text\"\n                    required\n                    value={name}\n                    onChange={(e) => setName(e.target.value)}\n                    className=\"appearance-none rounded-md relative block w-full px-3 py-2 pl-10 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm\"\n                    placeholder=\"Ім'я\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label htmlFor=\"phone\" className=\"sr-only\">Телефон</label>\n                <div className=\"relative\">\n                  <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                    <Phone className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                  <input\n                    id=\"phone\"\n                    name=\"phone\"\n                    type=\"text\"\n                    required\n                    value={phone}\n                    onChange={(e) => setPhone(e.target.value)}\n                    className=\"appearance-none rounded-md relative block w-full px-3 py-2 pl-10 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm\"\n                    placeholder=\"Телефон\"\n                  />\n                </div>\n              </div>\n            </>\n          )}\n\n          <div>\n            <label htmlFor=\"email\" className=\"sr-only\">Email</label>\n            <div className=\"relative\">\n              <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                <Mail className=\"h-5 w-5 text-gray-400\" />\n              </div>\n              <input\n                id=\"email\"\n                name=\"email\"\n                type=\"email\"\n                required\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                className=\"appearance-none rounded-md relative block w-full px-3 py-2 pl-10 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm\"\n                placeholder=\"Email\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <label htmlFor=\"password\" className=\"sr-only\">Пароль</label>\n            <div className=\"relative\">\n              <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                <Lock className=\"h-5 w-5 text-gray-400\" />\n              </div>\n              <input\n                id=\"password\"\n                name=\"password\"\n                type=\"password\"\n                required\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                className=\"appearance-none rounded-md relative block w-full px-3 py-2 pl-10 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm\"\n                placeholder=\"Пароль\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-800 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\"\n            >\n              {loading ? (\n                <div className=\"w-5 h-5 border-t-2 border-white rounded-full animate-spin\"></div>\n              ) : isLogin ? (\n                'Увійти'\n              ) : (\n                'Зареєструватися'\n              )}\n            </button>\n          </div>\n\n          <div>\n            <button\n              type=\"button\"\n              onClick={handleGoogleLogin}\n              disabled={loading}\n              className=\"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50\"\n            >\n              {loading ? 'Підключення...' : 'Увійти через Google'}\n            </button>\n          </div>\n\n          <div className=\"text-center\">\n            <button\n              type=\"button\"\n              onClick={() => setIsLogin(!isLogin)}\n              className=\"text-sm text-blue-800 hover:text-blue-700\"\n            >\n              {isLogin\n                ? 'Немає акаунту? Зареєструватися'\n                : 'Вже є акаунт? Увійти'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default Auth;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { User as UserIcon, Package, LogOut } from 'lucide-react';\nimport { supabase } from '../lib/supabaseClient';\nimport { User, Order } from '../types/database.types';\nimport { toast } from 'react-toastify';\n\nexport const Profile: React.FC = () => {\n  const navigate = useNavigate();\n  const [user, setUser] = useState<User | null>(null);\n  const [orders, setOrders] = useState<Order[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [editing, setEditing] = useState(false);\n  const [profileCreationAttempted, setProfileCreationAttempted] = useState(false);\n  const [formData, setFormData] = useState({\n    name: '',\n    phone: '',\n    address: '',\n  });\n  const initialLogin = useRef(true);\n\n  useEffect(() => {\n    const loadData = async () => {\n      await fetchUserData();\n      await fetchOrders();\n    };\n    loadData();\n  }, []);\n\n  const fetchUserData = async () => {\n    const { data: { user: authUser } } = await supabase.auth.getUser();\n    if (!authUser) {\n      navigate('/auth');\n      return;\n    }\n\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', authUser.id)\n      .maybeSingle();\n\n    if (error) {\n      console.error('Error fetching user:', error);\n      setLoading(false);\n      return;\n    }\n\n    if (!data) {\n      if (!profileCreationAttempted) {\n        setProfileCreationAttempted(true);\n        const { error: insertError, data: insertedData } = await supabase\n          .from('users')\n          .insert([{\n            id: authUser.id,\n            name: authUser.email,\n            phone: '',\n            address: '',\n          }])\n          .select()\n          .maybeSingle();\n\n        if (insertError) {\n          console.error('Error creating profile:', insertError);\n          toast.error('Помилка створення профілю');\n          setLoading(false);\n          return;\n        }\n\n        if (insertedData) {\n          setUser(insertedData);\n          setFormData({\n            name: insertedData.name || '',\n            phone: insertedData.phone || '',\n            address: insertedData.address || '',\n          });\n          toast.success('Профіль успішно створено!');\n        }\n      }\n      setLoading(false);\n      return;\n    }\n\n    setUser(data);\n    setFormData({\n      name: data.name || '',\n      phone: data.phone || '',\n      address: data.address || '',\n    });\n\n    if (initialLogin.current) {\n      toast.success('Вхід виконано успішно!');\n      initialLogin.current = false;\n    }\n    setLoading(false);\n  };\n\n  const fetchOrders = async () => {\n    const { data: { user: authUser } } = await supabase.auth.getUser();\n    if (!authUser) return;\n\n    const { data, error } = await supabase\n      .from('orders')\n      .select('*')\n      .eq('user_id', authUser.id)\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching orders:', error);\n      toast.error('Помилка завантаження замовлень');\n    } else {\n      setOrders(data);\n    }\n  };\n\n  const handleUpdateProfile = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user) return;\n\n    try {\n      const { error } = await supabase\n        .from('users')\n        .update(formData)\n        .eq('id', user.id);\n\n      if (error) throw error;\n\n      setEditing(false);\n      await fetchUserData();\n      toast.success('Профіль оновлено!');\n    } catch (error) {\n      console.error('Update error:', error);\n      toast.error('Помилка оновлення профілю');\n    }\n  };\n\n  const handleLogout = async () => {\n    await supabase.auth.signOut();\n    toast.success('Вихід виконано!');\n    navigate('/auth');\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-800\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <h1 className=\"text-2xl font-bold\">Особистий кабінет</h1>\n          <button\n            onClick={handleLogout}\n            className=\"flex items-center text-gray-600 hover:text-red-500\"\n          >\n            <LogOut className=\"w-5 h-5 mr-2\" />\n            Вийти\n          </button>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n          <div className=\"md:col-span-1\">\n            <div className=\"bg-white rounded-lg shadow-md p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-semibold\">Профіль</h2>\n                <button\n                  onClick={() => setEditing(!editing)}\n                  className=\"text-blue-800 hover:text-blue-700 text-sm\"\n                >\n                  {editing ? 'Скасувати' : 'Редагувати'}\n                </button>\n              </div>\n\n              {editing ? (\n                <form onSubmit={handleUpdateProfile} className=\"space-y-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Ім'я\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={formData.name}\n                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Телефон\n                    </label>\n                    <input\n                      type=\"tel\"\n                      value={formData.phone}\n                      onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Адреса\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={formData.address}\n                      onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                      className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n                    />\n                  </div>\n                  <button\n                    type=\"submit\"\n                    className=\"w-full bg-blue-800 text-white py-2 rounded-md hover:bg-blue-700\"\n                  >\n                    Зберегти\n                  </button>\n                </form>\n              ) : (\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center\">\n                    <UserIcon className=\"w-5 h-5 text-gray-400 mr-2\" />\n                    <span>{user?.name || 'Не вказано'}</span>\n                  </div>\n                  <div className=\"flex items-center\">\n                    <Package className=\"w-5 h-5 text-gray-400 mr-2\" />\n                    <span>{user?.phone || 'Не вказано'}</span>\n                  </div>\n                  <div className=\"flex items-center\">\n                    <Package className=\"w-5 h-5 text-gray-400 mr-2\" />\n                    <span>{user?.address || 'Не вказано'}</span>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          <div className=\"md:col-span-2\">\n            <div className=\"bg-white rounded-lg shadow-md p-6\">\n              <h2 className=\"text-xl font-semibold mb-4\">Історія замовлень</h2>\n              {orders.length === 0 ? (\n                <p className=\"text-gray-500\">У вас ще немає замовлень</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {orders.map((order) => (\n                    <div\n                      key={order.id}\n                      className=\"border border-gray-200 rounded-md p-4\"\n                    >\n                      <div className=\"flex justify-between items-center mb-2\">\n                        <span className=\"text-sm text-gray-500\">\n                          {new Date(order.created_at).toLocaleDateString()}\n                        </span>\n                        <span\n                          className={`px-2 py-1 rounded-full text-xs ${\n                            order.status === 'delivered'\n                              ? 'bg-green-100 text-green-800'\n                              : order.status === 'pending'\n                              ? 'bg-yellow-100 text-yellow-800'\n                              : 'bg-blue-100 text-blue-800'\n                          }`}\n                        >\n                          {order.status === 'delivered'\n                            ? 'Доставлено'\n                            : order.status === 'pending'\n                            ? 'В обробці'\n                            : 'В дорозі'}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"font-medium\">\n                          Замовлення #{order.id.slice(0, 8)}\n                        </span>\n                        <span className=\"font-bold\">{order.total} ₴</span>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Profile;","import axios from 'axios';\n\nconst NOVA_BASE_URL = 'https://api.novaposhta.ua/v2.0/json/';\nconst NOVA_API_KEY = import.meta.env.VITE_APP_NOVA_API_KEY;\n\ninterface CacheEntry<T> {\n  data: T;\n  timestamp: number;\n}\n\nconst cache = new Map<string, CacheEntry<unknown>>();\nconst CACHE_EXPIRY = 30 * 60 * 1000; // 30 минут\n\nexport interface NovaResponse<T> {\n  success: boolean;\n  data: T;\n  errors: string[];\n  warnings: string[];\n  info: string;\n}\n\nexport interface NovaCity {\n  Description: string;\n  Ref: string;\n  Area: string;\n  Regions: string;\n}\n\nexport interface NovaSettlement {\n  Description: string;\n  Ref: string;\n  CityRef?: string;\n}\n\nexport interface NovaWarehouse {\n  Description: string;\n  Ref: string;\n  CityRef: string;\n  SiteKey: string;\n}\n\nexport interface WarehouseQueryParams {\n  CityName?: string;\n  CityRef?: string;\n  FindByString?: string;\n  Page?: string;\n  Limit?: string;\n  Language?: string;\n  TypeOfWarehouseRef?: string;\n  WarehouseId?: string;\n  SettlementRef?: string;\n  BicycleParking?: string;\n  PostFinance?: string;\n  Ref?: string;\n}\n\n// Универсальная функция для выполнения запросов с использованием кэширования\nconst makeRequest = async <T>(\n  modelName: string,\n  calledMethod: string,\n  methodProperties: Record<string, string>,\n  skipCache = false\n): Promise<T> => {\n  const cacheKey = `${modelName}_${calledMethod}_${JSON.stringify(methodProperties)}`;\n  \n  if (!skipCache) {\n    const cachedData = cache.get(cacheKey) as CacheEntry<T> | undefined;\n    if (cachedData && Date.now() - cachedData.timestamp < CACHE_EXPIRY) {\n      return cachedData.data;\n    }\n  }\n  \n  try {\n    const response = await axios.post<NovaResponse<T>>(NOVA_BASE_URL, {\n      apiKey: NOVA_API_KEY,\n      modelName,\n      calledMethod,\n      methodProperties,\n    });\n    \n    if (response.data.success) {\n      cache.set(cacheKey, { data: response.data.data, timestamp: Date.now() });\n      return response.data.data;\n    } else {\n      throw new Error(response.data.errors.join(', '));\n    }\n  } catch (error) {\n    const errorMessage = error instanceof Error \n      ? error.message \n      : 'Unknown error occurred';\n    throw new Error(`API Request failed: ${errorMessage}`);\n  }\n};\n\n// Получение городов с пагинацией и кэшированием\nexport const getCities = async (): Promise<NovaCity[]> => {\n  const cacheKey = 'all_cities';\n  const cachedData = cache.get(cacheKey) as CacheEntry<NovaCity[]> | undefined;\n  \n  if (cachedData && Date.now() - cachedData.timestamp < CACHE_EXPIRY) {\n    return cachedData.data;\n  }\n  \n  const allCities: NovaCity[] = [];\n  const limit = 300;\n  let page = 1;\n  let morePages = true;\n\n  try {\n    while (morePages) {\n      const cities = await makeRequest<NovaCity[]>(\n        'Address',\n        'getCities',\n        {\n          Page: page.toString(),\n          Limit: limit.toString(),\n          Language: \"UA\"\n        },\n        true // Пропускаем кэширование для каждой страницы\n      );\n      \n      allCities.push(...cities);\n      \n      if (cities.length < limit) {\n        morePages = false;\n      } else {\n        page++;\n      }\n    }\n    \n    cache.set(cacheKey, { data: allCities, timestamp: Date.now() });\n    return allCities;\n  } catch (error: unknown) {\n    console.error('Error fetching cities:', error);\n    throw error;\n  }\n};\n\n// Получение отделений по городу\nexport const getWarehouses = async (\n  params: WarehouseQueryParams\n): Promise<NovaWarehouse[]> => {\n  try {\n    const methodProperties: Record<string, string> = {\n      Page: \"1\",\n      Limit: \"300\",\n      Language: \"UA\",\n      ...params,\n    };\n    \n    return await makeRequest<NovaWarehouse[]>(\n      'AddressGeneral',\n      'getWarehouses',\n      methodProperties\n    );\n  } catch (error: unknown) {\n    console.error('Error fetching warehouses:', error);\n    return [];\n  }\n};\n\nexport const clearNovaApiCache = () => {\n  cache.clear();\n};\n\nexport default {\n  getCities,\n  getWarehouses,\n  clearNovaApiCache,\n};","import React, { useState, useEffect, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Truck, CreditCard } from 'lucide-react';\nimport Select from 'react-select';\nimport AsyncSelect from 'react-select/async';\nimport { supabase } from '../lib/supabaseClient';\nimport { useCartStore } from '../stores/cartStore';\nimport { getCities, getWarehouses } from '../lib/nova';\n\ninterface CityOption {\n  value: string;\n  label: string;\n  ref: string;\n}\n\ninterface WarehouseOption {\n  value: string;\n  label: string;\n}\n\ninterface CartItem {\n  product_id: string;\n  quantity: number;\n  price: number;\n}\n\nexport const Checkout: React.FC = () => {\n  const navigate = useNavigate();\n  const { items, clearCart, total } = useCartStore();\n  const [loading, setLoading] = useState<boolean>(false);\n  const [cities, setCities] = useState<CityOption[]>([]);\n  const [isCitiesLoading, setIsCitiesLoading] = useState<boolean>(false);\n  const [isWarehousesLoading, setIsWarehousesLoading] = useState<boolean>(false);\n  const [warehouses, setWarehouses] = useState<WarehouseOption[]>([]);\n  const [selectedCity, setSelectedCity] = useState<CityOption | null>(null);\n\n  const [formData, setFormData] = useState({\n    firstName: '',\n    lastName: '',\n    phone: '',\n    cityRef: '',\n    warehouseRef: '',\n    delivery: 'nova-poshta',\n    payment: 'card',\n    city: '',\n    warehouse: '',\n  });\n\n  // Load cities only once when the component mounts\n  useEffect(() => {\n    const loadCities = async () => {\n      if (cities.length > 0) return; // Prevent redundant API calls\n      \n      setIsCitiesLoading(true);\n      try {\n        const citiesData = await getCities();\n        setCities(\n          citiesData.map((city) => ({\n            value: city.Ref,\n            label: city.Description,\n            ref: city.Ref,\n          }))\n        );\n      } catch (error) {\n        console.error('Error loading cities:', error);\n      } finally {\n        setIsCitiesLoading(false);\n      }\n    };\n\n    if (formData.delivery === 'nova-poshta') {\n      loadCities();\n    }\n  }, [formData.delivery, cities.length]);\n\n  // Memoize the loadWarehousesBySearch function to prevent recreating it on every render\n  const loadWarehousesBySearch = useCallback(\n    async (inputValue: string): Promise<WarehouseOption[]> => {\n      if (!formData.cityRef) return [];\n      \n      setIsWarehousesLoading(true);\n      try {\n        const warehousesData = await getWarehouses({\n          CityRef: formData.cityRef,\n          FindByString: inputValue,\n        });\n        \n        const options = warehousesData.map((wh) => ({\n          value: wh.Ref || '',\n          label: wh.Description,\n        }));\n        \n        return options;\n      } catch (error) {\n        console.error('Error loading warehouses by search:', error);\n        return [];\n      } finally {\n        setIsWarehousesLoading(false);\n      }\n    },\n    [formData.cityRef]\n  );\n\n  // Load default warehouses when city is selected\n  const loadWarehousesDefault = useCallback(async (cityRef: string) => {\n    if (!cityRef) return;\n    \n    setIsWarehousesLoading(true);\n    try {\n      const warehousesData = await getWarehouses({ CityRef: cityRef });\n      \n      const defaultWarehouses = warehousesData.map((wh) => ({\n        value: wh.Ref || '',\n        label: wh.Description,\n      }));\n      \n      setWarehouses(defaultWarehouses);\n    } catch (error) {\n      console.error('Error loading warehouses:', error);\n      setWarehouses([]);\n    } finally {\n      setIsWarehousesLoading(false);\n    }\n  }, []);\n\n  // Handle city selection\n  const handleCityChange = useCallback((selected: CityOption | null) => {\n    if (selected) {\n      setSelectedCity(selected);\n      setFormData({\n        ...formData,\n        city: selected.label,\n        cityRef: selected.value,\n        warehouseRef: '',\n        warehouse: '',\n      });\n      \n      // Load warehouses for the selected city\n      loadWarehousesDefault(selected.value);\n    } else {\n      setSelectedCity(null);\n      setFormData({\n        ...formData,\n        city: '',\n        cityRef: '',\n        warehouseRef: '',\n        warehouse: '',\n      });\n      setWarehouses([]);\n    }\n  }, [formData, loadWarehousesDefault]);\n\n  // Handle warehouse selection\n  const handleWarehouseChange = useCallback((selected: WarehouseOption | null) => {\n    setFormData({\n      ...formData,\n      warehouse: selected?.label || '',\n      warehouseRef: selected?.value || '',\n    });\n  }, [formData]);\n\n  // Handle delivery method change\n  const handleDeliveryChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n    \n    if (value === 'odessa-pickup') {\n      setFormData({\n        ...formData,\n        delivery: value,\n        city: 'Одеса',\n        warehouse: 'Склад Одеса',\n        cityRef: '',\n        warehouseRef: '',\n      });\n      setSelectedCity(null);\n      setWarehouses([]);\n    } else {\n      setFormData({\n        ...formData,\n        delivery: value,\n        city: '',\n        warehouse: '',\n        cityRef: '',\n        warehouseRef: '',\n      });\n      setSelectedCity(null);\n      setWarehouses([]);\n    }\n  }, [formData]);\n\n  // Validate form before submission\n  const isFormValid = () => {\n    if (!formData.firstName || !formData.lastName || !formData.phone) {\n      return false;\n    }\n    \n    if (formData.delivery === 'nova-poshta') {\n      return Boolean(formData.cityRef && formData.warehouseRef);\n    }\n    \n    return true;\n  };\n\n  // Handle form submission\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    \n    // Validate form\n    if (!isFormValid()) {\n      alert('Будь ласка, заповніть всі обов\\'язкові поля');\n      return;\n    }\n    \n    setLoading(true);\n\n    try {\n      // Get current authenticated user\n      const {\n        data: { user: authUser },\n      } = await supabase.auth.getUser();\n      \n      if (!authUser) {\n        throw new Error('Користувач не авторизований');\n      }\n      \n      const userId = authUser.id;\n\n      // Create order\n      const { data: order, error: orderError } = await supabase\n        .from('orders')\n        .insert([\n          {\n            user_id: userId,\n            status: 'pending',\n            total: total(),\n            first_name: formData.firstName,\n            last_name: formData.lastName,\n            customer_phone: formData.phone,\n            shipping_address: formData.delivery === 'nova-poshta' \n              ? `${formData.city}, ${formData.warehouse}` \n              : 'Одеса, самовивіз',\n            delivery_method: formData.delivery,\n            payment_method: formData.payment,\n          },\n        ])\n        .select('*')\n        .single();\n\n      if (orderError) throw orderError;\n\n      // Insert order items\n      const orderItems = items.map((item: CartItem) => ({\n        order_id: order.id,\n        product_id: item.product_id,\n        quantity: item.quantity,\n        price: item.price,\n      }));\n\n      const { error: itemsError } = await supabase.from('order_items').insert(orderItems);\n      if (itemsError) throw itemsError;\n\n      clearCart();\n      navigate('/profile');\n    } catch (error) {\n      console.error('Помилка оформлення замовлення:', error);\n      alert(error instanceof Error ? error.message : 'Сталася невідома помилка');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"max-w-3xl mx-auto\">\n        <h1 className=\"text-2xl font-bold mb-8\">Оформлення замовлення</h1>\n        <form onSubmit={handleSubmit} className=\"space-y-8\">\n          {/* Contact information */}\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">Контактні дані</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Ім'я*</label>\n                <input\n                  type=\"text\"\n                  required\n                  value={formData.firstName}\n                  onChange={(e) =>\n                    setFormData({ ...formData, firstName: e.target.value })\n                  }\n                  className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Прізвище*</label>\n                <input\n                  type=\"text\"\n                  required\n                  value={formData.lastName}\n                  onChange={(e) =>\n                    setFormData({ ...formData, lastName: e.target.value })\n                  }\n                  className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                />\n              </div>\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Телефон*</label>\n                <input\n                  type=\"tel\"\n                  required\n                  value={formData.phone}\n                  onChange={(e) =>\n                    setFormData({ ...formData, phone: e.target.value })\n                  }\n                  className=\"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  pattern=\"[0-9]{10}\"\n                  placeholder=\"0991234567\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Delivery */}\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">Доставка</h2>\n            <div className=\"space-y-4\">\n              <div className=\"flex flex-col space-y-2\">\n                <label className=\"flex items-center space-x-2\">\n                  <input\n                    type=\"radio\"\n                    value=\"nova-poshta\"\n                    checked={formData.delivery === 'nova-poshta'}\n                    onChange={handleDeliveryChange}\n                    className=\"text-blue-600 focus:ring-blue-500\"\n                  />\n                  <span className=\"flex items-center\">\n                    <Truck className=\"w-5 h-5 mr-2\" /> Нова Пошта\n                  </span>\n                </label>\n                <label className=\"flex items-center space-x-2\">\n                  <input\n                    type=\"radio\"\n                    value=\"odessa-pickup\"\n                    checked={formData.delivery === 'odessa-pickup'}\n                    onChange={handleDeliveryChange}\n                    className=\"text-blue-600 focus:ring-blue-500\"\n                  />\n                  <span className=\"flex items-center\">\n                    <Truck className=\"w-5 h-5 mr-2\" /> Зібрати зі складу (Одеса)\n                  </span>\n                </label>\n              </div>\n              \n              {/* Nova Poshta delivery options */}\n              {formData.delivery === 'nova-poshta' && (\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Місто*</label>\n                    <Select\n                      options={cities}\n                      value={selectedCity}\n                      onChange={handleCityChange}\n                      placeholder=\"Оберіть місто...\"\n                      noOptionsMessage={() => 'Місто не знайдено'}\n                      loadingMessage={() => 'Завантаження...'}\n                      isSearchable\n                      isLoading={isCitiesLoading}\n                      className=\"react-select-container\"\n                      classNamePrefix=\"react-select\"\n                      styles={{\n                        control: (base) => ({\n                          ...base,\n                          border: '1px solid #e5e7eb',\n                          borderRadius: '0.375rem',\n                          padding: '0.25rem',\n                        }),\n                      }}\n                    />\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Відділення*</label>\n                    <AsyncSelect\n                      key={formData.cityRef} // Re-mount when city changes\n                      cacheOptions\n                      defaultOptions={warehouses}\n                      loadOptions={loadWarehousesBySearch}\n                      onChange={handleWarehouseChange}\n                      isDisabled={!formData.cityRef}\n                      placeholder={formData.cityRef ? \"Оберіть відділення...\" : \"Спочатку оберіть місто\"}\n                      noOptionsMessage={() => 'Відділення не знайдено'}\n                      loadingMessage={() => 'Завантаження...'}\n                      isLoading={isWarehousesLoading}\n                      className=\"react-select-container\"\n                      classNamePrefix=\"react-select\"\n                      styles={{\n                        control: (base) => ({\n                          ...base,\n                          border: '1px solid #e5e7eb',\n                          borderRadius: '0.375rem',\n                          padding: '0.25rem',\n                        }),\n                      }}\n                    />\n                    {formData.cityRef && warehouses.length === 0 && !isWarehousesLoading && (\n                      <p className=\"text-sm text-yellow-600 mt-1\">\n                        Завантаження відділень... Якщо список порожній, спробуйте ввести перші букви вулиці або номер відділення.\n                      </p>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Payment */}\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">Оплата</h2>\n            <div className=\"space-y-4\">\n              <div className=\"flex flex-col space-y-2\">\n                <label className=\"flex items-center space-x-2\">\n                  <input\n                    type=\"radio\"\n                    value=\"card\"\n                    checked={formData.payment === 'card'}\n                    onChange={(e) =>\n                      setFormData({ ...formData, payment: e.target.value })\n                    }\n                    className=\"text-blue-600 focus:ring-blue-500\"\n                  />\n                  <span className=\"flex items-center\">\n                    <CreditCard className=\"w-5 h-5 mr-2\" /> Оплата карткою онлайн\n                  </span>\n                </label>\n                <label className=\"flex items-center space-x-2\">\n                  <input\n                    type=\"radio\"\n                    value=\"cash\"\n                    checked={formData.payment === 'cash'}\n                    onChange={(e) =>\n                      setFormData({ ...formData, payment: e.target.value })\n                    }\n                    className=\"text-blue-600 focus:ring-blue-500\"\n                  />\n                  <span className=\"flex items-center\">\n                    <CreditCard className=\"w-5 h-5 mr-2\" /> Оплата при отриманні\n                  </span>\n                </label>\n              </div>\n            </div>\n          </div>\n\n          {/* Order summary (optional) */}\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">Ваше замовлення</h2>\n            <div className=\"border-t border-gray-200 pt-4\">\n              <div className=\"flex justify-between font-semibold text-lg\">\n                <span>Загальна сума:</span>\n                <span>{total().toFixed(2)} грн</span>\n              </div>\n            </div>\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={loading || !isFormValid()}\n            className=\"w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex justify-center items-center\"\n          >\n            {loading ? (\n              <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\" />\n            ) : (\n              'Підтвердити замовлення'\n            )}\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default Checkout;","// ArticleDetailPage.tsx\nimport React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { supabase } from '../lib/supabaseClient';\n\ninterface Article {\n  id: number;\n  title: string;\n  content: string;\n  image_path?: string;\n}\n\nconst ArticleDetailPage: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const [article, setArticle] = useState<Article | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  const getPublicUrl = (imagePath: string) => {\n    const { data } = supabase.storage\n      .from('articles-images')\n      .getPublicUrl(imagePath);\n    return data.publicUrl;\n  };\n\n  useEffect(() => {\n    const fetchArticle = async () => {\n      const { data, error } = await supabase\n        .from('articles')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) {\n        console.error('Error fetching article:', error);\n      } else {\n        setArticle(data);\n      }\n      setLoading(false);\n    };\n\n    fetchArticle();\n  }, [id]);\n\n  if (loading) return <div>Loading...</div>;\n  if (!article) return <div>Article not found</div>;\n\n  return (\n    <div className=\"container mx-auto p-4\">\n      <h1 className=\"text-3xl font-bold mb-4\">{article.title}</h1>\n      {article.image_path && (\n        <img\n          src={getPublicUrl(article.image_path)}\n          alt={article.title}\n          className=\"w-full h-64 object-cover mb-4 rounded-lg\"\n        />\n      )}\n      <div className=\"prose max-w-none\">\n        <pre className=\"whitespace-pre-wrap\">{article.content}</pre>\n      </div>\n    </div>\n  );\n};\n\nexport default ArticleDetailPage;","import React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '../../lib/supabaseClient';\nimport { toast } from 'react-toastify';\n\nconst AuthCallback: React.FC = () => {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const fetchAccessToken = async () => {\n      try {\n        const code = new URLSearchParams(window.location.search).get('code');\n        if (!code) {\n          navigate('/login');\n          return;\n        }\n\n        // Получение access token\n        const response = await fetch(import.meta.env.VITE_SUPABASE_AUTH_CALLBACK_URL, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ code }),\n        });\n\n        if (!response.ok) throw new Error('Ошибка при получении токена');\n        \n        const data = await response.json();\n        \n        // Аутентификация через Supabase\n        const { data: { user }, error: authError } = await supabase.auth.signInWithIdToken({\n          provider: 'google',\n          token: data.access_token,\n        });\n\n        if (authError) throw new Error(authError.message);\n        if (!user) throw new Error('Пользователь не найден');\n\n        // Миграция гостевых данных\n        const guestId = localStorage.getItem('guest_id');\n        if (guestId) {\n          const { error: migrateError } = await supabase.rpc('migrate_guest_data', {\n            guest_id: guestId,\n            user_id: user.id,\n          });\n\n          if (migrateError) {\n            console.error('Ошибка миграции гостевых данных:', migrateError);\n            toast.warning('Не удалось перенести гостевые данные');\n          } else {\n            toast.success('Данные гостя успешно перенесены');\n            localStorage.removeItem('guest_id');\n          }\n        }\n\n        toast.success('Успешная аутентификация!');\n        navigate('/admin');\n\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Неизвестная ошибка';\n        console.error('Ошибка аутентификации:', error);\n        toast.error(`Ошибка аутентификации: ${message}`);\n        navigate('/login');\n      }\n    };\n\n    fetchAccessToken();\n  }, [navigate]);\n\n  return (\n    <div className=\"auth-callback-container\">\n      <div className=\"spinner\"></div>\n    </div>\n  );\n};\n\nexport default AuthCallback;","import React, {\n  useEffect,\n  useState,\n  useImperativeHandle,\n  forwardRef,\n  useRef,\n} from \"react\";\n\nexport interface ToastProps {\n  message: string;\n  duration?: number;\n  onClose: () => void;\n}\n\nexport interface ToastHandle {\n  dismiss: (exitType?: \"manual\" | \"auto\") => void;\n}\n\nexport const Toast = forwardRef<ToastHandle, ToastProps>(\n  ({ message, duration = 3000, onClose }, ref) => {\n    const [visible, setVisible] = useState(true);\n    const [exiting, setExiting] = useState(false);\n    const [exitType, setExitType] = useState<\"auto\" | \"manual\" | null>(null);\n    const timerRef = useRef<number | null>(null);\n    const [isMobile, setIsMobile] = useState(false);\n\n    // Определяем, мобильное ли устройство (ширина окна меньше 768px)\n    useEffect(() => {\n      const handleResize = () => {\n        setIsMobile(window.innerWidth < 768);\n      };\n      handleResize();\n      window.addEventListener(\"resize\", handleResize);\n      return () => window.removeEventListener(\"resize\", handleResize);\n    }, []);\n\n    // Добавляем keyframes для анимаций\n    useEffect(() => {\n      const styleElement = document.createElement(\"style\");\n      styleElement.innerHTML = `\n        @keyframes slideIn {\n          from { transform: translateY(100%); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        @keyframes slideOut {\n          from { transform: translateY(0); opacity: 1; }\n          to { transform: translateY(100%); opacity: 0; }\n        }\n        @keyframes fadeOut {\n          from { opacity: 1; }\n          to { opacity: 0; }\n        }\n      `;\n      document.head.appendChild(styleElement);\n      return () => {\n        document.head.removeChild(styleElement);\n      };\n    }, []);\n\n    // Устанавливаем таймер авто‑закрытия (запускается один раз при монтировании)\n    useEffect(() => {\n      timerRef.current = window.setTimeout(() => {\n        if (!exiting) {\n          setExitType(\"auto\");\n          setExiting(true);\n        }\n      }, duration);\n      return () => {\n        if (timerRef.current) clearTimeout(timerRef.current);\n      };\n    }, [duration, exiting]);\n\n    // Позволяем родительскому компоненту закрывать уведомление вручную\n    useImperativeHandle(\n      ref,\n      () => ({\n        dismiss: (type: \"manual\" | \"auto\" = \"manual\") => {\n          if (!exiting) {\n            if (timerRef.current) clearTimeout(timerRef.current);\n            setExitType(type);\n            setExiting(true);\n          }\n        },\n      }),\n      [exiting]\n    );\n\n    // После завершения анимации вызываем onClose и скрываем уведомление\n    const handleAnimationEnd = () => {\n      if (exiting) {\n        setVisible(false);\n        onClose();\n      }\n    };\n\n    if (!visible) return null;\n\n    // Если уведомление закрывается вручную — используем fadeOut, иначе — slideOut (при авто‑закрытии)\n    const animationStyle = exiting\n      ? exitType === \"manual\"\n        ? \"fadeOut 0.5s ease-out forwards\"\n        : \"slideOut 0.5s ease-out forwards\"\n      : \"slideIn 0.5s ease-out forwards\";\n\n    // Для мобильной версии выводим уведомление как горизонтальный баннер внизу экрана,\n    // для десктопа – как всплывающее окно в правом верхнем углу.\n    const toastStyle: React.CSSProperties = isMobile\n      ? {\n          position: \"fixed\",\n          bottom: \"16px\",\n          left: \"16px\",\n          right: \"16px\",\n          textAlign: \"center\",\n          zIndex: 50,\n          backgroundColor: \"red\",\n          color: \"white\",\n          padding: \"8px 16px\",\n          borderRadius: \"4px\",\n          boxShadow: \"0 2px 8px rgba(0, 0, 0, 0.2)\",\n          animation: animationStyle,\n        }\n      : {\n          position: \"fixed\",\n          top: \"16px\",\n          right: \"16px\",\n          zIndex: 50,\n          backgroundColor: \"red\",\n          color: \"white\",\n          padding: \"8px 16px\",\n          borderRadius: \"4px\",\n          boxShadow: \"0 2px 8px rgba(0, 0, 0, 0.2)\",\n          animation: animationStyle,\n        };\n\n    return (\n      <div style={toastStyle} onAnimationEnd={handleAnimationEnd}>\n        {message}\n      </div>\n    );\n  }\n);\n\nToast.displayName = \"Toast\";\n","import { useState, useEffect, useCallback } from \"react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { Button } from \"../components/ui/button\";\nimport { Select, SelectItem } from \"../components/ui/select\";\nimport { supabase } from \"../lib/supabaseClient\";\nimport { Toast } from \"../components/ui/Toast\";\n\nexport const DetailedSearch = () => {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n\n  // Фильтры для базовых параметров (мультивыбор)\n  const [brands, setBrands] = useState<string[]>([]);\n  const [models, setModels] = useState<string[]>([]);\n  const [widths, setWidths] = useState<number[]>([]);\n  const [diameters, setDiameters] = useState<number[]>([]);\n  const [profiles, setProfiles] = useState<number[]>([]);\n  const [seasons, setSeasons] = useState<string[]>([]);\n\n  // Дополнительные (расширенные) фильтры (мультивыбор)\n  const [noiseLevels, setNoiseLevels] = useState<number[]>([]);\n  const [countries, setCountries] = useState<string[]>([]);\n  const [years, setYears] = useState<number[]>([]);\n  const [wetGrips, setWetGrips] = useState<string[]>([]);\n  const [fuelEfficiencies, setFuelEfficiencies] = useState<string[]>([]);\n  const [loadIndexes, setLoadIndexes] = useState<string[]>([]);\n  const [speedIndexes, setSpeedIndexes] = useState<string[]>([]);\n\n  // Состояния для ценового фильтра\n  const [minPrice, setMinPrice] = useState<string>(\"\");\n  const [maxPrice, setMaxPrice] = useState<string>(\"\");\n  const [minDbPrice, setMinDbPrice] = useState<number>(0);\n  const [maxDbPrice, setMaxDbPrice] = useState<number>(0);\n  const [sliderValue, setSliderValue] = useState<number>(0);\n\n  // Новый фильтр \"Акційні товари\"\n  const [sale, setSale] = useState<boolean>(false);\n\n  // Выбранные значения для базовых фильтров (мультивыбор)\n  const [selectedBrands, setSelectedBrands] = useState<string[]>([]);\n  const [selectedModels, setSelectedModels] = useState<string[]>([]);\n  const [selectedWidths, setSelectedWidths] = useState<string[]>([]);\n  const [selectedDiameters, setSelectedDiameters] = useState<string[]>([]);\n  const [selectedProfiles, setSelectedProfiles] = useState<string[]>([]);\n  const [selectedSeasons, setSelectedSeasons] = useState<string[]>([]);\n\n  // Выбранные значения для расширенных фильтров (мультивыбор)\n  const [selectedNoiseLevels, setSelectedNoiseLevels] = useState<string[]>([]);\n  const [selectedCountries, setSelectedCountries] = useState<string[]>([]);\n  const [selectedYears, setSelectedYears] = useState<string[]>([]);\n  const [selectedWetGrips, setSelectedWetGrips] = useState<string[]>([]);\n  const [selectedFuelEfficiencies, setSelectedFuelEfficiencies] = useState<string[]>([]);\n  const [selectedLoadIndexes, setSelectedLoadIndexes] = useState<string[]>([]);\n  const [selectedSpeedIndexes, setSelectedSpeedIndexes] = useState<string[]>([]);\n\n  // Фильтр «шипы» реализован как чекбокс\n  const [spikes, setSpikes] = useState<boolean>(false);\n\n  // Флаг для показа/скрытия дополнительных фильтров\n  const [showAdvanced, setShowAdvanced] = useState<boolean>(false);\n\n  const [loading, setLoading] = useState(true);\n  const [toastMessage, setToastMessage] = useState<string>(\"\");\n  const [showToast, setShowToast] = useState(false);\n\n  // Функция показа уведомления\n  const showToastMessage = useCallback((message: string) => {\n    setToastMessage(message);\n    setShowToast(true);\n  }, []);\n\n  // Функция закрытия уведомления\n  const handleToastClose = useCallback(() => {\n    setShowToast(false);\n    setToastMessage(\"\");\n  }, []);\n\n  // Инициализация выбранных значений из query-параметров\n  useEffect(() => {\n    const brandsParam = searchParams.get(\"brand\");\n    if (brandsParam) setSelectedBrands(brandsParam.split(\",\"));\n\n    const modelsParam = searchParams.get(\"model\");\n    if (modelsParam) setSelectedModels(modelsParam.split(\",\"));\n\n    const widthsParam = searchParams.get(\"width\");\n    if (widthsParam) setSelectedWidths(widthsParam.split(\",\"));\n\n    const diametersParam = searchParams.get(\"diameter\");\n    if (diametersParam) setSelectedDiameters(diametersParam.split(\",\"));\n\n    const profilesParam = searchParams.get(\"profile\");\n    if (profilesParam) setSelectedProfiles(profilesParam.split(\",\"));\n\n    const seasonsParam = searchParams.get(\"season\");\n    if (seasonsParam) setSelectedSeasons(seasonsParam.split(\",\"));\n\n    const noiseLevelParam = searchParams.get(\"noiseLevel\");\n    if (noiseLevelParam) setSelectedNoiseLevels(noiseLevelParam.split(\",\"));\n\n    const countryParam = searchParams.get(\"country\");\n    if (countryParam) setSelectedCountries(countryParam.split(\",\"));\n\n    const yearParam = searchParams.get(\"year\");\n    if (yearParam) setSelectedYears(yearParam.split(\",\"));\n\n    const wetGripParam = searchParams.get(\"wetGrip\");\n    if (wetGripParam) setSelectedWetGrips(wetGripParam.split(\",\"));\n\n    const fuelEfficiencyParam = searchParams.get(\"fuelEfficiency\");\n    if (fuelEfficiencyParam) setSelectedFuelEfficiencies(fuelEfficiencyParam.split(\",\"));\n\n    const loadIndexParam = searchParams.get(\"loadIndex\");\n    if (loadIndexParam) setSelectedLoadIndexes(loadIndexParam.split(\",\"));\n\n    const speedIndexParam = searchParams.get(\"speedIndex\");\n    if (speedIndexParam) setSelectedSpeedIndexes(speedIndexParam.split(\",\"));\n\n    const spikesParam = searchParams.get(\"spikes\");\n    if (spikesParam) setSpikes(spikesParam === \"true\");\n\n    const saleParam = searchParams.get(\"sale\");\n    if (saleParam) setSale(saleParam === \"true\");\n\n    const minPriceParam = searchParams.get(\"minPrice\");\n    if (minPriceParam) setMinPrice(minPriceParam);\n\n    const maxPriceParam = searchParams.get(\"maxPrice\");\n    if (maxPriceParam) setMaxPrice(maxPriceParam);\n  }, [searchParams]);\n\n  useEffect(() => {\n    const fetchFilters = async () => {\n      try {\n        const { data, error } = await supabase\n          .from(\"products\")\n          .select(\n            `brand, model, width, diameter, profile, season, price,\n             noise_level, country, year, wet_grip, fuel_efficiency,\n             load_index, speed_index, spikes`\n          );\n\n        if (error) throw error;\n\n        if (data && data.length > 0) {\n          const uniqueData = {\n            brands: Array.from(new Set(data.map((item) => item.brand)))\n              .filter(Boolean)\n              .sort((a, b) => a.localeCompare(b)),\n            models: Array.from(new Set(data.map((item) => item.model)))\n              .filter(Boolean)\n              .sort((a, b) => a.localeCompare(b)),\n            widths: Array.from(new Set(data.map((item) => item.width)))\n              .filter((val) => val !== null)\n              .sort((a, b) => a - b),\n            diameters: Array.from(new Set(data.map((item) => item.diameter)))\n              .filter((val) => val !== null)\n              .sort((a, b) => a - b),\n            profiles: Array.from(new Set(data.map((item) => item.profile)))\n              .filter((val) => val !== null)\n              .sort((a, b) => a - b),\n            seasons: Array.from(new Set(data.map((item) => item.season)))\n              .filter(Boolean)\n              .sort((a, b) => a.localeCompare(b)),\n            noiseLevels: Array.from(new Set(data.map((item) => item.noise_level)))\n              .filter((val) => val !== null)\n              .sort((a, b) => a - b),\n            countries: Array.from(new Set(data.map((item) => item.country)))\n              .filter(Boolean)\n              .sort((a, b) => a.localeCompare(b)),\n            years: Array.from(new Set(data.map((item) => item.year)))\n              .filter((val) => val !== null)\n              .sort((a, b) => a - b),\n            wetGrips: Array.from(new Set(data.map((item) => item.wet_grip)))\n              .filter(Boolean)\n              .sort((a, b) => a.localeCompare(b)),\n            fuelEfficiencies: Array.from(new Set(data.map((item) => item.fuel_efficiency)))\n              .filter(Boolean)\n              .sort((a, b) => a.localeCompare(b)),\n            loadIndexes: Array.from(new Set(data.map((item) => item.load_index)))\n              .filter(Boolean)\n              .sort((a, b) => a.localeCompare(b)),\n            speedIndexes: Array.from(new Set(data.map((item) => item.speed_index)))\n              .filter(Boolean)\n              .sort((a, b) => a.localeCompare(b)),\n          };\n\n          setBrands(uniqueData.brands);\n          setModels(uniqueData.models);\n          setWidths(uniqueData.widths);\n          setDiameters(uniqueData.diameters);\n          setProfiles(uniqueData.profiles);\n          setSeasons(uniqueData.seasons);\n          setNoiseLevels(uniqueData.noiseLevels);\n          setCountries(uniqueData.countries);\n          setYears(uniqueData.years);\n          setWetGrips(uniqueData.wetGrips);\n          setFuelEfficiencies(uniqueData.fuelEfficiencies);\n          setLoadIndexes(uniqueData.loadIndexes);\n          setSpeedIndexes(uniqueData.speedIndexes);\n\n          const prices = data.map((item) => item.price);\n          const dbMinPrice = Math.min(...prices);\n          const dbMaxPrice = Math.max(...prices);\n          setMinDbPrice(dbMinPrice);\n          setMaxDbPrice(dbMaxPrice);\n          setSliderValue(dbMaxPrice);\n        }\n      } catch (error) {\n        console.error(\"Error fetching filters:\", error);\n        showToastMessage(\"Помилка завантаження фільтрів\");\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchFilters();\n  }, [showToastMessage]);\n\n  const handlePriceChange = (\n    e: React.ChangeEvent<HTMLInputElement>,\n    type: \"min\" | \"max\"\n  ) => {\n    const value = e.target.value.replace(/\\D/g, \"\");\n    handleToastClose();\n    if (type === \"min\") {\n      setMinPrice(value);\n    } else {\n      setMaxPrice(value);\n    }\n  };\n\n  const handleSliderChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = Number(e.target.value);\n    setSliderValue(value);\n    setMinPrice(minDbPrice.toString());\n    setMaxPrice(value.toString());\n  };\n\n  const validatePrice = () => {\n    if (maxPrice === \"\") return;\n    const effectiveMax = parseInt(maxPrice);\n    if (effectiveMax < minDbPrice) {\n      showToastMessage(`Максимальна ціна не може бути нижчою за ${minDbPrice}`);\n      return;\n    }\n    if (effectiveMax > maxDbPrice) {\n      showToastMessage(`Максимальна ціна не може бути вищою за ${maxDbPrice}`);\n      return;\n    }\n    const effectiveMin = minPrice ? parseInt(minPrice) : minDbPrice;\n    if (effectiveMin >= effectiveMax) {\n      showToastMessage(\"Максимальне значення має бути більшим за мінімальне\");\n    }\n  };\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    const effectiveMinPrice = minPrice ? parseInt(minPrice) : minDbPrice;\n    const effectiveMaxPrice = maxPrice ? parseInt(maxPrice) : maxDbPrice;\n\n    if (effectiveMaxPrice < minDbPrice) {\n      showToastMessage(`Максимальна ціна не може бути нижчою за ${minDbPrice}`);\n      return;\n    }\n    if (effectiveMaxPrice > maxDbPrice) {\n      showToastMessage(`Максимальна ціна не може бути вищою за ${maxDbPrice}`);\n      return;\n    }\n    if (effectiveMinPrice >= effectiveMaxPrice) {\n      showToastMessage(\"Максимальне значення має бути більшим за мінімальне\");\n      return;\n    }\n\n    const params = new URLSearchParams();\n    params.set(\"minPrice\", effectiveMinPrice.toString());\n    params.set(\"maxPrice\", effectiveMaxPrice.toString());\n\n    if (selectedBrands.length > 0) params.set(\"brand\", selectedBrands.join(\",\"));\n    if (selectedModels.length > 0) params.set(\"model\", selectedModels.join(\",\"));\n    if (selectedWidths.length > 0) params.set(\"width\", selectedWidths.join(\",\"));\n    if (selectedDiameters.length > 0) params.set(\"diameter\", selectedDiameters.join(\",\"));\n    if (selectedProfiles.length > 0) params.set(\"profile\", selectedProfiles.join(\",\"));\n    if (selectedSeasons.length > 0) params.set(\"season\", selectedSeasons.join(\",\"));\n\n    if (selectedNoiseLevels.length > 0) params.set(\"noiseLevel\", selectedNoiseLevels.join(\",\"));\n    if (selectedCountries.length > 0) params.set(\"country\", selectedCountries.join(\",\"));\n    if (selectedYears.length > 0) params.set(\"year\", selectedYears.join(\",\"));\n    if (selectedWetGrips.length > 0) params.set(\"wetGrip\", selectedWetGrips.join(\",\"));\n    if (selectedFuelEfficiencies.length > 0) params.set(\"fuelEfficiency\", selectedFuelEfficiencies.join(\",\"));\n    if (selectedLoadIndexes.length > 0) params.set(\"loadIndex\", selectedLoadIndexes.join(\",\"));\n    if (selectedSpeedIndexes.length > 0) params.set(\"speedIndex\", selectedSpeedIndexes.join(\",\"));\n    if (spikes) params.set(\"spikes\", \"true\");\n    if (sale) params.set(\"sale\", \"true\");\n\n    navigate(`/search-results?${params.toString()}`);\n  };\n\n  const handleReset = () => {\n    setMinPrice(\"\");\n    setMaxPrice(\"\");\n    setSelectedBrands([]);\n    setSelectedModels([]);\n    setSelectedWidths([]);\n    setSelectedDiameters([]);\n    setSelectedProfiles([]);\n    setSelectedSeasons([]);\n    setSelectedNoiseLevels([]);\n    setSelectedCountries([]);\n    setSelectedYears([]);\n    setSelectedWetGrips([]);\n    setSelectedFuelEfficiencies([]);\n    setSelectedLoadIndexes([]);\n    setSelectedSpeedIndexes([]);\n    setSpikes(false);\n    setSale(false);\n    handleToastClose();\n  };\n\n  return (\n    <div className=\"bg-white min-h-screen\">\n      <div className=\"container mx-auto p-4 relative\">\n        {showToast && (\n          <Toast message={toastMessage} duration={5000} onClose={handleToastClose} />\n        )}\n\n        <h1 className=\"text-2xl font-bold mb-6\">Детальний пошук</h1>\n\n        <form onSubmit={handleSearch} className=\"p-6\">\n          {/* Ціновий діапазон */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium mb-2\">ЦІНОВИЙ ДІАПАЗОН</h3>\n              <div className=\"flex items-center gap-2 mb-2\">\n                <input\n                  type=\"checkbox\"\n                  id=\"sale\"\n                  checked={sale}\n                  onChange={(e) => setSale(e.target.checked)}\n                  className=\"form-checkbox\"\n                />\n                <label htmlFor=\"sale\" className=\"text-sm font-medium\">\n                  Акційні товари\n                </label>\n              </div>\n              <div className=\"flex gap-4\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Мінімум\"\n                  value={minPrice}\n                  onChange={(e) => handlePriceChange(e, \"min\")}\n                  className=\"w-full p-2 border rounded\"\n                  inputMode=\"numeric\"\n                />\n                <input\n                  type=\"text\"\n                  placeholder=\"Максимум\"\n                  value={maxPrice}\n                  onChange={(e) => handlePriceChange(e, \"max\")}\n                  onBlur={validatePrice}\n                  className=\"w-full p-2 border rounded\"\n                  inputMode=\"numeric\"\n                />\n              </div>\n              {!loading && maxDbPrice > minDbPrice && (\n                <div className=\"space-y-2\">\n                  <h3 className=\"font-medium\">Швидкий вибір максимальної ціни</h3>\n                  <input\n                    type=\"range\"\n                    min={minDbPrice}\n                    max={maxDbPrice}\n                    value={sliderValue}\n                    onChange={handleSliderChange}\n                    className=\"w-full\"\n                  />\n                  <div className=\"text-sm text-gray-600\">Вибрано: до {sliderValue}</div>\n                </div>\n              )}\n            </div>\n\n            {/* Фільтри базових параметрів */}\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium mb-2\">БАЗОВІ ПАРАМЕТРИ</h3>\n              <Select\n                multiple\n                value={selectedBrands}\n                onValueChange={(value) => setSelectedBrands(value as string[])}\n                placeholder={loading ? \"Завантаження...\" : \"ВСІ БРЕНДИ\"}\n                disabled={loading}\n              >\n                {brands.map((brand) => (\n                  <SelectItem key={brand} value={brand}>\n                    {brand.toUpperCase()}\n                  </SelectItem>\n                ))}\n              </Select>\n\n              <Select\n                multiple\n                value={selectedModels}\n                onValueChange={(value) => setSelectedModels(value as string[])}\n                placeholder=\"ВСІ МОДЕЛІ\"\n              >\n                {models.map((model) => (\n                  <SelectItem key={model} value={model}>\n                    {model.toUpperCase()}\n                  </SelectItem>\n                ))}\n              </Select>\n\n              <Select\n                multiple\n                value={selectedDiameters}\n                onValueChange={(value) => setSelectedDiameters(value as string[])}\n                placeholder=\"ВИБЕРІТЬ ДІАМЕТР\"\n              >\n                {diameters.map((diameter) => {\n                  const val = diameter.toString();\n                  return (\n                    <SelectItem key={diameter} value={val}>\n                      {`R${diameter}`}\n                    </SelectItem>\n                  );\n                })}\n              </Select>\n            </div>\n          </div>\n\n          {/* Фільтри габаритів */}\n          <div className=\"grid grid-cols-2 gap-4 mt-6\">\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium mb-2\">ШИРИНА</h3>\n              <Select\n                multiple\n                value={selectedWidths}\n                onValueChange={(value) => setSelectedWidths(value as string[])}\n                placeholder=\"ВИБЕРІТЬ ШИРИНУ\"\n              >\n                {widths.map((width) => {\n                  const val = width.toString();\n                  return (\n                    <SelectItem key={width} value={val}>\n                      {width}\n                    </SelectItem>\n                  );\n                })}\n              </Select>\n            </div>\n            <div className=\"space-y-4\">\n              <h3 className=\"font-medium mb-2\">ПРОФІЛЬ</h3>\n              <Select\n                multiple\n                value={selectedProfiles}\n                onValueChange={(value) => setSelectedProfiles(value as string[])}\n                placeholder=\"ВИБЕРІТЬ ПРОФІЛЬ\"\n              >\n                {profiles.map((profile) => {\n                  const val = profile.toString();\n                  return (\n                    <SelectItem key={profile} value={val}>\n                      {profile}\n                    </SelectItem>\n                  );\n                })}\n              </Select>\n            </div>\n          </div>\n\n          {/* Фільтр по сезону */}\n          <div className=\"space-y-4 mt-6\">\n            <h3 className=\"font-medium mb-2\">СЕЗОН</h3>\n            <Select\n              multiple\n              value={selectedSeasons}\n              onValueChange={(value) => setSelectedSeasons(value as string[])}\n              placeholder=\"ВИБЕРІТЬ СЕЗОН\"\n              displayValue={(value: string[]) =>\n                value\n                  .map((v) =>\n                    v === \"summer\" ? \"ЛІТНІ\" : v === \"winter\" ? \"ЗИМОВІ\" : \"ВСЕСЕЗОННІ\"\n                  )\n                  .join(\", \")\n              }\n            >\n              {seasons.map((season) => (\n                <SelectItem key={season} value={season}>\n                  {season === \"summer\"\n                    ? \"ЛІТНІ\"\n                    : season === \"winter\"\n                    ? \"ЗИМОВІ\"\n                    : \"ВСЕСЕЗОННІ\"}\n                </SelectItem>\n              ))}\n            </Select>\n          </div>\n\n          {/* Кнопка \"Показати/Сховати додаткові параметри\" */}\n          <div className=\"mt-6\">\n            <Button\n              type=\"button\"\n              onClick={() => setShowAdvanced((prev) => !prev)}\n              className=\"bg-blue-600 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded w-full md:w-auto\"\n            >\n              {showAdvanced ? \"Сховати додаткові параметри\" : \"Показати додаткові параметри\"}\n            </Button>\n          </div>\n\n          {showAdvanced && (\n            <div className=\"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"space-y-4\">\n                <h3 className=\"font-medium mb-2\">УРОВЕНЬ ШУМУ</h3>\n                <Select\n                  multiple\n                  value={selectedNoiseLevels}\n                  onValueChange={(value) => setSelectedNoiseLevels(value as string[])}\n                  placeholder=\"ВИБЕРІТЬ\"\n                >\n                  {noiseLevels.map((noise) => {\n                    const val = noise.toString();\n                    return (\n                      <SelectItem key={noise} value={val}>\n                        {noise}\n                      </SelectItem>\n                    );\n                  })}\n                </Select>\n              </div>\n\n              <div className=\"space-y-4\">\n                <h3 className=\"font-medium mb-2\">КРАЇНА</h3>\n                <Select\n                  multiple\n                  value={selectedCountries}\n                  onValueChange={(value) => setSelectedCountries(value as string[])}\n                  placeholder=\"ВИБЕРІТЬ КРАЇНУ\"\n                >\n                  {countries.map((country) => (\n                    <SelectItem key={country} value={country}>\n                      {country.toUpperCase()}\n                    </SelectItem>\n                  ))}\n                </Select>\n              </div>\n\n              <div className=\"space-y-4\">\n                <h3 className=\"font-medium mb-2\">ГОД</h3>\n                <Select\n                  multiple\n                  value={selectedYears}\n                  onValueChange={(value) => setSelectedYears(value as string[])}\n                  placeholder=\"ВИБЕРІТЬ РІК\"\n                >\n                  {years.map((year) => {\n                    const val = year.toString();\n                    return (\n                      <SelectItem key={year} value={val}>\n                        {year}\n                      </SelectItem>\n                    );\n                  })}\n                </Select>\n              </div>\n\n              <div className=\"space-y-4\">\n                <h3 className=\"font-medium mb-2\">СЦЕПЛЕННЯ</h3>\n                <Select\n                  multiple\n                  value={selectedWetGrips}\n                  onValueChange={(value) => setSelectedWetGrips(value as string[])}\n                  placeholder=\"ВИБЕРІТЬ\"\n                >\n                  {wetGrips.map((wg) => (\n                    <SelectItem key={wg} value={wg}>\n                      {wg.toUpperCase()}\n                    </SelectItem>\n                  ))}\n                </Select>\n              </div>\n\n              <div className=\"space-y-4\">\n                <h3 className=\"font-medium mb-2\">ЕФЕКТИВНІСТЬ ПАЛИВА</h3>\n                <Select\n                  multiple\n                  value={selectedFuelEfficiencies}\n                  onValueChange={(value) => setSelectedFuelEfficiencies(value as string[])}\n                  placeholder=\"ВИБЕРІТЬ\"\n                >\n                  {fuelEfficiencies.map((fe) => (\n                    <SelectItem key={fe} value={fe}>\n                      {fe.toUpperCase()}\n                    </SelectItem>\n                  ))}\n                </Select>\n              </div>\n\n              <div className=\"space-y-4\">\n                <h3 className=\"font-medium mb-2\">ІНДЕКС НАВАНТАЖЕННЯ</h3>\n                <Select\n                  multiple\n                  value={selectedLoadIndexes}\n                  onValueChange={(value) => setSelectedLoadIndexes(value as string[])}\n                  placeholder=\"ВИБЕРІТЬ\"\n                >\n                  {loadIndexes.map((li) => (\n                    <SelectItem key={li} value={li}>\n                      {li.toUpperCase()}\n                    </SelectItem>\n                  ))}\n                </Select>\n              </div>\n\n              <div className=\"space-y-4\">\n                <h3 className=\"font-medium mb-2\">ІНДЕКС ШВИДКОСТІ</h3>\n                <Select\n                  multiple\n                  value={selectedSpeedIndexes}\n                  onValueChange={(value) => setSelectedSpeedIndexes(value as string[])}\n                  placeholder=\"ВИБЕРІТЬ\"\n                >\n                  {speedIndexes.map((si) => (\n                    <SelectItem key={si} value={si}>\n                      {si.toUpperCase()}\n                    </SelectItem>\n                  ))}\n                </Select>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"spikes\"\n                    checked={spikes}\n                    onChange={(e) => setSpikes(e.target.checked)}\n                    className=\"form-checkbox\"\n                  />\n                  <label htmlFor=\"spikes\" className=\"ml-2 select-none\">\n                    ШИПИ\n                  </label>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Нижние кнопки: \"Скасувати\" и \"Пошук\" */}\n          <div className=\"mt-8 flex items-center justify-between gap-4\">\n            <Button\n              type=\"button\"\n              onClick={handleReset}\n              className=\"bg-red-500 hover:bg-red-600 text-white text-sm px-4 py-2 rounded\"\n            >\n              Скасувати\n            </Button>\n            <Button\n              type=\"submit\"\n              className=\"bg-green-500 hover:bg-green-600 text-white text-sm px-8 py-2 rounded\"\n            >\n              Пошук\n            </Button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n","import React, { useState, useEffect, useCallback } from 'react';\nimport { ChevronUp, Filter } from 'lucide-react';\nimport { motion, AnimatePresence, useReducedMotion } from 'framer-motion';\nimport { throttle } from 'lodash-es';\n\nexport const MiniButton: React.FC = () => {\n  const [showMiniFilter, setShowMiniFilter] = useState(false);\n  const [icon, setIcon] = useState<'chevron' | 'filter'>('chevron');\n  const shouldReduceMotion = useReducedMotion();\n\n  // Оптимизированный обработчик скролла\n  useEffect(() => {\n    const handleScroll = throttle(() => {\n      const shouldShow = window.scrollY > 150;\n      setShowMiniFilter(prev => (prev !== shouldShow ? shouldShow : prev));\n    }, 100);\n\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n  // Переключение иконок только при видимой кнопке\n  useEffect(() => {\n    if (!showMiniFilter) return;\n    const interval = setInterval(() => {\n      setIcon(prev => (prev === 'chevron' ? 'filter' : 'chevron'));\n    }, 5000);\n    return () => clearInterval(interval);\n  }, [showMiniFilter]);\n\n  const scrollToTop = useCallback(() => {\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth',\n    });\n  }, []);\n\n  // Выбор конфигурации анимации в зависимости от shouldReduceMotion\n  const transitionConfig = shouldReduceMotion\n    ? { type: 'tween', duration: 0.3 }\n    : { type: 'spring', stiffness: 200, damping: 25, mass: 0.5 };\n\n  const animationConfig = {\n    initial: { opacity: 0, y: 100 },\n    animate: { \n      opacity: 1,\n      y: 0,\n      transition: transitionConfig\n    },\n    exit: {\n      opacity: 0,\n      y: 100,\n      transition: { duration: 0.2 }\n    }\n  };\n\n  return (\n    <AnimatePresence mode=\"wait\">\n      {showMiniFilter && (\n        <motion.button\n          key=\"mini-btn\" // Заменить ключ\n          {...animationConfig}\n          className=\"fixed z-50 flex items-center justify-center w-12 h-12 rounded-full bg-blue-600/60 shadow-lg bottom-20 right-4 backdrop-blur-sm hover:bg-blue-700/70 transition-colors\"\n          onTouchStart={(e) => e.preventDefault()}\n          onClick={scrollToTop}\n          aria-label=\"Scroll to top\"\n        >\n          {/* Удалить вложенный AnimatePresence */}\n          <motion.div\n            key={icon}\n            initial={{ opacity: 0, scale: 0.8 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.8 }}\n            transition={{ duration: 0.2 }}\n          >\n            {icon === 'chevron' ? (\n              <ChevronUp className=\"w-6 h-6 text-white\" strokeWidth={2.5} />\n            ) : (\n              <Filter className=\"w-6 h-6 text-white\" strokeWidth={2.5} />\n            )}\n          </motion.div>\n        </motion.button>\n      )}\n    </AnimatePresence>\n  );\n};\n","import { useLocation, useParams, useNavigate } from 'react-router-dom';\nimport { useState, useEffect, useRef } from 'react';\nimport { supabase } from './lib/supabaseClient';\n\nconst BC = () => {\n  const { id } = useParams<{ id?: string }>();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const { pathname } = location;\n\n  // История навигации\n  const [navHistory, setNavHistory] = useState([{ pathname: '/', title: 'Головна' }]);\n  // Состояние для заголовка (товара или статьи)\n  const [itemTitle, setItemTitle] = useState<string | null>(null);\n\n  // Ссылка на последний элемент хлебных крошек\n  const lastBreadcrumbRef = useRef<HTMLLIElement>(null);\n  // Контейнер для скроллинга\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n\n  // Для drag scroll\n  const isDown = useRef(false);\n  const startX = useRef(0);\n  const scrollLeftRef = useRef(0);\n\n  // Функция для получения перевода для определённого маршрута\n  const getTitle = (path: string) => {\n    if (path === '/') return 'Головна';\n    const translations: { [key: string]: string } = {\n      'detailed-search': 'Розширений пошук',\n      'search-results': 'Результати пошуку',\n      'product': 'Товар',\n      'tires': 'Шини',\n      'wheels': 'Диски',\n      'auth': 'Авторизація',\n      'profile': 'Профіль',\n      'checkout': 'Оформлення',\n      'admin': 'Адмінпанель',\n      'articles': 'Статті'\n    };\n    const segment = path.split('/')[1];\n    return translations[segment] || segment.replace(/-/g, ' ');\n  };\n\n  // Обновление истории при смене маршрута\n  useEffect(() => {\n    setNavHistory(prev => {\n      const existingIndex = prev.findIndex(entry => entry.pathname === pathname);\n      if (existingIndex !== -1) return prev.slice(0, existingIndex + 1);\n      // Если id есть и заголовок уже получен, используем его, иначе получаем перевод для маршрута\n      const title = id && itemTitle ? itemTitle : getTitle(pathname);\n      return [...prev, { pathname, title }];\n    });\n  }, [pathname, id, itemTitle]);\n\n  // Получение данных для деталей товара или статьи в зависимости от маршрута\n  useEffect(() => {\n    if (id) {\n      if (pathname.startsWith('/product/')) {\n        // Получаем данные товара\n        const fetchProduct = async () => {\n          const { data, error } = await supabase\n            .from('products')\n            .select('brand, model')\n            .eq('id', id)\n            .single();\n          if (!error && data) {\n            const title = `${data.brand} ${data.model}`;\n            setItemTitle(title);\n            setNavHistory(prev =>\n              prev.map(entry =>\n                entry.pathname === pathname ? { ...entry, title } : entry\n              )\n            );\n          } else {\n            console.error('Error fetching product data:', error);\n          }\n        };\n        fetchProduct();\n      } else if (pathname.startsWith('/articles/')) {\n        // Получаем данные статьи\n        const fetchArticle = async () => {\n          const { data, error } = await supabase\n            .from('articles')\n            .select('title')\n            .eq('id', id)\n            .single();\n          if (!error && data) {\n            const title = data.title;\n            setItemTitle(title);\n            setNavHistory(prev =>\n              prev.map(entry =>\n                entry.pathname === pathname ? { ...entry, title } : entry\n              )\n            );\n          } else {\n            console.error('Error fetching article data:', error);\n          }\n        };\n        fetchArticle();\n      }\n    }\n  }, [id, pathname]);\n\n  // Обработчик клика по хлебной крошке\n  const handleBreadcrumbClick = (index: number, path: string) => (e: React.MouseEvent<HTMLAnchorElement>) => {\n    e.preventDefault();\n    setNavHistory(prev => prev.slice(0, index + 1));\n    navigate(path);\n  };\n\n  // Автоскролл с bounce-эффектом для последней крошки\n  useEffect(() => {\n    const container = scrollContainerRef.current;\n    if (container && container.scrollWidth > container.clientWidth) {\n      const startScroll = container.scrollLeft;\n      const targetScroll = container.scrollWidth - container.clientWidth;\n      const duration = 800; // длительность анимации в мс\n      let startTime: number | null = null;\n\n      const animate = (timestamp: number) => {\n        if (!startTime) startTime = timestamp;\n        const elapsed = timestamp - startTime;\n        const progress = Math.min(elapsed / duration, 1);\n        const easeOutProgress = 1 - Math.pow(1 - progress, 3);\n        container.scrollLeft = startScroll + (targetScroll - startScroll) * easeOutProgress;\n        if (progress < 1) {\n          requestAnimationFrame(animate);\n        } else {\n          // Запускаем bounce-эффект у последнего элемента\n          if (lastBreadcrumbRef.current) {\n            lastBreadcrumbRef.current.classList.add('bounce');\n            setTimeout(() => {\n              if (lastBreadcrumbRef.current) {\n                lastBreadcrumbRef.current.classList.remove('bounce');\n              }\n            }, 500);\n          }\n        }\n      };\n\n      requestAnimationFrame(animate);\n    }\n  }, [navHistory]);\n\n  // Drag scroll (мышь)\n  const handleMouseDown = (e: React.MouseEvent) => {\n    const container = scrollContainerRef.current;\n    if (!container) return;\n    isDown.current = true;\n    startX.current = e.pageX - container.offsetLeft;\n    scrollLeftRef.current = container.scrollLeft;\n  };\n\n  const handleMouseLeave = () => {\n    isDown.current = false;\n  };\n\n  const handleMouseUp = () => {\n    isDown.current = false;\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    const container = scrollContainerRef.current;\n    if (!container || !isDown.current) return;\n    e.preventDefault();\n    const x = e.pageX - container.offsetLeft;\n    const walk = x - startX.current;\n    container.scrollLeft = scrollLeftRef.current - walk;\n  };\n\n  // Drag scroll (сенсорные события)\n  const handleTouchStart = (e: React.TouchEvent) => {\n    const container = scrollContainerRef.current;\n    if (!container) return;\n    isDown.current = true;\n    startX.current = e.touches[0].pageX - container.offsetLeft;\n    scrollLeftRef.current = container.scrollLeft;\n  };\n\n  const handleTouchEnd = () => {\n    isDown.current = false;\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    const container = scrollContainerRef.current;\n    if (!container || !isDown.current) return;\n    const x = e.touches[0].pageX - container.offsetLeft;\n    const walk = x - startX.current;\n    container.scrollLeft = scrollLeftRef.current - walk;\n  };\n\n  return (\n    <>\n      {/* Встроенные стили для bounce-анимации */}\n      <style>{`\n        @keyframes bounce {\n          0% { transform: translateY(0); }\n          30% { transform: translateY(-8px); }\n          50% { transform: translateY(0); }\n          70% { transform: translateY(-4px); }\n          100% { transform: translateY(0); }\n        }\n        .bounce {\n          animation: bounce 0.5s ease-out;\n        }\n      `}</style>\n      <nav aria-label=\"breadcrumb\" className=\"p-3 bg-gray-100 text-xs\">\n        <div\n          ref={scrollContainerRef}\n          className=\"overflow-x-auto whitespace-nowrap select-none\"\n          onMouseDown={handleMouseDown}\n          onMouseLeave={handleMouseLeave}\n          onMouseUp={handleMouseUp}\n          onMouseMove={handleMouseMove}\n          onTouchStart={handleTouchStart}\n          onTouchEnd={handleTouchEnd}\n          onTouchMove={handleTouchMove}\n        >\n          <ol className=\"flex items-center space-x-1\">\n            {navHistory.map((entry, index) => {\n              const isLast = index === navHistory.length - 1;\n              return (\n                <li key={index} className=\"flex items-center\" ref={isLast ? lastBreadcrumbRef : undefined}>\n                  {index !== 0 && <span className=\"mx-1\">-•-</span>}\n                  {isLast ? (\n                    <span className=\"text-gray-500\">{entry.title}</span>\n                  ) : (\n                    <a href={entry.pathname} onClick={handleBreadcrumbClick(index, entry.pathname)}>\n                      {entry.title}\n                    </a>\n                  )}\n                </li>\n              );\n            })}\n          </ol>\n        </div>\n      </nav>\n    </>\n  );\n};\n\nexport default BC;\n","import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport { NavLink, Outlet, useNavigate } from 'react-router-dom';\nimport {\n  LayoutDashboard,\n  Package,\n  Users,\n  ShoppingBag,\n  BarChart,\n  Settings,\n  LogOut,\n  Menu,\n  FileText, // Импортируем иконку для статьи\n} from 'lucide-react';\nimport { supabase } from '../../lib/supabaseClient';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport Modal from 'react-modal';\nimport { toast } from 'react-toastify';\n\nModal.setAppElement('#root');\n\ninterface NavItem {\n  to: string;\n  icon: JSX.Element;\n  text: string;\n}\n\nexport interface Session {\n  id: string;\n  user_id?: string;\n  guest_id?: string;\n  last_activity: string;\n  is_online: boolean;\n}\n\nexport const AdminLayout: React.FC = () => {\n  const navigate = useNavigate();\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n  const [isLogoutModalOpen, setIsLogoutModalOpen] = useState(false);\n  const [isLoggingOut, setIsLoggingOut] = useState(false);\n  const [sessions, setSessions] = useState<Session[]>([]);\n  const [isLoadingSessions, setIsLoadingSessions] = useState(true);\n  const [sessionsError, setSessionsError] = useState('');\n  const sidebarRef = useRef<HTMLDivElement>(null);\n\n  // Добавляем новый пункт «Статті» в массив навигации\n  const navItems = useMemo<NavItem[]>(() => [\n    { to: '/admin', icon: <LayoutDashboard />, text: 'Панель' },\n    { to: '/admin/products', icon: <Package />, text: 'Товари' },\n    { to: '/admin/orders', icon: <ShoppingBag />, text: 'Замовлення' },\n    { to: '/admin/sessions', icon: <Users />, text: 'Сесії' },\n    { to: '/admin/analytics', icon: <BarChart />, text: 'Аналітика' },\n    { to: '/admin/settings', icon: <Settings />, text: 'Налаштування' },\n    { to: '/admin/articles', icon: <FileText />, text: 'Статті' },\n  ], []);\n\n  const refreshSessions = useCallback(async () => {\n    try {\n      setIsLoadingSessions(true);\n      const { data, error } = await supabase\n        .from('sessions')\n        .select('*')\n        .order('last_activity', { ascending: false });\n      if (error) throw error;\n      setSessions(data || []);\n      setSessionsError('');\n    } catch (error) {\n      setSessionsError('Не удалось загрузить данные сессий');\n      console.error('Ошибка загрузки сессий:', error);\n      toast.error('Ошибка загрузки данных сессий');\n    } finally {\n      setIsLoadingSessions(false);\n    }\n  }, []);\n\n  // Генерация guest_id с использованием валидного UUID\n  const generateGuestId = () => {\n    return crypto.randomUUID();\n  };\n\n  // Функция обновления сессии до гостевой без создания новой записи.\n  // Если уже существует session_id, то обновляем соответствующую запись.\n  const updateSessionToGuest = async () => {\n    try {\n      const storedSessionId = localStorage.getItem('session_id');\n      const now = new Date().toISOString();\n      if (storedSessionId) {\n        let guestId = localStorage.getItem('guest_id');\n        if (!guestId) {\n          guestId = generateGuestId();\n          localStorage.setItem('guest_id', guestId);\n        }\n        const updatedSession = {\n          user_id: null,\n          guest_id: guestId,\n          last_activity: now,\n          is_online: true,\n        };\n        const { data, error } = await supabase\n          .from('sessions')\n          .update(updatedSession)\n          .eq('id', storedSessionId)\n          .select();\n        if (error) {\n          console.error('Ошибка обновления сессии до гостевой:', error);\n          toast.error(`Ошибка обновления сессии: ${error.message}`);\n          throw error;\n        }\n        console.log('Сессия успешно обновлена до гостевой:', data);\n        return data;\n      } else {\n        // Если session_id отсутствует, создаём новую гостевую сессию\n        const guestId = generateGuestId();\n        const newSession = {\n          user_id: null,\n          guest_id: guestId,\n          last_activity: new Date().toISOString(),\n          is_online: true,\n        };\n        const { data, error } = await supabase\n          .from('sessions')\n          .insert(newSession)\n          .select();\n        if (error) {\n          console.error('Ошибка создания гостевой сессии:', error);\n          toast.error(`Ошибка гостевой сессии: ${error.message}`);\n          throw error;\n        }\n        console.log('Гостевая сессия успешно создана:', data);\n        if (data && data.length > 0) {\n          localStorage.setItem('session_id', data[0].id);\n          localStorage.setItem('guest_id', guestId);\n        }\n        return data;\n      }\n    } catch (err) {\n      console.error('Ошибка в updateSessionToGuest:', err);\n      toast.error('Не удалось обновить сессию до гостевой');\n      return null;\n    }\n  };\n\n  // Функция создания или обновления сессии с учетом миграции гостевой сессии.\n  // Если пользователь авторизован, выполняется миграция гостевой сессии (если она есть) и upsert сессии.\n  const createSession = async () => {\n    try {\n      const { data: userData, error: userError } = await supabase.auth.getUser();\n      if (userError) {\n        console.error('Ошибка получения пользователя:', userError);\n        throw userError;\n      }\n      const user = userData?.user;\n      const now = new Date().toISOString();\n\n      if (user) {\n        // Пользователь авторизован\n        const guestId = localStorage.getItem('guest_id');\n        if (guestId) {\n          const { data: migratedId, error: migrateError } = await supabase.rpc('migrate_guest_data', {\n            p_guest_id: guestId,\n            p_user_id: user.id,\n          });\n          if (migrateError) {\n            // Если ошибка связана с дублированием, удаляем guest_id чтобы не повторять миграцию\n            if (migrateError.message.includes(\"duplicate key value violates unique constraint\")) {\n              localStorage.removeItem('guest_id');\n            } else {\n              console.error('Ошибка миграции:', migrateError);\n              toast.error(`Ошибка миграции: ${migrateError.message}`);\n            }\n          } else if (migratedId) {\n            toast.success('Данные гостя успешно перенесены');\n            localStorage.removeItem('guest_id');\n            localStorage.setItem('session_id', migratedId as string);\n            // Показываем уведомление об успешной авторизации, только если ранее не показывали\n            if (!localStorage.getItem('loggedInToastShown')) {\n              toast.success('Вы успешно авторизовались');\n              localStorage.setItem('loggedInToastShown', 'true');\n            }\n            return migratedId;\n          }\n        }\n        // Выполняем upsert для авторизованного пользователя\n        const newSession = {\n          user_id: user.id,\n          guest_id: null,\n          last_activity: now,\n          is_online: true,\n        };\n        const { data, error } = await supabase\n          .from('sessions')\n          .upsert(newSession, { onConflict: 'user_id' })\n          .select();\n        if (error) {\n          console.error('Ошибка создания/обновления сессии:', error);\n          toast.error(`Ошибка сессии: ${error.message}`);\n          throw error;\n        }\n        console.log('Сессия успешно создана/обновлена:', data);\n        if (data && data.length > 0) {\n          localStorage.setItem('session_id', data[0].id);\n        }\n        if (!localStorage.getItem('loggedInToastShown')) {\n          toast.success('Вы успешно авторизовались');\n          localStorage.setItem('loggedInToastShown', 'true');\n        }\n        return data;\n      } else {\n        // Пользователь не авторизован: обновляем или создаем гостевую сессию\n        return await updateSessionToGuest();\n      }\n    } catch (err) {\n      console.error('Ошибка в createSession:', err);\n      toast.error('Не удалось создать сессию');\n      return null;\n    }\n  };\n\n  useEffect(() => {\n    let isMounted = true;\n    const fetchData = async () => {\n      try {\n        if (isMounted) {\n          await createSession();\n          await refreshSessions();\n        }\n      } catch (err) {\n        console.error('Ошибка в fetchData:', err);\n        if (isMounted) {\n          setSessionsError('Не удалось загрузить или создать сессию');\n        }\n      }\n    };\n\n    fetchData();\n    const interval = setInterval(fetchData, 10000);\n    return () => {\n      isMounted = false;\n      clearInterval(interval);\n    };\n  }, [refreshSessions]);\n\n  const sessionStats = useMemo(() => ({\n    total: sessions.length,\n    active: sessions.reduce((acc, s) => s.is_online ? acc + 1 : acc, 0),\n    guests: sessions.reduce((acc, s) => s.guest_id ? acc + 1 : acc, 0),\n    users: sessions.reduce((acc, s) => s.user_id ? acc + 1 : acc, 0)\n  }), [sessions]);\n\n  const handleClickOutside = useCallback((event: MouseEvent) => {\n    if (sidebarRef.current && !sidebarRef.current.contains(event.target as Node)) {\n      setIsSidebarOpen(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (isSidebarOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [isSidebarOpen, handleClickOutside]);\n\n  // При выходе обновляем сессию до гостевой и сбрасываем флаг авторизации\n  const handleLogout = async () => {\n    try {\n      setIsLoggingOut(true);\n      await updateSessionToGuest();\n      const { error } = await supabase.auth.signOut();\n      if (error) throw error;\n      localStorage.removeItem('sb-auth-token');\n      sessionStorage.removeItem('sb-session');\n      // Сбрасываем флаг, чтобы при повторной авторизации уведомление показывалось\n      localStorage.removeItem('loggedInToastShown');\n      navigate('/', { replace: true });\n      toast.success('Выход выполнен успешно');\n    } catch (_error) {\n      toast.error('Ошибка при выходе. Пожалуйста, попробуйте снова.');\n    } finally {\n      setIsLoggingOut(false);\n      setIsLogoutModalOpen(false);\n    }\n  };\n\n  const sidebarVariants = {\n    open: { x: 0 },\n    closed: { x: '-100%' },\n  };\n\n  const renderNavLink = useCallback(({ to, icon, text }: NavItem) => (\n    <NavLink\n      key={to}\n      to={to}\n      onClick={() => setIsSidebarOpen(false)}\n      className={({ isActive }) =>\n        `flex items-center px-4 py-2 rounded-lg transition-colors \n         ${isActive ? 'bg-blue-800 text-white' : 'text-gray-300 hover:bg-blue-800 hover:text-white'}`\n      }\n    >\n      {React.cloneElement(icon, { className: 'w-5 h-5 mr-3' })}\n      {text}\n    </NavLink>\n  ), []);\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 relative overflow-hidden\">\n      <button\n        onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n        className=\"absolute top-4 right-4 p-2 bg-blue-900 text-white rounded-lg z-50 lg:hidden\"\n        aria-label=\"Меню\"\n      >\n        <Menu className=\"w-6 h-6\" />\n      </button>\n\n      <div className=\"flex relative\">\n        <motion.div\n          ref={sidebarRef}\n          className=\"hidden lg:block w-64 bg-blue-900 min-h-screen p-4 z-40\"\n          initial=\"open\"\n          animate=\"open\"\n        >\n          <div className=\"text-white font-bold text-xl mb-8 mt-16\">SHINAGO Admin</div>\n          <nav className=\"space-y-2\">\n            {navItems.map(renderNavLink)}\n            <div className=\"px-4 py-2 space-y-2 text-gray-300\">\n              {isLoadingSessions ? (\n                <div className=\"animate-pulse flex space-x-4\">\n                  <div className=\"flex-1 space-y-2 py-1\">\n                    <div className=\"h-4 bg-blue-800 rounded\"></div>\n                    <div className=\"h-4 bg-blue-800 rounded\"></div>\n                  </div>\n                </div>\n              ) : sessionsError ? (\n                <div className=\"text-red-300 text-sm\">{sessionsError}</div>\n              ) : (\n                <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                  <div className={`p-2 rounded ${sessionStats.active > 0 ? 'bg-green-500' : 'bg-gray-500'} text-white`}>\n                    Активных: {sessionStats.active}\n                  </div>\n                  <div className=\"p-2 rounded bg-blue-500 text-white\">\n                    Всего: {sessionStats.total}\n                  </div>\n                  <div className=\"p-2 rounded bg-purple-500 text-white\">\n                    Гостей: {sessionStats.guests}\n                  </div>\n                  <div className=\"p-2 rounded bg-orange-500 text-white\">\n                    Пользователей: {sessionStats.users}\n                  </div>\n                </div>\n              )}\n            </div>\n            <button\n              onClick={() => setIsLogoutModalOpen(true)}\n              className=\"flex items-center text-gray-300 hover:text-white hover:bg-blue-800 px-4 py-2 rounded-lg w-full transition-colors\"\n            >\n              <LogOut className=\"w-5 h-5 mr-3\" />\n              Вийти\n            </button>\n          </nav>\n        </motion.div>\n\n        <AnimatePresence>\n          {isSidebarOpen && (\n            <motion.div\n              ref={sidebarRef}\n              variants={sidebarVariants}\n              initial=\"closed\"\n              animate=\"open\"\n              exit=\"closed\"\n              className=\"fixed lg:hidden w-64 bg-blue-900 min-h-screen p-4 z-40\"\n            >\n              <div className=\"text-white font-bold text-xl mb-8 mt-16\">SHINAGO Admin</div>\n              <nav className=\"space-y-2\">\n                {navItems.map(renderNavLink)}\n                <button\n                  onClick={() => setIsLogoutModalOpen(true)}\n                  className=\"flex items-center text-gray-300 hover:text-white hover:bg-blue-800 px-4 py-2 rounded-lg w-full transition-colors\"\n                >\n                  <LogOut className=\"w-5 h-5 mr-3\" />\n                  Вийти\n                </button>\n              </nav>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        <div className=\"flex-1 p-8 mt-16\">\n          {sessionsError ? (\n            <div className=\"bg-red-50 text-red-600 p-4 rounded-lg\">\n              {sessionsError}\n            </div>\n          ) : (\n            <Outlet context={{ sessions, refreshSessions, isLoading: isLoadingSessions }} />\n          )}\n        </div>\n      </div>\n\n      <Modal\n        isOpen={isLogoutModalOpen}\n        onRequestClose={() => setIsLogoutModalOpen(false)}\n        shouldCloseOnOverlayClick={true}\n        className=\"modal\"\n        overlayClassName=\"modal-overlay\"\n        ariaHideApp={true}\n        contentLabel=\"Підтвердження виходу\"\n      >\n        <h2 className=\"text-xl font-bold mb-4\">Ви впевнені, що хочете вийти?</h2>\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            onClick={() => setIsLogoutModalOpen(false)}\n            className=\"px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400 transition-colors\"\n          >\n            Скасувати\n          </button>\n          <button\n            onClick={handleLogout}\n            disabled={isLoggingOut}\n            className=\"px-4 py-2 bg-red-500 text-white rounded-lg flex items-center gap-2 hover:bg-red-600 transition-colors\"\n          >\n            {isLoggingOut && (\n              <div className=\"w-4 h-4 border-2 border-white rounded-full animate-spin\" />\n            )}\n            {isLoggingOut ? 'Выход...' : 'Вийти'}\n          </button>\n        </div>\n      </Modal>\n    </div>\n  );\n};\n\nexport default AdminLayout;\n","import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '../../lib/supabaseClient';\nimport { motion } from 'framer-motion';\nimport { ToastContainer, toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\n\ninterface WeatherData {\n  temp: number;\n  description: string;\n  icon: string;\n  city: string;\n}\n\nconst Clock: React.FC = React.memo(() => {\n  const [time, setTime] = useState(new Date());\n  \n  useEffect(() => {\n    const timer = setInterval(() => setTime(new Date()), 1000);\n    return () => clearInterval(timer);\n  }, []);\n\n  return (\n    <div className=\"text-center\">\n      <div className=\"text-2xl sm:text-3xl md:text-4xl font-bold text-cyan-500\">\n        {time.toLocaleTimeString()}\n      </div>\n      <div className=\"mt-2 text-xs sm:text-sm text-gray-500\">\n        {time.toLocaleDateString()}\n      </div>\n    </div>\n  );\n});\n\nexport const AdminLogin: React.FC = () => {\n  const [loading, setLoading] = useState(false);\n  const [weather, setWeather] = useState<WeatherData | null>(null);\n  const [weatherLoading, setWeatherLoading] = useState(true);\n  const navigate = useNavigate();\n\n  const showErrorToast = (message: string) => {\n    toast.error(message, {\n      position: 'top-center',\n      autoClose: 5000,\n      hideProgressBar: true,\n      closeOnClick: true,\n      theme: 'colored',\n      className: 'bg-red-800 text-white'\n    });\n  };\n\n  const requestLocation = () => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          getWeather(position.coords.latitude, position.coords.longitude);\n        },\n        (error) => {\n          let errorMessage = 'Ошибка получения местоположения: ';\n          switch (error.code) {\n            case error.PERMISSION_DENIED:\n              errorMessage += 'Доступ к геолокации запрещен';\n              break;\n            case error.POSITION_UNAVAILABLE:\n              errorMessage += 'Информация о местоположении недоступна';\n              break;\n            case error.TIMEOUT:\n              errorMessage += 'Превышено время ожидания';\n              break;\n            default:\n              errorMessage += 'Неизвестная ошибка';\n          }\n          showErrorToast(errorMessage);\n          setWeatherLoading(false);\n        },\n        { enableHighAccuracy: true, timeout: 5000 }\n      );\n    } else {\n      showErrorToast('Ваш браузер не поддерживает геолокацию');\n      setWeatherLoading(false);\n    }\n  };\n\n  const getWeather = async (latitude: number, longitude: number) => {\n    try {\n      const response = await fetch(\n        `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=695605c4006a81a3e07c2f064ba1f851&units=metric&lang=ru`\n      );\n      \n      if (!response.ok) {\n        throw new Error('Ошибка получения данных о погоде');\n      }\n      \n      const data = await response.json();\n      setWeather({\n        temp: Math.round(data.main.temp),\n        description: data.weather[0].description,\n        icon: data.weather[0].icon,\n        city: data.name\n      });\n    } catch (_error) {\n      showErrorToast('Не удалось получить данные о погоде');\n    } finally {\n      setWeatherLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    requestLocation();\n  }, []);\n\n  const handleGoogleLogin = async () => {\n    try {\n      setLoading(true);\n      const { error } = await supabase.auth.signInWithOAuth({\n        provider: 'google',\n        options: {\n          redirectTo: window.location.origin + '/admin',\n        },\n      });\n\n      if (error) throw error;\n      navigate('/admin');\n    } catch (error) {\n      const errorMessage = error instanceof Error \n        ? error.message \n        : 'Произошла неизвестная ошибка';\n      showErrorToast(`Ошибка авторизации: ${errorMessage}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"relative min-h-screen w-full bg-gray-900 overflow-hidden\">\n      <ToastContainer />\n      \n      <div className=\"absolute inset-0 bg-gray-800 opacity-20\" />\n\n      <div className=\"relative z-10 flex min-h-screen items-center justify-center p-4\">\n        <motion.div\n          className=\"w-full max-w-md space-y-6 rounded-2xl border border-gray-800 bg-gray-900/80 p-4 sm:p-6 md:p-8 backdrop-blur-xl\"\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5 }}\n        >\n          <Clock />\n          \n          <div className=\"mt-4 rounded-lg bg-gray-800/50 p-3 sm:p-4\">\n            {weatherLoading ? (\n              <div className=\"text-gray-400\">Получение погоды...</div>\n            ) : weather ? (\n              <div className=\"flex items-center justify-center gap-2 sm:gap-4\">\n                <img\n                  src={`https://openweathermap.org/img/wn/${weather.icon}@2x.png`}\n                  alt=\"Погода\"\n                  className=\"h-10 w-10 sm:h-12 sm:w-12\"\n                />\n                <div className=\"text-left\">\n                  <div className=\"text-base sm:text-lg font-semibold text-white\">\n                    {weather.temp}°C\n                  </div>\n                  <div className=\"text-xs sm:text-sm text-gray-400\">\n                    {weather.city}\n                  </div>\n                  <div className=\"text-xs text-gray-500\">\n                    {weather.description}\n                  </div>\n                </div>\n              </div>\n            ) : null}\n          </div>\n\n          <div className=\"text-center\">\n            <div className=\"mx-auto mb-4 grid h-12 w-12 sm:h-16 sm:w-16 place-items-center rounded-full bg-cyan-500/10\">\n              <svg\n                className=\"h-6 w-6 sm:h-8 sm:w-8 text-cyan-500\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                stroke=\"currentColor\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"\n                />\n              </svg>\n            </div>\n            <h2 className=\"text-xl sm:text-2xl font-bold text-white\">\n              Система управления\n            </h2>\n            <p className=\"mt-2 text-xs sm:text-sm text-gray-400\">\n              Авторизация администратора\n            </p>\n          </div>\n\n          <motion.button\n            onClick={handleGoogleLogin}\n            disabled={loading}\n            className=\"group relative mt-6 sm:mt-8 flex w-full items-center justify-center gap-3 overflow-hidden rounded-lg bg-gradient-to-r from-cyan-500 to-blue-500 p-1 text-white transition-all hover:from-cyan-600 hover:to-blue-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 focus:ring-offset-gray-900 disabled:opacity-70\"\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <span className=\"flex w-full items-center justify-center gap-3 rounded-md bg-gray-900 px-4 sm:px-5 py-2.5 sm:py-3 transition-all group-hover:bg-transparent\">\n              <svg className=\"h-4 w-4 sm:h-5 sm:w-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                <path d=\"M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.254-3.138C18.189 1.186 15.479 0 12.24 0c-6.635 0-12 5.365-12 12s5.365 12 12 12c6.926 0 11.52-4.869 11.52-11.726 0-.788-.085-1.39-.189-1.989H12.24z\"/>\n              </svg>\n              <span className=\"text-xs sm:text-sm font-medium\">\n                {loading ? 'Подключение...' : 'Войти через Google'}\n              </span>\n            </span>\n          </motion.button>\n\n          <div className=\"pt-4\">\n            <div className=\"flex items-center justify-center gap-2 text-xs text-gray-500\">\n              <svg\n                className=\"h-3 w-3 sm:h-4 sm:w-4\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                stroke=\"currentColor\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"\n                />\n              </svg>\n              <span className=\"text-xs\">Защищенное соединение</span>\n            </div>\n          </div>\n        </motion.div>\n      </div>\n    </div>\n  );\n};","// useAdmin.ts\nimport { useEffect, useState } from 'react';\nimport { supabase } from '../lib/supabaseClient';\n\ntype UseAdminResult = {\n  isAdmin: boolean;\n  loading: boolean;\n};\n\nexport function useAdmin(): UseAdminResult {\n  const [state, setState] = useState<UseAdminResult>({\n    isAdmin: false,\n    loading: true,\n  });\n\n  const logEvent = (event: string, details?: Record<string, unknown>) => {\n    console.log(`[useAdmin] ${event}`, details || '');\n  };\n\n  const checkAdmin = async () => {\n    try {\n      setState((prev) => ({ ...prev, loading: true }));\n\n      const { data: { user }, error: userError } = await supabase.auth.getUser();\n\n      if (userError || !user) {\n        logEvent('User not authenticated', { error: userError?.message });\n        setState({ isAdmin: false, loading: false });\n        return;\n      }\n\n      const { data, error } = await supabase\n        .from('admins')\n        .select('user_id')\n        .eq('user_id', user.id)\n        .single();\n\n      setState({\n        isAdmin: !error && !!data,\n        loading: false,\n      });\n    } catch (error) {\n      logEvent('Error in admin check', { error });\n      setState({ isAdmin: false, loading: false });\n    }\n  };\n\n  useEffect(() => {\n    // Первоначальная проверка\n    checkAdmin();\n\n    // Подписка на изменения аутентификации\n    const { data: authListener } = supabase.auth.onAuthStateChange((event) => {\n      logEvent('Auth state changed', { event });\n      checkAdmin();\n    });\n\n    return () => {\n      authListener?.subscription.unsubscribe();\n    };\n  }, []);\n\n  return state;\n}\n","import { supabase } from './supabaseClient';\nimport { useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\n\n// Логирование событий в Supabase\nexport async function trackEvent(eventName: string, eventData: Record<string, unknown> = {}) {\n  try {\n    const { error } = await supabase.rpc('track_event', {\n      event_name: eventName,\n      event_data: JSON.stringify(eventData), // Всегда передаем JSON\n    });\n\n    if (error) throw error;\n  } catch (error) {\n    console.error('Error tracking event:', error);\n  }\n}\n\n// Логирование нажатий кнопок\nexport const logButtonClick = (buttonName: string, additionalData?: Record<string, unknown>) => {\n  console.log(`[FRONTEND] Button clicked: ${buttonName}`, additionalData || '');\n  trackEvent('button_click', { buttonName, ...additionalData });\n};\n\n// Логирование переходов по страницам\nexport const usePageTracking = () => {\n  const location = useLocation();\n\n  useEffect(() => {\n    console.log(`[FRONTEND] Page loaded: ${location.pathname}`);\n    trackEvent('page_view', { path: location.pathname });\n  }, [location]);\n};\n\n// Логирование ошибок\nexport const logError = (error: Error, context: string, additionalData?: Record<string, unknown>) => {\n  console.error(`[FRONTEND] Error in ${context}:`, error, additionalData || '');\n  trackEvent('error', { context, error: error.message, ...additionalData });\n};","import React, { useState, useEffect } from 'react';\nimport { useAdmin } from '../../hooks/useAdmin';\nimport { trackEvent } from '../../lib/analytics';\nimport { supabase } from '../../lib/supabaseClient';\nimport { useNavigate } from 'react-router-dom';\nimport { toast } from 'react-toastify';\n\ninterface DashboardStats {\n  total_orders: number;\n  total_revenue: number;\n  products_count: number;\n}\n\ninterface SessionUser {\n  email?: string;\n  is_admin?: boolean;\n}\n\ninterface UserSession {\n  id: string;\n  user_id: string | null;\n  guest_id: string | null;\n  session_start: string;\n  last_activity: string;\n  is_online: boolean;\n  user: SessionUser | null;\n}\n\nexport const Dashboard: React.FC = () => {\n  const { isAdmin, loading: adminLoading } = useAdmin();\n  const [stats, setStats] = useState<DashboardStats>({\n    total_orders: 0,\n    total_revenue: 0,\n    products_count: 0,\n  });\n  const [activeSessions, setActiveSessions] = useState<UserSession[]>([]);\n  const [dataLoading, setDataLoading] = useState(true);\n  const navigate = useNavigate();\n\n  const registeredUsers = activeSessions.filter(s => s.user_id);\n  const guests = activeSessions.filter(s => s.guest_id && !s.user_id);\n\n  useEffect(() => {\n    if (!isAdmin && !adminLoading) navigate('/');\n  }, [isAdmin, adminLoading, navigate]);\n\n  useEffect(() => {\n    if (!isAdmin || adminLoading) return;\n\n    const initializeDashboard = async () => {\n      await fetchDashboardStats();\n      trackEvent('admin_dashboard_view');\n      const realtimeCleanup = setupRealtimeSessions();\n      const interval = setInterval(updateSessionsList, 5000);\n      return () => {\n        realtimeCleanup();\n        clearInterval(interval);\n      };\n    };\n\n    initializeDashboard().catch(err => {\n      toast.error(`Ошибка инициализации: ${err.message}`);\n    });\n  }, [isAdmin, adminLoading]);\n\n  const fetchDashboardStats = async () => {\n    try {\n      setDataLoading(true);\n      const { data, error } = await supabase.rpc('get_dashboard_stats');\n      if (error) throw error;\n      setStats(data as DashboardStats);\n    } catch (err) {\n      const msg = err instanceof Error ? err.message : 'Неизвестная ошибка';\n      toast.error(`Ошибка загрузки статистики: ${msg}`);\n      trackEvent('dashboard_stats_error', { error: msg });\n    } finally {\n      setDataLoading(false);\n    }\n  };\n\n  const setupRealtimeSessions = () => {\n    const channel = supabase\n      .channel('sessions_realtime')\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'sessions' }, () => updateSessionsList())\n      .subscribe();\n    return () => supabase.removeChannel(channel);\n  };\n\n  const updateSessionsList = async () => {\n    try {\n      const since = new Date(Date.now() - 25000).toISOString();\n      const { data, error } = await supabase\n        .from('sessions')\n        .select(`\n          id,\n          user_id,\n          guest_id,\n          session_start,\n          last_activity,\n          is_online,\n          user:user_id (email, is_admin)\n        `)\n        .gte('last_activity', since)\n        .order('last_activity', { ascending: false });\n\n      if (error) throw error;\n      const sessions = (data || []).map(s => ({\n        id: s.id,\n        user_id: s.user_id,\n        guest_id: s.guest_id,\n        session_start: s.session_start,\n        last_activity: s.last_activity,\n        is_online: s.is_online,\n        user: Array.isArray(s.user) ? s.user[0] : s.user,\n      })) as UserSession[];\n      setActiveSessions(sessions);\n    } catch (err) {\n      console.error('Ошибка загрузки сессий:', err);\n      toast.error('Ошибка обновления списка сессий');\n      setActiveSessions([]);\n    }\n  };\n\n  if (adminLoading || dataLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-screen\">\n        <div className=\"text-gray-600\">Загрузка данных...</div>\n      </div>\n    );\n  }\n\n  if (!isAdmin) {\n    return (\n      <div className=\"p-8 text-center\">\n        <h1 className=\"text-2xl font-bold text-red-600\">Несанкционированный доступ</h1>\n        <p className=\"mt-2 text-gray-600\">У вас нет прав для просмотра этой страницы.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6 fade-in\">\n      <h1 className=\"text-xl sm:text-2xl font-bold mb-6 sm:mb-8\">Панель управления</h1>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <div className=\"grid grid-cols-1 gap-4 sm:gap-6 sm:grid-cols-2 lg:grid-cols-2\">\n          <div className=\"bg-white rounded-lg shadow p-4\">\n            <p className=\"text-xs text-gray-500\">Всего заказов</p>\n            <p className=\"text-2xl font-bold text-blue-600\">{stats.total_orders}</p>\n          </div>\n          <div className=\"bg-white rounded-lg shadow p-4\">\n            <p className=\"text-xs text-gray-500\">Общий доход</p>\n            <p className=\"text-2xl font-bold text-green-600\">₴{stats.total_revenue}</p>\n          </div>\n          <div className=\"bg-white rounded-lg shadow p-4\">\n            <p className=\"text-xs text-gray-500\">Товаров в каталоге</p>\n            <p className=\"text-2xl font-bold text-orange-600\">{stats.products_count}</p>\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow p-4\">\n          <h2 className=\"text-lg font-bold mb-4\">Активные сессии ({activeSessions.length})</h2>\n          <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n            {registeredUsers.length > 0 && (\n              <div>\n                <h3 className=\"text-sm font-semibold text-gray-600\">Зарегистрированные пользователи ({registeredUsers.length})</h3>\n                {registeredUsers.map(session => <SessionItem key={session.id} session={session} />)}\n              </div>\n            )}\n            {guests.length > 0 && (\n              <div>\n                <h3 className=\"text-sm font-semibold text-gray-600\">Гостевые сессии ({guests.length})</h3>\n                {guests.map(session => <SessionItem key={session.id} session={session} />)}\n              </div>\n            )}\n            {activeSessions.length === 0 && <p className=\"text-center text-gray-500 py-4\">Нет активных сессий</p>}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst SessionItem: React.FC<{ session: UserSession }> = ({ session }) => (\n  <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2\">\n    <div>\n      <p className=\"text-sm font-medium\">{session.user?.email || `Гость (${session.guest_id?.slice(0, 8)})`}</p>\n      <p className=\"text-xs text-gray-500\">Последняя активность: {new Date(session.last_activity).toLocaleTimeString()}</p>\n    </div>\n    <div className=\"flex items-center gap-2\">\n      <div className={`w-3 h-3 rounded-full ${session.is_online ? 'bg-green-500' : 'bg-gray-400'}`} />\n      <span className={`px-2 py-1 text-xs rounded-full ${\n        session.user?.is_admin ? 'bg-blue-100 text-blue-800' : session.user_id ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'\n      }`}>\n        {session.user?.is_admin ? 'Админ' : session.user_id ? 'Пользователь' : 'Гость'}\n      </span>\n    </div>\n  </div>\n);\n","import React, { useState, useEffect } from 'react';\n\nexport type SortOptions =\n  | 'created_at_asc'\n  | 'created_at_desc'\n  | 'price_asc'\n  | 'price_desc'\n  | 'rating_asc'\n  | 'rating_desc';\n\ninterface FiltersProps {\n  onFilterChange: (filters: { type: string; minPrice: number; maxPrice: number }) => void;\n  onSortChange: (sort: SortOptions) => void;\n}\n\nexport const Filters: React.FC<FiltersProps> = ({ onFilterChange, onSortChange }) => {\n  const [type, setType] = useState('');\n  const [minPrice, setMinPrice] = useState<number>(0);\n  const [maxPrice, setMaxPrice] = useState<number>(1000000);\n\n  useEffect(() => {\n    if (maxPrice < minPrice) {\n      setMaxPrice(minPrice);\n    }\n  }, [minPrice, maxPrice]);\n\n  const handleApplyFilters = () => {\n    onFilterChange({\n      type: type.trim(),\n      minPrice: Math.max(0, minPrice),\n      maxPrice: Math.max(minPrice, maxPrice)\n    });\n  };\n\n  const handleSortChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    onSortChange(e.target.value as SortOptions);\n  };\n\n  const handleMinPriceChange = (value: string) => {\n    const numericValue = Math.max(0, Number(value) || 0);\n    setMinPrice(numericValue);\n    if (maxPrice < numericValue) setMaxPrice(numericValue);\n  };\n\n  const handleMaxPriceChange = (value: string) => {\n    const numericValue = Math.max(minPrice, Number(value) || minPrice);\n    setMaxPrice(numericValue);\n  };\n\n  return (\n    <div className=\"mb-6 space-y-4\">\n      <div className=\"flex flex-wrap gap-4\">\n        <div className=\"flex-1 min-w-[200px]\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Тип</label>\n          <select\n            value={type}\n            onChange={(e) => setType(e.target.value)}\n            className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n          >\n            <option value=\"\">Всі товари</option>\n            <option value=\"tire\">Шини</option>\n            <option value=\"wheel\">Диски</option>\n          </select>\n        </div>\n\n        <div className=\"flex-1 min-w-[200px]\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Мінімальна ціна\n          </label>\n          <div className=\"relative\">\n            <input\n              type=\"number\"\n              value={minPrice}\n              onChange={(e) => handleMinPriceChange(e.target.value)}\n              className=\"w-full border border-gray-300 rounded-md p-2 pr-8 focus:ring-2 focus:ring-blue-500\"\n              min=\"0\"\n              placeholder=\"Від\"\n            />\n            <span className=\"absolute right-3 top-3 text-gray-400\">₴</span>\n          </div>\n        </div>\n\n        <div className=\"flex-1 min-w-[200px]\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Максимальна ціна\n          </label>\n          <div className=\"relative\">\n            <input\n              type=\"number\"\n              value={maxPrice}\n              onChange={(e) => handleMaxPriceChange(e.target.value)}\n              className=\"w-full border border-gray-300 rounded-md p-2 pr-8 focus:ring-2 focus:ring-blue-500\"\n              min={minPrice}\n              placeholder=\"До\"\n            />\n            <span className=\"absolute right-3 top-3 text-gray-400\">₴</span>\n          </div>\n        </div>\n\n        <div className=\"flex-1 min-w-[200px]\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Сортування</label>\n          <select\n            onChange={handleSortChange}\n            className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n            defaultValue=\"created_at_desc\"\n          >\n            <option value=\"created_at_desc\">Новіші спочатку</option>\n            <option value=\"created_at_asc\">Старіші спочатку</option>\n            <option value=\"price_asc\">Від дешевих</option>\n            <option value=\"price_desc\">Від дорогих</option>\n            <option value=\"rating_asc\">За рейтингом (↑)</option>\n            <option value=\"rating_desc\">За рейтингом (↓)</option>\n          </select>\n        </div>\n      </div>\n\n      <button\n        onClick={handleApplyFilters}\n        className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-colors flex items-center justify-center gap-2\"\n      >\n        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n          <path fillRule=\"evenodd\" d=\"M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z\" clipRule=\"evenodd\" />\n        </svg>\n        Застосувати фільтри\n      </button>\n    </div>\n  );\n};","import React, { useState, useEffect, useRef } from 'react';\nimport { motion } from 'framer-motion';\nimport Modal from 'react-modal';\nimport { Product } from '../../../types/database.types';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '../../../lib/supabaseClient';\nimport { trackEvent } from '../../../lib/analytics';\n\ninterface EditProductModalProps {\n  isOpen: boolean;\n  product: Product;\n  onClose: () => void;\n  onSave: (updatedProduct: Product) => void;\n}\n\nconst seasonOptions = [\n  { value: 'summer', label: 'Літо' },\n  { value: 'winter', label: 'Зима' },\n  { value: 'all-season', label: 'Всесезон' }\n];\n\nconst efficiencyGrades = ['A', 'B', 'C', 'D', 'E'];\n\n// Определяем типы для полезной нагрузки обновления\ntype UpdatableProduct = Omit<\n  Product,\n  'id' | 'name' | 'rating' | 'reviews_count' | 'created_at' | 'type' | 'stock' | 'wheel_width'\n>;\n\ntype UpdatePayload = Partial<UpdatableProduct> & {\n  updated_at: string;\n};\n\nexport const EditProductModal: React.FC<EditProductModalProps> = ({\n  isOpen,\n  product,\n  onClose,\n  onSave\n}) => {\n  const queryClient = useQueryClient();\n  const [formData, setFormData] = useState<Product>(product);\n  const [error, setError] = useState<string | null>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [images, setImages] = useState<string[]>(product.image_url || []);\n  const [newImages, setNewImages] = useState<File[]>([]);\n  const [changedFields, setChangedFields] = useState<Set<string>>(new Set());\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (product) {\n      setFormData(product);\n      setImages(product.image_url || []);\n      setNewImages([]);\n      setChangedFields(new Set());\n    }\n  }, [product]);\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\n    const { name, value } = e.target;\n    setChangedFields(prev => new Set(prev).add(name));\n    setFormData(prev => ({\n      ...prev,\n      [name]: ['price', 'sale_price', 'width', 'profile', 'diameter', 'year',\n               'noise_level', 'wheel_width'].includes(name)\n        ? (value === '' ? null : Number(value))\n        : value\n    }));\n  };\n\n  const handleCheckboxChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, checked } = e.target;\n    setChangedFields(prev => new Set(prev).add(name));\n    setFormData(prev => ({\n      ...prev,\n      [name]: checked\n    }));\n  };\n\n  const validateForm = () => {\n    const requiredFields: (keyof Product)[] = ['brand', 'model', 'price'];\n    const missingFields = requiredFields.filter(field => !formData[field]?.toString().trim());\n\n    if (missingFields.length > 0) {\n      setError('Обовʼязкові поля: Бренд, Модель, Ціна');\n      return false;\n    }\n\n    if (formData.price && formData.price <= 0) {\n      setError('Ціна повинна бути більше нуля');\n      return false;\n    }\n\n    return true;\n  };\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      const files = Array.from(e.target.files);\n      setNewImages(prev => [...prev, ...files]);\n      setChangedFields(prev => new Set(prev).add('image_url'));\n    }\n  };\n\n  const handleImageRemove = (index: number, isNewImage: boolean) => {\n    setChangedFields(prev => new Set(prev).add('image_url'));\n    if (isNewImage) {\n      setNewImages(prev => prev.filter((_, i) => i !== index));\n    } else {\n      setImages(prev => prev.filter((_, i) => i !== index));\n    }\n  };\n\n  const uploadImage = async (file: File) => {\n    const fileExt = file.name.split('.').pop();\n    const filePath = `products/${formData.id}/${Date.now()}.${fileExt}`;\n\n    const { error: uploadError } = await supabase.storage\n      .from('product-images')\n      .upload(filePath, file);\n\n    if (uploadError) throw uploadError;\n\n    const { data: { publicUrl } } = supabase.storage\n      .from('product-images')\n      .getPublicUrl(filePath);\n\n    return publicUrl;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n\n    if (!validateForm()) return;\n\n    setIsSubmitting(true);\n\n    try {\n      let updatedImageUrls = [...images];\n\n      if (newImages.length > 0) {\n        const uploadPromises = newImages.map(file => uploadImage(file));\n        const uploadedUrls = await Promise.all(uploadPromises);\n        updatedImageUrls = [...updatedImageUrls, ...uploadedUrls];\n      }\n\n      // Собираем payload строго по типу\n      const rawPayload: UpdatePayload = {\n        updated_at: new Date().toISOString(),\n        ...(changedFields.has('brand')     && { brand: formData.brand }),\n        ...(changedFields.has('model')     && { model: formData.model }),\n        ...(changedFields.has('price')     && { price: formData.price }),\n        ...(changedFields.has('sale_price') && { sale_price: formData.sale_price }),\n        ...(changedFields.has('width')     && { width: formData.width }),\n        ...(changedFields.has('profile')   && { profile: formData.profile }),\n        ...(changedFields.has('diameter')  && { diameter: formData.diameter }),\n        ...(changedFields.has('season')    && { season: formData.season }),\n        ...(changedFields.has('country')   && { country: formData.country }),\n        ...(changedFields.has('year')      && { year: formData.year }),\n        ...(changedFields.has('type')      && { type: formData.type }),\n        ...(changedFields.has('noise_level') && { noise_level: formData.noise_level }),\n        ...(changedFields.has('wet_grip')  && { wet_grip: formData.wet_grip }),\n        ...(changedFields.has('fuel_efficiency') && { fuel_efficiency: formData.fuel_efficiency }),\n        ...(changedFields.has('wheel_width') && { wheel_width: formData.wheel_width }),\n        ...(changedFields.has('load_index') && { load_index: formData.load_index }),\n        ...(changedFields.has('speed_index') && { speed_index: formData.speed_index }),\n        ...(changedFields.has('spikes')    && { spikes: formData.spikes }),\n        ...(changedFields.has('image_url') && { image_url: updatedImageUrls })\n      };\n\n      const { error } = await supabase\n        .from('products')\n        .update(rawPayload)\n        .eq('id', formData.id);\n\n      if (error) throw error;\n\n      await queryClient.invalidateQueries({\n        queryKey: ['products']\n      });\n\n      trackEvent('admin_product_edit', { product_id: formData.id });\n      onSave({ ...product, ...rawPayload });\n      onClose();\n    } catch (err) {\n      const errorMessage = err instanceof Error\n        ? err.message\n        : 'Помилка оновлення товару';\n      setError(errorMessage);\n      trackEvent('admin_product_edit_error', { error: errorMessage });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onRequestClose={onClose}\n      className=\"modal bg-white rounded-lg p-4 sm:p-6 mx-4 sm:mx-auto max-w-[95vw] sm:max-w-2xl w-full shadow-xl\"\n      overlayClassName=\"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4\"\n      closeTimeoutMS={200}\n      ariaHideApp={false}\n    >\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        exit={{ opacity: 0 }}\n        className=\"max-h-[90vh] overflow-y-auto\"\n      >\n        <div className=\"flex justify-between items-center mb-4\">\n          <h2 className=\"text-lg sm:text-xl font-bold\">Редагування товару</h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-500 hover:text-gray-700 transition-colors text-2xl\"\n          >\n            &times;\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n            <div className=\"space-y-3 sm:space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Бренд *\n                </label>\n                <input\n                  type=\"text\"\n                  name=\"brand\"\n                  value={formData.brand || ''}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Модель *\n                </label>\n                <input\n                  type=\"text\"\n                  name=\"model\"\n                  value={formData.model || ''}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                  required\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-3 sm:space-y-4\">\n              <div className=\"grid grid-cols-2 gap-3 sm:gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Ціна *\n                  </label>\n                  <input\n                    type=\"number\"\n                    name=\"price\"\n                    value={formData.price || ''}\n                    onChange={handleChange}\n                    className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                    min=\"0\"\n                    required\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Акційна ціна\n                  </label>\n                  <input\n                    type=\"number\"\n                    name=\"sale_price\"\n                    value={formData.sale_price || ''}\n                    onChange={handleChange}\n                    className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                    min=\"0\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Ширина\n                  </label>\n                  <input\n                    type=\"number\"\n                    name=\"width\"\n                    value={formData.width || ''}\n                    onChange={handleChange}\n                    className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                    min=\"0\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Профіль\n                  </label>\n                  <input\n                    type=\"number\"\n                    name=\"profile\"\n                    value={formData.profile || ''}\n                    onChange={handleChange}\n                    className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                    min=\"0\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Діаметр\n                  </label>\n                  <input\n                    type=\"number\"\n                    name=\"diameter\"\n                    value={formData.diameter || ''}\n                    onChange={handleChange}\n                    className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                    min=\"0\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mt-4\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Зображення товару\n            </label>\n\n            <div className=\"flex flex-wrap gap-4 mb-4\">\n              {images.map((url, index) => (\n                <div key={`current-${index}`} className=\"relative w-24 h-24 border rounded-md overflow-hidden group\">\n                  <img\n                    src={url}\n                    alt={`Товар ${formData.brand} ${formData.model}`}\n                    className=\"w-full h-full object-cover\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => handleImageRemove(index, false)}\n                    className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\n                  >\n                    &times;\n                  </button>\n                </div>\n              ))}\n\n              {newImages.map((file, index) => (\n                <div key={`new-${index}`} className=\"relative w-24 h-24 border rounded-md overflow-hidden group\">\n                  <img\n                    src={URL.createObjectURL(file)}\n                    alt={`Новое изображение ${index + 1}`}\n                    className=\"w-full h-full object-cover\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => handleImageRemove(index, true)}\n                    className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\n                  >\n                    &times;\n                  </button>\n                </div>\n              ))}\n\n              <button\n                type=\"button\"\n                onClick={() => fileInputRef.current?.click()}\n                className=\"w-24 h-24 border-2 border-dashed border-gray-300 rounded-md flex items-center justify-center text-gray-500 hover:bg-gray-50 transition-colors\"\n              >\n                <svg className=\"w-8 h-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\n                </svg>\n              </button>\n\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                multiple\n                accept=\"image/*\"\n                onChange={handleImageSelect}\n                className=\"hidden\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Країна виробник\n              </label>\n              <input\n                type=\"text\"\n                name=\"country\"\n                value={formData.country || ''}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Рік виробництва\n              </label>\n              <input\n                type=\"number\"\n                name=\"year\"\n                value={formData.year || ''}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                min=\"0\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Сезонність *\n              </label>\n              <select\n                name=\"season\"\n                value={formData.season || 'summer'}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                required\n              >\n                {seasonOptions.map(option => (\n                  <option key={option.value} value={option.value}>\n                    {option.label}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Тип товару *\n              </label>\n              <select\n                name=\"type\"\n                value={formData.type || 'tire'}\n                onChange={handleChange}\n                className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                required\n              >\n                <option value=\"tire\">Шина</option>\n                <option value=\"wheel\">Диск</option>\n              </select>\n            </div>\n          </div>\n\n          {formData.type === 'tire' && (\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Рівень шуму (dB)\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"noise_level\"\n                  value={formData.noise_level || ''}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                  min=\"0\"\n                  max=\"100\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Сцепление на мокрой дороге\n                </label>\n                <select\n                  name=\"wet_grip\"\n                  value={formData.wet_grip || 'A'}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                >\n                  {efficiencyGrades.map(grade => (\n                    <option key={grade} value={grade}>{grade}</option>\n                  ))}\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Топливная эффективность\n                </label>\n                <select\n                  name=\"fuel_efficiency\"\n                  value={formData.fuel_efficiency || 'A'}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                >\n                  {efficiencyGrades.map(grade => (\n                    <option key={grade} value={grade}>{grade}</option>\n                  ))}\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Индекс нагрузки\n                </label>\n                <input\n                  type=\"text\"\n                  name=\"load_index\"\n                  value={formData.load_index || ''}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"Наприклад: 92Y\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Индекс скорости\n                </label>\n                <input\n                  type=\"text\"\n                  name=\"speed_index\"\n                  value={formData.speed_index || ''}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"Наприклад: Y\"\n                />\n              </div>\n\n              <div className=\"flex items-center gap-2 mb-4\">\n                <input\n                  type=\"checkbox\"\n                  id=\"spikesCheckbox\"\n                  name=\"spikes\"\n                  checked={formData.spikes || false}\n                  onChange={handleCheckboxChange}\n                  className=\"h-4 w-4\"\n                />\n                <label htmlFor=\"spikesCheckbox\" className=\"text-sm\">Шипованные</label>\n              </div>\n            </div>\n          )}\n\n          {formData.type === 'wheel' && (\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Ширина диска (мм)\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"wheel_width\"\n                  value={formData.wheel_width ?? ''}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 text-sm sm:text-base focus:ring-2 focus:ring-blue-500\"\n                  min=\"100\"\n                  max=\"500\"\n                />\n              </div>\n            </div>\n          )}\n\n          {error && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              className=\"text-red-600 text-sm p-2 bg-red-100 rounded\"\n            >\n              {error}\n            </motion.div>\n          )}\n\n          <div className=\"flex flex-col sm:flex-row justify-end gap-3 mt-6\">\n            <motion.button\n              type=\"button\"\n              onClick={onClose}\n              className=\"w-full sm:w-auto px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-md\"\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n            >\n              Скасувати\n            </motion.button>\n\n            <motion.button\n              type=\"submit\"\n              className=\"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50\"\n              disabled={isSubmitting}\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n            >\n              {isSubmitting ? (\n                <span className=\"flex items-center justify-center\">\n                  <svg\n                    className=\"animate-spin h-5 w-5 mr-3\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <circle\n                      className=\"opacity-25\"\n                      cx=\"12\"\n                      cy=\"12\"\n                      r=\"10\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"4\"\n                      fill=\"none\"\n                    />\n                    <path\n                      className=\"opacity-75\"\n                      fill=\"currentColor\"\n                      d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                    />\n                  </svg>\n                  Збереження...\n                </span>\n              ) : (\n                'Зберегти зміни'\n              )}\n            </motion.button>\n          </div>\n        </form>\n      </motion.div>\n    </Modal>\n  );\n};\n","import React, { useState, useEffect, useCallback } from 'react';\nimport { useAdmin } from '../../hooks/useAdmin';\nimport { trackEvent } from '../../lib/analytics';\nimport { supabase } from '../../lib/supabaseClient';\nimport { Product } from '../../types/database.types';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport Modal from 'react-modal';\nimport { Pagination } from '../../components/ui/adminProducts/Pagination';\nimport { Filters, SortOptions } from '../../components/ui/adminProducts/Filters';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { EditProductModal } from '../../components/ui/adminProducts/EditProductModal';\n\nModal.setAppElement('#root');\n\ntype SeasonMap = {\n  summer: string;\n  winter: string;\n  'all-season': string;\n};\n\nconst seasonLabels: SeasonMap = {\n  summer: 'Літо',\n  winter: 'Зима',\n  'all-season': 'Всесезон'\n};\n\ninterface EnhancedProduct extends Product {\n  reviews_count: number;\n  wheel_width?: number; // number | undefined\n}\n\nexport const Products: React.FC = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { isAdmin, loading: adminLoading } = useAdmin();\n  const queryClient = useQueryClient();\n  const [page, setPage] = useState(1);\n  const [filters, setFilters] = useState({ \n    type: '', \n    minPrice: 0, \n    maxPrice: 1000000\n  });\n  const [sort, setSort] = useState<SortOptions>('created_at_desc');\n  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);\n  const [productToDelete, setProductToDelete] = useState<string | null>(null);\n  const [editProduct, setEditProduct] = useState<EnhancedProduct | null>(null);\n  const [totalCount, setTotalCount] = useState(0);\n\n  const stableRefetch = useCallback(() => {\n    return queryClient.refetchQueries({ \n      queryKey: ['products', page, filters, sort] \n    });\n  }, [page, filters, sort, queryClient]);\n\n  const { \n    data: products, \n    isLoading, \n    error \n  } = useQuery<EnhancedProduct[]>({\n    queryKey: ['products', page, filters, sort],\n    queryFn: async () => {\n      const [field, order] = sort.split('_');\n      \n      let query = supabase\n        .from('products')\n        .select(`\n          *,\n          reviews:reviews(count)\n        `, { \n          count: 'exact' \n        })\n        .gte('price', Math.max(0, filters.minPrice))\n        .lte('price', Math.max(filters.minPrice, filters.maxPrice));\n  \n      if (filters.type) {\n        query = query.eq('type', filters.type);\n      }\n  \n      const { data, error, count } = await query\n        .order(field === 'created' ? 'created_at' : field, { \n          ascending: order === 'asc' \n        })\n        .range((page - 1) * 10, page * 10 - 1);\n  \n      if (error) throw error;\n      \n      setTotalCount(count || 0);\n      \n      return data?.map(product => ({\n        ...product,\n        reviews_count: product.reviews?.length || 0,\n        wheel_width: product.wheel_width ? Number(product.wheel_width) : undefined\n        \n      })) || [];\n    },\n    enabled: isAdmin,\n    retry: 1\n  });\n\n  useEffect(() => {\n    if (location.state?.shouldResetPagination) {\n      setPage(1);\n      navigate(location.pathname, { replace: true, state: {} });\n    }\n  }, [location.state, navigate, location.pathname]);\n\n  useEffect(() => {\n    let channel: ReturnType<typeof supabase.channel>;\n    \n    const subscribe = async () => {\n      channel = supabase\n        .channel('realtime-products')\n        .on('postgres_changes', \n          { \n            event: '*', \n            schema: 'public', \n            table: 'products' \n          }, \n          () => stableRefetch()\n        )\n        .subscribe();\n    };\n\n    subscribe();\n\n    return () => {\n      channel?.unsubscribe().catch(console.error);\n    };\n  }, [stableRefetch]);\n\n  const deleteMutation = useMutation<void, Error, string>({\n    mutationFn: async (id) => {\n      const product = products?.find(p => p.id === id);\n      \n      if (product?.image_url) {\n        await Promise.all(\n          product.image_url.map(async (url: string) => {\n            const path = url.split('/').pop();\n            if (path) {\n              const folder = product.type === 'tire' ? 'tires' : 'wheels';\n              const { error } = await supabase.storage\n                .from('products')\n                .remove([`${folder}/${path}`]);\n              \n              if (error && error.message !== 'Object not found') throw error;\n            }\n          })\n        );\n      }\n\n      const { error } = await supabase\n        .from('products')\n        .delete()\n        .eq('id', id);\n      \n      if (error) throw error;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['products'] });\n      trackEvent('admin_product_delete', { product_id: productToDelete });\n    },\n    onError: (err) => {\n      trackEvent('admin_product_delete_error', { error: err.message });\n      console.error('Delete error:', err);\n    },\n    onSettled: () => {\n      setProductToDelete(null);\n      setIsDeleteModalOpen(false);\n    }\n  });\n\n  if (adminLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <motion.div\n          animate={{ rotate: 360 }}\n          transition={{ duration: 1.5, repeat: Infinity }}\n          className=\"border-4 border-blue-200 rounded-full w-16 h-16\"\n        />\n      </div>\n    );\n  }\n\n  if (!isAdmin) {\n    return (\n      <div className=\"p-8 text-center\">\n        <h1 className=\"text-2xl font-bold text-red-600\">Несанкціонований доступ</h1>\n        <p className=\"mt-2 text-gray-600\">У вас немає прав для перегляду цієї сторінки.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 sm:p-6\">\n      <header className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-3\">\n        <h1 className=\"text-xl sm:text-2xl font-bold\">Управління товарами</h1>\n        <motion.button\n          onClick={() => navigate('/admin/products/new')}\n          className=\"bg-blue-500 text-white px-3 py-1.5 sm:px-4 sm:py-2 rounded hover:bg-blue-600 text-sm sm:text-base\"\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n        >\n          Додати товар\n        </motion.button>\n      </header>\n\n      <Filters onFilterChange={setFilters} onSortChange={setSort} />\n\n      <AnimatePresence>\n        {error && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0 }}\n            className=\"mb-3 p-2 sm:p-3 bg-red-100 text-red-600 rounded-lg text-xs sm:text-sm\"\n          >\n            {error.message}\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {isLoading ? (\n        <div className=\"flex justify-center items-center h-64\">\n          <motion.div\n            animate={{ rotate: 360 }}\n            transition={{ duration: 1.2, repeat: Infinity }}\n            className=\"border-3 border-blue-400 rounded-full w-12 h-12\"\n          />\n        </div>\n      ) : (\n        <>\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            className=\"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4\"\n          >\n            {products?.map((product) => (\n              <motion.div\n                key={product.id}\n                whileHover={{ y: -3 }}\n                transition={{ duration: 0.2 }}\n                className=\"border p-2 sm:p-3 rounded shadow bg-white\"\n              >\n                {product.image_url?.[0] && (\n                  <img \n                    src={product.image_url[0]} \n                    alt={product.name} \n                    className=\"w-full h-28 sm:h-32 md:h-40 object-cover mb-2 rounded\"\n                  />\n                )}\n                <h3 className=\"font-bold text-sm sm:text-base mb-1\">\n                  {product.brand} {product.model}\n                </h3>\n\n                <div className=\"text-gray-600 text-xs sm:text-sm space-y-1\">\n                  <div className=\"flex flex-col gap-0.5\">\n                    <span className={`font-medium ${product.sale_price ? 'text-red-500 line-through' : 'text-gray-800'}`}>\n                      {product.price} грн\n                    </span>\n                    {product.sale_price && (\n                      <span className=\"font-medium text-green-600\">\n                        {product.sale_price} грн\n                      </span>\n                    )}\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-x-2 gap-y-1\">\n                    <p>Тип: {product.type === 'tire' ? 'Шина' : 'Диск'}</p>\n                    <p>Розмір: {product.width}/{product.profile}R{product.diameter}</p>\n                    <p>Країна: {product.country}</p>\n                    <p>Рік: {product.year}</p>\n                  </div>\n\n                  {product.type === 'tire' && (\n                    <div className=\"grid grid-cols-2 gap-x-2\">\n                      <p>Сезон: {seasonLabels[product.season as keyof SeasonMap]}</p>\n                      <p>Шум: {product.noise_level}dB</p>\n                      {product.wet_grip && <p>Сцепление: {product.wet_grip}</p>}\n                      {product.fuel_efficiency && <p>Экономия: {product.fuel_efficiency}</p>}\n                      {product.load_index && <p>Нагрузка: {product.load_index}</p>}\n                      {product.speed_index && <p>Скорость: {product.speed_index}</p>}\n                      <p>Шипы: {product.spikes ? 'Да' : 'Нет'}</p>\n                    </div>\n                  )}\n\n{product.type === 'wheel' && product.wheel_width !== undefined && (\n  <div className=\"grid grid-cols-2 gap-x-2\">\n    <p>Ширина диска: {product.wheel_width}мм</p>\n  </div>\n)}\n\n                  <div className=\"flex items-center gap-1.5 mt-1\">\n                    <span className=\"text-gray-500 text-xs\">\n                      Відгуків: {product.reviews_count}\n                    </span>\n                  </div>\n                </div>\n\n                <div className=\"mt-2 flex items-center justify-between\">\n                  <div className=\"flex gap-1.5 sm:gap-2\">\n                    <motion.button\n                      onClick={() => setEditProduct(product)}\n                      className=\"text-blue-600 hover:text-blue-800 text-xs sm:text-sm\"\n                      whileHover={{ scale: 1.05 }}\n                      whileTap={{ scale: 0.95 }}\n                    >\n                      Редагувати\n                    </motion.button>\n                    <motion.button\n                      onClick={() => {\n                        setProductToDelete(product.id);\n                        setIsDeleteModalOpen(true);\n                      }}\n                      className=\"text-red-600 hover:text-red-800 text-xs sm:text-sm\"\n                      whileHover={{ scale: 1.05 }}\n                      whileTap={{ scale: 0.95 }}\n                    >\n                      Видалити\n                    </motion.button>\n                  </div>\n                </div>\n              </motion.div>\n            ))}\n          </motion.div>\n\n          <Pagination \n            currentPage={page} \n            totalPages={Math.ceil(totalCount / 10) || 1}\n            onPageChange={setPage} \n          />\n        </>\n      )}\n\n      <Modal\n        isOpen={isDeleteModalOpen}\n        onRequestClose={() => setIsDeleteModalOpen(false)}\n        className=\"modal bg-white rounded-lg p-4 sm:p-6 max-w-md mx-auto shadow-xl\"\n        overlayClassName=\"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center\"\n      >\n        <h2 className=\"text-lg sm:text-xl font-bold mb-3\">Видалити товар?</h2>\n        <div className=\"space-y-3\">\n          <p className=\"text-sm sm:text-base\">Ви дійсно хочете видалити цей товар? Цю дію не можна скасувати.</p>\n          <div className=\"flex justify-end gap-2\">\n            <button\n              onClick={() => setIsDeleteModalOpen(false)}\n              className=\"px-3 py-1.5 text-gray-600 hover:bg-gray-100 rounded text-sm sm:text-base\"\n            >\n              Скасувати\n            </button>\n            <button\n              onClick={() => productToDelete && deleteMutation.mutate(productToDelete)}\n              className=\"px-3 py-1.5 bg-red-500 text-white rounded hover:bg-red-600 text-sm sm:text-base\"\n              disabled={deleteMutation.isPending}\n            >\n              {deleteMutation.isPending ? 'Видалення...' : 'Видалити'}\n            </button>\n          </div>\n        </div>\n      </Modal>\n\n      {editProduct && (\n        <EditProductModal\n          isOpen={!!editProduct}\n          product={editProduct}\n          onClose={() => setEditProduct(null)}\n          onSave={async (updatedProduct) => {\n            await supabase\n              .from('products')\n              .update(updatedProduct)\n              .eq('id', updatedProduct.id);\n            \n            await queryClient.invalidateQueries({ \n              queryKey: ['products'] \n            });\n            setEditProduct(null);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n","import { useState, Dispatch, SetStateAction } from 'react'; // Добавлен импорт типов\nimport { motion } from 'framer-motion';\nimport { uploadFile, getPublicUrl } from '../lib/storage';\n\ninterface ImageUploaderProps {\n  onUpload: (urls: string[]) => void; // Функция для передачи URL загруженных файлов\n  onUploading?: Dispatch<SetStateAction<boolean>>; // Функция для управления состоянием загрузки\n}\n\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\nconst ALLOWED_FILE_TYPES = ['image/jpeg', 'image/png', 'image/webp'];\n\nexport const ImageUploader = ({ onUpload, onUploading }: ImageUploaderProps) => {\n  const [progress, setProgress] = useState(0); // Прогресс загрузки\n  const [uploadedCount, setUploadedCount] = useState(0); // Количество успешно загруженных файлов\n  const [selectedFiles, setSelectedFiles] = useState<FileList | null>(null); // Выбранные файлы\n  const [isUploading, setIsUploading] = useState(false); // Состояние загрузки\n\n  const handleFileUpload = async (files: FileList | null) => {\n    if (isUploading) {\n      alert('Завантаження вже виконується. Будь ласка, зачекайте.');\n      return;\n    }\n\n    if (!files || files.length === 0) {\n      alert('Будь ласка, виберіть файли для завантаження');\n      return;\n    }\n\n    setIsUploading(true); // Устанавливаем состояние загрузки в true\n    setSelectedFiles(files);\n    onUploading?.(true); // Устанавливаем состояние загрузки в true для родительского компонента\n\n    const urls: string[] = []; // Массив для хранения URL загруженных файлов\n    let successCount = 0; // Счетчик успешно загруженных файлов\n\n    try {\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        let publicUrl = '';\n\n        try {\n          // Валидация файла\n          if (!ALLOWED_FILE_TYPES.includes(file.type)) {\n            throw new Error(`Файл \"${file.name}\": недопустимий формат`);\n          }\n\n          if (file.size > MAX_FILE_SIZE) {\n            throw new Error(`Файл \"${file.name}\": перевищує 5MB`);\n          }\n\n          // Загрузка файла\n          const { path } = await uploadFile(file, 'products', 'tires'); // Загружаем файл в хранилище\n          publicUrl = getPublicUrl('products', path); // Получаем публичный URL файла\n\n          urls.push(publicUrl); // Добавляем URL в массив\n          successCount++; // Увеличиваем счетчик успешных загрузок\n        } catch (error) {\n          console.error(`Помилка з файлом ${file.name}:`, error);\n          alert(error instanceof Error ? error.message : 'Невідома помилка');\n          continue; // Продолжаем загрузку остальных файлов, если произошла ошибка\n        }\n\n        // Обновление прогресса\n        setProgress(((i + 1) / files.length) * 100); // Обновляем прогресс\n        setUploadedCount(successCount); // Обновляем счетчик загруженных файлов\n      }\n\n      onUpload(urls); // Передаем массив URL загруженных файлов в родительский компонент\n    } finally {\n      setIsUploading(false); // Сбрасываем состояние загрузки\n      onUploading?.(false); // Устанавливаем состояние загрузки в false для родительского компонента\n      setProgress(0); // Сбрасываем прогресс\n      setUploadedCount(0); // Сбрасываем счетчик загруженных файлов\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <label className=\"block\">\n        <input\n          type=\"file\"\n          multiple\n          accept={ALLOWED_FILE_TYPES.join(',')} // Разрешенные типы файлов\n          onChange={(e) => handleFileUpload(e.target.files)} // Обработчик выбора файлов\n          className=\"block w-full text-sm text-gray-500\n            file:mr-4 file:py-2 file:px-4\n            file:rounded-full file:border-0\n            file:text-sm file:font-semibold\n            file:bg-blue-50 file:text-blue-700\n            hover:file:bg-blue-100\"\n          disabled={isUploading} // Блокируем input во время загрузки\n        />\n      </label>\n\n      {progress > 0 && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          className=\"relative pt-1\"\n        >\n          <div className=\"flex h-2 overflow-hidden bg-gray-200 rounded\">\n            <div\n              className=\"transition-all duration-300 ease-out bg-blue-500\"\n              style={{ width: `${progress}%` }} // Отображение прогресса\n            />\n          </div>\n          <span className=\"text-sm text-gray-600\">\n            {`Завантажено ${uploadedCount} з \n            ${selectedFiles?.length || 0} файлів \n            (${Math.round(progress)}%)`} // Отображение количества загруженных файлов\n          </span>\n        </motion.div>\n      )}\n    </div>\n  );\n};","import React, { useState, useEffect, useCallback } from 'react';\nimport { useAdmin } from '../../hooks/useAdmin';\nimport { trackEvent } from '../../lib/analytics';\nimport { supabase } from '../../lib/supabaseClient';\nimport { Product } from '../../types/database.types';\nimport { motion } from 'framer-motion';\nimport { useNavigate } from 'react-router-dom';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { ImageUploader } from '../../components/ImageUploader';\n\n\nexport const ProductCreatePage: React.FC = () => {\n  const navigate = useNavigate();\n  const queryClient = useQueryClient();\n  const { isAdmin, loading: adminLoading } = useAdmin();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isImageUploading, setIsImageUploading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [allBrands, setAllBrands] = useState<string[]>([]);\n  const [allModels, setAllModels] = useState<string[]>([]);\n  const [suggestions, setSuggestions] = useState<{\n    brands: string[];\n    models: string[];\n  }>({ brands: [], models: [] });\n\n  const [formData, setFormData] = useState<Partial<Product>>({\n    type: 'tire',\n    brand: '',\n    model: '',\n    width: 195,\n    diameter: 16,\n    profile: 55,\n    price: 0,\n    sale_price: undefined,\n    image_url: [],\n    country: 'UA',\n    year: new Date().getFullYear(),\n    season: 'summer',\n    noise_level: 70,\n    wet_grip: 'A',\n    fuel_efficiency: 'A',\n    wheel_width: undefined, // bigint\n    load_index: '',\n    speed_index: '',\n    spikes: false,\n  });\n\n\n  const fetchExistingData = useCallback(async () => {\n    try {\n      const { data: brandsData } = await supabase\n        .from('products')\n        .select('brand')\n        .not('brand', 'is', null);\n\n      const { data: modelsData } = await supabase\n        .from('products')\n        .select('model')\n        .not('model', 'is', null);\n\n      if (brandsData) {\n        const uniqueBrands = [...new Set(brandsData.map(p => p.brand))];\n        setAllBrands(uniqueBrands);\n        setSuggestions(prev => ({ ...prev, brands: uniqueBrands.slice(0, 5) }));\n      }\n\n      if (modelsData) {\n        const uniqueModels = [...new Set(modelsData.map(p => p.model))];\n        setAllModels(uniqueModels);\n      }\n    } catch (err) {\n      console.error('Ошибка загрузки данных:', err);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchExistingData();\n  }, [fetchExistingData]);\n\n  const handleBrandInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.trim();\n    setFormData(prev => ({ ...prev, brand: value, model: '' }));\n    \n    const filtered = value.length > 0 \n      ? allBrands\n          .filter(brand => brand.toLowerCase().includes(value.toLowerCase()))\n          .slice(0, 5)\n      : allBrands.slice(0, 5);\n    \n    setSuggestions(prev => ({ ...prev, brands: filtered }));\n  };\n\n  const handleModelInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.trim();\n    setFormData(prev => ({ ...prev, model: value }));\n    \n    const filtered = value.length > 0\n      ? allModels\n          .filter(model => model.toLowerCase().includes(value.toLowerCase()))\n          .slice(0, 5)\n      : allModels.slice(0, 5);\n    \n    setSuggestions(prev => ({ ...prev, models: filtered }));\n  };\n\n  const handleChange = (\n    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>\n  ) => {\n    const { name, value, type } = e.target;\n    \n    setFormData(prev => ({\n      ...prev,\n      [name]: type === 'number' ? (value === '' ? null : Number(value)) : value,\n    }));\n  };\n  \n  // Отдельный обработчик для bigint полей\n  const handleBigIntChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value === '' ? undefined : BigInt(value)\n    }));\n  };\n\n  const handleImageUpload = (urls: string[]) => {\n    setFormData(prev => ({\n      ...prev,\n      image_url: [...new Set([...(prev.image_url || []), ...urls])],\n    }));\n  };\n\n  const handleRemoveImage = (index: number) => {\n    setFormData(prev => ({\n      ...prev,\n      image_url: prev.image_url?.filter((_, i) => i !== index) || [],\n    }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n    setError(null);\n\n    try {\n      const formDataToSubmit = {\n        ...formData,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString(),\n      };\n\n      const { data: productData, error: productError } = await supabase\n        .from('products')\n        .insert([formDataToSubmit])\n        .select()\n        .single();\n\n      if (productError) throw productError;\n\n      trackEvent('admin_product_create', {\n        product_id: productData.id,\n        product_name: `${formData.brand} ${formData.model}`,\n      });\n\n      await queryClient.invalidateQueries({\n        queryKey: ['products'],\n        exact: false,\n        refetchType: 'all'\n      });\n\n      navigate('/admin/products', { \n        state: { \n          successMessage: 'Товар успішно створено',\n          shouldResetPagination: true\n        } \n      });\n\n    } catch (err) {\n      const errorMessage = err instanceof Error \n        ? err.message \n        : 'Помилка при створенні товару';\n      \n      console.error('Помилка створення:', errorMessage);\n      setError(errorMessage);\n      \n      trackEvent('admin_product_create_error', {\n        error: errorMessage,\n        product_data: formData,\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // Функция для преобразования bigint в строку для отображения\n  const bigIntToString = (value: bigint | undefined): string => {\n    return value?.toString() || '';\n  };\n\n  if (adminLoading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <motion.div\n          className=\"relative w-16 h-16\"\n          animate={{ rotate: 360 }}\n          transition={{ repeat: Infinity, duration: 1.5, ease: 'linear' }}\n        />\n      </div>\n    );\n  }\n\n  if (!isAdmin) {\n    return (\n      <div className=\"p-8 text-center\">\n        <h1 className=\"text-2xl font-bold text-red-600\">Несанкціонований доступ</h1>\n        <p className=\"mt-2 text-gray-600\">У вас немає прав для перегляду цієї сторінки.</p>\n      </div>\n    );\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"p-6 max-w-4xl mx-auto\"\n    >\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-2xl font-bold\">Додати новий товар</h1>\n        <motion.button\n          onClick={() => navigate('/admin/products')}\n          className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600\"\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n        >\n          Назад до списку\n        </motion.button>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"space-y-6 bg-white p-6 rounded-lg shadow\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Тип <span className=\"text-red-500\">*</span>\n            </label>\n            <select\n              name=\"type\"\n              value={formData.type}\n              onChange={handleChange}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"tire\">Шина</option>\n              <option value=\"wheel\">Диск</option>\n            </select>\n          </div>\n\n          {formData.type === 'tire' && (\n            <>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Сезон <span className=\"text-red-500\">*</span>\n                </label>\n                <select\n                  name=\"season\"\n                  value={formData.season}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"summer\">Літо</option>\n                  <option value=\"winter\">Зима</option>\n                  <option value=\"all-season\">Всесезон</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Рівень шуму (dB)\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"noise_level\"\n                  value={formData.noise_level || ''}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n                  min=\"0\"\n                  max=\"100\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Сцепление на мокрой дороге\n                </label>\n                <select\n                  name=\"wet_grip\"\n                  value={formData.wet_grip}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n                >\n                  {['A', 'B', 'C', 'D', 'E'].map(grade => (\n                    <option key={grade} value={grade}>{grade}</option>\n                  ))}\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Топливная эффективность\n                </label>\n                <select\n                  name=\"fuel_efficiency\"\n                  value={formData.fuel_efficiency}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n                >\n                  {['A', 'B', 'C', 'D', 'E'].map(grade => (\n                    <option key={grade} value={grade}>{grade}</option>\n                  ))}\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Индекс нагрузки\n                </label>\n                <input\n                  type=\"text\"\n                  name=\"load_index\"\n                  value={formData.load_index}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"Например: 92Y\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Индекс скорости\n                </label>\n                <input\n                  type=\"text\"\n                  name=\"speed_index\"\n                  value={formData.speed_index}\n                  onChange={handleChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"Например: Y\"\n                />\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"checkbox\"\n                  name=\"spikes\"\n                  checked={formData.spikes || false}\n                  onChange={(e) => setFormData(prev => ({\n                    ...prev,\n                    spikes: e.target.checked\n                  }))}\n                  className=\"h-4 w-4\"\n                />\n                <label className=\"text-sm\">Шипованные</label>\n              </div>\n            </>\n          )}\n\n          {formData.type === 'wheel' && (\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Ширина диска (мм)\n              </label>\n              <input\n                type=\"number\"\n                name=\"wheel_width\"\n                value={bigIntToString(formData.wheel_width as bigint | undefined)}\n                onChange={handleBigIntChange}\n                className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n                min=\"100\"\n                max=\"500\"\n              />\n            </div>\n          )}\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Бренд <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              list=\"brands-list\"\n              name=\"brand\"\n              value={formData.brand}\n              onChange={handleBrandInput}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n              required\n            />\n            <datalist id=\"brands-list\">\n              {suggestions.brands.map((brand, index) => (\n                <option key={index} value={brand} />\n              ))}\n            </datalist>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Модель <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              list=\"models-list\"\n              name=\"model\"\n              value={formData.model}\n              onChange={handleModelInput}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n              required\n            />\n            <datalist id=\"models-list\">\n              {suggestions.models.map((model, index) => (\n                <option key={index} value={model} />\n              ))}\n            </datalist>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Ширина <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"number\"\n              name=\"width\"\n              value={formData.width || ''}\n              onChange={handleChange}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n              required\n              min=\"100\"\n              max=\"500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Профіль (%) <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"number\"\n              name=\"profile\"\n              value={formData.profile || ''}\n              onChange={handleChange}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n              required\n              min=\"20\"\n              max=\"100\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Діаметр <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"number\"\n              name=\"diameter\"\n              value={formData.diameter || ''}\n              onChange={handleChange}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n              required\n              min=\"10\"\n              max=\"30\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Ціна (грн) <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"number\"\n              name=\"price\"\n              value={formData.price || ''}\n              onChange={handleChange}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n              required\n              min=\"0\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Акційна ціна (грн)\n            </label>\n            <input\n              type=\"number\"\n              name=\"sale_price\"\n              value={formData.sale_price || ''}\n              onChange={handleChange}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n              min=\"0\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Країна виробник\n            </label>\n            <input\n              type=\"text\"\n              name=\"country\"\n              value={formData.country}\n              onChange={handleChange}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Рік виробництва\n            </label>\n            <input\n              type=\"number\"\n              name=\"year\"\n              value={formData.year || ''}\n              onChange={handleChange}\n              className=\"w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500\"\n              min=\"2000\"\n              max={new Date().getFullYear() + 1}\n            />\n          </div>\n\n          <div className=\"md:col-span-2\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Зображення\n            </label>\n            <ImageUploader\n              onUpload={handleImageUpload}\n              onUploading={setIsImageUploading}\n            />\n            <div className=\"mt-2 grid grid-cols-3 gap-2\">\n              {formData.image_url?.map((url, index) => (\n                <div key={index} className=\"relative group\">\n                  <img\n                    src={url}\n                    alt={`Preview ${index + 1}`}\n                    className=\"h-24 w-full object-cover rounded border transition-opacity group-hover:opacity-75\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => handleRemoveImage(index)}\n                    className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors\"\n                  >\n                    ×\n                  </button>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {error && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"text-red-600 p-3 bg-red-100 rounded-lg\"\n          >\n            {error}\n          </motion.div>\n        )}\n\n        <div className=\"flex justify-end gap-4 mt-8\">\n          <motion.button\n            type=\"button\"\n            onClick={() => navigate('/admin/products')}\n            className=\"bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors\"\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n          >\n            Скасувати\n          </motion.button>\n\n          <motion.button\n            type=\"submit\"\n            disabled={isSubmitting || isImageUploading}\n            className=\"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n          >\n            {isSubmitting ? (\n              <span className=\"flex items-center\">\n                <svg className=\"animate-spin h-5 w-5 mr-3\" viewBox=\"0 0 24 24\">\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\"/>\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"/>\n                </svg>\n                Створення...\n              </span>\n            ) : (\n              'Створити товар'\n            )}\n          </motion.button>\n        </div>\n      </form>\n    </motion.div>\n  );\n};","import React, { useState, useEffect } from \"react\";\nimport { supabase } from \"../../lib/supabaseClient\";\nimport { useNavigate } from \"react-router-dom\";\n\ninterface Article {\n  id: number;\n  title: string;\n  content: string;\n  image_path?: string;\n}\n\nconst NewArticle: React.FC = () => {\n  // Состояния для формы загрузки статьи\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n  const [imageFile, setImageFile] = useState<File | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  // Состояние для списка статей\n  const [articles, setArticles] = useState<Article[]>([]);\n  const navigate = useNavigate();\n\n  // Загружаем статьи при монтировании компонента\n  useEffect(() => {\n    fetchArticles();\n  }, []);\n\n  const fetchArticles = async () => {\n    const { data, error } = await supabase\n      .from(\"articles\")\n      .select(\"*\")\n      .order(\"id\", { ascending: false });\n    if (error) {\n      console.error(\"Ошибка загрузки статей:\", error.message);\n    } else if (data) {\n      setArticles(data as Article[]);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    let imagePath = \"\";\n\n    if (imageFile) {\n      const fileName = `${Date.now()}_${imageFile.name}`;\n      const { error: uploadError } = await supabase.storage\n        .from(\"articles-images\")\n        .upload(fileName, imageFile);\n      if (uploadError) {\n        console.error(\"Ошибка загрузки изображения:\", uploadError.message);\n        setLoading(false);\n        return;\n      }\n      imagePath = fileName;\n    }\n\n    const { error: insertError } = await supabase\n      .from(\"articles\")\n      .insert([{ title, content, image_path: imagePath }]);\n    if (insertError) {\n      console.error(\"Ошибка добавления статьи:\", insertError.message);\n    } else {\n      setTitle(\"\");\n      setContent(\"\");\n      setImageFile(null);\n      alert(\"Статья успешно добавлена!\");\n      fetchArticles(); // Обновляем список статей после добавления\n    }\n    setLoading(false);\n  };\n\n  // Функция для получения публичного URL изображения\n  const getPublicUrl = (imagePath: string) => {\n    const { data } = supabase.storage\n      .from(\"articles-images\")\n      .getPublicUrl(imagePath);\n    return data.publicUrl;\n  };\n\n  // Обработчик клика по карточке статьи для перехода на страницу подробного просмотра\n  const handleArticleClick = (article: Article) => {\n    navigate(`/admin/articles/${article.id}`); // Предполагается, что данный маршрут существует\n  };\n\n  // Обработчик для перемещения карточки в начало списка\n  const handleMoveToTop = (article: Article) => {\n    setArticles((prev) => {\n      const filtered = prev.filter((a) => a.id !== article.id);\n      return [article, ...filtered];\n    });\n  };\n\n  // Обработчик удаления статьи\n  const handleDelete = async (article: Article) => {\n    if (window.confirm(`Удалить статью \"${article.title}\"?`)) {\n      const { error } = await supabase\n        .from(\"articles\")\n        .delete()\n        .eq(\"id\", article.id);\n      if (error) {\n        console.error(\"Ошибка удаления статьи:\", error.message);\n      } else {\n        setArticles((prev) => prev.filter((a) => a.id !== article.id));\n      }\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-4\">\n      {/* Форма загрузки статьи */}\n      <div className=\"max-w-3xl mx-auto bg-white shadow rounded-lg p-6 mb-8\">\n        <h1 className=\"text-2xl font-bold mb-6 text-center\">\n          Добавить новую статью\n        </h1>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className=\"block mb-2 font-medium\">Заголовок</label>\n            <input\n              type=\"text\"\n              className=\"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              value={title}\n              onChange={(e) => setTitle(e.target.value)}\n              required\n            />\n          </div>\n          <div>\n            <label className=\"block mb-2 font-medium\">Контент</label>\n            <textarea\n              className=\"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              rows={6}\n              value={content}\n              onChange={(e) => setContent(e.target.value)}\n              required\n            />\n          </div>\n          <div>\n            <label className=\"block mb-2 font-medium\">Изображение</label>\n            <input\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={(e) =>\n                e.target.files && setImageFile(e.target.files[0])\n              }\n              className=\"w-full\"\n            />\n          </div>\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n          >\n            {loading ? \"Загрузка...\" : \"Добавить статью\"}\n          </button>\n        </form>\n      </div>\n\n      {/* Список статей */}\n      <div>\n        <h2 className=\"text-xl font-bold mb-4\">Все статьи</h2>\n        {articles.length === 0 ? (\n          <p>Статей нет</p>\n        ) : (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6\">\n            {articles.map((article) => (\n              <div\n                key={article.id}\n                className=\"bg-white shadow rounded p-6 cursor-pointer flex flex-col\"\n              >\n                <div onClick={() => handleArticleClick(article)} className=\"flex-1\">\n                  <h3 className=\"font-bold mb-3 text-lg\">{article.title}</h3>\n                  {article.image_path && (\n                    <img\n                      src={getPublicUrl(article.image_path)}\n                      alt={article.title}\n                      className=\"w-full h-40 object-cover mb-3 rounded\"\n                    />\n                  )}\n                  <p\n                    className=\"text-sm text-gray-600 line-clamp-3\"\n                    style={{ whiteSpace: \"pre-wrap\" }}\n                  >\n                    {article.content}\n                  </p>\n                </div>\n                <div className=\"mt-4 flex justify-between\">\n                  <button\n                    onClick={() => handleMoveToTop(article)}\n                    className=\"bg-green-500 hover:bg-green-600 text-white text-xs py-1 px-2 rounded transition-colors\"\n                  >\n                    В начало\n                  </button>\n                  <button\n                    onClick={() => handleDelete(article)}\n                    className=\"bg-red-500 hover:bg-red-600 text-white text-xs py-1 px-2 rounded transition-colors\"\n                  >\n                    Удалить\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default NewArticle;\n","import { useOutletContext } from 'react-router-dom';\nimport { Session } from './AdminLayout';\nimport { useState, useMemo, useCallback } from 'react';\nimport { ArrowDownAZ, ArrowUpZA, Clock, RefreshCw, Trash2, UserX } from 'lucide-react';\nimport { supabase } from '../../lib/supabaseClient';\nimport { toast } from 'react-toastify';\n\nexport const SessionsPage = () => {\n  const { sessions, refreshSessions } = useOutletContext<{ \n    sessions: Session[];\n    refreshSessions: () => Promise<void>;\n  }>();\n\n  const [sortConfig, setSortConfig] = useState<{ \n    key: 'user_id' | 'guest_id' | 'last_activity' | 'is_online'; \n    direction: 'asc' | 'desc' \n  }>({\n    key: 'last_activity',\n    direction: 'desc'\n  });\n\n  const sortedSessions = useMemo(() => {\n    return [...sessions].sort((a, b) => {\n      switch (sortConfig.key) {\n        case 'last_activity': {\n          const aDate = new Date(a.last_activity).getTime();\n          const bDate = new Date(b.last_activity).getTime();\n          return sortConfig.direction === 'asc' ? aDate - bDate : bDate - aDate;\n        }\n        case 'user_id':\n        case 'guest_id': {\n          const aValue = a[sortConfig.key] || '';\n          const bValue = b[sortConfig.key] || '';\n          return sortConfig.direction === 'asc'\n            ? aValue.localeCompare(bValue)\n            : bValue.localeCompare(aValue);\n        }\n        case 'is_online': {\n          return sortConfig.direction === 'asc'\n            ? Number(a.is_online) - Number(b.is_online)\n            : Number(b.is_online) - Number(a.is_online);\n        }\n        default:\n          return 0;\n      }\n    });\n  }, [sessions, sortConfig]);\n\n  // Функция проверки прав администратора\n  const isAdmin = async (): Promise<boolean> => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n      toast.error('Пользователь не найден');\n      return false;\n    }\n    const { data: adminData, error: adminError } = await supabase\n      .from('admins')\n      .select('*')\n      .eq('user_id', user.id)\n      .single();\n\n    if (adminError || !adminData) {\n      toast.error('Недостаточно прав для удаления');\n      return false;\n    }\n    return true;\n  };\n\n  const deleteSession = async (sessionId: string) => {\n    if (!(await isAdmin())) return;\n\n    try {\n      const { error } = await supabase\n        .from('sessions')\n        .delete()\n        .eq('id', sessionId);\n\n      if (error) throw error;\n      \n      await refreshSessions();\n      toast.success('Сессия успешно удалена');\n    } catch (error) {\n      toast.error('Ошибка при удалении сессии');\n      console.error('Delete error:', error);\n    }\n  };\n\n  const deleteInactiveSessions = async () => {\n    if (!(await isAdmin())) return;\n\n    try {\n      const { error } = await supabase\n        .from('sessions')\n        .delete()\n        .eq('is_online', false);\n\n      if (error) throw error;\n      \n      await refreshSessions();\n      toast.success(`Удалено ${sessions.filter(s => !s.is_online).length} неактивных сессий`);\n    } catch (error) {\n      toast.error('Ошибка при удалении сессий');\n      console.error('Delete inactive error:', error);\n    }\n  };\n\n  const getSessionDuration = useCallback((session: Session) => {\n    const start = new Date(session.last_activity).getTime();\n    const now = Date.now();\n    const diff = now - start;\n    \n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n    \n    return `${hours}ч ${minutes}м`;\n  }, []);\n\n  const handleSort = (key: typeof sortConfig.key) => {\n    setSortConfig(prev => ({\n      key,\n      direction: prev.key === key && prev.direction === 'asc' ? 'desc' : 'asc'\n    }));\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-lg p-4 md:p-6 mx-2 md:mx-0 h-[calc(100vh-160px)] md:h-auto\">\n      <div className=\"flex flex-wrap gap-3 items-center justify-between mb-4 md:mb-6\">\n        <h2 className=\"text-xl md:text-2xl font-bold text-foreground\">\n          Активные сессии ({sessions.length})\n        </h2>\n        \n        <div className=\"flex gap-2\">\n          <button\n            onClick={deleteInactiveSessions}\n            className=\"p-2 hover:bg-red-50 rounded-lg transition-colors text-red-600\"\n            title=\"Удалить все неактивные сессии\"\n          >\n            <UserX className=\"w-5 h-5\" />\n          </button>\n          \n          <button \n            onClick={refreshSessions}\n            className=\"p-2 hover:bg-muted rounded-lg transition-colors\"\n            aria-label=\"Обновить данные\"\n          >\n            <RefreshCw className=\"w-5 h-5 text-primary\" />\n          </button>\n        </div>\n      </div>\n\n      <div className=\"md:hidden space-y-3 overflow-y-auto h-[calc(100%-60px)]\">\n        {sortedSessions.map((session) => (\n          <div key={session.id} className=\"border-b pb-3 animate-fadeIn\">\n            <div className=\"flex justify-between items-start\">\n              <div>\n                <div className=\"font-medium text-sm text-foreground\">\n                  {session.user_id ? 'Пользователь' : 'Гость'}\n                </div>\n                <div className=\"text-xs text-muted-foreground mt-1\">\n                  ID: {session.user_id || session.guest_id?.slice(0, 8)}\n                </div>\n              </div>\n              <div className=\"flex gap-2 items-center\">\n                <span className={`px-2 py-1 rounded-full text-xs ${\n                  session.is_online \n                    ? 'bg-green-100 text-green-800' \n                    : 'bg-gray-100 text-gray-800'\n                }`}>\n                  {session.is_online ? 'Онлайн' : 'Офлайн'}\n                </span>\n                <button \n                  onClick={() => deleteSession(session.id)}\n                  className=\"text-red-500 hover:text-red-700\"\n                >\n                  <Trash2 size={16} />\n                </button>\n              </div>\n            </div>\n            \n            <div className=\"mt-2 flex items-center justify-between\">\n              <div className=\"flex items-center gap-1 text-muted-foreground\">\n                <Clock className=\"w-3 h-3\" />\n                <span className=\"text-xs\">{getSessionDuration(session)}</span>\n              </div>\n              <span className=\"text-xs text-muted-foreground\">\n                {new Date(session.last_activity).toLocaleTimeString()}\n              </span>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"hidden md:block overflow-x-auto max-h-[70vh]\">\n        <table className=\"w-full\">\n          <thead className=\"sticky top-0 bg-background\">\n            <tr className=\"border-b\">\n              <th className=\"px-4 py-3 text-left text-sm font-medium text-foreground\">Действия</th>\n              <th \n                className=\"px-4 py-3 text-left text-sm font-medium text-foreground cursor-pointer\"\n                onClick={() => handleSort('user_id')}\n              >\n                <div className=\"flex items-center gap-2\">\n                  ID\n                  {sortConfig.key === 'user_id' && (\n                    sortConfig.direction === 'asc' \n                      ? <ArrowDownAZ size={14} className=\"text-primary\" /> \n                      : <ArrowUpZA size={14} className=\"text-primary\" />\n                  )}\n                </div>\n              </th>\n              <th \n                className=\"px-4 py-3 text-left text-sm font-medium text-foreground cursor-pointer\"\n                onClick={() => handleSort('is_online')}\n              >\n                Статус\n              </th>\n              <th \n                className=\"px-4 py-3 text-left text-sm font-medium text-foreground cursor-pointer\"\n                onClick={() => handleSort('last_activity')}\n              >\n                <div className=\"flex items-center gap-2\">\n                  Последняя активность\n                  {sortConfig.key === 'last_activity' && (\n                    sortConfig.direction === 'asc' \n                      ? <ArrowDownAZ size={14} className=\"text-primary\" /> \n                      : <ArrowUpZA size={14} className=\"text-primary\" />\n                  )}\n                </div>\n              </th>\n              <th className=\"px-4 py-3 text-left text-sm font-medium text-foreground\">\n                Время активности\n              </th>\n            </tr>\n          </thead>\n          \n          <tbody>\n            {sortedSessions.map((session) => (\n              <tr key={session.id} className=\"border-b hover:bg-muted/50 transition-colors\">\n                <td className=\"px-4 py-3\">\n                  <button \n                    onClick={() => deleteSession(session.id)}\n                    className=\"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50\"\n                  >\n                    <Trash2 size={18} />\n                  </button>\n                </td>\n                <td className=\"px-4 py-3 text-sm text-foreground font-mono\">\n                  {session.user_id || session.guest_id}\n                </td>\n                <td className=\"px-4 py-3\">\n                  <span className={`px-2 py-1 rounded-full text-sm ${\n                    session.is_online \n                      ? 'bg-green-100 text-green-800' \n                      : 'bg-gray-100 text-gray-800'\n                  }`}>\n                    {session.is_online ? 'Онлайн' : 'Офлайн'}\n                  </span>\n                </td>\n                <td className=\"px-4 py-3 text-sm text-foreground\">\n                  {new Date(session.last_activity).toLocaleString()}\n                </td>\n                <td className=\"px-4 py-3\">\n                  <div className=\"flex items-center gap-1 text-muted-foreground\">\n                    <Clock className=\"w-4 h-4\" />\n                    <span>{getSessionDuration(session)}</span>\n                  </div>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n\n      {sortedSessions.length === 0 && (\n        <div className=\"text-center py-6 text-muted-foreground text-sm md:text-base\">\n          Нет активных сессий\n        </div>\n      )}\n    </div>\n  );\n};\n","// AdminRoute.tsx\nimport React from 'react';\nimport { Navigate, useLocation } from 'react-router-dom';\nimport { useAdmin } from '../hooks/useAdmin';\nimport { motion } from 'framer-motion';\n\ninterface AdminRouteProps {\n  children: React.ReactNode;\n}\n\nexport const AdminRoute: React.FC<AdminRouteProps> = ({ children }) => {\n  const { isAdmin, loading } = useAdmin();\n  const location = useLocation();\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-screen bg-gradient-to-br from-gray-50 to-blue-50\">\n        {/* Анимация загрузки */}\n        <div className=\"text-center space-y-4\">\n          <motion.div\n            className=\"relative w-32 h-32 mx-auto\"\n            initial={{ rotate: 0 }}\n            animate={{ rotate: 360 }}\n            transition={{\n              duration: 2,\n              repeat: Infinity,\n              ease: 'linear'\n            }}\n          >\n            <motion.div\n              className=\"absolute inset-0 border-4 border-blue-200 rounded-full\"\n              animate={{\n                scale: [1, 1.2, 1],\n                opacity: [0.6, 1, 0.6]\n              }}\n              transition={{\n                duration: 2.5,\n                repeat: Infinity,\n                ease: 'easeInOut'\n              }}\n            />\n            <motion.div\n              className=\"absolute inset-2 border-4 border-blue-400 rounded-full\"\n              animate={{\n                scale: [1, 0.8, 1],\n                rotate: [0, -180, -360]\n              }}\n              transition={{\n                duration: 3,\n                repeat: Infinity,\n                ease: 'easeInOut'\n              }}\n            />\n            <motion.div\n              className=\"absolute inset-4 bg-blue-600 rounded-full\"\n              animate={{\n                scale: [1, 1.1, 1],\n                borderRadius: ['50%', '40%', '50%']\n              }}\n              transition={{\n                duration: 1.5,\n                repeat: Infinity,\n                ease: 'easeInOut'\n              }}\n            />\n          </motion.div>\n          <motion.p\n            className=\"text-blue-800 font-medium text-lg\"\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.3 }}\n          >\n            Проверка прав доступа...\n          </motion.p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAdmin) {\n    return <Navigate to=\"/admin/login\" state={{ from: location }} />;\n  }\n\n  return <>{children}</>;\n};\n","import React, {\n  lazy,\n  Suspense,\n  useEffect,\n  useState,\n  useRef,\n  useCallback,\n  useMemo,\n  memo,\n} from 'react';\nimport {\n  createBrowserRouter,\n  RouterProvider,\n  Navigate,\n  Outlet,\n  ScrollRestoration,\n  useLocation,\n} from 'react-router-dom';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { AliveScope, KeepAlive } from 'react-activation';\nimport { supabase } from './lib/supabaseClient';\nimport { ToastContainer } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport './index.css';\n\n// Импорт публичных компонентов\nimport NavBar from './pagesHome/HomeSections/NavBar/NavBar';\nimport { Home } from './pagesHome/Home';\nimport { ProductList } from './pages/ProductList';\nimport CommentsPage from './pages/CommentsPage';\nimport { Auth } from './pages/Auth';\nimport { Profile } from './pages/Profile';\nimport { Checkout } from './pages/Checkout';\nimport ArticleWindow from './FAKT_Info/ArticleWindow';\nimport ArticleDetailPage from './FAKT_Info/ArticleDetailPage';\nimport AuthCallback from './pages/auth/AuthCallback';\nimport { DetailedSearch } from './pages/DetailedSearch';\nimport { MiniButton } from './components/ui/MiniButton';\nimport BC from './BC';\n\n// Импорт для админ-панели\nimport { AdminLayout } from './pages/admin/AdminLayout';\nimport { AdminLogin } from './pages/admin/AdminLogin';\nimport { Dashboard } from './pages/admin/Dashboard';\nimport { Products } from './pages/admin/Products';\nimport { ProductCreatePage } from './pages/admin/ProductCreatePage';\nimport NewArticle from './pages/admin/NewArticle';\nimport { SessionsPage } from './pages/admin/SessionsPage';\nimport { AdminRoute } from './middleware/AdminRoute';\n\nconst LazyProductDetail = lazy(() => import('./pages/ProductDetail'));\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      refetchOnWindowFocus: false,\n      retry: 1,\n      staleTime: 60 * 1000,\n    },\n  },\n});\n\n// Функция debounce для оптимизации обработки событий активности\nfunction debounce<T extends (...args: unknown[]) => void>(func: T, delay: number): T {\n  let timeoutId: ReturnType<typeof setTimeout>;\n  return function (...args: Parameters<T>) {\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => func(...args), delay);\n  } as T;\n}\n\n// PublicLayout – layout для публичной части с постоянным NavBar\nconst PublicLayout: React.FC = () => {\n  const location = useLocation();\n  const publicPaths = useMemo(\n    () => ['/', '/tires', '/wheels', '/search-results', '/detailed-search'],\n    []\n  );\n  return (\n    <>\n      <NavBar />\n      <ScrollRestoration />\n      {location.pathname !== \"/\" && <BC />}\n      {publicPaths.some((path) => location.pathname.startsWith(path)) && <MiniButton />}\n      <Outlet />\n    </>\n  );\n};\n\n// HomeWrapper оборачивает Home в KeepAlive, чтобы сохранять его состояние\nconst HomeWrapper = memo(() => (\n  <div>\n    {/* KeepAlive должен быть внутри AliveScope */}\n    <Home />\n  </div>\n));\n\n// Конфигурация роутинга\nconst router = createBrowserRouter([\n  {\n    path: '/',\n    element: <PublicLayout />,\n    children: [\n      { index: true, element: <HomeWrapper /> },\n      { path: 'tires', element: <ProductList /> },\n      { path: 'wheels', element: <ProductList /> },\n      { path: 'search-results', element: <ProductList /> },\n      { path: 'detailed-search', element: <DetailedSearch /> },\n      {\n        path: 'product/:id',\n        element: (\n          <Suspense fallback={null}>\n            <LazyProductDetail />\n          </Suspense>\n        ),\n      },\n      { path: 'product/:id/comment', element: <CommentsPage /> },\n      { path: 'auth', element: <Auth /> },\n      { path: 'profile', element: <Profile /> },\n      { path: 'checkout', element: <Checkout /> },\n      { path: 'auth/callback', element: <AuthCallback /> },\n      { path: 'articles', element: <KeepAlive><ArticleWindow /></KeepAlive> },\n      { path: 'articles/:id', element: <ArticleDetailPage /> },\n      { path: '*', element: <Navigate to=\"/\" replace /> },\n    ],\n  },\n  {\n    path: '/admin',\n    element: (\n      <AdminRoute>\n        <AdminLayout />\n      </AdminRoute>\n    ),\n    children: [\n      { index: true, element: <Dashboard /> },\n      { path: 'products', element: <Products /> },\n      { path: 'products/new', element: <ProductCreatePage /> },\n      { path: 'products/edit/:id', element: <div>Edit Product Page</div> },\n      { path: 'sessions', element: <SessionsPage /> },\n      { path: 'articles', element: <NewArticle /> },\n    ],\n  },\n  {\n    path: '/admin/login',\n    element: <AdminLogin />,\n  },\n]);\n\n// AutoReload – перезагружает страницу через 30 минут бездействия\nfunction AutoReload() {\n  useEffect(() => {\n    let timer = setTimeout(reloadPage, 30 * 60 * 1000);\n    function reloadPage() {\n      window.location.reload();\n    }\n    const resetTimer = () => {\n      clearTimeout(timer);\n      timer = setTimeout(reloadPage, 30 * 60 * 1000);\n    };\n    const events = ['mousemove', 'keydown', 'scroll', 'touchstart', 'click'];\n    events.forEach((event) => window.addEventListener(event, resetTimer));\n    return () => {\n      clearTimeout(timer);\n      events.forEach((event) => window.removeEventListener(event, resetTimer));\n    };\n  }, []);\n  return null;\n}\n\n// Главный компонент App\nexport default function App() {\n  const [isLoaded, setIsLoaded] = useState(false);\n  const lastActivityRef = useRef<Date>(new Date());\n  const [appState, setAppState] = useState({ someData: 'значение' });\n\n  // Восстановление сохранённого состояния\n  useEffect(() => {\n    const savedState = localStorage.getItem('savedState');\n    if (savedState) {\n      try {\n        const parsedState = JSON.parse(savedState);\n        setAppState(parsedState);\n      } catch (error) {\n        console.error('Ошибка парсинга сохранённого состояния:', error);\n      }\n    }\n  }, []);\n\n  // Ожидание полной загрузки документа\n  useEffect(() => {\n    const handleLoad = () => setIsLoaded(true);\n    if (document.readyState === 'complete') {\n      handleLoad();\n    } else {\n      window.addEventListener('load', handleLoad);\n      return () => window.removeEventListener('load', handleLoad);\n    }\n  }, []);\n\n  // Инициализация гостевой сессии, если пользователь не авторизован\n  const initGuestSession = useCallback(async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n      let storedGuestId = localStorage.getItem('guest_id');\n      if (!storedGuestId) {\n        storedGuestId = crypto.randomUUID();\n        localStorage.setItem('guest_id', storedGuestId);\n        await supabase.from('sessions').upsert(\n          {\n            guest_id: storedGuestId,\n            last_activity: new Date().toISOString(),\n            is_online: true,\n          },\n          { onConflict: 'guest_id' }\n        );\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    initGuestSession();\n  }, [initGuestSession]);\n\n  // Обновление статуса сессии\n  const updateSessionStatus = useCallback(async (isOnline: boolean) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    const currentGuestId = localStorage.getItem('guest_id');\n    const updateData = {\n      last_activity: new Date().toISOString(),\n      is_online: isOnline,\n    };\n    try {\n      if (user) {\n        await supabase.from('sessions').update(updateData).eq('user_id', user.id);\n      } else if (currentGuestId) {\n        await supabase.from('sessions').upsert(\n          { ...updateData, guest_id: currentGuestId },\n          { onConflict: 'guest_id' }\n        );\n      }\n    } catch (error) {\n      console.error('Session update error:', error);\n    }\n  }, []);\n\n  // Обработка активности пользователя с использованием debounce\n  const handleActivity = useCallback(\n    debounce(() => {\n      lastActivityRef.current = new Date();\n      updateSessionStatus(true);\n    }, 5000),\n    [updateSessionStatus]\n  );\n\n  useEffect(() => {\n    const events: (keyof WindowEventMap)[] = ['mousemove', 'keydown', 'scroll', 'touchstart', 'click'];\n    events.forEach((e) => window.addEventListener(e, handleActivity));\n    return () => events.forEach((e) => window.removeEventListener(e, handleActivity));\n  }, [handleActivity]);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = new Date();\n      if (now.getTime() - lastActivityRef.current.getTime() > 25000) {\n        updateSessionStatus(false);\n      }\n    }, 25000);\n    return () => clearInterval(interval);\n  }, [updateSessionStatus]);\n\n  // Сохранение состояния и обновление сессии перед уходом со страницы\n  useEffect(() => {\n    const handleBeforeUnload = () => {\n      updateSessionStatus(false);\n      localStorage.setItem('savedState', JSON.stringify(appState));\n    };\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n      updateSessionStatus(false);\n    };\n  }, [updateSessionStatus, appState]);\n\n  if (!isLoaded) return null;\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AutoReload />\n      {/* AliveScope обеспечивает работу KeepAlive */}\n      <AliveScope>\n        <div data-router>\n          <RouterProvider router={router} />\n        </div>\n      </AliveScope>\n      <ToastContainer\n        position=\"top-right\"\n        autoClose={5000}\n        hideProgressBar={false}\n        newestOnTop={true}\n        closeOnClick\n        rtl={false}\n        pauseOnFocusLoss\n        draggable\n        pauseOnHover\n        theme=\"light\"\n      />\n    </QueryClientProvider>\n  );\n}\n","// src/ErrorBoundary.tsx\nimport React from 'react';\nimport { logError } from './lib/analytics';\n\ninterface ErrorBoundaryProps {\n  children: React.ReactNode;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n}\n\nexport default class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(): ErrorBoundaryState {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo): void {\n    logError(error, 'ErrorBoundary', { \n      componentStack: errorInfo.componentStack,\n      location: typeof window !== 'undefined' ? window.location.pathname : 'server'\n    });\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"p-4 text-center\">\n          <h1 className=\"text-2xl font-bold text-red-600 mb-4\">\n            Упс! Щось пішло не так\n          </h1>\n          <button\n            className=\"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600\"\n            onClick={() => typeof window !== 'undefined' && window.location.reload()}\n          >\n            Спробувати знову\n          </button>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}","import { StrictMode, Suspense } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App';\nimport './index.css';\nimport ErrorBoundary from './ErrorBoundary';\n\n\ncreateRoot(document.getElementById('root')!)\n  .render(\n    <StrictMode>\n      <Suspense fallback={<div className=\"loading-overlay\" />}>\n        <ErrorBoundary>\n          <App />\n        </ErrorBoundary>\n      </Suspense>\n    </StrictMode>\n  );\n"],"file":"assets/index-DL2gia46.js"}